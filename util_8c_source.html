<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ContextLogger2 Logger Daemon Internals: util.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_53e7feede50ae4cb655a635f658a2b4e.html">sqlite3h</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_a0c08fff43b69094a2511677d8587129.html">src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_05c6b5177aad09a72e8ee1adc608dac0.html">sqlite3</a>
  </div>
</div>
<div class="contents">
<h1>util.c</h1><a href="util_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment">** 2001 September 15</span>
<a name="l00003"></a>00003 <span class="comment">**</span>
<a name="l00004"></a>00004 <span class="comment">** The author disclaims copyright to this source code.  In place of</span>
<a name="l00005"></a>00005 <span class="comment">** a legal notice, here is a blessing:</span>
<a name="l00006"></a>00006 <span class="comment">**</span>
<a name="l00007"></a>00007 <span class="comment">**    May you do good and not evil.</span>
<a name="l00008"></a>00008 <span class="comment">**    May you find forgiveness for yourself and forgive others.</span>
<a name="l00009"></a>00009 <span class="comment">**    May you share freely, never taking more than you give.</span>
<a name="l00010"></a>00010 <span class="comment">**</span>
<a name="l00011"></a>00011 <span class="comment">*************************************************************************</span>
<a name="l00012"></a>00012 <span class="comment">** Utility functions used throughout sqlite.</span>
<a name="l00013"></a>00013 <span class="comment">**</span>
<a name="l00014"></a>00014 <span class="comment">** This file contains functions for allocating memory, comparing</span>
<a name="l00015"></a>00015 <span class="comment">** strings, and stuff like that.</span>
<a name="l00016"></a>00016 <span class="comment">**</span>
<a name="l00017"></a>00017 <span class="comment">** $Id: util.c,v 1.241 2008/07/28 19:34:54 drh Exp $</span>
<a name="l00018"></a>00018 <span class="comment">*/</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;<a class="code" href="sqliteInt_8h.html">sqliteInt.h</a>&quot;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &lt;stdarg.h&gt;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &lt;ctype.h&gt;</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="comment">/*</span>
<a name="l00025"></a>00025 <span class="comment">** Return true if the floating point value is Not a Number (NaN).</span>
<a name="l00026"></a>00026 <span class="comment">*/</span>
<a name="l00027"></a><a class="code" href="util_8c.html#ab02e5ca13784a211111278fd62327bdf">00027</a> <span class="keywordtype">int</span> <a class="code" href="sqliteInt_8h.html#a82c2a680007adffbdf6e95315b02477d">sqlite3IsNaN</a>(<span class="keywordtype">double</span> x){
<a name="l00028"></a>00028   <span class="comment">/* This NaN test sometimes fails if compiled on GCC with -ffast-math.</span>
<a name="l00029"></a>00029 <span class="comment">  ** On the other hand, the use of -ffast-math comes with the following</span>
<a name="l00030"></a>00030 <span class="comment">  ** warning:</span>
<a name="l00031"></a>00031 <span class="comment">  **</span>
<a name="l00032"></a>00032 <span class="comment">  **      This option [-ffast-math] should never be turned on by any</span>
<a name="l00033"></a>00033 <span class="comment">  **      -O option since it can result in incorrect output for programs</span>
<a name="l00034"></a>00034 <span class="comment">  **      which depend on an exact implementation of IEEE or ISO </span>
<a name="l00035"></a>00035 <span class="comment">  **      rules/specifications for math functions.</span>
<a name="l00036"></a>00036 <span class="comment">  **</span>
<a name="l00037"></a>00037 <span class="comment">  ** Under MSVC, this NaN test may fail if compiled with a floating-</span>
<a name="l00038"></a>00038 <span class="comment">  ** point precision mode other than /fp:precise.  From the MSDN </span>
<a name="l00039"></a>00039 <span class="comment">  ** documentation:</span>
<a name="l00040"></a>00040 <span class="comment">  **</span>
<a name="l00041"></a>00041 <span class="comment">  **      The compiler [with /fp:precise] will properly handle comparisons </span>
<a name="l00042"></a>00042 <span class="comment">  **      involving NaN. For example, x != x evaluates to true if x is NaN </span>
<a name="l00043"></a>00043 <span class="comment">  **      ...</span>
<a name="l00044"></a>00044 <span class="comment">  */</span>
<a name="l00045"></a>00045 <span class="preprocessor">#ifdef __FAST_MATH__</span>
<a name="l00046"></a>00046 <span class="preprocessor"></span><span class="preprocessor"># error SQLite will not work correctly with the -ffast-math option of GCC.</span>
<a name="l00047"></a>00047 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00048"></a>00048 <span class="preprocessor"></span>  <span class="keyword">volatile</span> <span class="keywordtype">double</span> y = x;
<a name="l00049"></a>00049   <span class="keyword">volatile</span> <span class="keywordtype">double</span> z = y;
<a name="l00050"></a>00050   <span class="keywordflow">return</span> y!=z;
<a name="l00051"></a>00051 }
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 <span class="comment">/*</span>
<a name="l00054"></a>00054 <span class="comment">** Return the length of a string, except do not allow the string length</span>
<a name="l00055"></a>00055 <span class="comment">** to exceed the SQLITE_LIMIT_LENGTH setting.</span>
<a name="l00056"></a>00056 <span class="comment">*/</span>
<a name="l00057"></a><a class="code" href="util_8c.html#a2158b3c5a3af6dd97d8cb63ec3f158ce">00057</a> <span class="keywordtype">int</span> <a class="code" href="sqliteInt_8h.html#a1f558a7b31531929a53e5413cf4e7cbb">sqlite3Strlen</a>(<a class="code" href="structsqlite3.html">sqlite3</a> *<a class="code" href="shell_8c.html#ad6e663497d2c934364b3bcf07496b30b">db</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *z){
<a name="l00058"></a>00058   <span class="keyword">const</span> <span class="keywordtype">char</span> *z2 = z;
<a name="l00059"></a>00059   <span class="keywordtype">int</span> len;
<a name="l00060"></a>00060   <span class="keywordtype">size_t</span> x;
<a name="l00061"></a>00061   <span class="keywordflow">while</span>( *z2 ){ z2++; }
<a name="l00062"></a>00062   x = z2 - z;
<a name="l00063"></a>00063   len = 0x7fffffff &amp; x;
<a name="l00064"></a>00064   <span class="keywordflow">if</span>( len!=x || len &gt; db-&gt;<a class="code" href="structsqlite3.html#ad8acf663e1619905094c9dfe4125157b">aLimit</a>[<a class="code" href="sqlite3_8h.html#aeba56345f14b7febdafaaa4bc3949245">SQLITE_LIMIT_LENGTH</a>] ){
<a name="l00065"></a>00065     <span class="keywordflow">return</span> db-&gt;<a class="code" href="structsqlite3.html#ad8acf663e1619905094c9dfe4125157b">aLimit</a>[<a class="code" href="sqlite3_8h.html#aeba56345f14b7febdafaaa4bc3949245">SQLITE_LIMIT_LENGTH</a>];
<a name="l00066"></a>00066   }<span class="keywordflow">else</span>{
<a name="l00067"></a>00067     <span class="keywordflow">return</span> len;
<a name="l00068"></a>00068   }
<a name="l00069"></a>00069 }
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 <span class="comment">/*</span>
<a name="l00072"></a>00072 <span class="comment">** Set the most recent error code and error string for the sqlite</span>
<a name="l00073"></a>00073 <span class="comment">** handle &quot;db&quot;. The error code is set to &quot;err_code&quot;.</span>
<a name="l00074"></a>00074 <span class="comment">**</span>
<a name="l00075"></a>00075 <span class="comment">** If it is not NULL, string zFormat specifies the format of the</span>
<a name="l00076"></a>00076 <span class="comment">** error string in the style of the printf functions: The following</span>
<a name="l00077"></a>00077 <span class="comment">** format characters are allowed:</span>
<a name="l00078"></a>00078 <span class="comment">**</span>
<a name="l00079"></a>00079 <span class="comment">**      %s      Insert a string</span>
<a name="l00080"></a>00080 <span class="comment">**      %z      A string that should be freed after use</span>
<a name="l00081"></a>00081 <span class="comment">**      %d      Insert an integer</span>
<a name="l00082"></a>00082 <span class="comment">**      %T      Insert a token</span>
<a name="l00083"></a>00083 <span class="comment">**      %S      Insert the first element of a SrcList</span>
<a name="l00084"></a>00084 <span class="comment">**</span>
<a name="l00085"></a>00085 <span class="comment">** zFormat and any string tokens that follow it are assumed to be</span>
<a name="l00086"></a>00086 <span class="comment">** encoded in UTF-8.</span>
<a name="l00087"></a>00087 <span class="comment">**</span>
<a name="l00088"></a>00088 <span class="comment">** To clear the most recent error for sqlite handle &quot;db&quot;, sqlite3Error</span>
<a name="l00089"></a>00089 <span class="comment">** should be called with err_code set to SQLITE_OK and zFormat set</span>
<a name="l00090"></a>00090 <span class="comment">** to NULL.</span>
<a name="l00091"></a>00091 <span class="comment">*/</span>
<a name="l00092"></a><a class="code" href="util_8c.html#a18d7d799d4a54a1b69084234ae53ee39">00092</a> <span class="keywordtype">void</span> <a class="code" href="sqliteInt_8h.html#adf4434e94ac41a2abedd476047d49983">sqlite3Error</a>(<a class="code" href="structsqlite3.html">sqlite3</a> *<a class="code" href="shell_8c.html#ad6e663497d2c934364b3bcf07496b30b">db</a>, <span class="keywordtype">int</span> err_code, <span class="keyword">const</span> <span class="keywordtype">char</span> *zFormat, ...){
<a name="l00093"></a>00093   <span class="keywordflow">if</span>( db &amp;&amp; (db-&gt;<a class="code" href="structsqlite3.html#a90941a0c05641f623c257a7a65b22809">pErr</a> || (db-&gt;<a class="code" href="structsqlite3.html#a90941a0c05641f623c257a7a65b22809">pErr</a> = <a class="code" href="sqliteInt_8h.html#af27aa2e0ce2c74a56328612b342a6d89">sqlite3ValueNew</a>(db))!=0) ){
<a name="l00094"></a>00094     db-&gt;<a class="code" href="structsqlite3.html#a73adbb5395118bcbd9e4d705712966a2">errCode</a> = err_code;
<a name="l00095"></a>00095     <span class="keywordflow">if</span>( zFormat ){
<a name="l00096"></a>00096       <span class="keywordtype">char</span> *z;
<a name="l00097"></a>00097       va_list ap;
<a name="l00098"></a>00098       va_start(ap, zFormat);
<a name="l00099"></a>00099       z = <a class="code" href="printf_8c.html#ac82afc5572767fef2638f3a680d9eaa1">sqlite3VMPrintf</a>(db, zFormat, ap);
<a name="l00100"></a>00100       va_end(ap);
<a name="l00101"></a>00101       <a class="code" href="sqliteInt_8h.html#abfaa7933ed60fe6211fe0f32022d89ca">sqlite3ValueSetStr</a>(db-&gt;<a class="code" href="structsqlite3.html#a90941a0c05641f623c257a7a65b22809">pErr</a>, -1, z, <a class="code" href="sqlite3_8h.html#a7a65f15cad0da22be8ebc0c70f526d32">SQLITE_UTF8</a>, <a class="code" href="sqliteInt_8h.html#a1c44dfe35a125f6778580d200c11c416">SQLITE_DYNAMIC</a>);
<a name="l00102"></a>00102     }<span class="keywordflow">else</span>{
<a name="l00103"></a>00103       <a class="code" href="sqliteInt_8h.html#abfaa7933ed60fe6211fe0f32022d89ca">sqlite3ValueSetStr</a>(db-&gt;<a class="code" href="structsqlite3.html#a90941a0c05641f623c257a7a65b22809">pErr</a>, 0, 0, <a class="code" href="sqlite3_8h.html#a7a65f15cad0da22be8ebc0c70f526d32">SQLITE_UTF8</a>, <a class="code" href="sqlite3_8h.html#a98b49797a7a15e2a570532fc2b5537c8">SQLITE_STATIC</a>);
<a name="l00104"></a>00104     }
<a name="l00105"></a>00105   }
<a name="l00106"></a>00106 }
<a name="l00107"></a>00107 
<a name="l00108"></a>00108 <span class="comment">/*</span>
<a name="l00109"></a>00109 <span class="comment">** Add an error message to pParse-&gt;zErrMsg and increment pParse-&gt;nErr.</span>
<a name="l00110"></a>00110 <span class="comment">** The following formatting characters are allowed:</span>
<a name="l00111"></a>00111 <span class="comment">**</span>
<a name="l00112"></a>00112 <span class="comment">**      %s      Insert a string</span>
<a name="l00113"></a>00113 <span class="comment">**      %z      A string that should be freed after use</span>
<a name="l00114"></a>00114 <span class="comment">**      %d      Insert an integer</span>
<a name="l00115"></a>00115 <span class="comment">**      %T      Insert a token</span>
<a name="l00116"></a>00116 <span class="comment">**      %S      Insert the first element of a SrcList</span>
<a name="l00117"></a>00117 <span class="comment">**</span>
<a name="l00118"></a>00118 <span class="comment">** This function should be used to report any error that occurs whilst</span>
<a name="l00119"></a>00119 <span class="comment">** compiling an SQL statement (i.e. within sqlite3_prepare()). The</span>
<a name="l00120"></a>00120 <span class="comment">** last thing the sqlite3_prepare() function does is copy the error</span>
<a name="l00121"></a>00121 <span class="comment">** stored by this function into the database handle using sqlite3Error().</span>
<a name="l00122"></a>00122 <span class="comment">** Function sqlite3Error() should be used during statement execution</span>
<a name="l00123"></a>00123 <span class="comment">** (sqlite3_step() etc.).</span>
<a name="l00124"></a>00124 <span class="comment">*/</span>
<a name="l00125"></a><a class="code" href="util_8c.html#a7ca13835a8aaef30f13b0e4f73142c5e">00125</a> <span class="keywordtype">void</span> <a class="code" href="sqliteInt_8h.html#af5069bb768199c3dab949999e7e6e19c">sqlite3ErrorMsg</a>(<a class="code" href="structParse.html">Parse</a> *pParse, <span class="keyword">const</span> <span class="keywordtype">char</span> *zFormat, ...){
<a name="l00126"></a>00126   va_list ap;
<a name="l00127"></a>00127   <a class="code" href="structsqlite3.html">sqlite3</a> *<a class="code" href="shell_8c.html#ad6e663497d2c934364b3bcf07496b30b">db</a> = pParse-&gt;<a class="code" href="structParse.html#a44364e5e1197927f89864ec345bc5491">db</a>;
<a name="l00128"></a>00128   pParse-&gt;<a class="code" href="structParse.html#ac7206f0c7e580ab32b7dfb20950bb1c9">nErr</a>++;
<a name="l00129"></a>00129   <a class="code" href="malloc_8c.html#a8ca215f2395ca90fd180460afb2eba9d">sqlite3DbFree</a>(db, pParse-&gt;<a class="code" href="structParse.html#a04146757986ff4654c7b321654896e81">zErrMsg</a>);
<a name="l00130"></a>00130   va_start(ap, zFormat);
<a name="l00131"></a>00131   pParse-&gt;<a class="code" href="structParse.html#a04146757986ff4654c7b321654896e81">zErrMsg</a> = <a class="code" href="printf_8c.html#ac82afc5572767fef2638f3a680d9eaa1">sqlite3VMPrintf</a>(db, zFormat, ap);
<a name="l00132"></a>00132   va_end(ap);
<a name="l00133"></a>00133   <span class="keywordflow">if</span>( pParse-&gt;<a class="code" href="structParse.html#a897c2ea40a1065d49a134f18ca251637">rc</a>==<a class="code" href="sqlite3_8h.html#a650d09c7bec7ddadb7c8aa3519dc842c">SQLITE_OK</a> ){
<a name="l00134"></a>00134     pParse-&gt;<a class="code" href="structParse.html#a897c2ea40a1065d49a134f18ca251637">rc</a> = <a class="code" href="sqlite3_8h.html#afda25cd6575e87558d2b7cd4a6585f2f">SQLITE_ERROR</a>;
<a name="l00135"></a>00135   }
<a name="l00136"></a>00136 }
<a name="l00137"></a>00137 
<a name="l00138"></a>00138 <span class="comment">/*</span>
<a name="l00139"></a>00139 <span class="comment">** Clear the error message in pParse, if any</span>
<a name="l00140"></a>00140 <span class="comment">*/</span>
<a name="l00141"></a><a class="code" href="util_8c.html#a87d642194a4b7ef07329939c1960df98">00141</a> <span class="keywordtype">void</span> <a class="code" href="sqliteInt_8h.html#adefec0a5695945b931b323dec7fcd22d">sqlite3ErrorClear</a>(<a class="code" href="structParse.html">Parse</a> *pParse){
<a name="l00142"></a>00142   <a class="code" href="malloc_8c.html#a8ca215f2395ca90fd180460afb2eba9d">sqlite3DbFree</a>(pParse-&gt;<a class="code" href="structParse.html#a44364e5e1197927f89864ec345bc5491">db</a>, pParse-&gt;<a class="code" href="structParse.html#a04146757986ff4654c7b321654896e81">zErrMsg</a>);
<a name="l00143"></a>00143   pParse-&gt;<a class="code" href="structParse.html#a04146757986ff4654c7b321654896e81">zErrMsg</a> = 0;
<a name="l00144"></a>00144   pParse-&gt;<a class="code" href="structParse.html#ac7206f0c7e580ab32b7dfb20950bb1c9">nErr</a> = 0;
<a name="l00145"></a>00145 }
<a name="l00146"></a>00146 
<a name="l00147"></a>00147 <span class="comment">/*</span>
<a name="l00148"></a>00148 <span class="comment">** Convert an SQL-style quoted string into a normal string by removing</span>
<a name="l00149"></a>00149 <span class="comment">** the quote characters.  The conversion is done in-place.  If the</span>
<a name="l00150"></a>00150 <span class="comment">** input does not begin with a quote character, then this routine</span>
<a name="l00151"></a>00151 <span class="comment">** is a no-op.</span>
<a name="l00152"></a>00152 <span class="comment">**</span>
<a name="l00153"></a>00153 <span class="comment">** 2002-Feb-14: This routine is extended to remove MS-Access style</span>
<a name="l00154"></a>00154 <span class="comment">** brackets from around identifers.  For example:  &quot;[a-b-c]&quot; becomes</span>
<a name="l00155"></a>00155 <span class="comment">** &quot;a-b-c&quot;.</span>
<a name="l00156"></a>00156 <span class="comment">*/</span>
<a name="l00157"></a><a class="code" href="util_8c.html#a2f4d1df1e41369ca2205bb078a159306">00157</a> <span class="keywordtype">void</span> <a class="code" href="sqliteInt_8h.html#aae913109bd651a86625a0cf190a71be6">sqlite3Dequote</a>(<span class="keywordtype">char</span> *z){
<a name="l00158"></a>00158   <span class="keywordtype">int</span> quote;
<a name="l00159"></a>00159   <span class="keywordtype">int</span> i, j;
<a name="l00160"></a>00160   <span class="keywordflow">if</span>( z==0 ) <span class="keywordflow">return</span>;
<a name="l00161"></a>00161   quote = z[0];
<a name="l00162"></a>00162   <span class="keywordflow">switch</span>( quote ){
<a name="l00163"></a>00163     <span class="keywordflow">case</span> <span class="charliteral">&apos;\&apos;&apos;</span>:  <span class="keywordflow">break</span>;
<a name="l00164"></a>00164     <span class="keywordflow">case</span> <span class="charliteral">&apos;&quot;&apos;</span>:   <span class="keywordflow">break</span>;
<a name="l00165"></a>00165     <span class="keywordflow">case</span> <span class="charliteral">&apos;`&apos;</span>:   <span class="keywordflow">break</span>;                <span class="comment">/* For MySQL compatibility */</span>
<a name="l00166"></a>00166     <span class="keywordflow">case</span> <span class="charliteral">&apos;[&apos;</span>:   quote = <span class="charliteral">&apos;]&apos;</span>;  <span class="keywordflow">break</span>;  <span class="comment">/* For MS SqlServer compatibility */</span>
<a name="l00167"></a>00167     <span class="keywordflow">default</span>:    <span class="keywordflow">return</span>;
<a name="l00168"></a>00168   }
<a name="l00169"></a>00169   <span class="keywordflow">for</span>(i=1, j=0; z[i]; i++){
<a name="l00170"></a>00170     <span class="keywordflow">if</span>( z[i]==quote ){
<a name="l00171"></a>00171       <span class="keywordflow">if</span>( z[i+1]==quote ){
<a name="l00172"></a>00172         z[j++] = quote;
<a name="l00173"></a>00173         i++;
<a name="l00174"></a>00174       }<span class="keywordflow">else</span>{
<a name="l00175"></a>00175         z[j++] = 0;
<a name="l00176"></a>00176         <span class="keywordflow">break</span>;
<a name="l00177"></a>00177       }
<a name="l00178"></a>00178     }<span class="keywordflow">else</span>{
<a name="l00179"></a>00179       z[j++] = z[i];
<a name="l00180"></a>00180     }
<a name="l00181"></a>00181   }
<a name="l00182"></a>00182 }
<a name="l00183"></a>00183 
<a name="l00184"></a>00184 <span class="comment">/* Convenient short-hand */</span>
<a name="l00185"></a><a class="code" href="util_8c.html#aad84227f921d88a5adf7a2f5a9047426">00185</a> <span class="preprocessor">#define UpperToLower sqlite3UpperToLower</span>
<a name="l00186"></a>00186 <span class="preprocessor"></span>
<a name="l00187"></a>00187 <span class="comment">/*</span>
<a name="l00188"></a>00188 <span class="comment">** Some systems have stricmp().  Others have strcasecmp().  Because</span>
<a name="l00189"></a>00189 <span class="comment">** there is no consistency, we will define our own.</span>
<a name="l00190"></a>00190 <span class="comment">*/</span>
<a name="l00191"></a><a class="code" href="util_8c.html#a2ebfe017dc61c5f893f805871adbe3f4">00191</a> <span class="keywordtype">int</span> <a class="code" href="sqliteInt_8h.html#ae3fd8e3be3ee260b4be7afe7b9d23406">sqlite3StrICmp</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *zLeft, <span class="keyword">const</span> <span class="keywordtype">char</span> *zRight){
<a name="l00192"></a>00192   <span class="keyword">register</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *a, *b;
<a name="l00193"></a>00193   a = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)zLeft;
<a name="l00194"></a>00194   b = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)zRight;
<a name="l00195"></a>00195   <span class="keywordflow">while</span>( *a!=0 &amp;&amp; <a class="code" href="util_8c.html#aad84227f921d88a5adf7a2f5a9047426">UpperToLower</a>[*a]==<a class="code" href="util_8c.html#aad84227f921d88a5adf7a2f5a9047426">UpperToLower</a>[*b]){ a++; b++; }
<a name="l00196"></a>00196   <span class="keywordflow">return</span> <a class="code" href="util_8c.html#aad84227f921d88a5adf7a2f5a9047426">UpperToLower</a>[*a] - <a class="code" href="util_8c.html#aad84227f921d88a5adf7a2f5a9047426">UpperToLower</a>[*b];
<a name="l00197"></a>00197 }
<a name="l00198"></a><a class="code" href="util_8c.html#a5c4fba1038f165e445c271028fa3c855">00198</a> <span class="keywordtype">int</span> <a class="code" href="sqliteInt_8h.html#acd3b8a2e2ada99c161975ac30cb50877">sqlite3StrNICmp</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *zLeft, <span class="keyword">const</span> <span class="keywordtype">char</span> *zRight, <span class="keywordtype">int</span> N){
<a name="l00199"></a>00199   <span class="keyword">register</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *a, *b;
<a name="l00200"></a>00200   a = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)zLeft;
<a name="l00201"></a>00201   b = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)zRight;
<a name="l00202"></a>00202   <span class="keywordflow">while</span>( N-- &gt; 0 &amp;&amp; *a!=0 &amp;&amp; <a class="code" href="util_8c.html#aad84227f921d88a5adf7a2f5a9047426">UpperToLower</a>[*a]==<a class="code" href="util_8c.html#aad84227f921d88a5adf7a2f5a9047426">UpperToLower</a>[*b]){ a++; b++; }
<a name="l00203"></a>00203   <span class="keywordflow">return</span> N&lt;0 ? 0 : <a class="code" href="util_8c.html#aad84227f921d88a5adf7a2f5a9047426">UpperToLower</a>[*a] - <a class="code" href="util_8c.html#aad84227f921d88a5adf7a2f5a9047426">UpperToLower</a>[*b];
<a name="l00204"></a>00204 }
<a name="l00205"></a>00205 
<a name="l00206"></a>00206 <span class="comment">/*</span>
<a name="l00207"></a>00207 <span class="comment">** Return TRUE if z is a pure numeric string.  Return FALSE if the</span>
<a name="l00208"></a>00208 <span class="comment">** string contains any character which is not part of a number. If</span>
<a name="l00209"></a>00209 <span class="comment">** the string is numeric and contains the &apos;.&apos; character, set *realnum</span>
<a name="l00210"></a>00210 <span class="comment">** to TRUE (otherwise FALSE).</span>
<a name="l00211"></a>00211 <span class="comment">**</span>
<a name="l00212"></a>00212 <span class="comment">** An empty string is considered non-numeric.</span>
<a name="l00213"></a>00213 <span class="comment">*/</span>
<a name="l00214"></a><a class="code" href="util_8c.html#a3af6bcdf8e852d04a61f599759b1360b">00214</a> <span class="keywordtype">int</span> <a class="code" href="sqliteInt_8h.html#ab7937a8daf7159354d0ea24679605924">sqlite3IsNumber</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *z, <span class="keywordtype">int</span> *realnum, <a class="code" href="sqliteInt_8h.html#a74a0f6424ae628af25f23f0a35f6ead3">u8</a> enc){
<a name="l00215"></a>00215   <span class="keywordtype">int</span> incr = (enc==<a class="code" href="sqlite3_8h.html#a7a65f15cad0da22be8ebc0c70f526d32">SQLITE_UTF8</a>?1:2);
<a name="l00216"></a>00216   <span class="keywordflow">if</span>( enc==<a class="code" href="sqlite3_8h.html#a6bb1ede657a9f5642ae25a95e6cd31d5">SQLITE_UTF16BE</a> ) z++;
<a name="l00217"></a>00217   <span class="keywordflow">if</span>( *z==<span class="charliteral">&apos;-&apos;</span> || *z==<span class="charliteral">&apos;+&apos;</span> ) z += incr;
<a name="l00218"></a>00218   <span class="keywordflow">if</span>( !isdigit(*(<a class="code" href="sqliteInt_8h.html#a74a0f6424ae628af25f23f0a35f6ead3">u8</a>*)z) ){
<a name="l00219"></a>00219     <span class="keywordflow">return</span> 0;
<a name="l00220"></a>00220   }
<a name="l00221"></a>00221   z += incr;
<a name="l00222"></a>00222   <span class="keywordflow">if</span>( realnum ) *realnum = 0;
<a name="l00223"></a>00223   <span class="keywordflow">while</span>( isdigit(*(<a class="code" href="sqliteInt_8h.html#a74a0f6424ae628af25f23f0a35f6ead3">u8</a>*)z) ){ z += incr; }
<a name="l00224"></a>00224   <span class="keywordflow">if</span>( *z==<span class="charliteral">&apos;.&apos;</span> ){
<a name="l00225"></a>00225     z += incr;
<a name="l00226"></a>00226     <span class="keywordflow">if</span>( !isdigit(*(<a class="code" href="sqliteInt_8h.html#a74a0f6424ae628af25f23f0a35f6ead3">u8</a>*)z) ) <span class="keywordflow">return</span> 0;
<a name="l00227"></a>00227     <span class="keywordflow">while</span>( isdigit(*(<a class="code" href="sqliteInt_8h.html#a74a0f6424ae628af25f23f0a35f6ead3">u8</a>*)z) ){ z += incr; }
<a name="l00228"></a>00228     <span class="keywordflow">if</span>( realnum ) *realnum = 1;
<a name="l00229"></a>00229   }
<a name="l00230"></a>00230   <span class="keywordflow">if</span>( *z==<span class="charliteral">&apos;e&apos;</span> || *z==<span class="charliteral">&apos;E&apos;</span> ){
<a name="l00231"></a>00231     z += incr;
<a name="l00232"></a>00232     <span class="keywordflow">if</span>( *z==<span class="charliteral">&apos;+&apos;</span> || *z==<span class="charliteral">&apos;-&apos;</span> ) z += incr;
<a name="l00233"></a>00233     <span class="keywordflow">if</span>( !isdigit(*(<a class="code" href="sqliteInt_8h.html#a74a0f6424ae628af25f23f0a35f6ead3">u8</a>*)z) ) <span class="keywordflow">return</span> 0;
<a name="l00234"></a>00234     <span class="keywordflow">while</span>( isdigit(*(<a class="code" href="sqliteInt_8h.html#a74a0f6424ae628af25f23f0a35f6ead3">u8</a>*)z) ){ z += incr; }
<a name="l00235"></a>00235     <span class="keywordflow">if</span>( realnum ) *realnum = 1;
<a name="l00236"></a>00236   }
<a name="l00237"></a>00237   <span class="keywordflow">return</span> *z==0;
<a name="l00238"></a>00238 }
<a name="l00239"></a>00239 
<a name="l00240"></a>00240 <span class="comment">/*</span>
<a name="l00241"></a>00241 <span class="comment">** The string z[] is an ascii representation of a real number.</span>
<a name="l00242"></a>00242 <span class="comment">** Convert this string to a double.</span>
<a name="l00243"></a>00243 <span class="comment">**</span>
<a name="l00244"></a>00244 <span class="comment">** This routine assumes that z[] really is a valid number.  If it</span>
<a name="l00245"></a>00245 <span class="comment">** is not, the result is undefined.</span>
<a name="l00246"></a>00246 <span class="comment">**</span>
<a name="l00247"></a>00247 <span class="comment">** This routine is used instead of the library atof() function because</span>
<a name="l00248"></a>00248 <span class="comment">** the library atof() might want to use &quot;,&quot; as the decimal point instead</span>
<a name="l00249"></a>00249 <span class="comment">** of &quot;.&quot; depending on how locale is set.  But that would cause problems</span>
<a name="l00250"></a>00250 <span class="comment">** for SQL.  So this routine always uses &quot;.&quot; regardless of locale.</span>
<a name="l00251"></a>00251 <span class="comment">*/</span>
<a name="l00252"></a><a class="code" href="util_8c.html#a634d4b4f00250a7be413ecdc95dacf78">00252</a> <span class="keywordtype">int</span> <a class="code" href="sqliteInt_8h.html#a5b7be55b6cc84fe900003291372b2311">sqlite3AtoF</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *z, <span class="keywordtype">double</span> *pResult){
<a name="l00253"></a>00253 <span class="preprocessor">#ifndef SQLITE_OMIT_FLOATING_POINT</span>
<a name="l00254"></a>00254 <span class="preprocessor"></span>  <span class="keywordtype">int</span> sign = 1;
<a name="l00255"></a>00255   <span class="keyword">const</span> <span class="keywordtype">char</span> *zBegin = z;
<a name="l00256"></a>00256   <a class="code" href="sqliteInt_8h.html#ab25a928f2f5c8aae9df8280d29d55b51">LONGDOUBLE_TYPE</a> v1 = 0.0;
<a name="l00257"></a>00257   <span class="keywordtype">int</span> nSignificant = 0;
<a name="l00258"></a>00258   <span class="keywordflow">while</span>( isspace(*(<a class="code" href="sqliteInt_8h.html#a74a0f6424ae628af25f23f0a35f6ead3">u8</a>*)z) ) z++;
<a name="l00259"></a>00259   <span class="keywordflow">if</span>( *z==<span class="charliteral">&apos;-&apos;</span> ){
<a name="l00260"></a>00260     sign = -1;
<a name="l00261"></a>00261     z++;
<a name="l00262"></a>00262   }<span class="keywordflow">else</span> <span class="keywordflow">if</span>( *z==<span class="charliteral">&apos;+&apos;</span> ){
<a name="l00263"></a>00263     z++;
<a name="l00264"></a>00264   }
<a name="l00265"></a>00265   <span class="keywordflow">while</span>( z[0]==<span class="charliteral">&apos;0&apos;</span> ){
<a name="l00266"></a>00266     z++;
<a name="l00267"></a>00267   }
<a name="l00268"></a>00268   <span class="keywordflow">while</span>( isdigit(*(<a class="code" href="sqliteInt_8h.html#a74a0f6424ae628af25f23f0a35f6ead3">u8</a>*)z) ){
<a name="l00269"></a>00269     v1 = v1*10.0 + (*z - <span class="charliteral">&apos;0&apos;</span>);
<a name="l00270"></a>00270     z++;
<a name="l00271"></a>00271     nSignificant++;
<a name="l00272"></a>00272   }
<a name="l00273"></a>00273   <span class="keywordflow">if</span>( *z==<span class="charliteral">&apos;.&apos;</span> ){
<a name="l00274"></a>00274     <a class="code" href="sqliteInt_8h.html#ab25a928f2f5c8aae9df8280d29d55b51">LONGDOUBLE_TYPE</a> divisor = 1.0;
<a name="l00275"></a>00275     z++;
<a name="l00276"></a>00276     <span class="keywordflow">if</span>( nSignificant==0 ){
<a name="l00277"></a>00277       <span class="keywordflow">while</span>( z[0]==<span class="charliteral">&apos;0&apos;</span> ){
<a name="l00278"></a>00278         divisor *= 10.0;
<a name="l00279"></a>00279         z++;
<a name="l00280"></a>00280       }
<a name="l00281"></a>00281     }
<a name="l00282"></a>00282     <span class="keywordflow">while</span>( isdigit(*(<a class="code" href="sqliteInt_8h.html#a74a0f6424ae628af25f23f0a35f6ead3">u8</a>*)z) ){
<a name="l00283"></a>00283       <span class="keywordflow">if</span>( nSignificant&lt;18 ){
<a name="l00284"></a>00284         v1 = v1*10.0 + (*z - <span class="charliteral">&apos;0&apos;</span>);
<a name="l00285"></a>00285         divisor *= 10.0;
<a name="l00286"></a>00286         nSignificant++;
<a name="l00287"></a>00287       }
<a name="l00288"></a>00288       z++;
<a name="l00289"></a>00289     }
<a name="l00290"></a>00290     v1 /= divisor;
<a name="l00291"></a>00291   }
<a name="l00292"></a>00292   <span class="keywordflow">if</span>( *z==<span class="charliteral">&apos;e&apos;</span> || *z==<span class="charliteral">&apos;E&apos;</span> ){
<a name="l00293"></a>00293     <span class="keywordtype">int</span> esign = 1;
<a name="l00294"></a>00294     <span class="keywordtype">int</span> eval = 0;
<a name="l00295"></a>00295     <a class="code" href="sqliteInt_8h.html#ab25a928f2f5c8aae9df8280d29d55b51">LONGDOUBLE_TYPE</a> scale = 1.0;
<a name="l00296"></a>00296     z++;
<a name="l00297"></a>00297     <span class="keywordflow">if</span>( *z==<span class="charliteral">&apos;-&apos;</span> ){
<a name="l00298"></a>00298       esign = -1;
<a name="l00299"></a>00299       z++;
<a name="l00300"></a>00300     }<span class="keywordflow">else</span> <span class="keywordflow">if</span>( *z==<span class="charliteral">&apos;+&apos;</span> ){
<a name="l00301"></a>00301       z++;
<a name="l00302"></a>00302     }
<a name="l00303"></a>00303     <span class="keywordflow">while</span>( isdigit(*(<a class="code" href="sqliteInt_8h.html#a74a0f6424ae628af25f23f0a35f6ead3">u8</a>*)z) ){
<a name="l00304"></a>00304       eval = eval*10 + *z - <span class="charliteral">&apos;0&apos;</span>;
<a name="l00305"></a>00305       z++;
<a name="l00306"></a>00306     }
<a name="l00307"></a>00307     <span class="keywordflow">while</span>( eval&gt;=64 ){ scale *= 1.0e+64; eval -= 64; }
<a name="l00308"></a>00308     <span class="keywordflow">while</span>( eval&gt;=16 ){ scale *= 1.0e+16; eval -= 16; }
<a name="l00309"></a>00309     <span class="keywordflow">while</span>( eval&gt;=4 ){ scale *= 1.0e+4; eval -= 4; }
<a name="l00310"></a>00310     <span class="keywordflow">while</span>( eval&gt;=1 ){ scale *= 1.0e+1; eval -= 1; }
<a name="l00311"></a>00311     <span class="keywordflow">if</span>( esign&lt;0 ){
<a name="l00312"></a>00312       v1 /= scale;
<a name="l00313"></a>00313     }<span class="keywordflow">else</span>{
<a name="l00314"></a>00314       v1 *= scale;
<a name="l00315"></a>00315     }
<a name="l00316"></a>00316   }
<a name="l00317"></a>00317   *pResult = sign&lt;0 ? -v1 : v1;
<a name="l00318"></a>00318   <span class="keywordflow">return</span> z - zBegin;
<a name="l00319"></a>00319 <span class="preprocessor">#else</span>
<a name="l00320"></a>00320 <span class="preprocessor"></span>  <span class="keywordflow">return</span> <a class="code" href="sqliteInt_8h.html#ad1b21ea73071f002b389388afb02b09f">sqlite3Atoi64</a>(z, pResult);
<a name="l00321"></a>00321 <span class="preprocessor">#endif </span><span class="comment">/* SQLITE_OMIT_FLOATING_POINT */</span>
<a name="l00322"></a>00322 }
<a name="l00323"></a>00323 
<a name="l00324"></a>00324 <span class="comment">/*</span>
<a name="l00325"></a>00325 <span class="comment">** Compare the 19-character string zNum against the text representation</span>
<a name="l00326"></a>00326 <span class="comment">** value 2^63:  9223372036854775808.  Return negative, zero, or positive</span>
<a name="l00327"></a>00327 <span class="comment">** if zNum is less than, equal to, or greater than the string.</span>
<a name="l00328"></a>00328 <span class="comment">**</span>
<a name="l00329"></a>00329 <span class="comment">** Unlike memcmp() this routine is guaranteed to return the difference</span>
<a name="l00330"></a>00330 <span class="comment">** in the values of the last digit if the only difference is in the</span>
<a name="l00331"></a>00331 <span class="comment">** last digit.  So, for example,</span>
<a name="l00332"></a>00332 <span class="comment">**</span>
<a name="l00333"></a>00333 <span class="comment">**      compare2pow63(&quot;9223372036854775800&quot;)</span>
<a name="l00334"></a>00334 <span class="comment">**</span>
<a name="l00335"></a>00335 <span class="comment">** will return -8.</span>
<a name="l00336"></a>00336 <span class="comment">*/</span>
<a name="l00337"></a><a class="code" href="util_8c.html#a7c59757893bf2b5724087b4768105a6a">00337</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="util_8c.html#a7c59757893bf2b5724087b4768105a6a">compare2pow63</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *zNum){
<a name="l00338"></a>00338   <span class="keywordtype">int</span> c;
<a name="l00339"></a>00339   c = memcmp(zNum,<span class="stringliteral">&quot;922337203685477580&quot;</span>,18);
<a name="l00340"></a>00340   <span class="keywordflow">if</span>( c==0 ){
<a name="l00341"></a>00341     c = zNum[18] - <span class="charliteral">&apos;8&apos;</span>;
<a name="l00342"></a>00342   }
<a name="l00343"></a>00343   <span class="keywordflow">return</span> c;
<a name="l00344"></a>00344 }
<a name="l00345"></a>00345 
<a name="l00346"></a>00346 
<a name="l00347"></a>00347 <span class="comment">/*</span>
<a name="l00348"></a>00348 <span class="comment">** Return TRUE if zNum is a 64-bit signed integer and write</span>
<a name="l00349"></a>00349 <span class="comment">** the value of the integer into *pNum.  If zNum is not an integer</span>
<a name="l00350"></a>00350 <span class="comment">** or is an integer that is too large to be expressed with 64 bits,</span>
<a name="l00351"></a>00351 <span class="comment">** then return false.</span>
<a name="l00352"></a>00352 <span class="comment">**</span>
<a name="l00353"></a>00353 <span class="comment">** When this routine was originally written it dealt with only</span>
<a name="l00354"></a>00354 <span class="comment">** 32-bit numbers.  At that time, it was much faster than the</span>
<a name="l00355"></a>00355 <span class="comment">** atoi() library routine in RedHat 7.2.</span>
<a name="l00356"></a>00356 <span class="comment">*/</span>
<a name="l00357"></a><a class="code" href="util_8c.html#ae10efe5c78bb80436aa87f8047a7c74e">00357</a> <span class="keywordtype">int</span> <a class="code" href="sqliteInt_8h.html#ad1b21ea73071f002b389388afb02b09f">sqlite3Atoi64</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *zNum, <a class="code" href="sqliteInt_8h.html#a2a0f0f4ae7001eb54351f77ea1cdbcfd">i64</a> *pNum){
<a name="l00358"></a>00358   <a class="code" href="sqliteInt_8h.html#a2a0f0f4ae7001eb54351f77ea1cdbcfd">i64</a> v = 0;
<a name="l00359"></a>00359   <span class="keywordtype">int</span> neg;
<a name="l00360"></a>00360   <span class="keywordtype">int</span> i, c;
<a name="l00361"></a>00361   <span class="keyword">const</span> <span class="keywordtype">char</span> *zStart;
<a name="l00362"></a>00362   <span class="keywordflow">while</span>( isspace(*(<a class="code" href="sqliteInt_8h.html#a74a0f6424ae628af25f23f0a35f6ead3">u8</a>*)zNum) ) zNum++;
<a name="l00363"></a>00363   <span class="keywordflow">if</span>( *zNum==<span class="charliteral">&apos;-&apos;</span> ){
<a name="l00364"></a>00364     neg = 1;
<a name="l00365"></a>00365     zNum++;
<a name="l00366"></a>00366   }<span class="keywordflow">else</span> <span class="keywordflow">if</span>( *zNum==<span class="charliteral">&apos;+&apos;</span> ){
<a name="l00367"></a>00367     neg = 0;
<a name="l00368"></a>00368     zNum++;
<a name="l00369"></a>00369   }<span class="keywordflow">else</span>{
<a name="l00370"></a>00370     neg = 0;
<a name="l00371"></a>00371   }
<a name="l00372"></a>00372   zStart = zNum;
<a name="l00373"></a>00373   <span class="keywordflow">while</span>( zNum[0]==<span class="charliteral">&apos;0&apos;</span> ){ zNum++; } <span class="comment">/* Skip over leading zeros. Ticket #2454 */</span>
<a name="l00374"></a>00374   <span class="keywordflow">for</span>(i=0; (c=zNum[i])&gt;=<span class="charliteral">&apos;0&apos;</span> &amp;&amp; c&lt;=<span class="charliteral">&apos;9&apos;</span>; i++){
<a name="l00375"></a>00375     v = v*10 + c - <span class="charliteral">&apos;0&apos;</span>;
<a name="l00376"></a>00376   }
<a name="l00377"></a>00377   *pNum = neg ? -v : v;
<a name="l00378"></a>00378   <span class="keywordflow">if</span>( c!=0 || (i==0 &amp;&amp; zStart==zNum) || i&gt;19 ){
<a name="l00379"></a>00379     <span class="comment">/* zNum is empty or contains non-numeric text or is longer</span>
<a name="l00380"></a>00380 <span class="comment">    ** than 19 digits (thus guaranting that it is too large) */</span>
<a name="l00381"></a>00381     <span class="keywordflow">return</span> 0;
<a name="l00382"></a>00382   }<span class="keywordflow">else</span> <span class="keywordflow">if</span>( i&lt;19 ){
<a name="l00383"></a>00383     <span class="comment">/* Less than 19 digits, so we know that it fits in 64 bits */</span>
<a name="l00384"></a>00384     <span class="keywordflow">return</span> 1;
<a name="l00385"></a>00385   }<span class="keywordflow">else</span>{
<a name="l00386"></a>00386     <span class="comment">/* 19-digit numbers must be no larger than 9223372036854775807 if positive</span>
<a name="l00387"></a>00387 <span class="comment">    ** or 9223372036854775808 if negative.  Note that 9223372036854665808</span>
<a name="l00388"></a>00388 <span class="comment">    ** is 2^63. */</span>
<a name="l00389"></a>00389     <span class="keywordflow">return</span> <a class="code" href="util_8c.html#a7c59757893bf2b5724087b4768105a6a">compare2pow63</a>(zNum)&lt;neg;
<a name="l00390"></a>00390   }
<a name="l00391"></a>00391 }
<a name="l00392"></a>00392 
<a name="l00393"></a>00393 <span class="comment">/*</span>
<a name="l00394"></a>00394 <span class="comment">** The string zNum represents an integer.  There might be some other</span>
<a name="l00395"></a>00395 <span class="comment">** information following the integer too, but that part is ignored.</span>
<a name="l00396"></a>00396 <span class="comment">** If the integer that the prefix of zNum represents will fit in a</span>
<a name="l00397"></a>00397 <span class="comment">** 64-bit signed integer, return TRUE.  Otherwise return FALSE.</span>
<a name="l00398"></a>00398 <span class="comment">**</span>
<a name="l00399"></a>00399 <span class="comment">** This routine returns FALSE for the string -9223372036854775808 even that</span>
<a name="l00400"></a>00400 <span class="comment">** that number will, in theory fit in a 64-bit integer.  Positive</span>
<a name="l00401"></a>00401 <span class="comment">** 9223373036854775808 will not fit in 64 bits.  So it seems safer to return</span>
<a name="l00402"></a>00402 <span class="comment">** false.</span>
<a name="l00403"></a>00403 <span class="comment">*/</span>
<a name="l00404"></a><a class="code" href="util_8c.html#a090cf3ce32599dc547b2c44127f9a91a">00404</a> <span class="keywordtype">int</span> <a class="code" href="sqliteInt_8h.html#aa3410f8e765792247c0e5694d26582f9">sqlite3FitsIn64Bits</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *zNum, <span class="keywordtype">int</span> negFlag){
<a name="l00405"></a>00405   <span class="keywordtype">int</span> i, c;
<a name="l00406"></a>00406   <span class="keywordtype">int</span> neg = 0;
<a name="l00407"></a>00407   <span class="keywordflow">if</span>( *zNum==<span class="charliteral">&apos;-&apos;</span> ){
<a name="l00408"></a>00408     neg = 1;
<a name="l00409"></a>00409     zNum++;
<a name="l00410"></a>00410   }<span class="keywordflow">else</span> <span class="keywordflow">if</span>( *zNum==<span class="charliteral">&apos;+&apos;</span> ){
<a name="l00411"></a>00411     zNum++;
<a name="l00412"></a>00412   }
<a name="l00413"></a>00413   <span class="keywordflow">if</span>( negFlag ) neg = 1-neg;
<a name="l00414"></a>00414   <span class="keywordflow">while</span>( *zNum==<span class="charliteral">&apos;0&apos;</span> ){
<a name="l00415"></a>00415     zNum++;   <span class="comment">/* Skip leading zeros.  Ticket #2454 */</span>
<a name="l00416"></a>00416   }
<a name="l00417"></a>00417   <span class="keywordflow">for</span>(i=0; (c=zNum[i])&gt;=<span class="charliteral">&apos;0&apos;</span> &amp;&amp; c&lt;=<span class="charliteral">&apos;9&apos;</span>; i++){}
<a name="l00418"></a>00418   <span class="keywordflow">if</span>( i&lt;19 ){
<a name="l00419"></a>00419     <span class="comment">/* Guaranteed to fit if less than 19 digits */</span>
<a name="l00420"></a>00420     <span class="keywordflow">return</span> 1;
<a name="l00421"></a>00421   }<span class="keywordflow">else</span> <span class="keywordflow">if</span>( i&gt;19 ){
<a name="l00422"></a>00422     <span class="comment">/* Guaranteed to be too big if greater than 19 digits */</span>
<a name="l00423"></a>00423     <span class="keywordflow">return</span> 0;
<a name="l00424"></a>00424   }<span class="keywordflow">else</span>{
<a name="l00425"></a>00425     <span class="comment">/* Compare against 2^63. */</span>
<a name="l00426"></a>00426     <span class="keywordflow">return</span> <a class="code" href="util_8c.html#a7c59757893bf2b5724087b4768105a6a">compare2pow63</a>(zNum)&lt;neg;
<a name="l00427"></a>00427   }
<a name="l00428"></a>00428 }
<a name="l00429"></a>00429 
<a name="l00430"></a>00430 <span class="comment">/*</span>
<a name="l00431"></a>00431 <span class="comment">** If zNum represents an integer that will fit in 32-bits, then set</span>
<a name="l00432"></a>00432 <span class="comment">** *pValue to that integer and return true.  Otherwise return false.</span>
<a name="l00433"></a>00433 <span class="comment">**</span>
<a name="l00434"></a>00434 <span class="comment">** Any non-numeric characters that following zNum are ignored.</span>
<a name="l00435"></a>00435 <span class="comment">** This is different from sqlite3Atoi64() which requires the</span>
<a name="l00436"></a>00436 <span class="comment">** input number to be zero-terminated.</span>
<a name="l00437"></a>00437 <span class="comment">*/</span>
<a name="l00438"></a><a class="code" href="util_8c.html#aaeff20606df92720224e1206f2832747">00438</a> <span class="keywordtype">int</span> <a class="code" href="sqliteInt_8h.html#a953bc62b777a4e71cf8cc64dacef166e">sqlite3GetInt32</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *zNum, <span class="keywordtype">int</span> *pValue){
<a name="l00439"></a>00439   <a class="code" href="sqlite3_8h.html#a520a95f9080c018b2fade39885bd2e2a">sqlite_int64</a> v = 0;
<a name="l00440"></a>00440   <span class="keywordtype">int</span> i, c;
<a name="l00441"></a>00441   <span class="keywordtype">int</span> neg = 0;
<a name="l00442"></a>00442   <span class="keywordflow">if</span>( zNum[0]==<span class="charliteral">&apos;-&apos;</span> ){
<a name="l00443"></a>00443     neg = 1;
<a name="l00444"></a>00444     zNum++;
<a name="l00445"></a>00445   }<span class="keywordflow">else</span> <span class="keywordflow">if</span>( zNum[0]==<span class="charliteral">&apos;+&apos;</span> ){
<a name="l00446"></a>00446     zNum++;
<a name="l00447"></a>00447   }
<a name="l00448"></a>00448   <span class="keywordflow">while</span>( zNum[0]==<span class="charliteral">&apos;0&apos;</span> ) zNum++;
<a name="l00449"></a>00449   <span class="keywordflow">for</span>(i=0; i&lt;11 &amp;&amp; (c = zNum[i] - <span class="charliteral">&apos;0&apos;</span>)&gt;=0 &amp;&amp; c&lt;=9; i++){
<a name="l00450"></a>00450     v = v*10 + c;
<a name="l00451"></a>00451   }
<a name="l00452"></a>00452 
<a name="l00453"></a>00453   <span class="comment">/* The longest decimal representation of a 32 bit integer is 10 digits:</span>
<a name="l00454"></a>00454 <span class="comment">  **</span>
<a name="l00455"></a>00455 <span class="comment">  **             1234567890</span>
<a name="l00456"></a>00456 <span class="comment">  **     2^31 -&gt; 2147483648</span>
<a name="l00457"></a>00457 <span class="comment">  */</span>
<a name="l00458"></a>00458   <span class="keywordflow">if</span>( i&gt;10 ){
<a name="l00459"></a>00459     <span class="keywordflow">return</span> 0;
<a name="l00460"></a>00460   }
<a name="l00461"></a>00461   <span class="keywordflow">if</span>( v-neg&gt;2147483647 ){
<a name="l00462"></a>00462     <span class="keywordflow">return</span> 0;
<a name="l00463"></a>00463   }
<a name="l00464"></a>00464   <span class="keywordflow">if</span>( neg ){
<a name="l00465"></a>00465     v = -v;
<a name="l00466"></a>00466   }
<a name="l00467"></a>00467   *pValue = (int)v;
<a name="l00468"></a>00468   <span class="keywordflow">return</span> 1;
<a name="l00469"></a>00469 }
<a name="l00470"></a>00470 
<a name="l00471"></a>00471 <span class="comment">/*</span>
<a name="l00472"></a>00472 <span class="comment">** The variable-length integer encoding is as follows:</span>
<a name="l00473"></a>00473 <span class="comment">**</span>
<a name="l00474"></a>00474 <span class="comment">** KEY:</span>
<a name="l00475"></a>00475 <span class="comment">**         A = 0xxxxxxx    7 bits of data and one flag bit</span>
<a name="l00476"></a>00476 <span class="comment">**         B = 1xxxxxxx    7 bits of data and one flag bit</span>
<a name="l00477"></a>00477 <span class="comment">**         C = xxxxxxxx    8 bits of data</span>
<a name="l00478"></a>00478 <span class="comment">**</span>
<a name="l00479"></a>00479 <span class="comment">**  7 bits - A</span>
<a name="l00480"></a>00480 <span class="comment">** 14 bits - BA</span>
<a name="l00481"></a>00481 <span class="comment">** 21 bits - BBA</span>
<a name="l00482"></a>00482 <span class="comment">** 28 bits - BBBA</span>
<a name="l00483"></a>00483 <span class="comment">** 35 bits - BBBBA</span>
<a name="l00484"></a>00484 <span class="comment">** 42 bits - BBBBBA</span>
<a name="l00485"></a>00485 <span class="comment">** 49 bits - BBBBBBA</span>
<a name="l00486"></a>00486 <span class="comment">** 56 bits - BBBBBBBA</span>
<a name="l00487"></a>00487 <span class="comment">** 64 bits - BBBBBBBBC</span>
<a name="l00488"></a>00488 <span class="comment">*/</span>
<a name="l00489"></a>00489 
<a name="l00490"></a>00490 <span class="comment">/*</span>
<a name="l00491"></a>00491 <span class="comment">** Write a 64-bit variable-length integer to memory starting at p[0].</span>
<a name="l00492"></a>00492 <span class="comment">** The length of data write will be between 1 and 9 bytes.  The number</span>
<a name="l00493"></a>00493 <span class="comment">** of bytes written is returned.</span>
<a name="l00494"></a>00494 <span class="comment">**</span>
<a name="l00495"></a>00495 <span class="comment">** A variable-length integer consists of the lower 7 bits of each byte</span>
<a name="l00496"></a>00496 <span class="comment">** for all bytes that have the 8th bit set and one byte with the 8th</span>
<a name="l00497"></a>00497 <span class="comment">** bit clear.  Except, if we get to the 9th byte, it stores the full</span>
<a name="l00498"></a>00498 <span class="comment">** 8 bits and is the last byte.</span>
<a name="l00499"></a>00499 <span class="comment">*/</span>
<a name="l00500"></a><a class="code" href="util_8c.html#a6de3bfe56e5bdab3e5c6d5fcd2ad5e4e">00500</a> <span class="keywordtype">int</span> <a class="code" href="sqliteInt_8h.html#a78970d12b67b3fc6cfa4ce05eacc7ad2">sqlite3PutVarint</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *p, <a class="code" href="sqliteInt_8h.html#a0e0cdb443a471891a042a6bfdc4644ca">u64</a> v){
<a name="l00501"></a>00501   <span class="keywordtype">int</span> i, j, n;
<a name="l00502"></a>00502   <a class="code" href="sqliteInt_8h.html#a74a0f6424ae628af25f23f0a35f6ead3">u8</a> buf[10];
<a name="l00503"></a>00503   <span class="keywordflow">if</span>( v &amp; (((<a class="code" href="sqliteInt_8h.html#a0e0cdb443a471891a042a6bfdc4644ca">u64</a>)0xff000000)&lt;&lt;32) ){
<a name="l00504"></a>00504     p[8] = v;
<a name="l00505"></a>00505     v &gt;&gt;= 8;
<a name="l00506"></a>00506     <span class="keywordflow">for</span>(i=7; i&gt;=0; i--){
<a name="l00507"></a>00507       p[i] = (v &amp; 0x7f) | 0x80;
<a name="l00508"></a>00508       v &gt;&gt;= 7;
<a name="l00509"></a>00509     }
<a name="l00510"></a>00510     <span class="keywordflow">return</span> 9;
<a name="l00511"></a>00511   }    
<a name="l00512"></a>00512   n = 0;
<a name="l00513"></a>00513   <span class="keywordflow">do</span>{
<a name="l00514"></a>00514     buf[n++] = (v &amp; 0x7f) | 0x80;
<a name="l00515"></a>00515     v &gt;&gt;= 7;
<a name="l00516"></a>00516   }<span class="keywordflow">while</span>( v!=0 );
<a name="l00517"></a>00517   buf[0] &amp;= 0x7f;
<a name="l00518"></a>00518   assert( n&lt;=9 );
<a name="l00519"></a>00519   <span class="keywordflow">for</span>(i=0, j=n-1; j&gt;=0; j--, i++){
<a name="l00520"></a>00520     p[i] = buf[j];
<a name="l00521"></a>00521   }
<a name="l00522"></a>00522   <span class="keywordflow">return</span> n;
<a name="l00523"></a>00523 }
<a name="l00524"></a>00524 
<a name="l00525"></a>00525 <span class="comment">/*</span>
<a name="l00526"></a>00526 <span class="comment">** This routine is a faster version of sqlite3PutVarint() that only</span>
<a name="l00527"></a>00527 <span class="comment">** works for 32-bit positive integers and which is optimized for</span>
<a name="l00528"></a>00528 <span class="comment">** the common case of small integers.  A MACRO version, putVarint32,</span>
<a name="l00529"></a>00529 <span class="comment">** is provided which inlines the single-byte case.  All code should use</span>
<a name="l00530"></a>00530 <span class="comment">** the MACRO version as this function assumes the single-byte case has</span>
<a name="l00531"></a>00531 <span class="comment">** already been handled.</span>
<a name="l00532"></a>00532 <span class="comment">*/</span>
<a name="l00533"></a><a class="code" href="util_8c.html#ad864817bf33f7a586864954dd71b8802">00533</a> <span class="keywordtype">int</span> <a class="code" href="sqliteInt_8h.html#ad2c51d191b6d93354e4fc66bae002a84">sqlite3PutVarint32</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *p, <a class="code" href="sqliteInt_8h.html#a03ad5adfaeb9b7640dde78a0cc390319">u32</a> v){
<a name="l00534"></a>00534 <span class="preprocessor">#ifndef putVarint32</span>
<a name="l00535"></a>00535 <span class="preprocessor"></span>  <span class="keywordflow">if</span>( (v &amp; ~0x7f)==0 ){
<a name="l00536"></a>00536     p[0] = v;
<a name="l00537"></a>00537     <span class="keywordflow">return</span> 1;
<a name="l00538"></a>00538   }
<a name="l00539"></a>00539 <span class="preprocessor">#endif</span>
<a name="l00540"></a>00540 <span class="preprocessor"></span>  <span class="keywordflow">if</span>( (v &amp; ~0x3fff)==0 ){
<a name="l00541"></a>00541     p[0] = (v&gt;&gt;7) | 0x80;
<a name="l00542"></a>00542     p[1] = v &amp; 0x7f;
<a name="l00543"></a>00543     <span class="keywordflow">return</span> 2;
<a name="l00544"></a>00544   }
<a name="l00545"></a>00545   <span class="keywordflow">return</span> <a class="code" href="sqliteInt_8h.html#a78970d12b67b3fc6cfa4ce05eacc7ad2">sqlite3PutVarint</a>(p, v);
<a name="l00546"></a>00546 }
<a name="l00547"></a>00547 
<a name="l00548"></a>00548 <span class="comment">/*</span>
<a name="l00549"></a>00549 <span class="comment">** Read a 64-bit variable-length integer from memory starting at p[0].</span>
<a name="l00550"></a>00550 <span class="comment">** Return the number of bytes read.  The value is stored in *v.</span>
<a name="l00551"></a>00551 <span class="comment">*/</span>
<a name="l00552"></a><a class="code" href="util_8c.html#ab0858a0305177bd494c73a163558d21f">00552</a> <span class="keywordtype">int</span> <a class="code" href="sqliteInt_8h.html#a524edd14e06a9d0242421bfa84ab34e3">sqlite3GetVarint</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *p, <a class="code" href="sqliteInt_8h.html#a0e0cdb443a471891a042a6bfdc4644ca">u64</a> *v){
<a name="l00553"></a>00553   <a class="code" href="sqliteInt_8h.html#a03ad5adfaeb9b7640dde78a0cc390319">u32</a> a,b,s;
<a name="l00554"></a>00554 
<a name="l00555"></a>00555   a = *p;
<a name="l00556"></a>00556   <span class="comment">/* a: p0 (unmasked) */</span>
<a name="l00557"></a>00557   <span class="keywordflow">if</span> (!(a&amp;0x80))
<a name="l00558"></a>00558   {
<a name="l00559"></a>00559     *v = a;
<a name="l00560"></a>00560     <span class="keywordflow">return</span> 1;
<a name="l00561"></a>00561   }
<a name="l00562"></a>00562 
<a name="l00563"></a>00563   p++;
<a name="l00564"></a>00564   b = *p;
<a name="l00565"></a>00565   <span class="comment">/* b: p1 (unmasked) */</span>
<a name="l00566"></a>00566   <span class="keywordflow">if</span> (!(b&amp;0x80))
<a name="l00567"></a>00567   {
<a name="l00568"></a>00568     a &amp;= 0x7f;
<a name="l00569"></a>00569     a = a&lt;&lt;7;
<a name="l00570"></a>00570     a |= b;
<a name="l00571"></a>00571     *v = a;
<a name="l00572"></a>00572     <span class="keywordflow">return</span> 2;
<a name="l00573"></a>00573   }
<a name="l00574"></a>00574 
<a name="l00575"></a>00575   p++;
<a name="l00576"></a>00576   a = a&lt;&lt;14;
<a name="l00577"></a>00577   a |= *p;
<a name="l00578"></a>00578   <span class="comment">/* a: p0&lt;&lt;14 | p2 (unmasked) */</span>
<a name="l00579"></a>00579   <span class="keywordflow">if</span> (!(a&amp;0x80))
<a name="l00580"></a>00580   {
<a name="l00581"></a>00581     a &amp;= (0x7f&lt;&lt;14)|(0x7f);
<a name="l00582"></a>00582     b &amp;= 0x7f;
<a name="l00583"></a>00583     b = b&lt;&lt;7;
<a name="l00584"></a>00584     a |= b;
<a name="l00585"></a>00585     *v = a;
<a name="l00586"></a>00586     <span class="keywordflow">return</span> 3;
<a name="l00587"></a>00587   }
<a name="l00588"></a>00588 
<a name="l00589"></a>00589   <span class="comment">/* CSE1 from below */</span>
<a name="l00590"></a>00590   a &amp;= (0x7f&lt;&lt;14)|(0x7f);
<a name="l00591"></a>00591   p++;
<a name="l00592"></a>00592   b = b&lt;&lt;14;
<a name="l00593"></a>00593   b |= *p;
<a name="l00594"></a>00594   <span class="comment">/* b: p1&lt;&lt;14 | p3 (unmasked) */</span>
<a name="l00595"></a>00595   <span class="keywordflow">if</span> (!(b&amp;0x80))
<a name="l00596"></a>00596   {
<a name="l00597"></a>00597     b &amp;= (0x7f&lt;&lt;14)|(0x7f);
<a name="l00598"></a>00598     <span class="comment">/* moved CSE1 up */</span>
<a name="l00599"></a>00599     <span class="comment">/* a &amp;= (0x7f&lt;&lt;14)|(0x7f); */</span>
<a name="l00600"></a>00600     a = a&lt;&lt;7;
<a name="l00601"></a>00601     a |= b;
<a name="l00602"></a>00602     *v = a;
<a name="l00603"></a>00603     <span class="keywordflow">return</span> 4;
<a name="l00604"></a>00604   }
<a name="l00605"></a>00605 
<a name="l00606"></a>00606   <span class="comment">/* a: p0&lt;&lt;14 | p2 (masked) */</span>
<a name="l00607"></a>00607   <span class="comment">/* b: p1&lt;&lt;14 | p3 (unmasked) */</span>
<a name="l00608"></a>00608   <span class="comment">/* 1:save off p0&lt;&lt;21 | p1&lt;&lt;14 | p2&lt;&lt;7 | p3 (masked) */</span>
<a name="l00609"></a>00609   <span class="comment">/* moved CSE1 up */</span>
<a name="l00610"></a>00610   <span class="comment">/* a &amp;= (0x7f&lt;&lt;14)|(0x7f); */</span>
<a name="l00611"></a>00611   b &amp;= (0x7f&lt;&lt;14)|(0x7f);
<a name="l00612"></a>00612   s = a;
<a name="l00613"></a>00613   <span class="comment">/* s: p0&lt;&lt;14 | p2 (masked) */</span>
<a name="l00614"></a>00614 
<a name="l00615"></a>00615   p++;
<a name="l00616"></a>00616   a = a&lt;&lt;14;
<a name="l00617"></a>00617   a |= *p;
<a name="l00618"></a>00618   <span class="comment">/* a: p0&lt;&lt;28 | p2&lt;&lt;14 | p4 (unmasked) */</span>
<a name="l00619"></a>00619   <span class="keywordflow">if</span> (!(a&amp;0x80))
<a name="l00620"></a>00620   {
<a name="l00621"></a>00621     <span class="comment">/* we can skip these cause they were (effectively) done above in calc&apos;ing s */</span>
<a name="l00622"></a>00622     <span class="comment">/* a &amp;= (0x7f&lt;&lt;28)|(0x7f&lt;&lt;14)|(0x7f); */</span>
<a name="l00623"></a>00623     <span class="comment">/* b &amp;= (0x7f&lt;&lt;14)|(0x7f); */</span>
<a name="l00624"></a>00624     b = b&lt;&lt;7;
<a name="l00625"></a>00625     a |= b;
<a name="l00626"></a>00626     s = s&gt;&gt;18;
<a name="l00627"></a>00627     *v = ((<a class="code" href="sqliteInt_8h.html#a0e0cdb443a471891a042a6bfdc4644ca">u64</a>)s)&lt;&lt;32 | a;
<a name="l00628"></a>00628     <span class="keywordflow">return</span> 5;
<a name="l00629"></a>00629   }
<a name="l00630"></a>00630 
<a name="l00631"></a>00631   <span class="comment">/* 2:save off p0&lt;&lt;21 | p1&lt;&lt;14 | p2&lt;&lt;7 | p3 (masked) */</span>
<a name="l00632"></a>00632   s = s&lt;&lt;7;
<a name="l00633"></a>00633   s |= b;
<a name="l00634"></a>00634   <span class="comment">/* s: p0&lt;&lt;21 | p1&lt;&lt;14 | p2&lt;&lt;7 | p3 (masked) */</span>
<a name="l00635"></a>00635 
<a name="l00636"></a>00636   p++;
<a name="l00637"></a>00637   b = b&lt;&lt;14;
<a name="l00638"></a>00638   b |= *p;
<a name="l00639"></a>00639   <span class="comment">/* b: p1&lt;&lt;28 | p3&lt;&lt;14 | p5 (unmasked) */</span>
<a name="l00640"></a>00640   <span class="keywordflow">if</span> (!(b&amp;0x80))
<a name="l00641"></a>00641   {
<a name="l00642"></a>00642     <span class="comment">/* we can skip this cause it was (effectively) done above in calc&apos;ing s */</span>
<a name="l00643"></a>00643     <span class="comment">/* b &amp;= (0x7f&lt;&lt;28)|(0x7f&lt;&lt;14)|(0x7f); */</span>
<a name="l00644"></a>00644     a &amp;= (0x7f&lt;&lt;14)|(0x7f);
<a name="l00645"></a>00645     a = a&lt;&lt;7;
<a name="l00646"></a>00646     a |= b;
<a name="l00647"></a>00647     s = s&gt;&gt;18;
<a name="l00648"></a>00648     *v = ((<a class="code" href="sqliteInt_8h.html#a0e0cdb443a471891a042a6bfdc4644ca">u64</a>)s)&lt;&lt;32 | a;
<a name="l00649"></a>00649     <span class="keywordflow">return</span> 6;
<a name="l00650"></a>00650   }
<a name="l00651"></a>00651 
<a name="l00652"></a>00652   p++;
<a name="l00653"></a>00653   a = a&lt;&lt;14;
<a name="l00654"></a>00654   a |= *p;
<a name="l00655"></a>00655   <span class="comment">/* a: p2&lt;&lt;28 | p4&lt;&lt;14 | p6 (unmasked) */</span>
<a name="l00656"></a>00656   <span class="keywordflow">if</span> (!(a&amp;0x80))
<a name="l00657"></a>00657   {
<a name="l00658"></a>00658     a &amp;= (0x7f&lt;&lt;28)|(0x7f&lt;&lt;14)|(0x7f);
<a name="l00659"></a>00659     b &amp;= (0x7f&lt;&lt;14)|(0x7f);
<a name="l00660"></a>00660     b = b&lt;&lt;7;
<a name="l00661"></a>00661     a |= b;
<a name="l00662"></a>00662     s = s&gt;&gt;11;
<a name="l00663"></a>00663     *v = ((<a class="code" href="sqliteInt_8h.html#a0e0cdb443a471891a042a6bfdc4644ca">u64</a>)s)&lt;&lt;32 | a;
<a name="l00664"></a>00664     <span class="keywordflow">return</span> 7;
<a name="l00665"></a>00665   }
<a name="l00666"></a>00666 
<a name="l00667"></a>00667   <span class="comment">/* CSE2 from below */</span>
<a name="l00668"></a>00668   a &amp;= (0x7f&lt;&lt;14)|(0x7f);
<a name="l00669"></a>00669   p++;
<a name="l00670"></a>00670   b = b&lt;&lt;14;
<a name="l00671"></a>00671   b |= *p;
<a name="l00672"></a>00672   <span class="comment">/* b: p3&lt;&lt;28 | p5&lt;&lt;14 | p7 (unmasked) */</span>
<a name="l00673"></a>00673   <span class="keywordflow">if</span> (!(b&amp;0x80))
<a name="l00674"></a>00674   {
<a name="l00675"></a>00675     b &amp;= (0x7f&lt;&lt;28)|(0x7f&lt;&lt;14)|(0x7f);
<a name="l00676"></a>00676     <span class="comment">/* moved CSE2 up */</span>
<a name="l00677"></a>00677     <span class="comment">/* a &amp;= (0x7f&lt;&lt;14)|(0x7f); */</span>
<a name="l00678"></a>00678     a = a&lt;&lt;7;
<a name="l00679"></a>00679     a |= b;
<a name="l00680"></a>00680     s = s&gt;&gt;4;
<a name="l00681"></a>00681     *v = ((<a class="code" href="sqliteInt_8h.html#a0e0cdb443a471891a042a6bfdc4644ca">u64</a>)s)&lt;&lt;32 | a;
<a name="l00682"></a>00682     <span class="keywordflow">return</span> 8;
<a name="l00683"></a>00683   }
<a name="l00684"></a>00684 
<a name="l00685"></a>00685   p++;
<a name="l00686"></a>00686   a = a&lt;&lt;15;
<a name="l00687"></a>00687   a |= *p;
<a name="l00688"></a>00688   <span class="comment">/* a: p4&lt;&lt;29 | p6&lt;&lt;15 | p8 (unmasked) */</span>
<a name="l00689"></a>00689 
<a name="l00690"></a>00690   <span class="comment">/* moved CSE2 up */</span>
<a name="l00691"></a>00691   <span class="comment">/* a &amp;= (0x7f&lt;&lt;29)|(0x7f&lt;&lt;15)|(0xff); */</span>
<a name="l00692"></a>00692   b &amp;= (0x7f&lt;&lt;14)|(0x7f);
<a name="l00693"></a>00693   b = b&lt;&lt;8;
<a name="l00694"></a>00694   a |= b;
<a name="l00695"></a>00695 
<a name="l00696"></a>00696   s = s&lt;&lt;4;
<a name="l00697"></a>00697   b = p[-4];
<a name="l00698"></a>00698   b &amp;= 0x7f;
<a name="l00699"></a>00699   b = b&gt;&gt;3;
<a name="l00700"></a>00700   s |= b;
<a name="l00701"></a>00701 
<a name="l00702"></a>00702   *v = ((<a class="code" href="sqliteInt_8h.html#a0e0cdb443a471891a042a6bfdc4644ca">u64</a>)s)&lt;&lt;32 | a;
<a name="l00703"></a>00703 
<a name="l00704"></a>00704   <span class="keywordflow">return</span> 9;
<a name="l00705"></a>00705 }
<a name="l00706"></a>00706 
<a name="l00707"></a>00707 <span class="comment">/*</span>
<a name="l00708"></a>00708 <span class="comment">** Read a 32-bit variable-length integer from memory starting at p[0].</span>
<a name="l00709"></a>00709 <span class="comment">** Return the number of bytes read.  The value is stored in *v.</span>
<a name="l00710"></a>00710 <span class="comment">** A MACRO version, getVarint32, is provided which inlines the </span>
<a name="l00711"></a>00711 <span class="comment">** single-byte case.  All code should use the MACRO version as </span>
<a name="l00712"></a>00712 <span class="comment">** this function assumes the single-byte case has already been handled.</span>
<a name="l00713"></a>00713 <span class="comment">*/</span>
<a name="l00714"></a><a class="code" href="util_8c.html#aa7c3e4450e45d4edd57a06e92aa5679e">00714</a> <span class="keywordtype">int</span> <a class="code" href="sqliteInt_8h.html#a621c8c28ce420c3066c1cc318387fd31">sqlite3GetVarint32</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *p, <a class="code" href="sqliteInt_8h.html#a03ad5adfaeb9b7640dde78a0cc390319">u32</a> *v){
<a name="l00715"></a>00715   <a class="code" href="sqliteInt_8h.html#a03ad5adfaeb9b7640dde78a0cc390319">u32</a> a,b;
<a name="l00716"></a>00716 
<a name="l00717"></a>00717   a = *p;
<a name="l00718"></a>00718   <span class="comment">/* a: p0 (unmasked) */</span>
<a name="l00719"></a>00719 <span class="preprocessor">#ifndef getVarint32</span>
<a name="l00720"></a>00720 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (!(a&amp;0x80))
<a name="l00721"></a>00721   {
<a name="l00722"></a>00722     *v = a;
<a name="l00723"></a>00723     <span class="keywordflow">return</span> 1;
<a name="l00724"></a>00724   }
<a name="l00725"></a>00725 <span class="preprocessor">#endif</span>
<a name="l00726"></a>00726 <span class="preprocessor"></span>
<a name="l00727"></a>00727   p++;
<a name="l00728"></a>00728   b = *p;
<a name="l00729"></a>00729   <span class="comment">/* b: p1 (unmasked) */</span>
<a name="l00730"></a>00730   <span class="keywordflow">if</span> (!(b&amp;0x80))
<a name="l00731"></a>00731   {
<a name="l00732"></a>00732     a &amp;= 0x7f;
<a name="l00733"></a>00733     a = a&lt;&lt;7;
<a name="l00734"></a>00734     *v = a | b;
<a name="l00735"></a>00735     <span class="keywordflow">return</span> 2;
<a name="l00736"></a>00736   }
<a name="l00737"></a>00737 
<a name="l00738"></a>00738   p++;
<a name="l00739"></a>00739   a = a&lt;&lt;14;
<a name="l00740"></a>00740   a |= *p;
<a name="l00741"></a>00741   <span class="comment">/* a: p0&lt;&lt;14 | p2 (unmasked) */</span>
<a name="l00742"></a>00742   <span class="keywordflow">if</span> (!(a&amp;0x80))
<a name="l00743"></a>00743   {
<a name="l00744"></a>00744     a &amp;= (0x7f&lt;&lt;14)|(0x7f);
<a name="l00745"></a>00745     b &amp;= 0x7f;
<a name="l00746"></a>00746     b = b&lt;&lt;7;
<a name="l00747"></a>00747     *v = a | b;
<a name="l00748"></a>00748     <span class="keywordflow">return</span> 3;
<a name="l00749"></a>00749   }
<a name="l00750"></a>00750 
<a name="l00751"></a>00751   p++;
<a name="l00752"></a>00752   b = b&lt;&lt;14;
<a name="l00753"></a>00753   b |= *p;
<a name="l00754"></a>00754   <span class="comment">/* b: p1&lt;&lt;14 | p3 (unmasked) */</span>
<a name="l00755"></a>00755   <span class="keywordflow">if</span> (!(b&amp;0x80))
<a name="l00756"></a>00756   {
<a name="l00757"></a>00757     b &amp;= (0x7f&lt;&lt;14)|(0x7f);
<a name="l00758"></a>00758     a &amp;= (0x7f&lt;&lt;14)|(0x7f);
<a name="l00759"></a>00759     a = a&lt;&lt;7;
<a name="l00760"></a>00760     *v = a | b;
<a name="l00761"></a>00761     <span class="keywordflow">return</span> 4;
<a name="l00762"></a>00762   }
<a name="l00763"></a>00763 
<a name="l00764"></a>00764   p++;
<a name="l00765"></a>00765   a = a&lt;&lt;14;
<a name="l00766"></a>00766   a |= *p;
<a name="l00767"></a>00767   <span class="comment">/* a: p0&lt;&lt;28 | p2&lt;&lt;14 | p4 (unmasked) */</span>
<a name="l00768"></a>00768   <span class="keywordflow">if</span> (!(a&amp;0x80))
<a name="l00769"></a>00769   {
<a name="l00770"></a>00770     a &amp;= (0x7f&lt;&lt;28)|(0x7f&lt;&lt;14)|(0x7f);
<a name="l00771"></a>00771     b &amp;= (0x7f&lt;&lt;28)|(0x7f&lt;&lt;14)|(0x7f);
<a name="l00772"></a>00772     b = b&lt;&lt;7;
<a name="l00773"></a>00773     *v = a | b;
<a name="l00774"></a>00774     <span class="keywordflow">return</span> 5;
<a name="l00775"></a>00775   }
<a name="l00776"></a>00776 
<a name="l00777"></a>00777   <span class="comment">/* We can only reach this point when reading a corrupt database</span>
<a name="l00778"></a>00778 <span class="comment">  ** file.  In that case we are not in any hurry.  Use the (relatively</span>
<a name="l00779"></a>00779 <span class="comment">  ** slow) general-purpose sqlite3GetVarint() routine to extract the</span>
<a name="l00780"></a>00780 <span class="comment">  ** value. */</span>
<a name="l00781"></a>00781   {
<a name="l00782"></a>00782     <a class="code" href="sqliteInt_8h.html#a0e0cdb443a471891a042a6bfdc4644ca">u64</a> v64;
<a name="l00783"></a>00783     <span class="keywordtype">int</span> n;
<a name="l00784"></a>00784 
<a name="l00785"></a>00785     p -= 4;
<a name="l00786"></a>00786     n = <a class="code" href="sqliteInt_8h.html#a524edd14e06a9d0242421bfa84ab34e3">sqlite3GetVarint</a>(p, &amp;v64);
<a name="l00787"></a>00787     assert( n&gt;5 &amp;&amp; n&lt;=9 );
<a name="l00788"></a>00788     *v = (<a class="code" href="sqliteInt_8h.html#a03ad5adfaeb9b7640dde78a0cc390319">u32</a>)v64;
<a name="l00789"></a>00789     <span class="keywordflow">return</span> n;
<a name="l00790"></a>00790   }
<a name="l00791"></a>00791 }
<a name="l00792"></a>00792 
<a name="l00793"></a>00793 <span class="comment">/*</span>
<a name="l00794"></a>00794 <span class="comment">** Return the number of bytes that will be needed to store the given</span>
<a name="l00795"></a>00795 <span class="comment">** 64-bit integer.</span>
<a name="l00796"></a>00796 <span class="comment">*/</span>
<a name="l00797"></a><a class="code" href="util_8c.html#a4c25fa3dcd7bf5ca327b4541bae4359d">00797</a> <span class="keywordtype">int</span> <a class="code" href="sqliteInt_8h.html#a4c25fa3dcd7bf5ca327b4541bae4359d">sqlite3VarintLen</a>(<a class="code" href="sqliteInt_8h.html#a0e0cdb443a471891a042a6bfdc4644ca">u64</a> v){
<a name="l00798"></a>00798   <span class="keywordtype">int</span> i = 0;
<a name="l00799"></a>00799   <span class="keywordflow">do</span>{
<a name="l00800"></a>00800     i++;
<a name="l00801"></a>00801     v &gt;&gt;= 7;
<a name="l00802"></a>00802   }<span class="keywordflow">while</span>( v!=0 &amp;&amp; i&lt;9 );
<a name="l00803"></a>00803   <span class="keywordflow">return</span> i;
<a name="l00804"></a>00804 }
<a name="l00805"></a>00805 
<a name="l00806"></a>00806 
<a name="l00807"></a>00807 <span class="comment">/*</span>
<a name="l00808"></a>00808 <span class="comment">** Read or write a four-byte big-endian integer value.</span>
<a name="l00809"></a>00809 <span class="comment">*/</span>
<a name="l00810"></a><a class="code" href="util_8c.html#afc0061a199c5bbd0d2eabba510e7b08c">00810</a> <a class="code" href="sqliteInt_8h.html#a03ad5adfaeb9b7640dde78a0cc390319">u32</a> <a class="code" href="sqliteInt_8h.html#a80eafae5a6fd5c7231275c95f228f4db">sqlite3Get4byte</a>(<span class="keyword">const</span> <a class="code" href="sqliteInt_8h.html#a74a0f6424ae628af25f23f0a35f6ead3">u8</a> *p){
<a name="l00811"></a>00811   <span class="keywordflow">return</span> (p[0]&lt;&lt;24) | (p[1]&lt;&lt;16) | (p[2]&lt;&lt;8) | p[3];
<a name="l00812"></a>00812 }
<a name="l00813"></a><a class="code" href="util_8c.html#a0a1f0ca41cae1385cc6ffe9564378b76">00813</a> <span class="keywordtype">void</span> <a class="code" href="sqliteInt_8h.html#a31247c2c37b5a909078f5d73fab7093f">sqlite3Put4byte</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *p, <a class="code" href="sqliteInt_8h.html#a03ad5adfaeb9b7640dde78a0cc390319">u32</a> v){
<a name="l00814"></a>00814   p[0] = v&gt;&gt;24;
<a name="l00815"></a>00815   p[1] = v&gt;&gt;16;
<a name="l00816"></a>00816   p[2] = v&gt;&gt;8;
<a name="l00817"></a>00817   p[3] = v;
<a name="l00818"></a>00818 }
<a name="l00819"></a>00819 
<a name="l00820"></a>00820 
<a name="l00821"></a>00821 
<a name="l00822"></a>00822 <span class="preprocessor">#if !defined(SQLITE_OMIT_BLOB_LITERAL) || defined(SQLITE_HAS_CODEC)</span>
<a name="l00823"></a>00823 <span class="preprocessor"></span><span class="comment">/*</span>
<a name="l00824"></a>00824 <span class="comment">** Translate a single byte of Hex into an integer.</span>
<a name="l00825"></a>00825 <span class="comment">** This routinen only works if h really is a valid hexadecimal</span>
<a name="l00826"></a>00826 <span class="comment">** character:  0..9a..fA..F</span>
<a name="l00827"></a>00827 <span class="comment">*/</span>
<a name="l00828"></a><a class="code" href="util_8c.html#a8c57fcc9f18e3815650448f049bddaf2">00828</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="util_8c.html#a8c57fcc9f18e3815650448f049bddaf2">hexToInt</a>(<span class="keywordtype">int</span> h){
<a name="l00829"></a>00829   assert( (h&gt;=<span class="charliteral">&apos;0&apos;</span> &amp;&amp; h&lt;=<span class="charliteral">&apos;9&apos;</span>) ||  (h&gt;=<span class="charliteral">&apos;a&apos;</span> &amp;&amp; h&lt;=<span class="charliteral">&apos;f&apos;</span>) ||  (h&gt;=<span class="charliteral">&apos;A&apos;</span> &amp;&amp; h&lt;=<span class="charliteral">&apos;F&apos;</span>) );
<a name="l00830"></a>00830 <span class="preprocessor">#ifdef SQLITE_ASCII</span>
<a name="l00831"></a>00831 <span class="preprocessor"></span>  h += 9*(1&amp;(h&gt;&gt;6));
<a name="l00832"></a>00832 <span class="preprocessor">#endif</span>
<a name="l00833"></a>00833 <span class="preprocessor"></span><span class="preprocessor">#ifdef SQLITE_EBCDIC</span>
<a name="l00834"></a>00834 <span class="preprocessor"></span>  h += 9*(1&amp;~(h&gt;&gt;4));
<a name="l00835"></a>00835 <span class="preprocessor">#endif</span>
<a name="l00836"></a>00836 <span class="preprocessor"></span>  <span class="keywordflow">return</span> h &amp; 0xf;
<a name="l00837"></a>00837 }
<a name="l00838"></a>00838 <span class="preprocessor">#endif </span><span class="comment">/* !SQLITE_OMIT_BLOB_LITERAL || SQLITE_HAS_CODEC */</span>
<a name="l00839"></a>00839 
<a name="l00840"></a>00840 <span class="preprocessor">#if !defined(SQLITE_OMIT_BLOB_LITERAL) || defined(SQLITE_HAS_CODEC)</span>
<a name="l00841"></a>00841 <span class="preprocessor"></span><span class="comment">/*</span>
<a name="l00842"></a>00842 <span class="comment">** Convert a BLOB literal of the form &quot;x&apos;hhhhhh&apos;&quot; into its binary</span>
<a name="l00843"></a>00843 <span class="comment">** value.  Return a pointer to its binary value.  Space to hold the</span>
<a name="l00844"></a>00844 <span class="comment">** binary value has been obtained from malloc and must be freed by</span>
<a name="l00845"></a>00845 <span class="comment">** the calling routine.</span>
<a name="l00846"></a>00846 <span class="comment">*/</span>
<a name="l00847"></a><a class="code" href="util_8c.html#a9b8ffeb173887bb3cb66ef40d18c7819">00847</a> <span class="keywordtype">void</span> *<a class="code" href="sqliteInt_8h.html#a3dd03733843554658173521240ec8511">sqlite3HexToBlob</a>(<a class="code" href="structsqlite3.html">sqlite3</a> *<a class="code" href="shell_8c.html#ad6e663497d2c934364b3bcf07496b30b">db</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *z, <span class="keywordtype">int</span> n){
<a name="l00848"></a>00848   <span class="keywordtype">char</span> *zBlob;
<a name="l00849"></a>00849   <span class="keywordtype">int</span> i;
<a name="l00850"></a>00850 
<a name="l00851"></a>00851   zBlob = (<span class="keywordtype">char</span> *)<a class="code" href="malloc_8c.html#a043f868d32456bd7cdca4a62837277c1">sqlite3DbMallocRaw</a>(db, n/2 + 1);
<a name="l00852"></a>00852   n--;
<a name="l00853"></a>00853   <span class="keywordflow">if</span>( zBlob ){
<a name="l00854"></a>00854     <span class="keywordflow">for</span>(i=0; i&lt;n; i+=2){
<a name="l00855"></a>00855       zBlob[i/2] = (<a class="code" href="util_8c.html#a8c57fcc9f18e3815650448f049bddaf2">hexToInt</a>(z[i])&lt;&lt;4) | <a class="code" href="util_8c.html#a8c57fcc9f18e3815650448f049bddaf2">hexToInt</a>(z[i+1]);
<a name="l00856"></a>00856     }
<a name="l00857"></a>00857     zBlob[i/2] = 0;
<a name="l00858"></a>00858   }
<a name="l00859"></a>00859   <span class="keywordflow">return</span> zBlob;
<a name="l00860"></a>00860 }
<a name="l00861"></a>00861 <span class="preprocessor">#endif </span><span class="comment">/* !SQLITE_OMIT_BLOB_LITERAL || SQLITE_HAS_CODEC */</span>
<a name="l00862"></a>00862 
<a name="l00863"></a>00863 
<a name="l00864"></a>00864 <span class="comment">/*</span>
<a name="l00865"></a>00865 <span class="comment">** Change the sqlite.magic from SQLITE_MAGIC_OPEN to SQLITE_MAGIC_BUSY.</span>
<a name="l00866"></a>00866 <span class="comment">** Return an error (non-zero) if the magic was not SQLITE_MAGIC_OPEN</span>
<a name="l00867"></a>00867 <span class="comment">** when this routine is called.</span>
<a name="l00868"></a>00868 <span class="comment">**</span>
<a name="l00869"></a>00869 <span class="comment">** This routine is called when entering an SQLite API.  The SQLITE_MAGIC_OPEN</span>
<a name="l00870"></a>00870 <span class="comment">** value indicates that the database connection passed into the API is</span>
<a name="l00871"></a>00871 <span class="comment">** open and is not being used by another thread.  By changing the value</span>
<a name="l00872"></a>00872 <span class="comment">** to SQLITE_MAGIC_BUSY we indicate that the connection is in use.</span>
<a name="l00873"></a>00873 <span class="comment">** sqlite3SafetyOff() below will change the value back to SQLITE_MAGIC_OPEN</span>
<a name="l00874"></a>00874 <span class="comment">** when the API exits. </span>
<a name="l00875"></a>00875 <span class="comment">**</span>
<a name="l00876"></a>00876 <span class="comment">** This routine is a attempt to detect if two threads use the</span>
<a name="l00877"></a>00877 <span class="comment">** same sqlite* pointer at the same time.  There is a race </span>
<a name="l00878"></a>00878 <span class="comment">** condition so it is possible that the error is not detected.</span>
<a name="l00879"></a>00879 <span class="comment">** But usually the problem will be seen.  The result will be an</span>
<a name="l00880"></a>00880 <span class="comment">** error which can be used to debug the application that is</span>
<a name="l00881"></a>00881 <span class="comment">** using SQLite incorrectly.</span>
<a name="l00882"></a>00882 <span class="comment">**</span>
<a name="l00883"></a>00883 <span class="comment">** Ticket #202:  If db-&gt;magic is not a valid open value, take care not</span>
<a name="l00884"></a>00884 <span class="comment">** to modify the db structure at all.  It could be that db is a stale</span>
<a name="l00885"></a>00885 <span class="comment">** pointer.  In other words, it could be that there has been a prior</span>
<a name="l00886"></a>00886 <span class="comment">** call to sqlite3_close(db) and db has been deallocated.  And we do</span>
<a name="l00887"></a>00887 <span class="comment">** not want to write into deallocated memory.</span>
<a name="l00888"></a>00888 <span class="comment">*/</span>
<a name="l00889"></a>00889 <span class="preprocessor">#ifdef SQLITE_DEBUG</span>
<a name="l00890"></a>00890 <span class="preprocessor"></span><span class="keywordtype">int</span> <a class="code" href="sqliteInt_8h.html#a5478b816780572bc0098dd1e2076ded2">sqlite3SafetyOn</a>(<a class="code" href="structsqlite3.html">sqlite3</a> *<a class="code" href="shell_8c.html#ad6e663497d2c934364b3bcf07496b30b">db</a>){
<a name="l00891"></a>00891   <span class="keywordflow">if</span>( db-&gt;<a class="code" href="structsqlite3.html#a6d9069c555657020c5dd1532d8e9c3f9">magic</a>==<a class="code" href="sqliteInt_8h.html#a254a8538f88691bd87ebca9e5864dfcb">SQLITE_MAGIC_OPEN</a> ){
<a name="l00892"></a>00892     db-&gt;<a class="code" href="structsqlite3.html#a6d9069c555657020c5dd1532d8e9c3f9">magic</a> = <a class="code" href="sqliteInt_8h.html#ad024aa586d9bf98f26fccca95f21b265">SQLITE_MAGIC_BUSY</a>;
<a name="l00893"></a>00893     assert( <a class="code" href="mutex_8h.html#ab92b5e853fc83d5aaa9a5d25e1883d3d">sqlite3_mutex_held</a>(db-&gt;<a class="code" href="structsqlite3.html#a6328497ac0393204ab5f5083f05731c9">mutex</a>) );
<a name="l00894"></a>00894     <span class="keywordflow">return</span> 0;
<a name="l00895"></a>00895   }<span class="keywordflow">else</span> <span class="keywordflow">if</span>( db-&gt;<a class="code" href="structsqlite3.html#a6d9069c555657020c5dd1532d8e9c3f9">magic</a>==<a class="code" href="sqliteInt_8h.html#ad024aa586d9bf98f26fccca95f21b265">SQLITE_MAGIC_BUSY</a> ){
<a name="l00896"></a>00896     db-&gt;<a class="code" href="structsqlite3.html#a6d9069c555657020c5dd1532d8e9c3f9">magic</a> = <a class="code" href="sqliteInt_8h.html#a1ddb89a30d5a7ecc7ea8681ea516670c">SQLITE_MAGIC_ERROR</a>;
<a name="l00897"></a>00897     db-&gt;<a class="code" href="structsqlite3.html#aa5db6567b0e7d5009c52e0307b1cf095">u1</a>.<a class="code" href="structsqlite3.html#a80b995fd97507bbf978d6960adde53f8">isInterrupted</a> = 1;
<a name="l00898"></a>00898   }
<a name="l00899"></a>00899   <span class="keywordflow">return</span> 1;
<a name="l00900"></a>00900 }
<a name="l00901"></a>00901 <span class="preprocessor">#endif</span>
<a name="l00902"></a>00902 <span class="preprocessor"></span>
<a name="l00903"></a>00903 <span class="comment">/*</span>
<a name="l00904"></a>00904 <span class="comment">** Change the magic from SQLITE_MAGIC_BUSY to SQLITE_MAGIC_OPEN.</span>
<a name="l00905"></a>00905 <span class="comment">** Return an error (non-zero) if the magic was not SQLITE_MAGIC_BUSY</span>
<a name="l00906"></a>00906 <span class="comment">** when this routine is called.</span>
<a name="l00907"></a>00907 <span class="comment">*/</span>
<a name="l00908"></a>00908 <span class="preprocessor">#ifdef SQLITE_DEBUG</span>
<a name="l00909"></a>00909 <span class="preprocessor"></span><span class="keywordtype">int</span> <a class="code" href="sqliteInt_8h.html#afd5afdeac4ae868c2bcb8a2246eefaf0">sqlite3SafetyOff</a>(<a class="code" href="structsqlite3.html">sqlite3</a> *db){
<a name="l00910"></a>00910   <span class="keywordflow">if</span>( db-&gt;<a class="code" href="structsqlite3.html#a6d9069c555657020c5dd1532d8e9c3f9">magic</a>==<a class="code" href="sqliteInt_8h.html#ad024aa586d9bf98f26fccca95f21b265">SQLITE_MAGIC_BUSY</a> ){
<a name="l00911"></a>00911     db-&gt;<a class="code" href="structsqlite3.html#a6d9069c555657020c5dd1532d8e9c3f9">magic</a> = <a class="code" href="sqliteInt_8h.html#a254a8538f88691bd87ebca9e5864dfcb">SQLITE_MAGIC_OPEN</a>;
<a name="l00912"></a>00912     assert( <a class="code" href="mutex_8h.html#ab92b5e853fc83d5aaa9a5d25e1883d3d">sqlite3_mutex_held</a>(db-&gt;<a class="code" href="structsqlite3.html#a6328497ac0393204ab5f5083f05731c9">mutex</a>) );
<a name="l00913"></a>00913     <span class="keywordflow">return</span> 0;
<a name="l00914"></a>00914   }<span class="keywordflow">else</span>{
<a name="l00915"></a>00915     db-&gt;<a class="code" href="structsqlite3.html#a6d9069c555657020c5dd1532d8e9c3f9">magic</a> = <a class="code" href="sqliteInt_8h.html#a1ddb89a30d5a7ecc7ea8681ea516670c">SQLITE_MAGIC_ERROR</a>;
<a name="l00916"></a>00916     db-&gt;<a class="code" href="structsqlite3.html#aa5db6567b0e7d5009c52e0307b1cf095">u1</a>.<a class="code" href="structsqlite3.html#a80b995fd97507bbf978d6960adde53f8">isInterrupted</a> = 1;
<a name="l00917"></a>00917     <span class="keywordflow">return</span> 1;
<a name="l00918"></a>00918   }
<a name="l00919"></a>00919 }
<a name="l00920"></a>00920 <span class="preprocessor">#endif</span>
<a name="l00921"></a>00921 <span class="preprocessor"></span>
<a name="l00922"></a>00922 <span class="comment">/*</span>
<a name="l00923"></a>00923 <span class="comment">** Check to make sure we have a valid db pointer.  This test is not</span>
<a name="l00924"></a>00924 <span class="comment">** foolproof but it does provide some measure of protection against</span>
<a name="l00925"></a>00925 <span class="comment">** misuse of the interface such as passing in db pointers that are</span>
<a name="l00926"></a>00926 <span class="comment">** NULL or which have been previously closed.  If this routine returns</span>
<a name="l00927"></a>00927 <span class="comment">** 1 it means that the db pointer is valid and 0 if it should not be</span>
<a name="l00928"></a>00928 <span class="comment">** dereferenced for any reason.  The calling function should invoke</span>
<a name="l00929"></a>00929 <span class="comment">** SQLITE_MISUSE immediately.</span>
<a name="l00930"></a>00930 <span class="comment">**</span>
<a name="l00931"></a>00931 <span class="comment">** sqlite3SafetyCheckOk() requires that the db pointer be valid for</span>
<a name="l00932"></a>00932 <span class="comment">** use.  sqlite3SafetyCheckSickOrOk() allows a db pointer that failed to</span>
<a name="l00933"></a>00933 <span class="comment">** open properly and is not fit for general use but which can be</span>
<a name="l00934"></a>00934 <span class="comment">** used as an argument to sqlite3_errmsg() or sqlite3_close().</span>
<a name="l00935"></a>00935 <span class="comment">*/</span>
<a name="l00936"></a><a class="code" href="util_8c.html#a6f97bd2ecf780b5f78aa56d607d6f400">00936</a> <span class="keywordtype">int</span> <a class="code" href="sqliteInt_8h.html#aab020605a0d83080a5db8fae5e51db2e">sqlite3SafetyCheckOk</a>(<a class="code" href="structsqlite3.html">sqlite3</a> *db){
<a name="l00937"></a>00937   <span class="keywordtype">int</span> magic;
<a name="l00938"></a>00938   <span class="keywordflow">if</span>( db==0 ) <span class="keywordflow">return</span> 0;
<a name="l00939"></a>00939   magic = db-&gt;<a class="code" href="structsqlite3.html#a6d9069c555657020c5dd1532d8e9c3f9">magic</a>;
<a name="l00940"></a>00940   <span class="keywordflow">if</span>( magic!=<a class="code" href="sqliteInt_8h.html#a254a8538f88691bd87ebca9e5864dfcb">SQLITE_MAGIC_OPEN</a> &amp;&amp;
<a name="l00941"></a>00941       magic!=<a class="code" href="sqliteInt_8h.html#ad024aa586d9bf98f26fccca95f21b265">SQLITE_MAGIC_BUSY</a> ) <span class="keywordflow">return</span> 0;
<a name="l00942"></a>00942   <span class="keywordflow">return</span> 1;
<a name="l00943"></a>00943 }
<a name="l00944"></a><a class="code" href="util_8c.html#ac32f917c8855a41db3ab863cdb8d1d0e">00944</a> <span class="keywordtype">int</span> <a class="code" href="sqliteInt_8h.html#aaf32c129396a15c0357ab51f3ad1c846">sqlite3SafetyCheckSickOrOk</a>(<a class="code" href="structsqlite3.html">sqlite3</a> *db){
<a name="l00945"></a>00945   <span class="keywordtype">int</span> magic;
<a name="l00946"></a>00946   <span class="keywordflow">if</span>( db==0 ) <span class="keywordflow">return</span> 0;
<a name="l00947"></a>00947   magic = db-&gt;<a class="code" href="structsqlite3.html#a6d9069c555657020c5dd1532d8e9c3f9">magic</a>;
<a name="l00948"></a>00948   <span class="keywordflow">if</span>( magic!=<a class="code" href="sqliteInt_8h.html#ad13a61785087f873b4d9009e9f90d5b8">SQLITE_MAGIC_SICK</a> &amp;&amp;
<a name="l00949"></a>00949       magic!=<a class="code" href="sqliteInt_8h.html#a254a8538f88691bd87ebca9e5864dfcb">SQLITE_MAGIC_OPEN</a> &amp;&amp;
<a name="l00950"></a>00950       magic!=<a class="code" href="sqliteInt_8h.html#ad024aa586d9bf98f26fccca95f21b265">SQLITE_MAGIC_BUSY</a> ) <span class="keywordflow">return</span> 0;
<a name="l00951"></a>00951   <span class="keywordflow">return</span> 1;
<a name="l00952"></a>00952 }
</pre></div></div>
<hr size="1">

<p style="text-align: right;">
  <a href="http://www.contextlogger.org/">ContextLogger2</a>&#8212;ContextLogger2 Logger Daemon Internals&#8212;<small>Generated on Mon May 2 13:49:57 2011 by&nbsp;<a href="http://www.doxygen.org/">Doxygen</a> 1.6.1</small>
</p>

</body>
</html>
