<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ContextLogger2 Logger Daemon Internals: os.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_53e7feede50ae4cb655a635f658a2b4e.html">sqlite3h</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_a0c08fff43b69094a2511677d8587129.html">src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_05c6b5177aad09a72e8ee1adc608dac0.html">sqlite3</a>
  </div>
</div>
<div class="contents">
<h1>os.c</h1><a href="os_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment">** 2005 November 29</span>
<a name="l00003"></a>00003 <span class="comment">**</span>
<a name="l00004"></a>00004 <span class="comment">** The author disclaims copyright to this source code.  In place of</span>
<a name="l00005"></a>00005 <span class="comment">** a legal notice, here is a blessing:</span>
<a name="l00006"></a>00006 <span class="comment">**</span>
<a name="l00007"></a>00007 <span class="comment">**    May you do good and not evil.</span>
<a name="l00008"></a>00008 <span class="comment">**    May you find forgiveness for yourself and forgive others.</span>
<a name="l00009"></a>00009 <span class="comment">**    May you share freely, never taking more than you give.</span>
<a name="l00010"></a>00010 <span class="comment">**</span>
<a name="l00011"></a>00011 <span class="comment">******************************************************************************</span>
<a name="l00012"></a>00012 <span class="comment">**</span>
<a name="l00013"></a>00013 <span class="comment">** This file contains OS interface code that is common to all</span>
<a name="l00014"></a>00014 <span class="comment">** architectures.</span>
<a name="l00015"></a>00015 <span class="comment">**</span>
<a name="l00016"></a>00016 <span class="comment">** $Id: os.c,v 1.124 2008/10/07 15:25:48 drh Exp $</span>
<a name="l00017"></a>00017 <span class="comment">*/</span>
<a name="l00018"></a><a class="code" href="os_8c.html#a2507257b4c2b446a28186e34c69e6c37">00018</a> <span class="preprocessor">#define _SQLITE_OS_C_ 1</span>
<a name="l00019"></a>00019 <span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="sqliteInt_8h.html">sqliteInt.h</a>&quot;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#undef _SQLITE_OS_C_</span>
<a name="l00021"></a>00021 <span class="preprocessor"></span>
<a name="l00022"></a>00022 <span class="comment">/*</span>
<a name="l00023"></a>00023 <span class="comment">** The default SQLite sqlite3_vfs implementations do not allocate</span>
<a name="l00024"></a>00024 <span class="comment">** memory (actually, os_unix.c allocates a small amount of memory</span>
<a name="l00025"></a>00025 <span class="comment">** from within OsOpen()), but some third-party implementations may.</span>
<a name="l00026"></a>00026 <span class="comment">** So we test the effects of a malloc() failing and the sqlite3OsXXX()</span>
<a name="l00027"></a>00027 <span class="comment">** function returning SQLITE_IOERR_NOMEM using the DO_OS_MALLOC_TEST macro.</span>
<a name="l00028"></a>00028 <span class="comment">**</span>
<a name="l00029"></a>00029 <span class="comment">** The following functions are instrumented for malloc() failure </span>
<a name="l00030"></a>00030 <span class="comment">** testing:</span>
<a name="l00031"></a>00031 <span class="comment">**</span>
<a name="l00032"></a>00032 <span class="comment">**     sqlite3OsOpen()</span>
<a name="l00033"></a>00033 <span class="comment">**     sqlite3OsRead()</span>
<a name="l00034"></a>00034 <span class="comment">**     sqlite3OsWrite()</span>
<a name="l00035"></a>00035 <span class="comment">**     sqlite3OsSync()</span>
<a name="l00036"></a>00036 <span class="comment">**     sqlite3OsLock()</span>
<a name="l00037"></a>00037 <span class="comment">**</span>
<a name="l00038"></a>00038 <span class="comment">*/</span>
<a name="l00039"></a>00039 <span class="preprocessor">#if defined(SQLITE_TEST) &amp;&amp; (SQLITE_OS_WIN==0)</span>
<a name="l00040"></a>00040 <span class="preprocessor"></span><span class="preprocessor">  #define DO_OS_MALLOC_TEST if (1) {            \</span>
<a name="l00041"></a>00041 <span class="preprocessor">    void *pTstAlloc = sqlite3Malloc(10);       \</span>
<a name="l00042"></a>00042 <span class="preprocessor">    if (!pTstAlloc) return SQLITE_IOERR_NOMEM;  \</span>
<a name="l00043"></a>00043 <span class="preprocessor">    sqlite3_free(pTstAlloc);                    \</span>
<a name="l00044"></a>00044 <span class="preprocessor">  }</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00046"></a><a class="code" href="os_8c.html#a6655b7197714fd873119ac95518b6142">00046</a> <span class="preprocessor"></span><span class="preprocessor">  #define DO_OS_MALLOC_TEST</span>
<a name="l00047"></a>00047 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00048"></a>00048 <span class="preprocessor"></span>
<a name="l00049"></a>00049 <span class="comment">/*</span>
<a name="l00050"></a>00050 <span class="comment">** The following routines are convenience wrappers around methods</span>
<a name="l00051"></a>00051 <span class="comment">** of the sqlite3_file object.  This is mostly just syntactic sugar. All</span>
<a name="l00052"></a>00052 <span class="comment">** of this would be completely automatic if SQLite were coded using</span>
<a name="l00053"></a>00053 <span class="comment">** C++ instead of plain old C.</span>
<a name="l00054"></a>00054 <span class="comment">*/</span>
<a name="l00055"></a><a class="code" href="os_8h.html#a3846de84b5142b8416942b1c8ee924dc">00055</a> <span class="keywordtype">int</span> <a class="code" href="os_8c.html#a458e3eeb363e32a910dd21ca2507a98d">sqlite3OsClose</a>(<a class="code" href="structsqlite3__file.html">sqlite3_file</a> *pId){
<a name="l00056"></a>00056   <span class="keywordtype">int</span> rc = <a class="code" href="sqlite3_8h.html#a650d09c7bec7ddadb7c8aa3519dc842c">SQLITE_OK</a>;
<a name="l00057"></a>00057   <span class="keywordflow">if</span>( pId-&gt;<a class="code" href="structsqlite3__file.html#a27d68d712557d860f3ee987cd84c7a10">pMethods</a> ){
<a name="l00058"></a>00058     rc = pId-&gt;<a class="code" href="structsqlite3__file.html#a27d68d712557d860f3ee987cd84c7a10">pMethods</a>-&gt;<a class="code" href="structsqlite3__io__methods.html#a3c021d16959e0533f507b3212681a22e">xClose</a>(pId);
<a name="l00059"></a>00059     pId-&gt;<a class="code" href="structsqlite3__file.html#a27d68d712557d860f3ee987cd84c7a10">pMethods</a> = 0;
<a name="l00060"></a>00060   }
<a name="l00061"></a>00061   <span class="keywordflow">return</span> rc;
<a name="l00062"></a>00062 }
<a name="l00063"></a><a class="code" href="os_8h.html#aca5e522de4049240cd7f65e9d6fc524b">00063</a> <span class="keywordtype">int</span> <a class="code" href="os_8c.html#a8ba5eb27c01086de33d3d43abe2863dc">sqlite3OsRead</a>(<a class="code" href="structsqlite3__file.html">sqlite3_file</a> *<span class="keywordtype">id</span>, <span class="keywordtype">void</span> *pBuf, <span class="keywordtype">int</span> amt, <a class="code" href="sqliteInt_8h.html#a2a0f0f4ae7001eb54351f77ea1cdbcfd">i64</a> offset){
<a name="l00064"></a>00064   <a class="code" href="os_8c.html#a6655b7197714fd873119ac95518b6142">DO_OS_MALLOC_TEST</a>;
<a name="l00065"></a>00065   <span class="keywordflow">return</span> <span class="keywordtype">id</span>-&gt;pMethods-&gt;xRead(<span class="keywordtype">id</span>, pBuf, amt, offset);
<a name="l00066"></a>00066 }
<a name="l00067"></a><a class="code" href="os_8h.html#a69ff97dea63d8784560c1e5e88ac82a1">00067</a> <span class="keywordtype">int</span> <a class="code" href="os_8c.html#ab2aa7b80aa192c498f721ad60860315e">sqlite3OsWrite</a>(<a class="code" href="structsqlite3__file.html">sqlite3_file</a> *<span class="keywordtype">id</span>, <span class="keyword">const</span> <span class="keywordtype">void</span> *pBuf, <span class="keywordtype">int</span> amt, <a class="code" href="sqliteInt_8h.html#a2a0f0f4ae7001eb54351f77ea1cdbcfd">i64</a> offset){
<a name="l00068"></a>00068   <a class="code" href="os_8c.html#a6655b7197714fd873119ac95518b6142">DO_OS_MALLOC_TEST</a>;
<a name="l00069"></a>00069   <span class="keywordflow">return</span> <span class="keywordtype">id</span>-&gt;pMethods-&gt;xWrite(<span class="keywordtype">id</span>, pBuf, amt, offset);
<a name="l00070"></a>00070 }
<a name="l00071"></a><a class="code" href="os_8h.html#a6ff6daaf11844e77392b3edaf2f80fc1">00071</a> <span class="keywordtype">int</span> <a class="code" href="os_8c.html#ac9663a9bea01b912890e14e536f181a9">sqlite3OsTruncate</a>(<a class="code" href="structsqlite3__file.html">sqlite3_file</a> *<span class="keywordtype">id</span>, <a class="code" href="sqliteInt_8h.html#a2a0f0f4ae7001eb54351f77ea1cdbcfd">i64</a> size){
<a name="l00072"></a>00072   <span class="keywordflow">return</span> <span class="keywordtype">id</span>-&gt;pMethods-&gt;xTruncate(<span class="keywordtype">id</span>, size);
<a name="l00073"></a>00073 }
<a name="l00074"></a><a class="code" href="os_8h.html#af4b260476d062b8bdf17fe805b9fb541">00074</a> <span class="keywordtype">int</span> <a class="code" href="os_8c.html#a08a9a7080eb78647a7906e05ccd8c7d9">sqlite3OsSync</a>(<a class="code" href="structsqlite3__file.html">sqlite3_file</a> *<span class="keywordtype">id</span>, <span class="keywordtype">int</span> flags){
<a name="l00075"></a>00075   <a class="code" href="os_8c.html#a6655b7197714fd873119ac95518b6142">DO_OS_MALLOC_TEST</a>;
<a name="l00076"></a>00076   <span class="keywordflow">return</span> <span class="keywordtype">id</span>-&gt;pMethods-&gt;xSync(<span class="keywordtype">id</span>, flags);
<a name="l00077"></a>00077 }
<a name="l00078"></a><a class="code" href="os_8h.html#a247fd637f7dd475a47d030bdcddc40df">00078</a> <span class="keywordtype">int</span> <a class="code" href="os_8c.html#aa2bb9815327ee76bca70cd42a97fa82e">sqlite3OsFileSize</a>(<a class="code" href="structsqlite3__file.html">sqlite3_file</a> *<span class="keywordtype">id</span>, <a class="code" href="sqliteInt_8h.html#a2a0f0f4ae7001eb54351f77ea1cdbcfd">i64</a> *pSize){
<a name="l00079"></a>00079   <a class="code" href="os_8c.html#a6655b7197714fd873119ac95518b6142">DO_OS_MALLOC_TEST</a>;
<a name="l00080"></a>00080   <span class="keywordflow">return</span> <span class="keywordtype">id</span>-&gt;pMethods-&gt;xFileSize(<span class="keywordtype">id</span>, pSize);
<a name="l00081"></a>00081 }
<a name="l00082"></a><a class="code" href="os_8h.html#a0eb51cc8f19b56d17a2c5dc1636fba97">00082</a> <span class="keywordtype">int</span> <a class="code" href="os_8c.html#a98dccd3dff1ff09b2c356d8946960c45">sqlite3OsLock</a>(<a class="code" href="structsqlite3__file.html">sqlite3_file</a> *<span class="keywordtype">id</span>, <span class="keywordtype">int</span> lockType){
<a name="l00083"></a>00083   <a class="code" href="os_8c.html#a6655b7197714fd873119ac95518b6142">DO_OS_MALLOC_TEST</a>;
<a name="l00084"></a>00084   <span class="keywordflow">return</span> <span class="keywordtype">id</span>-&gt;pMethods-&gt;xLock(<span class="keywordtype">id</span>, lockType);
<a name="l00085"></a>00085 }
<a name="l00086"></a><a class="code" href="os_8h.html#acbfd0965e090bac5a48f479757e58842">00086</a> <span class="keywordtype">int</span> <a class="code" href="os_8c.html#ad80fb94a60964579384230addbaab9fc">sqlite3OsUnlock</a>(<a class="code" href="structsqlite3__file.html">sqlite3_file</a> *<span class="keywordtype">id</span>, <span class="keywordtype">int</span> lockType){
<a name="l00087"></a>00087   <span class="keywordflow">return</span> <span class="keywordtype">id</span>-&gt;pMethods-&gt;xUnlock(<span class="keywordtype">id</span>, lockType);
<a name="l00088"></a>00088 }
<a name="l00089"></a><a class="code" href="os_8h.html#a9af3cbaea08b47e347d495ab30fad65d">00089</a> <span class="keywordtype">int</span> <a class="code" href="os_8c.html#a9af3cbaea08b47e347d495ab30fad65d">sqlite3OsCheckReservedLock</a>(<a class="code" href="structsqlite3__file.html">sqlite3_file</a> *<span class="keywordtype">id</span>, <span class="keywordtype">int</span> *pResOut){
<a name="l00090"></a>00090   <a class="code" href="os_8c.html#a6655b7197714fd873119ac95518b6142">DO_OS_MALLOC_TEST</a>;
<a name="l00091"></a>00091   <span class="keywordflow">return</span> <span class="keywordtype">id</span>-&gt;pMethods-&gt;xCheckReservedLock(<span class="keywordtype">id</span>, pResOut);
<a name="l00092"></a>00092 }
<a name="l00093"></a><a class="code" href="os_8h.html#ad5a1005592cd677168ed79738d4c8b95">00093</a> <span class="keywordtype">int</span> <a class="code" href="os_8c.html#ab2a73d96e3dab8795109b7d5b5612e88">sqlite3OsFileControl</a>(<a class="code" href="structsqlite3__file.html">sqlite3_file</a> *<span class="keywordtype">id</span>, <span class="keywordtype">int</span> op, <span class="keywordtype">void</span> *pArg){
<a name="l00094"></a>00094   <span class="keywordflow">return</span> <span class="keywordtype">id</span>-&gt;pMethods-&gt;xFileControl(<span class="keywordtype">id</span>, op, pArg);
<a name="l00095"></a>00095 }
<a name="l00096"></a><a class="code" href="os_8h.html#a1ed0d544bfad30e3d2d0d332aed462fa">00096</a> <span class="keywordtype">int</span> <a class="code" href="os_8c.html#a1ed0d544bfad30e3d2d0d332aed462fa">sqlite3OsSectorSize</a>(<a class="code" href="structsqlite3__file.html">sqlite3_file</a> *<span class="keywordtype">id</span>){
<a name="l00097"></a>00097   int (*xSectorSize)(<a class="code" href="structsqlite3__file.html">sqlite3_file</a>*) = id-&gt;<a class="code" href="structsqlite3__file.html#a27d68d712557d860f3ee987cd84c7a10">pMethods</a>-&gt;<a class="code" href="structsqlite3__io__methods.html#a8436e6eeac404b35057be97f3c2b5c3d">xSectorSize</a>;
<a name="l00098"></a>00098   return (xSectorSize ? xSectorSize(<span class="keywordtype">id</span>) : <a class="code" href="os_8h.html#ab35bd9ac959b178e2ce0f7ccd646c557">SQLITE_DEFAULT_SECTOR_SIZE</a>);
<a name="l00099"></a>00099 }
<a name="l00100"></a><a class="code" href="os_8h.html#a58cdb6aae4a35782cfcd2298ee239a99">00100</a> <span class="keywordtype">int</span> <a class="code" href="os_8c.html#a58cdb6aae4a35782cfcd2298ee239a99">sqlite3OsDeviceCharacteristics</a>(<a class="code" href="structsqlite3__file.html">sqlite3_file</a> *<span class="keywordtype">id</span>){
<a name="l00101"></a>00101   <span class="keywordflow">return</span> <span class="keywordtype">id</span>-&gt;pMethods-&gt;xDeviceCharacteristics(<span class="keywordtype">id</span>);
<a name="l00102"></a>00102 }
<a name="l00103"></a>00103 
<a name="l00104"></a>00104 <span class="comment">/*</span>
<a name="l00105"></a>00105 <span class="comment">** The next group of routines are convenience wrappers around the</span>
<a name="l00106"></a>00106 <span class="comment">** VFS methods.</span>
<a name="l00107"></a>00107 <span class="comment">*/</span>
<a name="l00108"></a><a class="code" href="os_8h.html#a48942b4cff5f8726a273b9b07d85dc75">00108</a> <span class="keywordtype">int</span> <a class="code" href="os_8c.html#ac3ec0b9862182928d45cf63695dfeb9f">sqlite3OsOpen</a>(
<a name="l00109"></a>00109   <a class="code" href="structsqlite3__vfs.html">sqlite3_vfs</a> *pVfs, 
<a name="l00110"></a>00110   <span class="keyword">const</span> <span class="keywordtype">char</span> *zPath, 
<a name="l00111"></a>00111   <a class="code" href="structsqlite3__file.html">sqlite3_file</a> *pFile, 
<a name="l00112"></a>00112   <span class="keywordtype">int</span> flags, 
<a name="l00113"></a>00113   <span class="keywordtype">int</span> *pFlagsOut
<a name="l00114"></a>00114 ){
<a name="l00115"></a>00115   <a class="code" href="os_8c.html#a6655b7197714fd873119ac95518b6142">DO_OS_MALLOC_TEST</a>;
<a name="l00116"></a>00116   <span class="keywordflow">return</span> pVfs-&gt;<a class="code" href="structsqlite3__vfs.html#a5f35d5528d8fdf1d26e1e206879afbe1">xOpen</a>(pVfs, zPath, pFile, flags, pFlagsOut);
<a name="l00117"></a>00117 }
<a name="l00118"></a><a class="code" href="os_8h.html#a62664cb3cf58c3feef426e05e083cc1f">00118</a> <span class="keywordtype">int</span> <a class="code" href="os_8c.html#aefc174f728d138188ac764088382e342">sqlite3OsDelete</a>(<a class="code" href="structsqlite3__vfs.html">sqlite3_vfs</a> *pVfs, <span class="keyword">const</span> <span class="keywordtype">char</span> *zPath, <span class="keywordtype">int</span> dirSync){
<a name="l00119"></a>00119   <span class="keywordflow">return</span> pVfs-&gt;<a class="code" href="structsqlite3__vfs.html#a5f547a3e54f91c7ebef140d51054bbc0">xDelete</a>(pVfs, zPath, dirSync);
<a name="l00120"></a>00120 }
<a name="l00121"></a><a class="code" href="os_8h.html#ae99f2b5ec2110472da9f0cb3bbb45222">00121</a> <span class="keywordtype">int</span> <a class="code" href="os_8c.html#a0cae4a47231c187a56c7b1aa98708b6a">sqlite3OsAccess</a>(
<a name="l00122"></a>00122   <a class="code" href="structsqlite3__vfs.html">sqlite3_vfs</a> *pVfs, 
<a name="l00123"></a>00123   <span class="keyword">const</span> <span class="keywordtype">char</span> *zPath, 
<a name="l00124"></a>00124   <span class="keywordtype">int</span> flags, 
<a name="l00125"></a>00125   <span class="keywordtype">int</span> *pResOut
<a name="l00126"></a>00126 ){
<a name="l00127"></a>00127   <a class="code" href="os_8c.html#a6655b7197714fd873119ac95518b6142">DO_OS_MALLOC_TEST</a>;
<a name="l00128"></a>00128   <span class="keywordflow">return</span> pVfs-&gt;<a class="code" href="structsqlite3__vfs.html#ab4344474034c2dbc9223a362c65ff235">xAccess</a>(pVfs, zPath, flags, pResOut);
<a name="l00129"></a>00129 }
<a name="l00130"></a><a class="code" href="os_8h.html#a2b23a06e31022b3b5872b5a4c5f8cf85">00130</a> <span class="keywordtype">int</span> <a class="code" href="os_8c.html#a0107e460384be5fa29765421c20e4a46">sqlite3OsFullPathname</a>(
<a name="l00131"></a>00131   <a class="code" href="structsqlite3__vfs.html">sqlite3_vfs</a> *pVfs, 
<a name="l00132"></a>00132   <span class="keyword">const</span> <span class="keywordtype">char</span> *zPath, 
<a name="l00133"></a>00133   <span class="keywordtype">int</span> nPathOut, 
<a name="l00134"></a>00134   <span class="keywordtype">char</span> *zPathOut
<a name="l00135"></a>00135 ){
<a name="l00136"></a>00136   <span class="keywordflow">return</span> pVfs-&gt;<a class="code" href="structsqlite3__vfs.html#a02fafc56d26adab5f236df6493a8bd55">xFullPathname</a>(pVfs, zPath, nPathOut, zPathOut);
<a name="l00137"></a>00137 }
<a name="l00138"></a>00138 <span class="preprocessor">#ifndef SQLITE_OMIT_LOAD_EXTENSION</span>
<a name="l00139"></a><a class="code" href="os_8h.html#ac356c3e8f2bd2d50ac2e1a42668e8471">00139</a> <span class="preprocessor"></span><span class="keywordtype">void</span> *<a class="code" href="os_8c.html#a412d2fa42a07218da7b55ea93bba4f8c">sqlite3OsDlOpen</a>(<a class="code" href="structsqlite3__vfs.html">sqlite3_vfs</a> *pVfs, <span class="keyword">const</span> <span class="keywordtype">char</span> *zPath){
<a name="l00140"></a>00140   <span class="keywordflow">return</span> pVfs-&gt;<a class="code" href="structsqlite3__vfs.html#ad896d84388d20f7e69fa277bc034eb68">xDlOpen</a>(pVfs, zPath);
<a name="l00141"></a>00141 }
<a name="l00142"></a><a class="code" href="os_8h.html#a965588423d802138a42f8e1480761b14">00142</a> <span class="keywordtype">void</span> <a class="code" href="os_8c.html#af9fbae7f2b134a6af40faaac0d7da5aa">sqlite3OsDlError</a>(<a class="code" href="structsqlite3__vfs.html">sqlite3_vfs</a> *pVfs, <span class="keywordtype">int</span> nByte, <span class="keywordtype">char</span> *zBufOut){
<a name="l00143"></a>00143   pVfs-&gt;<a class="code" href="structsqlite3__vfs.html#a3cda3a00a43861cef4d5554354cdfda4">xDlError</a>(pVfs, nByte, zBufOut);
<a name="l00144"></a>00144 }
<a name="l00145"></a><a class="code" href="os_8h.html#aef0ea866ecc3c3fb7f21119b10af39af">00145</a> <span class="keywordtype">void</span> *<a class="code" href="os_8c.html#a40ad63fe8bd92889251d54b3a616dd97">sqlite3OsDlSym</a>(<a class="code" href="structsqlite3__vfs.html">sqlite3_vfs</a> *pVfs, <span class="keywordtype">void</span> *pHandle, <span class="keyword">const</span> <span class="keywordtype">char</span> *zSymbol){
<a name="l00146"></a>00146   <span class="keywordflow">return</span> pVfs-&gt;<a class="code" href="structsqlite3__vfs.html#ab5ad5f6c327471d778e24d434aabcc60">xDlSym</a>(pVfs, pHandle, zSymbol);
<a name="l00147"></a>00147 }
<a name="l00148"></a><a class="code" href="os_8h.html#a519ccd066ee07c6ef2b47d69c8ed3223">00148</a> <span class="keywordtype">void</span> <a class="code" href="os_8c.html#a53a98f8689f0cf46bb9f07a4d72b81bd">sqlite3OsDlClose</a>(<a class="code" href="structsqlite3__vfs.html">sqlite3_vfs</a> *pVfs, <span class="keywordtype">void</span> *pHandle){
<a name="l00149"></a>00149   pVfs-&gt;<a class="code" href="structsqlite3__vfs.html#adaa986b55a44971e7048d160ac5071ad">xDlClose</a>(pVfs, pHandle);
<a name="l00150"></a>00150 }
<a name="l00151"></a>00151 <span class="preprocessor">#endif </span><span class="comment">/* SQLITE_OMIT_LOAD_EXTENSION */</span>
<a name="l00152"></a><a class="code" href="os_8h.html#abfb8f451a3420bdc9e97852d300753d3">00152</a> <span class="keywordtype">int</span> <a class="code" href="os_8c.html#a0d278d7fb9b18671ccb3be5c20b5c2d1">sqlite3OsRandomness</a>(<a class="code" href="structsqlite3__vfs.html">sqlite3_vfs</a> *pVfs, <span class="keywordtype">int</span> nByte, <span class="keywordtype">char</span> *zBufOut){
<a name="l00153"></a>00153   <span class="keywordflow">return</span> pVfs-&gt;<a class="code" href="structsqlite3__vfs.html#ace3fcb41cb01a947457532f645ba4c88">xRandomness</a>(pVfs, nByte, zBufOut);
<a name="l00154"></a>00154 }
<a name="l00155"></a><a class="code" href="os_8h.html#a53885f39b078fedee17859b6bca82167">00155</a> <span class="keywordtype">int</span> <a class="code" href="os_8c.html#a0534cab88cfb39b03c0f2a80494acf56">sqlite3OsSleep</a>(<a class="code" href="structsqlite3__vfs.html">sqlite3_vfs</a> *pVfs, <span class="keywordtype">int</span> nMicro){
<a name="l00156"></a>00156   <span class="keywordflow">return</span> pVfs-&gt;<a class="code" href="structsqlite3__vfs.html#a8ebcfaceced9713024cb8e2508fe6c1b">xSleep</a>(pVfs, nMicro);
<a name="l00157"></a>00157 }
<a name="l00158"></a><a class="code" href="os_8h.html#a288a4b6dc736d11bddd46742c9db8b4e">00158</a> <span class="keywordtype">int</span> <a class="code" href="os_8c.html#a1371fb22564c725792654f13c9e85cfe">sqlite3OsCurrentTime</a>(<a class="code" href="structsqlite3__vfs.html">sqlite3_vfs</a> *pVfs, <span class="keywordtype">double</span> *pTimeOut){
<a name="l00159"></a>00159   <span class="keywordflow">return</span> pVfs-&gt;<a class="code" href="structsqlite3__vfs.html#ab85a8a3ab59f76a6685508fefaa7b691">xCurrentTime</a>(pVfs, pTimeOut);
<a name="l00160"></a>00160 }
<a name="l00161"></a>00161 
<a name="l00162"></a><a class="code" href="os_8h.html#ab27d279fc5a39eb523fe9233c1250571">00162</a> <span class="keywordtype">int</span> <a class="code" href="os_8c.html#abc39a77b7f8cb5b745e409fcdae89e84">sqlite3OsOpenMalloc</a>(
<a name="l00163"></a>00163   <a class="code" href="structsqlite3__vfs.html">sqlite3_vfs</a> *pVfs, 
<a name="l00164"></a>00164   <span class="keyword">const</span> <span class="keywordtype">char</span> *zFile, 
<a name="l00165"></a>00165   <a class="code" href="structsqlite3__file.html">sqlite3_file</a> **ppFile, 
<a name="l00166"></a>00166   <span class="keywordtype">int</span> flags,
<a name="l00167"></a>00167   <span class="keywordtype">int</span> *pOutFlags
<a name="l00168"></a>00168 ){
<a name="l00169"></a>00169   <span class="keywordtype">int</span> rc = <a class="code" href="sqlite3_8h.html#a9e34c7a5186dc9095e108e517eaac9f6">SQLITE_NOMEM</a>;
<a name="l00170"></a>00170   <a class="code" href="structsqlite3__file.html">sqlite3_file</a> *pFile;
<a name="l00171"></a>00171   pFile = (<a class="code" href="structsqlite3__file.html">sqlite3_file</a> *)<a class="code" href="malloc_8c.html#a8c1a33577a57524c7c6eef3d9e64e742">sqlite3Malloc</a>(pVfs-&gt;<a class="code" href="structsqlite3__vfs.html#a549399081342d61134b6398562a0a997">szOsFile</a>);
<a name="l00172"></a>00172   <span class="keywordflow">if</span>( pFile ){
<a name="l00173"></a>00173     rc = <a class="code" href="os_8c.html#ac3ec0b9862182928d45cf63695dfeb9f">sqlite3OsOpen</a>(pVfs, zFile, pFile, flags, pOutFlags);
<a name="l00174"></a>00174     <span class="keywordflow">if</span>( rc!=<a class="code" href="sqlite3_8h.html#a650d09c7bec7ddadb7c8aa3519dc842c">SQLITE_OK</a> ){
<a name="l00175"></a>00175       <a class="code" href="malloc_8c.html#a89d4380358f918be2a8e2171d95bbb04">sqlite3_free</a>(pFile);
<a name="l00176"></a>00176     }<span class="keywordflow">else</span>{
<a name="l00177"></a>00177       *ppFile = pFile;
<a name="l00178"></a>00178     }
<a name="l00179"></a>00179   }
<a name="l00180"></a>00180   <span class="keywordflow">return</span> rc;
<a name="l00181"></a>00181 }
<a name="l00182"></a><a class="code" href="os_8h.html#a27c70375b86856478c41c48c9250bb8e">00182</a> <span class="keywordtype">int</span> <a class="code" href="os_8c.html#a454eb770db26fff1e88f4f82ed3e3195">sqlite3OsCloseFree</a>(<a class="code" href="structsqlite3__file.html">sqlite3_file</a> *pFile){
<a name="l00183"></a>00183   <span class="keywordtype">int</span> rc = <a class="code" href="sqlite3_8h.html#a650d09c7bec7ddadb7c8aa3519dc842c">SQLITE_OK</a>;
<a name="l00184"></a>00184   assert( pFile );
<a name="l00185"></a>00185   rc = <a class="code" href="os_8c.html#a458e3eeb363e32a910dd21ca2507a98d">sqlite3OsClose</a>(pFile);
<a name="l00186"></a>00186   <a class="code" href="malloc_8c.html#a89d4380358f918be2a8e2171d95bbb04">sqlite3_free</a>(pFile);
<a name="l00187"></a>00187   <span class="keywordflow">return</span> rc;
<a name="l00188"></a>00188 }
<a name="l00189"></a>00189 
<a name="l00190"></a>00190 <span class="comment">/*</span>
<a name="l00191"></a>00191 <span class="comment">** The list of all registered VFS implementations.</span>
<a name="l00192"></a>00192 <span class="comment">*/</span>
<a name="l00193"></a><a class="code" href="os_8c.html#ad9ed2d5a349140ddb00ca3efcb38738e">00193</a> <span class="keyword">static</span> <a class="code" href="structsqlite3__vfs.html">sqlite3_vfs</a> * <a class="code" href="sqliteInt_8h.html#a8e0dad3bed1d9dc1ee42098adace3cb8">SQLITE_WSD</a> <a class="code" href="os_8c.html#a9a303c352868b9694a24f19638a9a873">vfsList</a> = 0;
<a name="l00194"></a><a class="code" href="os_8c.html#a9a303c352868b9694a24f19638a9a873">00194</a> <span class="preprocessor">#define vfsList GLOBAL(sqlite3_vfs *, vfsList)</span>
<a name="l00195"></a>00195 <span class="preprocessor"></span>
<a name="l00196"></a>00196 <span class="comment">/*</span>
<a name="l00197"></a>00197 <span class="comment">** Locate a VFS by name.  If no name is given, simply return the</span>
<a name="l00198"></a>00198 <span class="comment">** first VFS on the list.</span>
<a name="l00199"></a>00199 <span class="comment">*/</span>
<a name="l00200"></a><a class="code" href="sqlite3_8h.html#a5c5ee130308ed15ec2cb9394ce617d08">00200</a> <a class="code" href="structsqlite3__vfs.html">sqlite3_vfs</a> *<a class="code" href="os_8c.html#a5ab343e252c5fb97d15e06dbe9c3ebd2">sqlite3_vfs_find</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *zVfs){
<a name="l00201"></a>00201   <a class="code" href="structsqlite3__vfs.html">sqlite3_vfs</a> *pVfs = 0;
<a name="l00202"></a>00202 <span class="preprocessor">#if SQLITE_THREADSAFE</span>
<a name="l00203"></a>00203 <span class="preprocessor"></span>  <a class="code" href="sqlite3_8h.html#a0f546860bde03fddb33a9fed920da05c">sqlite3_mutex</a> *mutex;
<a name="l00204"></a>00204 <span class="preprocessor">#endif</span>
<a name="l00205"></a>00205 <span class="preprocessor"></span><span class="preprocessor">#ifndef SQLITE_OMIT_AUTOINIT</span>
<a name="l00206"></a>00206 <span class="preprocessor"></span>  <span class="keywordtype">int</span> rc = <a class="code" href="main_8c.html#a11cd4a01bc7c0dba16f4b737409b7069">sqlite3_initialize</a>();
<a name="l00207"></a>00207   <span class="keywordflow">if</span>( rc ) <span class="keywordflow">return</span> 0;
<a name="l00208"></a>00208 <span class="preprocessor">#endif</span>
<a name="l00209"></a>00209 <span class="preprocessor"></span><span class="preprocessor">#if SQLITE_THREADSAFE</span>
<a name="l00210"></a>00210 <span class="preprocessor"></span>  mutex = <a class="code" href="mutex_8h.html#a35e6a158f17df4b319462d26685c345f">sqlite3MutexAlloc</a>(<a class="code" href="sqlite3_8h.html#a182cdcec7ab77f67221af68bcd805cc6">SQLITE_MUTEX_STATIC_MASTER</a>);
<a name="l00211"></a>00211 <span class="preprocessor">#endif</span>
<a name="l00212"></a>00212 <span class="preprocessor"></span>  <a class="code" href="mutex_8h.html#afbab5dc0108b65678f2fa579473041ac">sqlite3_mutex_enter</a>(mutex);
<a name="l00213"></a>00213   <span class="keywordflow">for</span>(pVfs = <a class="code" href="os_8c.html#a9a303c352868b9694a24f19638a9a873">vfsList</a>; pVfs; pVfs=pVfs-&gt;<a class="code" href="structsqlite3__vfs.html#ae795a4417697ecd35163f6cdf0069073">pNext</a>){
<a name="l00214"></a>00214     <span class="keywordflow">if</span>( zVfs==0 ) <span class="keywordflow">break</span>;
<a name="l00215"></a>00215     <span class="keywordflow">if</span>( strcmp(zVfs, pVfs-&gt;<a class="code" href="structsqlite3__vfs.html#a0f06a27ac2201ea04c0623ef19e5d73e">zName</a>)==0 ) <span class="keywordflow">break</span>;
<a name="l00216"></a>00216   }
<a name="l00217"></a>00217   <a class="code" href="mutex_8h.html#aba06556afc1a17868af4675ba856701c">sqlite3_mutex_leave</a>(mutex);
<a name="l00218"></a>00218   <span class="keywordflow">return</span> pVfs;
<a name="l00219"></a>00219 }
<a name="l00220"></a>00220 
<a name="l00221"></a>00221 <span class="comment">/*</span>
<a name="l00222"></a>00222 <span class="comment">** Unlink a VFS from the linked list</span>
<a name="l00223"></a>00223 <span class="comment">*/</span>
<a name="l00224"></a><a class="code" href="os_8c.html#ac83aba5f7ebe1ae9bdcf187ea2a8a692">00224</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="os_8c.html#ac83aba5f7ebe1ae9bdcf187ea2a8a692">vfsUnlink</a>(<a class="code" href="structsqlite3__vfs.html">sqlite3_vfs</a> *pVfs){
<a name="l00225"></a>00225   assert( <a class="code" href="mutex_8h.html#ab92b5e853fc83d5aaa9a5d25e1883d3d">sqlite3_mutex_held</a>(<a class="code" href="mutex_8h.html#a35e6a158f17df4b319462d26685c345f">sqlite3MutexAlloc</a>(<a class="code" href="sqlite3_8h.html#a182cdcec7ab77f67221af68bcd805cc6">SQLITE_MUTEX_STATIC_MASTER</a>)) );
<a name="l00226"></a>00226   <span class="keywordflow">if</span>( pVfs==0 ){
<a name="l00227"></a>00227     <span class="comment">/* No-op */</span>
<a name="l00228"></a>00228   }<span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="os_8c.html#a9a303c352868b9694a24f19638a9a873">vfsList</a>==pVfs ){
<a name="l00229"></a>00229     <a class="code" href="os_8c.html#a9a303c352868b9694a24f19638a9a873">vfsList</a> = pVfs-&gt;<a class="code" href="structsqlite3__vfs.html#ae795a4417697ecd35163f6cdf0069073">pNext</a>;
<a name="l00230"></a>00230   }<span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="os_8c.html#a9a303c352868b9694a24f19638a9a873">vfsList</a> ){
<a name="l00231"></a>00231     <a class="code" href="structsqlite3__vfs.html">sqlite3_vfs</a> *p = <a class="code" href="os_8c.html#a9a303c352868b9694a24f19638a9a873">vfsList</a>;
<a name="l00232"></a>00232     <span class="keywordflow">while</span>( p-&gt;<a class="code" href="structsqlite3__vfs.html#ae795a4417697ecd35163f6cdf0069073">pNext</a> &amp;&amp; p-&gt;<a class="code" href="structsqlite3__vfs.html#ae795a4417697ecd35163f6cdf0069073">pNext</a>!=pVfs ){
<a name="l00233"></a>00233       p = p-&gt;<a class="code" href="structsqlite3__vfs.html#ae795a4417697ecd35163f6cdf0069073">pNext</a>;
<a name="l00234"></a>00234     }
<a name="l00235"></a>00235     <span class="keywordflow">if</span>( p-&gt;<a class="code" href="structsqlite3__vfs.html#ae795a4417697ecd35163f6cdf0069073">pNext</a>==pVfs ){
<a name="l00236"></a>00236       p-&gt;<a class="code" href="structsqlite3__vfs.html#ae795a4417697ecd35163f6cdf0069073">pNext</a> = pVfs-&gt;<a class="code" href="structsqlite3__vfs.html#ae795a4417697ecd35163f6cdf0069073">pNext</a>;
<a name="l00237"></a>00237     }
<a name="l00238"></a>00238   }
<a name="l00239"></a>00239 }
<a name="l00240"></a>00240 
<a name="l00241"></a>00241 <span class="comment">/*</span>
<a name="l00242"></a>00242 <span class="comment">** Register a VFS with the system.  It is harmless to register the same</span>
<a name="l00243"></a>00243 <span class="comment">** VFS multiple times.  The new VFS becomes the default if makeDflt is</span>
<a name="l00244"></a>00244 <span class="comment">** true.</span>
<a name="l00245"></a>00245 <span class="comment">*/</span>
<a name="l00246"></a><a class="code" href="sqlite3_8h.html#a5771288cb6cdb753b70604e5f49ecf3f">00246</a> <span class="keywordtype">int</span> <a class="code" href="os_8c.html#ae7c5e86e3ae223cde05a7a03a32ed4f2">sqlite3_vfs_register</a>(<a class="code" href="structsqlite3__vfs.html">sqlite3_vfs</a> *pVfs, <span class="keywordtype">int</span> makeDflt){
<a name="l00247"></a>00247   <a class="code" href="sqlite3_8h.html#a0f546860bde03fddb33a9fed920da05c">sqlite3_mutex</a> *mutex = 0;
<a name="l00248"></a>00248 <span class="preprocessor">#ifndef SQLITE_OMIT_AUTOINIT</span>
<a name="l00249"></a>00249 <span class="preprocessor"></span>  <span class="keywordtype">int</span> rc = <a class="code" href="main_8c.html#a11cd4a01bc7c0dba16f4b737409b7069">sqlite3_initialize</a>();
<a name="l00250"></a>00250   <span class="keywordflow">if</span>( rc ) <span class="keywordflow">return</span> rc;
<a name="l00251"></a>00251 <span class="preprocessor">#endif</span>
<a name="l00252"></a>00252 <span class="preprocessor"></span>  mutex = <a class="code" href="mutex_8h.html#a35e6a158f17df4b319462d26685c345f">sqlite3MutexAlloc</a>(<a class="code" href="sqlite3_8h.html#a182cdcec7ab77f67221af68bcd805cc6">SQLITE_MUTEX_STATIC_MASTER</a>);
<a name="l00253"></a>00253   <a class="code" href="mutex_8h.html#afbab5dc0108b65678f2fa579473041ac">sqlite3_mutex_enter</a>(mutex);
<a name="l00254"></a>00254   <a class="code" href="os_8c.html#ac83aba5f7ebe1ae9bdcf187ea2a8a692">vfsUnlink</a>(pVfs);
<a name="l00255"></a>00255   <span class="keywordflow">if</span>( makeDflt || <a class="code" href="os_8c.html#a9a303c352868b9694a24f19638a9a873">vfsList</a>==0 ){
<a name="l00256"></a>00256     pVfs-&gt;<a class="code" href="structsqlite3__vfs.html#ae795a4417697ecd35163f6cdf0069073">pNext</a> = <a class="code" href="os_8c.html#a9a303c352868b9694a24f19638a9a873">vfsList</a>;
<a name="l00257"></a>00257     <a class="code" href="os_8c.html#a9a303c352868b9694a24f19638a9a873">vfsList</a> = pVfs;
<a name="l00258"></a>00258   }<span class="keywordflow">else</span>{
<a name="l00259"></a>00259     pVfs-&gt;<a class="code" href="structsqlite3__vfs.html#ae795a4417697ecd35163f6cdf0069073">pNext</a> = <a class="code" href="os_8c.html#a9a303c352868b9694a24f19638a9a873">vfsList</a>-&gt;pNext;
<a name="l00260"></a>00260     <a class="code" href="os_8c.html#a9a303c352868b9694a24f19638a9a873">vfsList</a>-&gt;pNext = pVfs;
<a name="l00261"></a>00261   }
<a name="l00262"></a>00262   assert(<a class="code" href="os_8c.html#a9a303c352868b9694a24f19638a9a873">vfsList</a>);
<a name="l00263"></a>00263   <a class="code" href="mutex_8h.html#aba06556afc1a17868af4675ba856701c">sqlite3_mutex_leave</a>(mutex);
<a name="l00264"></a>00264   <span class="keywordflow">return</span> <a class="code" href="sqlite3_8h.html#a650d09c7bec7ddadb7c8aa3519dc842c">SQLITE_OK</a>;
<a name="l00265"></a>00265 }
<a name="l00266"></a>00266 
<a name="l00267"></a>00267 <span class="comment">/*</span>
<a name="l00268"></a>00268 <span class="comment">** Unregister a VFS so that it is no longer accessible.</span>
<a name="l00269"></a>00269 <span class="comment">*/</span>
<a name="l00270"></a><a class="code" href="sqlite3_8h.html#a66a4cd4d9d178e89474ba6117c56c012">00270</a> <span class="keywordtype">int</span> <a class="code" href="os_8c.html#ae213c9262c098c1858044f2f121067f0">sqlite3_vfs_unregister</a>(<a class="code" href="structsqlite3__vfs.html">sqlite3_vfs</a> *pVfs){
<a name="l00271"></a>00271 <span class="preprocessor">#if SQLITE_THREADSAFE</span>
<a name="l00272"></a>00272 <span class="preprocessor"></span>  <a class="code" href="sqlite3_8h.html#a0f546860bde03fddb33a9fed920da05c">sqlite3_mutex</a> *mutex = <a class="code" href="mutex_8h.html#a35e6a158f17df4b319462d26685c345f">sqlite3MutexAlloc</a>(<a class="code" href="sqlite3_8h.html#a182cdcec7ab77f67221af68bcd805cc6">SQLITE_MUTEX_STATIC_MASTER</a>);
<a name="l00273"></a>00273 <span class="preprocessor">#endif</span>
<a name="l00274"></a>00274 <span class="preprocessor"></span>  <a class="code" href="mutex_8h.html#afbab5dc0108b65678f2fa579473041ac">sqlite3_mutex_enter</a>(mutex);
<a name="l00275"></a>00275   <a class="code" href="os_8c.html#ac83aba5f7ebe1ae9bdcf187ea2a8a692">vfsUnlink</a>(pVfs);
<a name="l00276"></a>00276   <a class="code" href="mutex_8h.html#aba06556afc1a17868af4675ba856701c">sqlite3_mutex_leave</a>(mutex);
<a name="l00277"></a>00277   <span class="keywordflow">return</span> <a class="code" href="sqlite3_8h.html#a650d09c7bec7ddadb7c8aa3519dc842c">SQLITE_OK</a>;
<a name="l00278"></a>00278 }
</pre></div></div>
<hr size="1">

<p style="text-align: right;">
  <a href="http://www.contextlogger.org/">ContextLogger2</a>&#8212;ContextLogger2 Logger Daemon Internals&#8212;<small>Generated on Mon May 2 13:49:55 2011 by&nbsp;<a href="http://www.doxygen.org/">Doxygen</a> 1.6.1</small>
</p>

</body>
</html>
