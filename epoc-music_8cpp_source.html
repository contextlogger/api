<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ContextLogger2 Logger Daemon Internals: epoc-music.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_ce488f798153ac6666006744a35bf93c.html">src</a>
  </div>
</div>
<div class="contents">
<h1>epoc-music.cpp</h1><a href="epoc-music_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> !concept {:name =&gt; &quot;Tracking music playback on Symbian&quot;}</span>
<a name="l00003"></a>00003 <span class="comment">*/</span>
<a name="l00004"></a>00004 <span class="comment"></span>
<a name="l00005"></a>00005 <span class="comment">/** </span>
<a name="l00006"></a>00006 <span class="comment"></span>
<a name="l00007"></a>00007 <span class="comment">  Music artist and track logging</span>
<a name="l00008"></a>00008 <span class="comment"></span>
<a name="l00009"></a>00009 <span class="comment">  References:</span>
<a name="l00010"></a>00010 <span class="comment"></span>
<a name="l00011"></a>00011 <span class="comment">  Sample source code for example in the [Music Player Remote https://www.iyouit.eu/portal/Software.aspx] PyS60 extension.</span>
<a name="l00012"></a>00012 <span class="comment"></span>
<a name="l00013"></a>00013 <span class="comment">  As for APIs, see the [Media Player Engine API http://wiki.forum.nokia.com/index.php/Media_Player_Engine_API]. Related, possibly interesting API: [Audio Metadata Reader API http://wiki.forum.nokia.com/index.php/Audio_Metadata_Reader_API]. [Music Player Remote Control API http://wiki.forum.nokia.com/index.php/Music_Player_Remote_Control_API] sounds highly related despite the name, but do note [this http://wiki.forum.nokia.com/index.php/KIS001005_-_Music_Player_Remote_Control_API_does_not_work_in_all_S60_3rd_Edition%2C_FP1_and_FP2_devices] issue. For more recent devices see [MPX Playback Utility API http://wiki.forum.nokia.com/index.php/TSS001652_-_Using_MPX_Playback_Utility_API].</span>
<a name="l00014"></a>00014 <span class="comment"></span>
<a name="l00015"></a>00015 <span class="comment"> */</span>
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 <span class="preprocessor">#include &quot;<a class="code" href="epoc-music_8hpp.html">epoc-music.hpp</a>&quot;</span>
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;<a class="code" href="er__errors_8h.html">er_errors.h</a>&quot;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="ld__logging_8h.html">ld_logging.h</a>&quot;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;<a class="code" href="sa__sensor__list__log__db_8h.html">sa_sensor_list_log_db.h</a>&quot;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;<a class="code" href="utils__cl2_8h.html">utils_cl2.h</a>&quot;</span>
<a name="l00023"></a>00023 
<a name="l00024"></a><a class="code" href="classMyTrackInfo.html">00024</a> NONSHARABLE_CLASS(<a class="code" href="classMyTrackInfo.html">MyTrackInfo</a>)
<a name="l00025"></a>00025 {
<a name="l00026"></a>00026  <span class="keyword">public</span>:
<a name="l00027"></a><a class="code" href="classMyTrackInfo.html#a27021c5d1c1a56ec125e32d3044753be">00027</a>   <a class="code" href="classMyTrackInfo.html#a27021c5d1c1a56ec125e32d3044753be">MyTrackInfo</a>() : iUrl(0), iArtist(0), iTitle(0), iAlbum(0) {}
<a name="l00028"></a>00028 
<a name="l00029"></a><a class="code" href="classMyTrackInfo.html#a724271e1bf2d4687dcdae32a11cf9b20">00029</a>   HBufC8* iUrl; <span class="comment">// owned</span>
<a name="l00030"></a><a class="code" href="classMyTrackInfo.html#aeabc565af3f88b1f96bf94d8949b1e0c">00030</a>   HBufC8* iArtist; <span class="comment">// owned</span>
<a name="l00031"></a><a class="code" href="classMyTrackInfo.html#afda1038c7dce915bc78ecbd8ab9443c5">00031</a>   HBufC8* iTitle; <span class="comment">// owned</span>
<a name="l00032"></a><a class="code" href="classMyTrackInfo.html#a15d9a6ff909f372aee980871ab656d19">00032</a>   HBufC8* iAlbum; <span class="comment">// owned</span>
<a name="l00033"></a>00033 
<a name="l00034"></a><a class="code" href="classMyTrackInfo.html#a898d1d342034e44291da5e012a5fbd11">00034</a>   <span class="keywordtype">void</span> <a class="code" href="classMyTrackInfo.html#a898d1d342034e44291da5e012a5fbd11">Reset</a>() {
<a name="l00035"></a>00035     DELETE_Z(iUrl);
<a name="l00036"></a>00036     DELETE_Z(iTitle);
<a name="l00037"></a>00037     DELETE_Z(iArtist);
<a name="l00038"></a>00038     DELETE_Z(iAlbum);
<a name="l00039"></a>00039   }
<a name="l00040"></a>00040 
<a name="l00041"></a><a class="code" href="classMyTrackInfo.html#a6eaf8bacbedec210f4c0c290a4e5a0ca">00041</a>   <a class="code" href="classMyTrackInfo.html#a6eaf8bacbedec210f4c0c290a4e5a0ca">~MyTrackInfo</a>() { Reset(); }
<a name="l00042"></a>00042 
<a name="l00043"></a>00043   <span class="keywordtype">int</span> Cmp(<span class="keyword">const</span> <a class="code" href="classMyTrackInfo.html">MyTrackInfo</a>&amp; another) <span class="keyword">const</span>;
<a name="l00044"></a>00044 };
<a name="l00045"></a>00045 
<a name="l00046"></a><a class="code" href="epoc-music_8cpp.html#a7391d1a93ac01bd34586a08052cbb2fe">00046</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="epoc-music_8cpp.html#a7391d1a93ac01bd34586a08052cbb2fe">CmpHBufC8</a>(<span class="keyword">const</span> HBufC8* a, <span class="keyword">const</span> HBufC8* b)
<a name="l00047"></a>00047 {
<a name="l00048"></a>00048   <span class="keywordflow">if</span> (!a &amp;&amp; !b) <span class="keywordflow">return</span> 0;
<a name="l00049"></a>00049   <span class="keywordflow">if</span> (a &amp;&amp; !b) <span class="keywordflow">return</span> 1;
<a name="l00050"></a>00050   <span class="keywordflow">if</span> (!a &amp;&amp; b) <span class="keywordflow">return</span> -1;
<a name="l00051"></a>00051   <span class="keywordflow">return</span> (*a).Compare(*b);
<a name="l00052"></a>00052 }
<a name="l00053"></a>00053 
<a name="l00054"></a><a class="code" href="classMyTrackInfo.html#acb714f317fbfe512959251c44e4ac61c">00054</a> <span class="keywordtype">int</span> <a class="code" href="classMyTrackInfo.html#acb714f317fbfe512959251c44e4ac61c">MyTrackInfo::Cmp</a>(<span class="keyword">const</span> <a class="code" href="classMyTrackInfo.html">MyTrackInfo</a>&amp; another)<span class="keyword"> const</span>
<a name="l00055"></a>00055 <span class="keyword"></span>{
<a name="l00056"></a>00056   <span class="keywordflow">return</span> <a class="code" href="epoc-music_8cpp.html#a7391d1a93ac01bd34586a08052cbb2fe">CmpHBufC8</a>(<a class="code" href="classMyTrackInfo.html#a724271e1bf2d4687dcdae32a11cf9b20">iUrl</a>, another.<a class="code" href="classMyTrackInfo.html#a724271e1bf2d4687dcdae32a11cf9b20">iUrl</a>) ||
<a name="l00057"></a>00057     <a class="code" href="epoc-music_8cpp.html#a7391d1a93ac01bd34586a08052cbb2fe">CmpHBufC8</a>(<a class="code" href="classMyTrackInfo.html#afda1038c7dce915bc78ecbd8ab9443c5">iTitle</a>, another.<a class="code" href="classMyTrackInfo.html#afda1038c7dce915bc78ecbd8ab9443c5">iTitle</a>) ||
<a name="l00058"></a>00058     <a class="code" href="epoc-music_8cpp.html#a7391d1a93ac01bd34586a08052cbb2fe">CmpHBufC8</a>(<a class="code" href="classMyTrackInfo.html#aeabc565af3f88b1f96bf94d8949b1e0c">iArtist</a>, another.<a class="code" href="classMyTrackInfo.html#aeabc565af3f88b1f96bf94d8949b1e0c">iArtist</a>) ||
<a name="l00059"></a>00059     <a class="code" href="epoc-music_8cpp.html#a7391d1a93ac01bd34586a08052cbb2fe">CmpHBufC8</a>(<a class="code" href="classMyTrackInfo.html#a15d9a6ff909f372aee980871ab656d19">iAlbum</a>, another.<a class="code" href="classMyTrackInfo.html#a15d9a6ff909f372aee980871ab656d19">iAlbum</a>);
<a name="l00060"></a>00060 }
<a name="l00061"></a>00061 
<a name="l00062"></a><a class="code" href="classCSensor__music.html#ad2d09caf619a19df24f5cce6c7ab0262">00062</a> <a class="code" href="classCSensor__music.html">CSensor_music</a>* <a class="code" href="classCSensor__music.html#ad2d09caf619a19df24f5cce6c7ab0262">CSensor_music::NewLC</a>(<a class="code" href="struct__ac__AppContext.html">ac_AppContext</a>* aAppContext)
<a name="l00063"></a>00063 {
<a name="l00064"></a>00064   <a class="code" href="classCSensor__music.html">CSensor_music</a>* obj = <span class="keyword">new</span> (ELeave) <a class="code" href="classCSensor__music.html#a49bc04d247839f84147b8470636a6665">CSensor_music</a>(aAppContext);
<a name="l00065"></a>00065   CleanupStack::PushL(obj);
<a name="l00066"></a>00066   obj-&gt;<a class="code" href="classCSensor__music.html#a75209801e1e1f8596412092ecbfe3787">ConstructL</a>();
<a name="l00067"></a>00067   <span class="keywordflow">return</span> obj;
<a name="l00068"></a>00068 }
<a name="l00069"></a>00069 
<a name="l00070"></a><a class="code" href="classCSensor__music.html#a444461dd6ec0d41b27de5bc2203c65d6">00070</a> <a class="code" href="classCSensor__music.html">CSensor_music</a>* <a class="code" href="classCSensor__music.html#a444461dd6ec0d41b27de5bc2203c65d6">CSensor_music::NewL</a>(<a class="code" href="struct__ac__AppContext.html">ac_AppContext</a>* aAppContext)
<a name="l00071"></a>00071 {
<a name="l00072"></a>00072   <a class="code" href="classCSensor__music.html">CSensor_music</a>* obj = <a class="code" href="classCSensor__music.html#ad2d09caf619a19df24f5cce6c7ab0262">CSensor_music::NewLC</a>(aAppContext);
<a name="l00073"></a>00073   CleanupStack::Pop(obj);
<a name="l00074"></a>00074   <span class="keywordflow">return</span> obj;
<a name="l00075"></a>00075 }
<a name="l00076"></a>00076 
<a name="l00077"></a><a class="code" href="classCSensor__music.html#a8e6f2047296c454f51b5dfabbdf48f38">00077</a> <a class="code" href="classCSensor__music.html#a8e6f2047296c454f51b5dfabbdf48f38">CSensor_music::~CSensor_music</a>()
<a name="l00078"></a>00078 {
<a name="l00079"></a>00079   <a class="code" href="classCSensor__music.html#aed1bc6d11c2d34cea3dde19389f67c2d">CloseSession</a>();
<a name="l00080"></a>00080   <span class="keyword">delete</span> <a class="code" href="classCSensor__music.html#af87def6052cc60ae43ccfa39d081d78b">iTrackInfo</a>;
<a name="l00081"></a>00081   <span class="keyword">delete</span> <a class="code" href="classCSensor__music.html#a782544962ed5b63667ed06432438d58b">iOldTrackInfo</a>;
<a name="l00082"></a>00082 }
<a name="l00083"></a>00083 
<a name="l00084"></a><a class="code" href="classCSensor__music.html#aed1bc6d11c2d34cea3dde19389f67c2d">00084</a> <span class="keywordtype">void</span> <a class="code" href="classCSensor__music.html#aed1bc6d11c2d34cea3dde19389f67c2d">CSensor_music::CloseSession</a>()
<a name="l00085"></a>00085 {
<a name="l00086"></a>00086   <span class="keywordflow">if</span> (<a class="code" href="classCSensor__music.html#a563c547632a32ff1894f5bcd7b805aa2">iPlaybackUtility</a>) {
<a name="l00087"></a>00087     <span class="comment">//TRAP_IGNORE(iPlaybackUtility-&gt;CommandL(EPbCmdClose));</span>
<a name="l00088"></a>00088     <span class="comment">//iPlaybackUtility-&gt;CancelRequest();</span>
<a name="l00089"></a>00089     <a class="code" href="classCSensor__music.html#a563c547632a32ff1894f5bcd7b805aa2">iPlaybackUtility</a>-&gt;Close();
<a name="l00090"></a>00090     <span class="comment">// We appear to be getting USER 42 if we delete iPlaybackUtility.</span>
<a name="l00091"></a>00091     <span class="comment">// Hopefully Close() is enough.</span>
<a name="l00092"></a>00092     <span class="comment">//delete iPlaybackUtility; // not</span>
<a name="l00093"></a>00093     <a class="code" href="classCSensor__music.html#a563c547632a32ff1894f5bcd7b805aa2">iPlaybackUtility</a> = NULL;
<a name="l00094"></a>00094   }
<a name="l00095"></a>00095 }
<a name="l00096"></a>00096 
<a name="l00097"></a><a class="code" href="classCSensor__music.html#a49bc04d247839f84147b8470636a6665">00097</a> <a class="code" href="classCSensor__music.html#a49bc04d247839f84147b8470636a6665">CSensor_music::CSensor_music</a>(<a class="code" href="struct__ac__AppContext.html">ac_AppContext</a>* aAppContext) :
<a name="l00098"></a>00098   iAppContext(aAppContext)
<a name="l00099"></a>00099 {
<a name="l00100"></a>00100 }
<a name="l00101"></a>00101 
<a name="l00102"></a><a class="code" href="classCSensor__music.html#a75209801e1e1f8596412092ecbfe3787">00102</a> <span class="keywordtype">void</span> <a class="code" href="classCSensor__music.html#a75209801e1e1f8596412092ecbfe3787">CSensor_music::ConstructL</a>()
<a name="l00103"></a>00103 {
<a name="l00104"></a>00104   <a class="code" href="classCSensor__music.html#af87def6052cc60ae43ccfa39d081d78b">iTrackInfo</a> = <span class="keyword">new</span> (ELeave) <a class="code" href="classMyTrackInfo.html">MyTrackInfo</a>;
<a name="l00105"></a>00105   <a class="code" href="classCSensor__music.html#a782544962ed5b63667ed06432438d58b">iOldTrackInfo</a> = <span class="keyword">new</span> (ELeave) <a class="code" href="classMyTrackInfo.html">MyTrackInfo</a>;
<a name="l00106"></a>00106 
<a name="l00107"></a>00107   <a class="code" href="classCSensor__music.html#a563c547632a32ff1894f5bcd7b805aa2">iPlaybackUtility</a> = <a class="code" href="classCSensor__music.html#a444461dd6ec0d41b27de5bc2203c65d6">MMPXPlaybackUtility::NewL</a>(KPbModeActivePlayer, <span class="keyword">this</span>);
<a name="l00108"></a>00108 
<a name="l00109"></a>00109   <span class="keywordflow">if</span> ((<a class="code" href="classCSensor__music.html#a563c547632a32ff1894f5bcd7b805aa2">iPlaybackUtility</a>-&gt;StateL() != EPbStateNotInitialised) &amp;&amp;
<a name="l00110"></a>00110       (<a class="code" href="classCSensor__music.html#a563c547632a32ff1894f5bcd7b805aa2">iPlaybackUtility</a>-&gt;StateL() != EPbStateInitialising)) {
<a name="l00111"></a>00111     <span class="comment">// Request info for anything already playing.</span>
<a name="l00112"></a>00112     <a class="code" href="classCSensor__music.html#ad0e63e0e933f794b602f833bb1edc931">RequestMediaL</a>();
<a name="l00113"></a>00113   }
<a name="l00114"></a>00114 }
<a name="l00115"></a>00115 
<a name="l00116"></a>00116 <span class="preprocessor">#include &lt;mpxmessagegeneraldefs.h&gt;</span>
<a name="l00117"></a>00117 <span class="preprocessor">#include &lt;mpxplaybackmessage.h&gt;</span>
<a name="l00118"></a>00118 
<a name="l00119"></a>00119 <span class="preprocessor">#include &lt;glib/gprintf.h&gt;</span>
<a name="l00120"></a>00120 
<a name="l00121"></a><a class="code" href="classCSensor__music.html#abf7c46f7a055ec866f6aadb5885cc89e">00121</a> <span class="keywordtype">void</span> <a class="code" href="classCSensor__music.html#abf7c46f7a055ec866f6aadb5885cc89e">CSensor_music::HandlePlaybackMessage</a>(CMPXMessage* aMessage, TInt errCode)
<a name="l00122"></a>00122 {
<a name="l00123"></a>00123   <span class="keywordflow">if</span> (errCode) {
<a name="l00124"></a>00124     <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;music: error %d&quot;</span>, errCode);
<a name="l00125"></a>00125     <a class="code" href="er__errors_8h.html#a008602962ee67e8048c9eec8828e2258">er_log_symbian</a>(0, errCode, <span class="stringliteral">&quot;INACTIVATE: music data fetch error&quot;</span>);
<a name="l00126"></a>00126     <a class="code" href="classCSensor__music.html#aed1bc6d11c2d34cea3dde19389f67c2d">CloseSession</a>();
<a name="l00127"></a>00127     <span class="keywordflow">return</span>;
<a name="l00128"></a>00128   }
<a name="l00129"></a>00129 
<a name="l00130"></a>00130   <span class="keywordtype">int</span> eventId = -1; <span class="comment">// logged</span>
<a name="l00131"></a>00131   <span class="keyword">const</span> <span class="keywordtype">char</span>* detail = NULL; <span class="comment">// logged</span>
<a name="l00132"></a>00132 <span class="preprocessor">#define DETAILBUFSIZE 50</span>
<a name="l00133"></a>00133 <span class="preprocessor"></span>  <span class="keywordtype">char</span> detailBuf[<a class="code" href="epoc-music_8cpp.html#a7afbfd7c83d6d7bc1066d07f2bd820c3">DETAILBUFSIZE</a>];
<a name="l00134"></a>00134 <span class="preprocessor">#define DETAILFMT(f...) g_snprintf(detailBuf, DETAILBUFSIZE, f)</span>
<a name="l00135"></a>00135 <span class="preprocessor"></span>
<a name="l00136"></a>00136   TMPXMessageId msgId(*aMessage-&gt;Value&lt;TMPXMessageId&gt;(KMPXMessageGeneralId));
<a name="l00137"></a>00137   <span class="comment">//guilogf(&quot;music: message ID %d&quot;, msgId);</span>
<a name="l00138"></a>00138   <span class="keywordflow">if</span> (msgId != KMPXMessageGeneral) {
<a name="l00139"></a>00139     <span class="keywordflow">return</span>;
<a name="l00140"></a>00140   } <span class="keywordflow">else</span> {
<a name="l00141"></a>00141      eventId = aMessage-&gt;ValueTObjectL&lt;TInt&gt;(KMPXMessageGeneralEvent);
<a name="l00142"></a>00142      <span class="comment">//guilogf(&quot;music: event ID %d&quot;, eventId);</span>
<a name="l00143"></a>00143      <span class="keywordflow">switch</span> (eventId)
<a name="l00144"></a>00144        {
<a name="l00145"></a>00145        <span class="keywordflow">case</span> TMPXPlaybackMessage::ENoEvent:
<a name="l00146"></a>00146    {
<a name="l00147"></a>00147      <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;music: ENoEvent&quot;</span>);
<a name="l00148"></a>00148      <span class="keywordflow">break</span>;
<a name="l00149"></a>00149    }
<a name="l00150"></a>00150        <span class="keywordflow">case</span> TMPXPlaybackMessage::EError:
<a name="l00151"></a>00151    {
<a name="l00152"></a>00152      <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;music: EError&quot;</span>);
<a name="l00153"></a>00153      <span class="keywordflow">break</span>;
<a name="l00154"></a>00154    }
<a name="l00155"></a>00155        <span class="keywordflow">case</span> TMPXPlaybackMessage::ECommandReceived: <span class="comment">/* seen often */</span>
<a name="l00156"></a>00156    {
<a name="l00157"></a>00157      <span class="comment">//guilogf(&quot;music: ECommandReceived&quot;);</span>
<a name="l00158"></a>00158      <span class="keywordflow">break</span>;
<a name="l00159"></a>00159    }
<a name="l00160"></a>00160        <span class="keywordflow">case</span> TMPXPlaybackMessage::ECommandComplete:
<a name="l00161"></a>00161    {
<a name="l00162"></a>00162      <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;music: ECommandComplete&quot;</span>);
<a name="l00163"></a>00163      <span class="keywordflow">break</span>;
<a name="l00164"></a>00164    }
<a name="l00165"></a>00165        <span class="keywordflow">case</span> TMPXPlaybackMessage::EPropertyChanged: <span class="comment">/* seen often */</span>
<a name="l00166"></a>00166    {
<a name="l00167"></a>00167      TMPXPlaybackProperty propId(aMessage-&gt;ValueTObjectL&lt;TMPXPlaybackProperty&gt;(KMPXMessageGeneralType));
<a name="l00168"></a>00168      TInt value(aMessage-&gt;ValueTObjectL&lt;TInt&gt;(KMPXMessageGeneralData));
<a name="l00169"></a>00169      <span class="keyword">const</span> <span class="keywordtype">char</span>* propStr;
<a name="l00170"></a>00170      <span class="keywordflow">switch</span> (propId)
<a name="l00171"></a>00171        {
<a name="l00172"></a>00172        <span class="keywordflow">case</span> EPbPropertyVolume:
<a name="l00173"></a>00173          {
<a name="l00174"></a>00174      propStr = <span class="stringliteral">&quot;EPbPropertyVolume&quot;</span>;
<a name="l00175"></a>00175      <span class="keywordflow">break</span>;
<a name="l00176"></a>00176          }
<a name="l00177"></a>00177        <span class="keywordflow">case</span> EPbPropertyMaxVolume:
<a name="l00178"></a>00178          {
<a name="l00179"></a>00179      propStr = <span class="stringliteral">&quot;EPbPropertyMaxVolume&quot;</span>;
<a name="l00180"></a>00180      <span class="keywordflow">break</span>;
<a name="l00181"></a>00181          }
<a name="l00182"></a>00182        <span class="keywordflow">case</span> EPbPropertyVolumeRamp:
<a name="l00183"></a>00183          {
<a name="l00184"></a>00184      propStr = <span class="stringliteral">&quot;EPbPropertyVolumeRamp&quot;</span>;
<a name="l00185"></a>00185      <span class="keywordflow">break</span>;
<a name="l00186"></a>00186          }
<a name="l00187"></a>00187        <span class="keywordflow">case</span> EPbPropertyMute:
<a name="l00188"></a>00188          {
<a name="l00189"></a>00189      propStr = <span class="stringliteral">&quot;EPbPropertyMute&quot;</span>;
<a name="l00190"></a>00190      <span class="keywordflow">break</span>;
<a name="l00191"></a>00191          }
<a name="l00192"></a>00192        <span class="keywordflow">case</span> EPbPropertyBalance:
<a name="l00193"></a>00193          {
<a name="l00194"></a>00194      propStr = <span class="stringliteral">&quot;EPbPropertyBalance&quot;</span>;
<a name="l00195"></a>00195      <span class="keywordflow">break</span>;
<a name="l00196"></a>00196          }
<a name="l00197"></a>00197        <span class="keywordflow">case</span> EPbPropertyEmbeddedMode:
<a name="l00198"></a>00198          {
<a name="l00199"></a>00199      propStr = <span class="stringliteral">&quot;EPbPropertyEmbeddedMode&quot;</span>;
<a name="l00200"></a>00200      <span class="keywordflow">break</span>;
<a name="l00201"></a>00201          }
<a name="l00202"></a>00202        <span class="keywordflow">case</span> EPbPropertyCrossFade:
<a name="l00203"></a>00203          {
<a name="l00204"></a>00204      propStr = <span class="stringliteral">&quot;EPbPropertyCrossFade&quot;</span>;
<a name="l00205"></a>00205      <span class="keywordflow">break</span>;
<a name="l00206"></a>00206          }
<a name="l00207"></a>00207        <span class="keywordflow">case</span> EPbPropertyRandomMode:
<a name="l00208"></a>00208          {
<a name="l00209"></a>00209      propStr = <span class="stringliteral">&quot;EPbPropertyRandomMode&quot;</span>;
<a name="l00210"></a>00210      <span class="keywordflow">break</span>;
<a name="l00211"></a>00211          }
<a name="l00212"></a>00212        <span class="keywordflow">case</span> EPbPropertyRepeatMode:
<a name="l00213"></a>00213          {
<a name="l00214"></a>00214      propStr = <span class="stringliteral">&quot;EPbPropertyRepeatMode&quot;</span>;
<a name="l00215"></a>00215      <span class="keywordflow">break</span>;
<a name="l00216"></a>00216          }
<a name="l00217"></a>00217        <span class="keywordflow">case</span> EPbPropertyAccessPoint:
<a name="l00218"></a>00218          {
<a name="l00219"></a>00219      propStr = <span class="stringliteral">&quot;EPbPropertyAccessPoint&quot;</span>;
<a name="l00220"></a>00220      <span class="keywordflow">break</span>;
<a name="l00221"></a>00221          }
<a name="l00222"></a>00222        <span class="keywordflow">case</span> EPbPropertyPosition:
<a name="l00223"></a>00223          {
<a name="l00224"></a>00224 <span class="preprocessor">#if 0</span>
<a name="l00225"></a>00225 <span class="preprocessor"></span>     propStr = <span class="stringliteral">&quot;EPbPropertyPosition&quot;</span>;
<a name="l00226"></a>00226      <span class="keywordflow">break</span>;
<a name="l00227"></a>00227 <span class="preprocessor">#else</span>
<a name="l00228"></a>00228 <span class="preprocessor"></span>                 <span class="comment">// These events are very frequent as track position</span>
<a name="l00229"></a>00229                  <span class="comment">// progress is frequently reported.</span>
<a name="l00230"></a>00230      <span class="keywordflow">return</span>;
<a name="l00231"></a>00231 <span class="preprocessor">#endif</span>
<a name="l00232"></a>00232 <span class="preprocessor"></span>         }
<a name="l00233"></a>00233        <span class="keywordflow">case</span> EPbPropertyDuration:
<a name="l00234"></a>00234          {
<a name="l00235"></a>00235      propStr = <span class="stringliteral">&quot;EPbPropertyDuration&quot;</span>;
<a name="l00236"></a>00236      <span class="keywordflow">break</span>;
<a name="l00237"></a>00237          }
<a name="l00238"></a>00238        <span class="keywordflow">case</span> EPbPropertySongValid:
<a name="l00239"></a>00239          {
<a name="l00240"></a>00240      propStr = <span class="stringliteral">&quot;EPbPropertySongValid&quot;</span>;
<a name="l00241"></a>00241      <span class="keywordflow">break</span>;
<a name="l00242"></a>00242          }
<a name="l00243"></a>00243        <span class="keywordflow">case</span> EPbPropertyRemote:
<a name="l00244"></a>00244          {
<a name="l00245"></a>00245      propStr = <span class="stringliteral">&quot;EPbPropertyRemote&quot;</span>;
<a name="l00246"></a>00246      <span class="keywordflow">break</span>;
<a name="l00247"></a>00247          }
<a name="l00248"></a>00248        <span class="keywordflow">case</span> EPbPropertySupportedFeatures:
<a name="l00249"></a>00249          {
<a name="l00250"></a>00250      propStr = <span class="stringliteral">&quot;EPbPropertySupportedFeatures&quot;</span>;
<a name="l00251"></a>00251      <span class="keywordflow">break</span>;
<a name="l00252"></a>00252          }
<a name="l00253"></a>00253        <span class="keywordflow">default</span>:
<a name="l00254"></a>00254          {
<a name="l00255"></a>00255            propStr = <span class="stringliteral">&quot;&lt;unknown&gt;&quot;</span>;
<a name="l00256"></a>00256            <span class="keywordflow">break</span>;
<a name="l00257"></a>00257          }
<a name="l00258"></a>00258        }
<a name="l00259"></a>00259      <a class="code" href="epoc-music_8cpp.html#a28771690ee028081cc80307792c67ac2">DETAILFMT</a>(<span class="stringliteral">&quot;{property: %d, value: %d}&quot;</span>, propId, value);
<a name="l00260"></a>00260      detail = detailBuf;
<a name="l00261"></a>00261      <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;music: EPropertyChanged: &apos;%s&apos; = %d&quot;</span>, propStr, value);
<a name="l00262"></a>00262      <span class="keywordflow">break</span>;
<a name="l00263"></a>00263    }
<a name="l00264"></a>00264        <span class="keywordflow">case</span> TMPXPlaybackMessage::EStateChanged: <span class="comment">/* seen often */</span>
<a name="l00265"></a>00265    {
<a name="l00266"></a>00266      TInt stateId(aMessage-&gt;ValueTObjectL&lt;TMPXPlaybackState&gt;(KMPXMessageGeneralType));
<a name="l00267"></a>00267      <span class="keywordflow">if</span> (stateId == <a class="code" href="classCSensor__music.html#aeda5b9be3ddb93d8a96a276a697134ba">iOldPbState</a>)
<a name="l00268"></a>00268        <span class="comment">// We seem to get repeats, avoid that.</span>
<a name="l00269"></a>00269        <span class="keywordflow">return</span>;
<a name="l00270"></a>00270      <a class="code" href="classCSensor__music.html#aeda5b9be3ddb93d8a96a276a697134ba">iOldPbState</a> = stateId;
<a name="l00271"></a>00271      <span class="keyword">const</span> <span class="keywordtype">char</span>* stateStr;
<a name="l00272"></a>00272      <span class="keywordflow">switch</span> (stateId)
<a name="l00273"></a>00273        {
<a name="l00274"></a>00274        <span class="keywordflow">case</span> EPbStateNotInitialised:
<a name="l00275"></a>00275          {
<a name="l00276"></a>00276      stateStr = <span class="stringliteral">&quot;EPbStateNotInitialised&quot;</span>;
<a name="l00277"></a>00277      <span class="keywordflow">break</span>;
<a name="l00278"></a>00278          }
<a name="l00279"></a>00279        <span class="keywordflow">case</span> EPbStateInitialising:
<a name="l00280"></a>00280          {
<a name="l00281"></a>00281      stateStr = <span class="stringliteral">&quot;EPbStateInitialising&quot;</span>;
<a name="l00282"></a>00282      <span class="keywordflow">break</span>;
<a name="l00283"></a>00283          }
<a name="l00284"></a>00284        <span class="keywordflow">case</span> EPbStatePlaying:
<a name="l00285"></a>00285          {
<a name="l00286"></a>00286      stateStr = <span class="stringliteral">&quot;EPbStatePlaying&quot;</span>;
<a name="l00287"></a>00287      <span class="keywordflow">break</span>;
<a name="l00288"></a>00288          }
<a name="l00289"></a>00289        <span class="keywordflow">case</span> EPbStatePaused:
<a name="l00290"></a>00290          {
<a name="l00291"></a>00291      stateStr = <span class="stringliteral">&quot;EPbStatePaused&quot;</span>;
<a name="l00292"></a>00292      <span class="keywordflow">break</span>;
<a name="l00293"></a>00293          }
<a name="l00294"></a>00294        <span class="keywordflow">case</span> EPbStateStopped:
<a name="l00295"></a>00295          {
<a name="l00296"></a>00296      stateStr = <span class="stringliteral">&quot;EPbStateStopped&quot;</span>;
<a name="l00297"></a>00297      <span class="keywordflow">break</span>;
<a name="l00298"></a>00298          }
<a name="l00299"></a>00299        <span class="keywordflow">case</span> EPbStateSeekingForward:
<a name="l00300"></a>00300          {
<a name="l00301"></a>00301      stateStr = <span class="stringliteral">&quot;EPbStateSeekingForward&quot;</span>;
<a name="l00302"></a>00302      <span class="keywordflow">break</span>;
<a name="l00303"></a>00303          }
<a name="l00304"></a>00304        <span class="keywordflow">case</span> EPbStateSeekingBackward:
<a name="l00305"></a>00305          {
<a name="l00306"></a>00306      stateStr = <span class="stringliteral">&quot;EPbStateSeekingBackward&quot;</span>;
<a name="l00307"></a>00307      <span class="keywordflow">break</span>;
<a name="l00308"></a>00308          }
<a name="l00309"></a>00309        <span class="keywordflow">case</span> EPbStateShuttingDown:
<a name="l00310"></a>00310          {
<a name="l00311"></a>00311      stateStr = <span class="stringliteral">&quot;EPbStateShuttingDown&quot;</span>;
<a name="l00312"></a>00312      <span class="keywordflow">break</span>;
<a name="l00313"></a>00313          }
<a name="l00314"></a>00314        <span class="keywordflow">case</span> EPbStateBuffering:
<a name="l00315"></a>00315          {
<a name="l00316"></a>00316      stateStr = <span class="stringliteral">&quot;EPbStateBuffering&quot;</span>;
<a name="l00317"></a>00317      <span class="keywordflow">break</span>;
<a name="l00318"></a>00318          }
<a name="l00319"></a>00319        <span class="keywordflow">case</span> EPbStateDownloading:
<a name="l00320"></a>00320          {
<a name="l00321"></a>00321      stateStr = <span class="stringliteral">&quot;EPbStateDownloading&quot;</span>;
<a name="l00322"></a>00322      <span class="keywordflow">break</span>;
<a name="l00323"></a>00323          }
<a name="l00324"></a>00324        <span class="keywordflow">default</span>:
<a name="l00325"></a>00325          {
<a name="l00326"></a>00326            stateStr = <span class="stringliteral">&quot;&lt;unknown&gt;&quot;</span>;
<a name="l00327"></a>00327            <span class="keywordflow">break</span>;
<a name="l00328"></a>00328          }
<a name="l00329"></a>00329        }
<a name="l00330"></a>00330      <a class="code" href="epoc-music_8cpp.html#a28771690ee028081cc80307792c67ac2">DETAILFMT</a>(<span class="stringliteral">&quot;{state: %d}&quot;</span>, stateId);
<a name="l00331"></a>00331      detail = detailBuf;
<a name="l00332"></a>00332      <span class="comment">//guilogf(&quot;music: EStateChanged %d&quot;, stateId);</span>
<a name="l00333"></a>00333      <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;music: playback state %s (%d)&quot;</span>, stateStr, stateId);
<a name="l00334"></a>00334      <span class="keywordflow">break</span>;
<a name="l00335"></a>00335    }
<a name="l00336"></a>00336        <span class="keywordflow">case</span> TMPXPlaybackMessage::ESongCorrupt:
<a name="l00337"></a>00337    {
<a name="l00338"></a>00338      <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;music: ESongCorrupt&quot;</span>);
<a name="l00339"></a>00339      <span class="keywordflow">break</span>;
<a name="l00340"></a>00340    }
<a name="l00341"></a>00341        <span class="keywordflow">case</span> TMPXPlaybackMessage::ESongContainerChanged:
<a name="l00342"></a>00342    {
<a name="l00343"></a>00343      <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;music: ESongContainerChanged&quot;</span>);
<a name="l00344"></a>00344      <span class="keywordflow">break</span>;
<a name="l00345"></a>00345    }
<a name="l00346"></a>00346        <span class="keywordflow">case</span> TMPXPlaybackMessage::EInitializeComplete: <span class="comment">/* seen often */</span>
<a name="l00347"></a>00347    {
<a name="l00348"></a>00348      <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;music: EInitializeComplete&quot;</span>);
<a name="l00349"></a>00349      <span class="keywordflow">break</span>;
<a name="l00350"></a>00350    }
<a name="l00351"></a>00351        <span class="keywordflow">case</span> TMPXPlaybackMessage::ESongChanged:
<a name="l00352"></a>00352    {
<a name="l00353"></a>00353      <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;music: ESongChanged&quot;</span>);
<a name="l00354"></a>00354      <span class="keywordflow">break</span>;
<a name="l00355"></a>00355    }
<a name="l00356"></a>00356        <span class="keywordflow">case</span> TMPXPlaybackMessage::EPlayerChanged:
<a name="l00357"></a>00357    {
<a name="l00358"></a>00358      <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;music: EPlayerChanged&quot;</span>);
<a name="l00359"></a>00359      <span class="keywordflow">break</span>;
<a name="l00360"></a>00360    }
<a name="l00361"></a>00361        <span class="keywordflow">case</span> TMPXPlaybackMessage::EActivePlayerChanged:
<a name="l00362"></a>00362    {
<a name="l00363"></a>00363      <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;music: EActivePlayerChanged&quot;</span>);
<a name="l00364"></a>00364      <span class="keywordflow">break</span>;
<a name="l00365"></a>00365    }
<a name="l00366"></a>00366        <span class="keywordflow">case</span> TMPXPlaybackMessage::ESubPlayersChanged:
<a name="l00367"></a>00367    {
<a name="l00368"></a>00368      <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;music: ESubPlayersChanged&quot;</span>);
<a name="l00369"></a>00369      <span class="keywordflow">break</span>;
<a name="l00370"></a>00370    }
<a name="l00371"></a>00371        <span class="keywordflow">case</span> TMPXPlaybackMessage::EPlayerSelectionChanged:
<a name="l00372"></a>00372    {
<a name="l00373"></a>00373      <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;music: EPlayerSelectionChanged&quot;</span>);
<a name="l00374"></a>00374      <span class="keywordflow">break</span>;
<a name="l00375"></a>00375    }
<a name="l00376"></a>00376        <span class="keywordflow">case</span> TMPXPlaybackMessage::EDownloadStarted:
<a name="l00377"></a>00377    {
<a name="l00378"></a>00378      <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;music: EDownloadStarted&quot;</span>);
<a name="l00379"></a>00379      <span class="keywordflow">break</span>;
<a name="l00380"></a>00380    }
<a name="l00381"></a>00381        <span class="keywordflow">case</span> TMPXPlaybackMessage::EDownloadUpdated:
<a name="l00382"></a>00382    {
<a name="l00383"></a>00383      <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;music: EDownloadUpdated&quot;</span>);
<a name="l00384"></a>00384      <span class="keywordflow">break</span>;
<a name="l00385"></a>00385    }
<a name="l00386"></a>00386        <span class="keywordflow">case</span> TMPXPlaybackMessage::EDownloadComplete:
<a name="l00387"></a>00387    {
<a name="l00388"></a>00388      <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;music: EDownloadComplete&quot;</span>);
<a name="l00389"></a>00389      <span class="keywordflow">break</span>;
<a name="l00390"></a>00390    }
<a name="l00391"></a>00391        <span class="keywordflow">case</span> TMPXPlaybackMessage::EDownloadPositionChanged:
<a name="l00392"></a>00392    {
<a name="l00393"></a>00393      <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;music: EDownloadPositionChanged&quot;</span>);
<a name="l00394"></a>00394      <span class="keywordflow">break</span>;
<a name="l00395"></a>00395    }
<a name="l00396"></a>00396        <span class="keywordflow">case</span> TMPXPlaybackMessage::EDownloadStateChanged:
<a name="l00397"></a>00397    {
<a name="l00398"></a>00398      <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;music: EDownloadStateChanged&quot;</span>);
<a name="l00399"></a>00399      <span class="keywordflow">break</span>;
<a name="l00400"></a>00400    }
<a name="l00401"></a>00401        <span class="keywordflow">case</span> TMPXPlaybackMessage::EDownloadCmdPauseDownload:
<a name="l00402"></a>00402    {
<a name="l00403"></a>00403      <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;music: EDownloadCmdPauseDownload&quot;</span>);
<a name="l00404"></a>00404      <span class="keywordflow">break</span>;
<a name="l00405"></a>00405    }
<a name="l00406"></a>00406        <span class="keywordflow">case</span> TMPXPlaybackMessage::EDownloadCmdResumeDownload:
<a name="l00407"></a>00407    {
<a name="l00408"></a>00408      <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;music: EDownloadCmdResumeDownload&quot;</span>);
<a name="l00409"></a>00409      <span class="keywordflow">break</span>;
<a name="l00410"></a>00410    }
<a name="l00411"></a>00411        <span class="keywordflow">case</span> TMPXPlaybackMessage::EDownloadCmdCancelDownload:
<a name="l00412"></a>00412    {
<a name="l00413"></a>00413      <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;music: EDownloadCmdCancelDownload&quot;</span>);
<a name="l00414"></a>00414      <span class="keywordflow">break</span>;
<a name="l00415"></a>00415    }
<a name="l00416"></a>00416        <span class="keywordflow">case</span> TMPXPlaybackMessage::EAccessoryChanged:
<a name="l00417"></a>00417    {
<a name="l00418"></a>00418      <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;music: EAccessoryChanged&quot;</span>);
<a name="l00419"></a>00419      <span class="keywordflow">break</span>;
<a name="l00420"></a>00420    }
<a name="l00421"></a>00421        <span class="keywordflow">case</span> TMPXPlaybackMessage::EMediaChanged: <span class="comment">/* seen often */</span>
<a name="l00422"></a>00422    {
<a name="l00423"></a>00423      <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;music: EMediaChanged&quot;</span>);
<a name="l00424"></a>00424      <a class="code" href="classCSensor__music.html#ad0e63e0e933f794b602f833bb1edc931">RequestMediaL</a>();
<a name="l00425"></a>00425      <span class="keywordflow">break</span>;
<a name="l00426"></a>00426    }
<a name="l00427"></a>00427        <span class="keywordflow">case</span> TMPXPlaybackMessage::ESkipping:
<a name="l00428"></a>00428    {
<a name="l00429"></a>00429      <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;music: ESkipping&quot;</span>);
<a name="l00430"></a>00430      <span class="keywordflow">break</span>;
<a name="l00431"></a>00431    }
<a name="l00432"></a>00432        <span class="keywordflow">case</span> TMPXPlaybackMessage::ESkipEnd:
<a name="l00433"></a>00433    {
<a name="l00434"></a>00434      <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;music: ESkipEnd&quot;</span>);
<a name="l00435"></a>00435      <span class="keywordflow">break</span>;
<a name="l00436"></a>00436    }
<a name="l00437"></a>00437        <span class="keywordflow">case</span> TMPXPlaybackMessage::EPlayerUnavailable:
<a name="l00438"></a>00438    {
<a name="l00439"></a>00439      <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;music: EPlayerUnavailable&quot;</span>);
<a name="l00440"></a>00440      <span class="keywordflow">break</span>;
<a name="l00441"></a>00441    }
<a name="l00442"></a>00442        <span class="keywordflow">case</span> TMPXPlaybackMessage::EPlaylistUpdated:
<a name="l00443"></a>00443    {
<a name="l00444"></a>00444      <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;music: EPlaylistUpdated&quot;</span>);
<a name="l00445"></a>00445      <a class="code" href="classCSensor__music.html#ad0e63e0e933f794b602f833bb1edc931">RequestMediaL</a>();
<a name="l00446"></a>00446      <span class="keywordflow">break</span>;
<a name="l00447"></a>00447    }
<a name="l00448"></a>00448        <span class="keywordflow">case</span> TMPXPlaybackMessage::EReachedEndOfPlaylist:
<a name="l00449"></a>00449    {
<a name="l00450"></a>00450      <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;music: EReachedEndOfPlaylist&quot;</span>);
<a name="l00451"></a>00451      <span class="keywordflow">break</span>;
<a name="l00452"></a>00452    }
<a name="l00453"></a>00453        <span class="keywordflow">default</span>:
<a name="l00454"></a>00454          {
<a name="l00455"></a>00455      <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;music: unknown event&quot;</span>);
<a name="l00456"></a>00456            <span class="keywordflow">break</span>;
<a name="l00457"></a>00457          }
<a name="l00458"></a>00458        }
<a name="l00459"></a>00459 
<a name="l00460"></a>00460      <a class="code" href="sa__sensor__list__log__db_8c.html#a429ff06acc511ce4c8c732c77376af7c">log_db_log_musicplayer</a>(<a class="code" href="classCSensor__music.html#a73cf2dcbd0d48c5c0a84c0442da06bc7">GetLogDb</a>(), eventId, detail, NULL);
<a name="l00461"></a>00461   }
<a name="l00462"></a>00462 }
<a name="l00463"></a>00463 
<a name="l00464"></a>00464 <span class="preprocessor">#include &lt;mpxmediageneraldefs.h&gt;</span>
<a name="l00465"></a>00465 <span class="preprocessor">#include &lt;mpxmediamusicdefs.h&gt;</span>
<a name="l00466"></a>00466 
<a name="l00467"></a>00467 <span class="comment">// adapted from code in Music Player Remote Python extension</span>
<a name="l00468"></a><a class="code" href="classCSensor__music.html#ad0e63e0e933f794b602f833bb1edc931">00468</a> <span class="keywordtype">void</span> <a class="code" href="classCSensor__music.html#ad0e63e0e933f794b602f833bb1edc931">CSensor_music::RequestMediaL</a>()
<a name="l00469"></a>00469 {
<a name="l00470"></a>00470   MMPXSource* source(<a class="code" href="classCSensor__music.html#a563c547632a32ff1894f5bcd7b805aa2">iPlaybackUtility</a>-&gt;Source());
<a name="l00471"></a>00471   <span class="keywordflow">if</span> (source)
<a name="l00472"></a>00472     {
<a name="l00473"></a>00473       RArray&lt;TMPXAttribute&gt; attrs;
<a name="l00474"></a>00474       CleanupClosePushL(attrs);
<a name="l00475"></a>00475       attrs.Append(KMPXMediaGeneralUri);
<a name="l00476"></a>00476       attrs.Append(KMPXMediaGeneralTitle);
<a name="l00477"></a>00477       attrs.Append(KMPXMediaMusicArtist);
<a name="l00478"></a>00478       attrs.Append(KMPXMediaMusicAlbum);
<a name="l00479"></a>00479       <span class="comment">// The two-arg method is deprecated, we assume passing NULL as</span>
<a name="l00480"></a>00480       <span class="comment">// the third arg has the same semantics. The arg is</span>
<a name="l00481"></a>00481       <span class="comment">// CMPXAttributeSpecs* aSpecs (typedef CMPXMedia</span>
<a name="l00482"></a>00482       <span class="comment">// CMPXAttributeSpecs).</span>
<a name="l00483"></a>00483       CMPXAttributeSpecs* specs = NULL;
<a name="l00484"></a>00484       source-&gt;MediaL(attrs.Array(), *<span class="keyword">this</span>, specs);
<a name="l00485"></a>00485       CleanupStack::PopAndDestroy(&amp;attrs);
<a name="l00486"></a>00486     }
<a name="l00487"></a>00487 }
<a name="l00488"></a>00488 
<a name="l00489"></a><a class="code" href="epoc-music_8cpp.html#ac0a175517dd38f43b0dbd572e077a7c2">00489</a> <span class="preprocessor">#define SWAP(t,x,y) { t _tmp = x; x = y; y = _tmp; }</span>
<a name="l00490"></a>00490 <span class="preprocessor"></span>
<a name="l00491"></a>00491 <span class="comment">// adapted from code in Music Player Remote Python extension</span>
<a name="l00492"></a>00492 <span class="comment">// also see mpxmedia.h</span>
<a name="l00493"></a><a class="code" href="classCSensor__music.html#a96e4c7747239fb532cc58837e5169063">00493</a> <span class="keywordtype">void</span> <a class="code" href="classCSensor__music.html#a96e4c7747239fb532cc58837e5169063">CSensor_music::HandleMediaL</a>(<span class="keyword">const</span> CMPXMedia&amp; aMedia,
<a name="l00494"></a>00494          TInt errCode)
<a name="l00495"></a>00495 {
<a name="l00496"></a>00496   <span class="comment">//guilogf(&quot;HandleMediaL (%d)&quot;, errCode);</span>
<a name="l00497"></a>00497 
<a name="l00498"></a>00498   <span class="keywordflow">if</span> (errCode)
<a name="l00499"></a>00499     <span class="keywordflow">return</span>;
<a name="l00500"></a>00500 
<a name="l00501"></a>00501   <a class="code" href="epoc-btprox_8cpp.html#ac0a175517dd38f43b0dbd572e077a7c2">SWAP</a>(<a class="code" href="classMyTrackInfo.html">MyTrackInfo</a>*, <a class="code" href="classCSensor__music.html#a782544962ed5b63667ed06432438d58b">iOldTrackInfo</a>, <a class="code" href="classCSensor__music.html#af87def6052cc60ae43ccfa39d081d78b">iTrackInfo</a>); <span class="comment">// current becomes old</span>
<a name="l00502"></a>00502 
<a name="l00503"></a>00503   <a class="code" href="classCSensor__music.html#af87def6052cc60ae43ccfa39d081d78b">iTrackInfo</a>-&gt;<a class="code" href="classMyTrackInfo.html#a898d1d342034e44291da5e012a5fbd11">Reset</a>(); <span class="comment">// clear space for new data</span>
<a name="l00504"></a>00504 
<a name="l00505"></a>00505   HBufC8*&amp; iUrl = <a class="code" href="classCSensor__music.html#af87def6052cc60ae43ccfa39d081d78b">iTrackInfo</a>-&gt;<a class="code" href="classMyTrackInfo.html#a724271e1bf2d4687dcdae32a11cf9b20">iUrl</a>;
<a name="l00506"></a>00506   HBufC8*&amp; iArtist = <a class="code" href="classCSensor__music.html#af87def6052cc60ae43ccfa39d081d78b">iTrackInfo</a>-&gt;<a class="code" href="classMyTrackInfo.html#aeabc565af3f88b1f96bf94d8949b1e0c">iArtist</a>;
<a name="l00507"></a>00507   HBufC8*&amp; iTitle = <a class="code" href="classCSensor__music.html#af87def6052cc60ae43ccfa39d081d78b">iTrackInfo</a>-&gt;<a class="code" href="classMyTrackInfo.html#afda1038c7dce915bc78ecbd8ab9443c5">iTitle</a>;
<a name="l00508"></a>00508   HBufC8*&amp; iAlbum = <a class="code" href="classCSensor__music.html#af87def6052cc60ae43ccfa39d081d78b">iTrackInfo</a>-&gt;<a class="code" href="classMyTrackInfo.html#a15d9a6ff909f372aee980871ab656d19">iAlbum</a>;
<a name="l00509"></a>00509 
<a name="l00510"></a>00510   <span class="keywordflow">if</span> (aMedia.IsSupported(KMPXMediaGeneralUri)) {
<a name="l00511"></a>00511     <span class="keyword">const</span> TDesC&amp; text = aMedia.ValueText(KMPXMediaGeneralUri);
<a name="l00512"></a>00512     <span class="comment">/*</span>
<a name="l00513"></a>00513 <span class="comment">    TParsePtrC filePath(text);</span>
<a name="l00514"></a>00514 <span class="comment">    iUrl = ConvToUtf8ZL(filePath.Name());</span>
<a name="l00515"></a>00515 <span class="comment">    */</span>
<a name="l00516"></a>00516     iUrl = ConvToUtf8ZL(text);
<a name="l00517"></a>00517   }
<a name="l00518"></a>00518   <span class="keywordflow">if</span> (aMedia.IsSupported(KMPXMediaGeneralTitle)) {
<a name="l00519"></a>00519     iTitle = ConvToUtf8ZL(aMedia.ValueText(KMPXMediaGeneralTitle));
<a name="l00520"></a>00520   }
<a name="l00521"></a>00521   <span class="keywordflow">if</span> (aMedia.IsSupported(KMPXMediaMusicArtist)) {
<a name="l00522"></a>00522     iArtist = ConvToUtf8ZL(aMedia.ValueText(KMPXMediaMusicArtist));
<a name="l00523"></a>00523   }
<a name="l00524"></a>00524   <span class="keywordflow">if</span> (aMedia.IsSupported(KMPXMediaMusicAlbum)) {
<a name="l00525"></a>00525     iAlbum = ConvToUtf8ZL(aMedia.ValueText(KMPXMediaMusicAlbum));
<a name="l00526"></a>00526   }
<a name="l00527"></a>00527 
<a name="l00528"></a>00528   <span class="keywordflow">if</span> (<a class="code" href="classCSensor__music.html#af87def6052cc60ae43ccfa39d081d78b">iTrackInfo</a>-&gt;<a class="code" href="classMyTrackInfo.html#acb714f317fbfe512959251c44e4ac61c">Cmp</a>(*<a class="code" href="classCSensor__music.html#a782544962ed5b63667ed06432438d58b">iOldTrackInfo</a>) == 0)
<a name="l00529"></a>00529     <span class="keywordflow">return</span>; <span class="comment">// no duplicates</span>
<a name="l00530"></a>00530 
<a name="l00531"></a>00531   <span class="keyword">const</span> <span class="keywordtype">char</span>* url = (iUrl ? (<span class="keyword">const</span> <span class="keywordtype">char</span>*)(iUrl-&gt;Ptr()) : NULL);
<a name="l00532"></a>00532   <span class="keyword">const</span> <span class="keywordtype">char</span>* title = (iTitle ? (<span class="keyword">const</span> <span class="keywordtype">char</span>*)(iTitle-&gt;Ptr()) : NULL);
<a name="l00533"></a>00533   <span class="keyword">const</span> <span class="keywordtype">char</span>* artist = (iArtist ? (<span class="keyword">const</span> <span class="keywordtype">char</span>*)(iArtist-&gt;Ptr()) : NULL);
<a name="l00534"></a>00534   <span class="keyword">const</span> <span class="keywordtype">char</span>* album = (iAlbum ? (<span class="keyword">const</span> <span class="keywordtype">char</span>*)(iAlbum-&gt;Ptr()) : NULL);
<a name="l00535"></a>00535 
<a name="l00536"></a>00536   <a class="code" href="sa__sensor__list__log__db_8c.html#a8c3dfd97e2149ee73f5146b9da7d9c52">log_db_log_musictrack</a>(<a class="code" href="classCSensor__music.html#a73cf2dcbd0d48c5c0a84c0442da06bc7">GetLogDb</a>(), url, title, artist, album, NULL);
<a name="l00537"></a>00537 
<a name="l00538"></a>00538   <span class="keywordflow">if</span> (url)
<a name="l00539"></a>00539     <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;music: URL &apos;%s&apos;&quot;</span>, url);
<a name="l00540"></a>00540   <span class="keywordflow">if</span> (title)
<a name="l00541"></a>00541     <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;music: title &apos;%s&apos;&quot;</span>, title);
<a name="l00542"></a>00542   <span class="keywordflow">if</span> (artist)
<a name="l00543"></a>00543     <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;music: artist &apos;%s&apos;&quot;</span>, artist);
<a name="l00544"></a>00544   <span class="keywordflow">if</span> (album)
<a name="l00545"></a>00545     <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;music: album &apos;%s&apos;&quot;</span>, album);
<a name="l00546"></a>00546 }
<a name="l00547"></a>00547 <span class="comment"></span>
<a name="l00548"></a>00548 <span class="comment">/**</span>
<a name="l00549"></a>00549 <span class="comment"></span>
<a name="l00550"></a>00550 <span class="comment">Copyright 2011 Helsinki Institute for Information Technology (HIIT)</span>
<a name="l00551"></a>00551 <span class="comment">and the authors. All rights reserved.</span>
<a name="l00552"></a>00552 <span class="comment"></span>
<a name="l00553"></a>00553 <span class="comment">Authors: Tero Hasu &lt;tero.hasu@hut.fi&gt;</span>
<a name="l00554"></a>00554 <span class="comment"></span>
<a name="l00555"></a>00555 <span class="comment">Permission is hereby granted, free of charge, to any person</span>
<a name="l00556"></a>00556 <span class="comment">obtaining a copy of this software and associated documentation files</span>
<a name="l00557"></a>00557 <span class="comment">(the &quot;Software&quot;), to deal in the Software without restriction,</span>
<a name="l00558"></a>00558 <span class="comment">including without limitation the rights to use, copy, modify, merge,</span>
<a name="l00559"></a>00559 <span class="comment">publish, distribute, sublicense, and/or sell copies of the Software,</span>
<a name="l00560"></a>00560 <span class="comment">and to permit persons to whom the Software is furnished to do so,</span>
<a name="l00561"></a>00561 <span class="comment">subject to the following conditions:</span>
<a name="l00562"></a>00562 <span class="comment"></span>
<a name="l00563"></a>00563 <span class="comment">The above copyright notice and this permission notice shall be</span>
<a name="l00564"></a>00564 <span class="comment">included in all copies or substantial portions of the Software.</span>
<a name="l00565"></a>00565 <span class="comment"></span>
<a name="l00566"></a>00566 <span class="comment">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,</span>
<a name="l00567"></a>00567 <span class="comment">EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF</span>
<a name="l00568"></a>00568 <span class="comment">MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND</span>
<a name="l00569"></a>00569 <span class="comment">NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS</span>
<a name="l00570"></a>00570 <span class="comment">BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN</span>
<a name="l00571"></a>00571 <span class="comment">ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN</span>
<a name="l00572"></a>00572 <span class="comment">CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span>
<a name="l00573"></a>00573 <span class="comment">SOFTWARE.</span>
<a name="l00574"></a>00574 <span class="comment"></span>
<a name="l00575"></a>00575 <span class="comment"> **/</span>
</pre></div></div>
<hr size="1">

<p style="text-align: right;">
  <a href="http://www.contextlogger.org/">ContextLogger2</a>&#8212;ContextLogger2 Logger Daemon Internals&#8212;<small>Generated on Mon May 2 13:49:52 2011 by&nbsp;<a href="http://www.doxygen.org/">Doxygen</a> 1.6.1</small>
</p>

</body>
</html>
