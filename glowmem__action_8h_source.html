<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ContextLogger2 Logger Daemon Internals: glowmem_action.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_bf2b3bdb1651bc5322e1494d35fecc4b.html">shared</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_0c37473320d0f0bf464654b3047150fd.html">common</a>
  </div>
</div>
<div class="contents">
<h1>glowmem_action.h</h1><a href="glowmem__action_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* </span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright (C) 2006 Nokia Corporation.</span>
<a name="l00003"></a>00003 <span class="comment"> * Copyright 2010 Helsinki Institute for Information Technology (HIIT)</span>
<a name="l00004"></a>00004 <span class="comment"> * and Tero Hasu &lt;tero.hasu@hut.fi&gt;.</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * This is a derived work of SET_LOW_MEMORY_TRAP as found in glowmem.h</span>
<a name="l00007"></a>00007 <span class="comment"> * by Nokia Corporation.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This library is free software; you can redistribute it and/or</span>
<a name="l00010"></a>00010 <span class="comment"> * modify it under the terms of the GNU Lesser General Public</span>
<a name="l00011"></a>00011 <span class="comment"> * License as published by the Free Software Foundation; either</span>
<a name="l00012"></a>00012 <span class="comment"> * version 2.1 of the License.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * This library is distributed in the hope that it will be useful,</span>
<a name="l00015"></a>00015 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00016"></a>00016 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU</span>
<a name="l00017"></a>00017 <span class="comment"> * Lesser General Public License for more details.</span>
<a name="l00018"></a>00018 <span class="comment"> *</span>
<a name="l00019"></a>00019 <span class="comment"> * You should have received a copy of the GNU Lesser General</span>
<a name="l00020"></a>00020 <span class="comment"> * Public License along with this library; if not, write to the</span>
<a name="l00021"></a>00021 <span class="comment"> * Free Software Foundation, Inc., 59 Temple Place, Suite 330,</span>
<a name="l00022"></a>00022 <span class="comment"> * Boston, MA 02111-1307, USA.</span>
<a name="l00023"></a>00023 <span class="comment"> */</span>
<a name="l00024"></a>00024 <span class="preprocessor">#ifndef __glowmem_action_h__</span>
<a name="l00025"></a>00025 <span class="preprocessor"></span><span class="preprocessor">#define __glowmem_action_h__</span>
<a name="l00026"></a>00026 <span class="preprocessor"></span>
<a name="l00027"></a>00027 <span class="preprocessor">#if defined(__SYMBIAN32__)</span>
<a name="l00028"></a>00028 <span class="preprocessor"></span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;glowmem.h&gt;</span>
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="comment">// The idea is to set up some action to deal with an OOM error.</span>
<a name="l00032"></a>00032 <span class="comment">// You must specify an action that causes a return, non-local return, jump, or thread exit. This is because the macro assumes that its execution does not continue after the provided action (this could be changed with better understanding of the internal APIs used).</span>
<a name="l00033"></a>00033 <span class="comment">// Yes, SET_LOW_MEMORY_TRAP_VOID() and SET_LOW_MEMORY_TRAP(failure_value) could be implemented in terms of this macro.</span>
<a name="l00034"></a>00034 <span class="comment">// And yes, this is a bit naughty as it uses internal APIs, but if the internal ABI changes, then existing uses of SET_LOW_MEMORY_TRAP_VOID and SET_LOW_MEMORY_TRAP also require at least recompilation.</span>
<a name="l00035"></a>00035 <span class="comment">// Does this code leak memory if _set_thread_specific_data fails?</span>
<a name="l00036"></a>00036 <span class="preprocessor">#define SET_LOW_MEMORY_TRAP_ACTION(action)      \</span>
<a name="l00037"></a>00037 <span class="preprocessor">gboolean did_i_set = FALSE;\</span>
<a name="l00038"></a>00038 <span class="preprocessor">{\</span>
<a name="l00039"></a>00039 <span class="preprocessor">        mem_info *m = _get_thread_specific_data();\</span>
<a name="l00040"></a>00040 <span class="preprocessor">        if(m == NULL)\</span>
<a name="l00041"></a>00041 <span class="preprocessor">        {\</span>
<a name="l00042"></a>00042 <span class="preprocessor">                m = (mem_info *)_pAlloc(sizeof(mem_info));\</span>
<a name="l00043"></a>00043 <span class="preprocessor">                if(!m) { action; } \</span>
<a name="l00044"></a>00044 <span class="preprocessor">                m-&gt;is_setjmp_called = FALSE;\</span>
<a name="l00045"></a>00045 <span class="preprocessor">                _clearCleanUpStack(&amp;(m-&gt;stack));\</span>
<a name="l00046"></a>00046 <span class="preprocessor">                if(_set_thread_specific_data(m))\</span>
<a name="l00047"></a>00047 <span class="preprocessor">                        { action; } \</span>
<a name="l00048"></a>00048 <span class="preprocessor">        }\</span>
<a name="l00049"></a>00049 <span class="preprocessor">        if(!m-&gt;is_setjmp_called)\</span>
<a name="l00050"></a>00050 <span class="preprocessor">        {\</span>
<a name="l00051"></a>00051 <span class="preprocessor">                if(setjmp(m-&gt;buf) &gt; 0)\</span>
<a name="l00052"></a>00052 <span class="preprocessor">                {\</span>
<a name="l00053"></a>00053 <span class="preprocessor">                        m-&gt;is_setjmp_called = FALSE;\</span>
<a name="l00054"></a>00054 <span class="preprocessor">                        _destroCleanUpStack(&amp;(m-&gt;stack));\</span>
<a name="l00055"></a>00055 <span class="preprocessor">                        { action; } \</span>
<a name="l00056"></a>00056 <span class="preprocessor">                }\</span>
<a name="l00057"></a>00057 <span class="preprocessor">                m-&gt;is_setjmp_called = TRUE;\</span>
<a name="l00058"></a>00058 <span class="preprocessor">                did_i_set = TRUE;\</span>
<a name="l00059"></a>00059 <span class="preprocessor">        }\</span>
<a name="l00060"></a>00060 <span class="preprocessor">}</span>
<a name="l00061"></a>00061 <span class="preprocessor"></span>
<a name="l00062"></a>00062 <span class="preprocessor">#else</span>
<a name="l00063"></a><a class="code" href="glowmem__action_8h.html#a5f50c50705a48bff24adbe46c8253abf">00063</a> <span class="preprocessor"></span><span class="preprocessor">#define SET_LOW_MEMORY_TRAP_ACTION(action)</span>
<a name="l00064"></a>00064 <span class="preprocessor"></span><span class="preprocessor">#endif </span><span class="comment">/* __SYMBIAN32__ */</span>
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 <span class="preprocessor">#endif </span><span class="comment">/* __glowmem_action_h__ */</span>
</pre></div></div>
<hr size="1">

<p style="text-align: right;">
  <a href="http://www.contextlogger.org/">ContextLogger2</a>&#8212;ContextLogger2 Logger Daemon Internals&#8212;<small>Generated on Mon May 2 13:49:53 2011 by&nbsp;<a href="http://www.doxygen.org/">Doxygen</a> 1.6.1</small>
</p>

</body>
</html>
