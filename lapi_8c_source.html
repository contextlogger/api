<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ContextLogger2 Logger Daemon Internals: lapi.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_0a42b8d7a42fdff37378486477d8f5e0.html">lua</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_3536dc5472cf8658af6f2f3c074e6fb2.html">src</a>
  </div>
</div>
<div class="contents">
<h1>lapi.c</h1><a href="lapi_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment">** $Id: lapi.c,v 2.55.1.5 2008/07/04 18:41:18 roberto Exp $</span>
<a name="l00003"></a>00003 <span class="comment">** Lua API</span>
<a name="l00004"></a>00004 <span class="comment">** See Copyright Notice in lua.h</span>
<a name="l00005"></a>00005 <span class="comment">*/</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 <span class="comment">//#include &lt;assert.h&gt;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &lt;stdarg.h&gt;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00012"></a>00012 
<a name="l00013"></a><a class="code" href="lapi_8c.html#a6f4862161259fd87002d41735b0ccfa8">00013</a> <span class="preprocessor">#define lapi_c</span>
<a name="l00014"></a><a class="code" href="lapi_8c.html#abf0b3947b59218777a8e928a10be205b">00014</a> <span class="preprocessor"></span><span class="preprocessor">#define LUA_CORE</span>
<a name="l00015"></a>00015 <span class="preprocessor"></span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;<a class="code" href="lua_8h.html">lua.h</a>&quot;</span>
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 <span class="preprocessor">#include &quot;<a class="code" href="lapi_8h.html">lapi.h</a>&quot;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;<a class="code" href="ldebug_8h.html">ldebug.h</a>&quot;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="ldo_8h.html">ldo.h</a>&quot;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;<a class="code" href="lfunc_8h.html">lfunc.h</a>&quot;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;<a class="code" href="lgc_8h.html">lgc.h</a>&quot;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;<a class="code" href="lmem_8h.html">lmem.h</a>&quot;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="lobject_8h.html">lobject.h</a>&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;<a class="code" href="lstate_8h.html">lstate.h</a>&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="lstring_8h.html">lstring.h</a>&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;<a class="code" href="ltable_8h.html">ltable.h</a>&quot;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="ltm_8h.html">ltm.h</a>&quot;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="lundump_8h.html">lundump.h</a>&quot;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="lvm_8h.html">lvm.h</a>&quot;</span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 
<a name="l00034"></a><a class="code" href="lapi_8c.html#acbf4dc2e5f80547c7f54f41a179258b2">00034</a> <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="lapi_8c.html#acbf4dc2e5f80547c7f54f41a179258b2">lua_ident</a>[] =
<a name="l00035"></a>00035   <span class="stringliteral">&quot;$Lua: &quot;</span> <a class="code" href="lua_8h.html#abeb7a5ea7080e8ef597181124801f759">LUA_RELEASE</a> <span class="stringliteral">&quot; &quot;</span> <a class="code" href="lua_8h.html#a5126fa04dbeee0b9118c769beadcd62d">LUA_COPYRIGHT</a> <span class="stringliteral">&quot; $\n&quot;</span>
<a name="l00036"></a>00036   <span class="stringliteral">&quot;$Authors: &quot;</span> <a class="code" href="lua_8h.html#ab6ff0964a416a9a7c1e90337c965f102">LUA_AUTHORS</a> <span class="stringliteral">&quot; $\n&quot;</span>
<a name="l00037"></a>00037   <span class="stringliteral">&quot;$URL: www.lua.org $\n&quot;</span>;
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 
<a name="l00041"></a><a class="code" href="lapi_8c.html#a9785915283c3f0a0ec90f1b6be32b2c2">00041</a> <span class="preprocessor">#define api_checknelems(L, n) api_check(L, (n) &lt;= (L-&gt;top - L-&gt;base))</span>
<a name="l00042"></a>00042 <span class="preprocessor"></span>
<a name="l00043"></a><a class="code" href="lapi_8c.html#a29c1133faa3c6591f82b5cca34842d67">00043</a> <span class="preprocessor">#define api_checkvalidindex(L, i) api_check(L, (i) != luaO_nilobject)</span>
<a name="l00044"></a>00044 <span class="preprocessor"></span>
<a name="l00045"></a><a class="code" href="lapi_8c.html#afe4a5994dd3704ec53de77f9fd121915">00045</a> <span class="preprocessor">#define api_incr_top(L)   {api_check(L, L-&gt;top &lt; L-&gt;ci-&gt;top); L-&gt;top++;}</span>
<a name="l00046"></a>00046 <span class="preprocessor"></span>
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 
<a name="l00049"></a><a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">00049</a> <span class="keyword">static</span> <a class="code" href="structlua__TValue.html">TValue</a> *<a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> idx) {
<a name="l00050"></a>00050   <span class="keywordflow">if</span> (idx &gt; 0) {
<a name="l00051"></a>00051     <a class="code" href="structlua__TValue.html">TValue</a> *o = L-&gt;<a class="code" href="structlua__State.html#ac11fa7aeb6254b8de57fb9d1dd06fdf2">base</a> + (idx - 1);
<a name="l00052"></a>00052     <a class="code" href="llimits_8h.html#a2e63f41a5abfb21dd4394da89206b3f2">api_check</a>(L, idx &lt;= L-&gt;ci-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> - L-&gt;<a class="code" href="structlua__State.html#ac11fa7aeb6254b8de57fb9d1dd06fdf2">base</a>);
<a name="l00053"></a>00053     <span class="keywordflow">if</span> (o &gt;= L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>) <span class="keywordflow">return</span> <a class="code" href="llimits_8h.html#af17d62ec9e237a7644de6b9b34a48a34">cast</a>(<a class="code" href="structlua__TValue.html">TValue</a> *, <a class="code" href="lobject_8h.html#a7b3b558006786b9088568ae50483603a">luaO_nilobject</a>);
<a name="l00054"></a>00054     <span class="keywordflow">else</span> <span class="keywordflow">return</span> o;
<a name="l00055"></a>00055   }
<a name="l00056"></a>00056   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (idx &gt; <a class="code" href="lua_8h.html#a3524c2bbc8fcf847dc083246b62945dd">LUA_REGISTRYINDEX</a>) {
<a name="l00057"></a>00057     <a class="code" href="llimits_8h.html#a2e63f41a5abfb21dd4394da89206b3f2">api_check</a>(L, idx != 0 &amp;&amp; -idx &lt;= L-&gt;top - L-&gt;<a class="code" href="structlua__State.html#ac11fa7aeb6254b8de57fb9d1dd06fdf2">base</a>);
<a name="l00058"></a>00058     <span class="keywordflow">return</span> L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> + idx;
<a name="l00059"></a>00059   }
<a name="l00060"></a>00060   <span class="keywordflow">else</span> <span class="keywordflow">switch</span> (idx) {  <span class="comment">/* pseudo-indices */</span>
<a name="l00061"></a>00061     <span class="keywordflow">case</span> <a class="code" href="lua_8h.html#a3524c2bbc8fcf847dc083246b62945dd">LUA_REGISTRYINDEX</a>: <span class="keywordflow">return</span> <a class="code" href="lstate_8h.html#ad294d19c007815f4c238efbd221ea705">registry</a>(L);
<a name="l00062"></a>00062     <span class="keywordflow">case</span> <a class="code" href="lua_8h.html#a7f265c572db9a8ff4fe6069ae8b40995">LUA_ENVIRONINDEX</a>: {
<a name="l00063"></a>00063       <a class="code" href="unionClosure.html">Closure</a> *func = <a class="code" href="lstate_8h.html#adb3d2c648d3489e94bf9f685e8651b4e">curr_func</a>(L);
<a name="l00064"></a>00064       <a class="code" href="lobject_8h.html#ab9379699ac579d54410e3542f061bbad">sethvalue</a>(L, &amp;L-&gt;<a class="code" href="structlua__State.html#af67c33e03066e3c268d29a6d1b9fcc6c">env</a>, func-&gt;<a class="code" href="unionClosure.html#ace9dac5a62b61db682ef0cd86b3b44b1">c</a>.env);
<a name="l00065"></a>00065       <span class="keywordflow">return</span> &amp;L-&gt;<a class="code" href="structlua__State.html#af67c33e03066e3c268d29a6d1b9fcc6c">env</a>;
<a name="l00066"></a>00066     }
<a name="l00067"></a>00067     <span class="keywordflow">case</span> <a class="code" href="lua_8h.html#adcd23d4ad1ec6e825daea03ee83c8c73">LUA_GLOBALSINDEX</a>: <span class="keywordflow">return</span> <a class="code" href="lstate_8h.html#a1108b4374aa20059cd53d90b638c0e4b">gt</a>(L);
<a name="l00068"></a>00068     <span class="keywordflow">default</span>: {
<a name="l00069"></a>00069       <a class="code" href="unionClosure.html">Closure</a> *func = <a class="code" href="lstate_8h.html#adb3d2c648d3489e94bf9f685e8651b4e">curr_func</a>(L);
<a name="l00070"></a>00070       idx = <a class="code" href="lua_8h.html#adcd23d4ad1ec6e825daea03ee83c8c73">LUA_GLOBALSINDEX</a> - idx;
<a name="l00071"></a>00071       <span class="keywordflow">return</span> (idx &lt;= func-&gt;c.nupvalues)
<a name="l00072"></a>00072                 ? &amp;func-&gt;<a class="code" href="unionClosure.html#ace9dac5a62b61db682ef0cd86b3b44b1">c</a>.<a class="code" href="structCClosure.html#a75d6bfc66f8ed48b3dd67007be84174f">upvalue</a>[idx-1]
<a name="l00073"></a>00073                 : <a class="code" href="llimits_8h.html#af17d62ec9e237a7644de6b9b34a48a34">cast</a>(<a class="code" href="structlua__TValue.html">TValue</a> *, <a class="code" href="lobject_8h.html#a7b3b558006786b9088568ae50483603a">luaO_nilobject</a>);
<a name="l00074"></a>00074     }
<a name="l00075"></a>00075   }
<a name="l00076"></a>00076 }
<a name="l00077"></a>00077 
<a name="l00078"></a>00078 
<a name="l00079"></a><a class="code" href="lapi_8c.html#a95a3021abc491c31183d30fcb175035e">00079</a> <span class="keyword">static</span> <a class="code" href="structTable.html">Table</a> *<a class="code" href="lapi_8c.html#a95a3021abc491c31183d30fcb175035e">getcurrenv</a> (<a class="code" href="structlua__State.html">lua_State</a> *L) {
<a name="l00080"></a>00080   <span class="keywordflow">if</span> (L-&gt;<a class="code" href="structlua__State.html#a7fbb5727050853f411ad64b4be9ab5c8">ci</a> == L-&gt;<a class="code" href="structlua__State.html#a5e99f3f914a793d73684a19eb96dda3b">base_ci</a>)  <span class="comment">/* no enclosing function? */</span>
<a name="l00081"></a>00081     <span class="keywordflow">return</span> <a class="code" href="lobject_8h.html#a336a6ce5e8340e6de133ec249cf47ebf">hvalue</a>(<a class="code" href="lstate_8h.html#a1108b4374aa20059cd53d90b638c0e4b">gt</a>(L));  <span class="comment">/* use global table as environment */</span>
<a name="l00082"></a>00082   <span class="keywordflow">else</span> {
<a name="l00083"></a>00083     <a class="code" href="unionClosure.html">Closure</a> *func = <a class="code" href="lstate_8h.html#adb3d2c648d3489e94bf9f685e8651b4e">curr_func</a>(L);
<a name="l00084"></a>00084     <span class="keywordflow">return</span> func-&gt;<a class="code" href="unionClosure.html#ace9dac5a62b61db682ef0cd86b3b44b1">c</a>.env;
<a name="l00085"></a>00085   }
<a name="l00086"></a>00086 }
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 
<a name="l00089"></a><a class="code" href="lapi_8h.html#aecc6369a30c850f25781a2d3f3919e62">00089</a> <span class="keywordtype">void</span> <a class="code" href="lapi_8c.html#a7a20f9a76303e8dda4ecd7adc05917a7">luaA_pushobject</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keyword">const</span> <a class="code" href="structlua__TValue.html">TValue</a> *o) {
<a name="l00090"></a>00090   <a class="code" href="lobject_8h.html#a1c51b9462c606f1f97242fae6b1220d1">setobj2s</a>(L, L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>, o);
<a name="l00091"></a>00091   <a class="code" href="lapi_8c.html#afe4a5994dd3704ec53de77f9fd121915">api_incr_top</a>(L);
<a name="l00092"></a>00092 }
<a name="l00093"></a>00093 
<a name="l00094"></a>00094 
<a name="l00095"></a><a class="code" href="lua_8h.html#a587f91654912f901426c7118ecc5348c">00095</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">int</span> <a class="code" href="lapi_8c.html#acea2383413b1e10bee681b109bad5b59">lua_checkstack</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> size) {
<a name="l00096"></a>00096   <span class="keywordtype">int</span> res = 1;
<a name="l00097"></a>00097   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00098"></a>00098   <span class="keywordflow">if</span> (size &gt; <a class="code" href="luaconf_8h.html#aad7d9b351cde290eb12c180d03ec71e4">LUAI_MAXCSTACK</a> || (L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> - L-&gt;<a class="code" href="structlua__State.html#ac11fa7aeb6254b8de57fb9d1dd06fdf2">base</a> + size) &gt; <a class="code" href="luaconf_8h.html#aad7d9b351cde290eb12c180d03ec71e4">LUAI_MAXCSTACK</a>)
<a name="l00099"></a>00099     res = 0;  <span class="comment">/* stack overflow */</span>
<a name="l00100"></a>00100   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (size &gt; 0) {
<a name="l00101"></a>00101     <a class="code" href="ldo_8h.html#ab1500a6449b9cdf335e3c7ce23aa85d7">luaD_checkstack</a>(L, size);
<a name="l00102"></a>00102     <span class="keywordflow">if</span> (L-&gt;<a class="code" href="structlua__State.html#a7fbb5727050853f411ad64b4be9ab5c8">ci</a>-&gt;<a class="code" href="structCallInfo.html#ae782b06ef00ccfe0720625ffa99b093a">top</a> &lt; L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> + size)
<a name="l00103"></a>00103       L-&gt;<a class="code" href="structlua__State.html#a7fbb5727050853f411ad64b4be9ab5c8">ci</a>-&gt;<a class="code" href="structCallInfo.html#ae782b06ef00ccfe0720625ffa99b093a">top</a> = L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> + size;
<a name="l00104"></a>00104   }
<a name="l00105"></a>00105   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00106"></a>00106   <span class="keywordflow">return</span> res;
<a name="l00107"></a>00107 }
<a name="l00108"></a>00108 
<a name="l00109"></a>00109 
<a name="l00110"></a><a class="code" href="lua_8h.html#a389cf4bf773f353508a28293143d403e">00110</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">void</span> <a class="code" href="lapi_8c.html#ae27bb8d0218710bbbfefc1f573839d6d">lua_xmove</a> (<a class="code" href="structlua__State.html">lua_State</a> *from, <a class="code" href="structlua__State.html">lua_State</a> *to, <span class="keywordtype">int</span> n) {
<a name="l00111"></a>00111   <span class="keywordtype">int</span> i;
<a name="l00112"></a>00112   <span class="keywordflow">if</span> (from == to) <span class="keywordflow">return</span>;
<a name="l00113"></a>00113   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(to);
<a name="l00114"></a>00114   <a class="code" href="lapi_8c.html#a9785915283c3f0a0ec90f1b6be32b2c2">api_checknelems</a>(from, n);
<a name="l00115"></a>00115   <a class="code" href="llimits_8h.html#a2e63f41a5abfb21dd4394da89206b3f2">api_check</a>(from, <a class="code" href="lstate_8h.html#a103db2de6edf3420c6c6c9a282562406">G</a>(from) == <a class="code" href="lstate_8h.html#a103db2de6edf3420c6c6c9a282562406">G</a>(to));
<a name="l00116"></a>00116   <a class="code" href="llimits_8h.html#a2e63f41a5abfb21dd4394da89206b3f2">api_check</a>(from, to-&gt;<a class="code" href="structlua__State.html#a7fbb5727050853f411ad64b4be9ab5c8">ci</a>-&gt;<a class="code" href="structCallInfo.html#ae782b06ef00ccfe0720625ffa99b093a">top</a> - to-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> &gt;= n);
<a name="l00117"></a>00117   from-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> -= n;
<a name="l00118"></a>00118   <span class="keywordflow">for</span> (i = 0; i &lt; n; i++) {
<a name="l00119"></a>00119     <a class="code" href="lobject_8h.html#a1c51b9462c606f1f97242fae6b1220d1">setobj2s</a>(to, to-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>++, from-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> + i);
<a name="l00120"></a>00120   }
<a name="l00121"></a>00121   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(to);
<a name="l00122"></a>00122 }
<a name="l00123"></a>00123 
<a name="l00124"></a>00124 
<a name="l00125"></a><a class="code" href="lua_8h.html#a23ba67a2597f1bce7e408f44ff5bc4f4">00125</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">void</span> <a class="code" href="lapi_8c.html#a23ba67a2597f1bce7e408f44ff5bc4f4">lua_setlevel</a> (<a class="code" href="structlua__State.html">lua_State</a> *from, <a class="code" href="structlua__State.html">lua_State</a> *to) {
<a name="l00126"></a>00126   to-&gt;<a class="code" href="structlua__State.html#ac388127d044b54d2e9779beb44398845">nCcalls</a> = from-&gt;<a class="code" href="structlua__State.html#ac388127d044b54d2e9779beb44398845">nCcalls</a>;
<a name="l00127"></a>00127 }
<a name="l00128"></a>00128 
<a name="l00129"></a>00129 
<a name="l00130"></a><a class="code" href="lua_8h.html#a21ccd6b330c56c62fc3d0f15dd59f7a7">00130</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <a class="code" href="lua_8h.html#a5f5bedea265eccf43c6e404e020988ce">lua_CFunction</a> <a class="code" href="lapi_8c.html#a90bf785da77985164dbe2eb0d64bf82e">lua_atpanic</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <a class="code" href="lua_8h.html#a5f5bedea265eccf43c6e404e020988ce">lua_CFunction</a> panicf) {
<a name="l00131"></a>00131   <a class="code" href="lua_8h.html#a5f5bedea265eccf43c6e404e020988ce">lua_CFunction</a> old;
<a name="l00132"></a>00132   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00133"></a>00133   old = <a class="code" href="lstate_8h.html#a103db2de6edf3420c6c6c9a282562406">G</a>(L)-&gt;panic;
<a name="l00134"></a>00134   <a class="code" href="lstate_8h.html#a103db2de6edf3420c6c6c9a282562406">G</a>(L)-&gt;panic = panicf;
<a name="l00135"></a>00135   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00136"></a>00136   <span class="keywordflow">return</span> old;
<a name="l00137"></a>00137 }
<a name="l00138"></a>00138 
<a name="l00139"></a>00139 
<a name="l00140"></a><a class="code" href="lua_8h.html#a6a7867e39b589ae581e2ed837cbc6ea4">00140</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <a class="code" href="structlua__State.html">lua_State</a> *<a class="code" href="lapi_8c.html#a86b660d6f2b69734c35ec9fc718e4ca9">lua_newthread</a> (<a class="code" href="structlua__State.html">lua_State</a> *L) {
<a name="l00141"></a>00141   <a class="code" href="structlua__State.html">lua_State</a> *L1;
<a name="l00142"></a>00142   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00143"></a>00143   <a class="code" href="lgc_8h.html#ad013db5004ccc5fbe8a6450caa1f1ad9">luaC_checkGC</a>(L);
<a name="l00144"></a>00144   L1 = <a class="code" href="lstate_8c.html#a37e72603bb5f5f82e35938b696ce36a7">luaE_newthread</a>(L);
<a name="l00145"></a>00145   <a class="code" href="lobject_8h.html#a9c2bad449e8e998bb9d937642923a225">setthvalue</a>(L, L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>, L1);
<a name="l00146"></a>00146   <a class="code" href="lapi_8c.html#afe4a5994dd3704ec53de77f9fd121915">api_incr_top</a>(L);
<a name="l00147"></a>00147   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00148"></a>00148   <a class="code" href="luaconf_8h.html#a533eae4cf709fa76f3974823354e4067">luai_userstatethread</a>(L, L1);
<a name="l00149"></a>00149   <span class="keywordflow">return</span> L1;
<a name="l00150"></a>00150 }
<a name="l00151"></a>00151 
<a name="l00152"></a>00152 
<a name="l00153"></a>00153 
<a name="l00154"></a>00154 <span class="comment">/*</span>
<a name="l00155"></a>00155 <span class="comment">** basic stack manipulation</span>
<a name="l00156"></a>00156 <span class="comment">*/</span>
<a name="l00157"></a>00157 
<a name="l00158"></a>00158 
<a name="l00159"></a><a class="code" href="lua_8h.html#ac5d7d4db9186b87ab018916e8826f008">00159</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">int</span> <a class="code" href="lapi_8c.html#afbb08ecb69421875494105d4de68e5bf">lua_gettop</a> (<a class="code" href="structlua__State.html">lua_State</a> *L) {
<a name="l00160"></a>00160   <span class="keywordflow">return</span> <a class="code" href="llimits_8h.html#a37a9e2c4b53433d34bad0f12a1500c08">cast_int</a>(L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> - L-&gt;<a class="code" href="structlua__State.html#ac11fa7aeb6254b8de57fb9d1dd06fdf2">base</a>);
<a name="l00161"></a>00161 }
<a name="l00162"></a>00162 
<a name="l00163"></a>00163 
<a name="l00164"></a><a class="code" href="lua_8h.html#a6cb9c62b9d85b1ad2a04d72bcb733816">00164</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">void</span> <a class="code" href="lapi_8c.html#adaa30f0d34786144c94644039d1d1b6e">lua_settop</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> idx) {
<a name="l00165"></a>00165   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00166"></a>00166   <span class="keywordflow">if</span> (idx &gt;= 0) {
<a name="l00167"></a>00167     <a class="code" href="llimits_8h.html#a2e63f41a5abfb21dd4394da89206b3f2">api_check</a>(L, idx &lt;= L-&gt;stack_last - L-&gt;<a class="code" href="structlua__State.html#ac11fa7aeb6254b8de57fb9d1dd06fdf2">base</a>);
<a name="l00168"></a>00168     <span class="keywordflow">while</span> (L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> &lt; L-&gt;<a class="code" href="structlua__State.html#ac11fa7aeb6254b8de57fb9d1dd06fdf2">base</a> + idx)
<a name="l00169"></a>00169       <a class="code" href="lobject_8h.html#ad9034def7bbc1965ec3d714d84620b07">setnilvalue</a>(L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>++);
<a name="l00170"></a>00170     L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> = L-&gt;<a class="code" href="structlua__State.html#ac11fa7aeb6254b8de57fb9d1dd06fdf2">base</a> + idx;
<a name="l00171"></a>00171   }
<a name="l00172"></a>00172   <span class="keywordflow">else</span> {
<a name="l00173"></a>00173     <a class="code" href="llimits_8h.html#a2e63f41a5abfb21dd4394da89206b3f2">api_check</a>(L, -(idx+1) &lt;= (L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> - L-&gt;<a class="code" href="structlua__State.html#ac11fa7aeb6254b8de57fb9d1dd06fdf2">base</a>));
<a name="l00174"></a>00174     L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> += idx+1;  <span class="comment">/* `subtract&apos; index (index is negative) */</span>
<a name="l00175"></a>00175   }
<a name="l00176"></a>00176   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00177"></a>00177 }
<a name="l00178"></a>00178 
<a name="l00179"></a>00179 
<a name="l00180"></a><a class="code" href="lua_8h.html#acb96e065629db2dedb0624524a9b34d4">00180</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">void</span> <a class="code" href="lapi_8c.html#a7f2ac31d9ad6f0e0ff068d2fbbd08714">lua_remove</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> idx) {
<a name="l00181"></a>00181   <a class="code" href="structlua__TValue.html">StkId</a> p;
<a name="l00182"></a>00182   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00183"></a>00183   p = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, idx);
<a name="l00184"></a>00184   <a class="code" href="lapi_8c.html#a29c1133faa3c6591f82b5cca34842d67">api_checkvalidindex</a>(L, p);
<a name="l00185"></a>00185   <span class="keywordflow">while</span> (++p &lt; L-&gt;top) <a class="code" href="lobject_8h.html#a6d30d7fa36e78e0bfb56ba38d9e89ce2">setobjs2s</a>(L, p-1, p);
<a name="l00186"></a>00186   L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>--;
<a name="l00187"></a>00187   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00188"></a>00188 }
<a name="l00189"></a>00189 
<a name="l00190"></a>00190 
<a name="l00191"></a><a class="code" href="lua_8h.html#a9185776cc77b691daca1eb94fd8e9807">00191</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">void</span> <a class="code" href="lapi_8c.html#aba6844115e26e0923488403436219e66">lua_insert</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> idx) {
<a name="l00192"></a>00192   <a class="code" href="structlua__TValue.html">StkId</a> p;
<a name="l00193"></a>00193   <a class="code" href="structlua__TValue.html">StkId</a> q;
<a name="l00194"></a>00194   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00195"></a>00195   p = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, idx);
<a name="l00196"></a>00196   <a class="code" href="lapi_8c.html#a29c1133faa3c6591f82b5cca34842d67">api_checkvalidindex</a>(L, p);
<a name="l00197"></a>00197   <span class="keywordflow">for</span> (q = L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>; q&gt;p; q--) <a class="code" href="lobject_8h.html#a6d30d7fa36e78e0bfb56ba38d9e89ce2">setobjs2s</a>(L, q, q-1);
<a name="l00198"></a>00198   <a class="code" href="lobject_8h.html#a6d30d7fa36e78e0bfb56ba38d9e89ce2">setobjs2s</a>(L, p, L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>);
<a name="l00199"></a>00199   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00200"></a>00200 }
<a name="l00201"></a>00201 
<a name="l00202"></a>00202 
<a name="l00203"></a><a class="code" href="lua_8h.html#a40a5a870b611d40f44e82ca3c9678b62">00203</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">void</span> <a class="code" href="lapi_8c.html#a66d3827120ac828f870502bff0d4ff75">lua_replace</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> idx) {
<a name="l00204"></a>00204   <a class="code" href="structlua__TValue.html">StkId</a> o;
<a name="l00205"></a>00205   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00206"></a>00206   <span class="comment">/* explicit test for incompatible code */</span>
<a name="l00207"></a>00207   <span class="keywordflow">if</span> (idx == <a class="code" href="lua_8h.html#a7f265c572db9a8ff4fe6069ae8b40995">LUA_ENVIRONINDEX</a> &amp;&amp; L-&gt;<a class="code" href="structlua__State.html#a7fbb5727050853f411ad64b4be9ab5c8">ci</a> == L-&gt;<a class="code" href="structlua__State.html#a5e99f3f914a793d73684a19eb96dda3b">base_ci</a>)
<a name="l00208"></a>00208     <a class="code" href="ldebug_8h.html#a09f10e9e270ceb370bfddaaace18b468">luaG_runerror_1</a>(L, <span class="stringliteral">&quot;no calling environment&quot;</span>);
<a name="l00209"></a>00209   <a class="code" href="lapi_8c.html#a9785915283c3f0a0ec90f1b6be32b2c2">api_checknelems</a>(L, 1);
<a name="l00210"></a>00210   o = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, idx);
<a name="l00211"></a>00211   <a class="code" href="lapi_8c.html#a29c1133faa3c6591f82b5cca34842d67">api_checkvalidindex</a>(L, o);
<a name="l00212"></a>00212   <span class="keywordflow">if</span> (idx == <a class="code" href="lua_8h.html#a7f265c572db9a8ff4fe6069ae8b40995">LUA_ENVIRONINDEX</a>) {
<a name="l00213"></a>00213     <a class="code" href="unionClosure.html">Closure</a> *func = <a class="code" href="lstate_8h.html#adb3d2c648d3489e94bf9f685e8651b4e">curr_func</a>(L);
<a name="l00214"></a>00214     <a class="code" href="llimits_8h.html#a2e63f41a5abfb21dd4394da89206b3f2">api_check</a>(L, <a class="code" href="lobject_8h.html#ac5338f5fe3885d1ee65412e00a44384e">ttistable</a>(L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> - 1)); 
<a name="l00215"></a>00215     func-&gt;<a class="code" href="unionClosure.html#ace9dac5a62b61db682ef0cd86b3b44b1">c</a>.env = <a class="code" href="lobject_8h.html#a336a6ce5e8340e6de133ec249cf47ebf">hvalue</a>(L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> - 1);
<a name="l00216"></a>00216     <a class="code" href="lgc_8h.html#a21660a316c42bc1aad10f115e2261bca">luaC_barrier</a>(L, func, L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> - 1);
<a name="l00217"></a>00217   }
<a name="l00218"></a>00218   <span class="keywordflow">else</span> {
<a name="l00219"></a>00219     <a class="code" href="lobject_8h.html#acf2af15f3d5cceca8e8870f96634bc2d">setobj</a>(L, o, L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> - 1);
<a name="l00220"></a>00220     <span class="keywordflow">if</span> (idx &lt; <a class="code" href="lua_8h.html#adcd23d4ad1ec6e825daea03ee83c8c73">LUA_GLOBALSINDEX</a>)  <span class="comment">/* function upvalue? */</span>
<a name="l00221"></a>00221       <a class="code" href="lgc_8h.html#a21660a316c42bc1aad10f115e2261bca">luaC_barrier</a>(L, <a class="code" href="lstate_8h.html#adb3d2c648d3489e94bf9f685e8651b4e">curr_func</a>(L), L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> - 1);
<a name="l00222"></a>00222   }
<a name="l00223"></a>00223   L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>--;
<a name="l00224"></a>00224   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00225"></a>00225 }
<a name="l00226"></a>00226 
<a name="l00227"></a>00227 
<a name="l00228"></a><a class="code" href="lua_8h.html#a95e1c0a61aff11059655e6d246bcace7">00228</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">void</span> <a class="code" href="lapi_8c.html#a602f61a9b583d69dc1c72c8970bd65e8">lua_pushvalue</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> idx) {
<a name="l00229"></a>00229   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00230"></a>00230   <a class="code" href="lobject_8h.html#a1c51b9462c606f1f97242fae6b1220d1">setobj2s</a>(L, L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>, <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, idx));
<a name="l00231"></a>00231   <a class="code" href="lapi_8c.html#afe4a5994dd3704ec53de77f9fd121915">api_incr_top</a>(L);
<a name="l00232"></a>00232   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00233"></a>00233 }
<a name="l00234"></a>00234 
<a name="l00235"></a>00235 
<a name="l00236"></a>00236 
<a name="l00237"></a>00237 <span class="comment">/*</span>
<a name="l00238"></a>00238 <span class="comment">** access functions (stack -&gt; C)</span>
<a name="l00239"></a>00239 <span class="comment">*/</span>
<a name="l00240"></a>00240 
<a name="l00241"></a>00241 
<a name="l00242"></a><a class="code" href="lua_8h.html#aa988ba5b97ff838ccb92babd63063273">00242</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">int</span> <a class="code" href="lapi_8c.html#a652b273947f0656686f998d8e90cd3ea">lua_type</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> idx) {
<a name="l00243"></a>00243   <a class="code" href="structlua__TValue.html">StkId</a> o = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, idx);
<a name="l00244"></a>00244   <span class="keywordflow">return</span> (o == <a class="code" href="lobject_8h.html#a7b3b558006786b9088568ae50483603a">luaO_nilobject</a>) ? <a class="code" href="lua_8h.html#a39c27eef097c704eee3536906dea5380">LUA_TNONE</a> : <a class="code" href="lobject_8h.html#acd205ab396b96fba48e1f758c17a2cf3">ttype</a>(o);
<a name="l00245"></a>00245 }
<a name="l00246"></a>00246 
<a name="l00247"></a>00247 
<a name="l00248"></a><a class="code" href="lua_8h.html#a963a421b920cd7ce229f82091eab18a9">00248</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="lapi_8c.html#a7d64f87addab440bbda96bb088816e17">lua_typename</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> t) {
<a name="l00249"></a>00249   <a class="code" href="llimits_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(L);
<a name="l00250"></a>00250   <span class="keywordflow">return</span> (t == <a class="code" href="lua_8h.html#a39c27eef097c704eee3536906dea5380">LUA_TNONE</a>) ? <span class="stringliteral">&quot;no value&quot;</span> : <a class="code" href="ltm_8c.html#a3ba7d248c312c86b29d7027a374ebc4f">luaT_typenames</a>[t];
<a name="l00251"></a>00251 }
<a name="l00252"></a>00252 
<a name="l00253"></a>00253 
<a name="l00254"></a><a class="code" href="lua_8h.html#a6b2ce32286576a8e36fe4629662cb536">00254</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">int</span> <a class="code" href="lapi_8c.html#a3b922032c9fe2930399186a3647cc3ad">lua_iscfunction</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> idx) {
<a name="l00255"></a>00255   <a class="code" href="structlua__TValue.html">StkId</a> o = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, idx);
<a name="l00256"></a>00256   <span class="keywordflow">return</span> <a class="code" href="lobject_8h.html#a6461891bd185c211514aef4fa7179767">iscfunction</a>(o);
<a name="l00257"></a>00257 }
<a name="l00258"></a>00258 
<a name="l00259"></a>00259 
<a name="l00260"></a><a class="code" href="lua_8h.html#a2b5321e5370d82564c138e9dd8ffc9a5">00260</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">int</span> <a class="code" href="lapi_8c.html#a99451f234bf085c9c46c3d17a5aef905">lua_isnumber</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> idx) {
<a name="l00261"></a>00261   <a class="code" href="structlua__TValue.html">TValue</a> n;
<a name="l00262"></a>00262   <span class="keyword">const</span> <a class="code" href="structlua__TValue.html">TValue</a> *o = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, idx);
<a name="l00263"></a>00263   <span class="keywordflow">return</span> <a class="code" href="lvm_8h.html#af9edcc5da8ea1ac07ffdf79fbe5bb95c">tonumber</a>(o, &amp;n);
<a name="l00264"></a>00264 }
<a name="l00265"></a>00265 
<a name="l00266"></a>00266 
<a name="l00267"></a><a class="code" href="lua_8h.html#a70f6031d538713cb3b6093adbc658909">00267</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">int</span> <a class="code" href="lapi_8c.html#a9f20233199a414b04c1c4b43f5d040f3">lua_isstring</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> idx) {
<a name="l00268"></a>00268   <span class="keywordtype">int</span> t = <a class="code" href="lapi_8c.html#a652b273947f0656686f998d8e90cd3ea">lua_type</a>(L, idx);
<a name="l00269"></a>00269   <span class="keywordflow">return</span> (t == <a class="code" href="lua_8h.html#a57de20d87bb5131a3159f2bd52e3fab6">LUA_TSTRING</a> || t == <a class="code" href="lua_8h.html#a7f62ecb240cb38da9c8a53b41fe21ed9">LUA_TNUMBER</a>);
<a name="l00270"></a>00270 }
<a name="l00271"></a>00271 
<a name="l00272"></a>00272 
<a name="l00273"></a><a class="code" href="lua_8h.html#af4cc013f4e4e84fc89bab292bd410981">00273</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">int</span> <a class="code" href="lapi_8c.html#aa8a1dab86cfb4e0f9a4d1f699af0041b">lua_isuserdata</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> idx) {
<a name="l00274"></a>00274   <span class="keyword">const</span> <a class="code" href="structlua__TValue.html">TValue</a> *o = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, idx);
<a name="l00275"></a>00275   <span class="keywordflow">return</span> (<a class="code" href="lobject_8h.html#adb92da594f060270240a415b3483efc2">ttisuserdata</a>(o) || <a class="code" href="lobject_8h.html#a6440445277dce2e73af1e043f9884d7a">ttislightuserdata</a>(o));
<a name="l00276"></a>00276 }
<a name="l00277"></a>00277 
<a name="l00278"></a>00278 
<a name="l00279"></a><a class="code" href="lua_8h.html#a2cd7fef8e86adabbfec04ddb15aeebda">00279</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">int</span> <a class="code" href="lapi_8c.html#ace66ea78ced7fda0b367f45d09d10d83">lua_rawequal</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> index1, <span class="keywordtype">int</span> index2) {
<a name="l00280"></a>00280   <a class="code" href="structlua__TValue.html">StkId</a> o1 = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, index1);
<a name="l00281"></a>00281   <a class="code" href="structlua__TValue.html">StkId</a> o2 = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, index2);
<a name="l00282"></a>00282   <span class="keywordflow">return</span> (o1 == <a class="code" href="lobject_8h.html#a7b3b558006786b9088568ae50483603a">luaO_nilobject</a> || o2 == <a class="code" href="lobject_8h.html#a7b3b558006786b9088568ae50483603a">luaO_nilobject</a>) ? 0
<a name="l00283"></a>00283          : <a class="code" href="lobject_8c.html#a491502522b283e90c5fa3391f66827dc">luaO_rawequalObj</a>(o1, o2);
<a name="l00284"></a>00284 }
<a name="l00285"></a>00285 
<a name="l00286"></a>00286 
<a name="l00287"></a><a class="code" href="lua_8h.html#ae22897869083c78bde3055b6189b7d0c">00287</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">int</span> <a class="code" href="lapi_8c.html#ae9280336584359894597220e5691bbce">lua_equal</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> index1, <span class="keywordtype">int</span> index2) {
<a name="l00288"></a>00288   <a class="code" href="structlua__TValue.html">StkId</a> o1, o2;
<a name="l00289"></a>00289   <span class="keywordtype">int</span> i;
<a name="l00290"></a>00290   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);  <span class="comment">/* may call tag method */</span>
<a name="l00291"></a>00291   o1 = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, index1);
<a name="l00292"></a>00292   o2 = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, index2);
<a name="l00293"></a>00293   i = (o1 == <a class="code" href="lobject_8h.html#a7b3b558006786b9088568ae50483603a">luaO_nilobject</a> || o2 == <a class="code" href="lobject_8h.html#a7b3b558006786b9088568ae50483603a">luaO_nilobject</a>) ? 0 : <a class="code" href="lvm_8h.html#aa2cf0219381d4d4c3d7108f1f11fdf42">equalobj</a>(L, o1, o2);
<a name="l00294"></a>00294   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00295"></a>00295   <span class="keywordflow">return</span> i;
<a name="l00296"></a>00296 }
<a name="l00297"></a>00297 
<a name="l00298"></a>00298 
<a name="l00299"></a><a class="code" href="lua_8h.html#a9d0b4eabdb4ebe518e9de3779e50d884">00299</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">int</span> <a class="code" href="lapi_8c.html#ae2059ba2de707cb5657d1723aa23e752">lua_lessthan</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> index1, <span class="keywordtype">int</span> index2) {
<a name="l00300"></a>00300   <a class="code" href="structlua__TValue.html">StkId</a> o1, o2;
<a name="l00301"></a>00301   <span class="keywordtype">int</span> i;
<a name="l00302"></a>00302   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);  <span class="comment">/* may call tag method */</span>
<a name="l00303"></a>00303   o1 = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, index1);
<a name="l00304"></a>00304   o2 = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, index2);
<a name="l00305"></a>00305   i = (o1 == <a class="code" href="lobject_8h.html#a7b3b558006786b9088568ae50483603a">luaO_nilobject</a> || o2 == <a class="code" href="lobject_8h.html#a7b3b558006786b9088568ae50483603a">luaO_nilobject</a>) ? 0
<a name="l00306"></a>00306        : <a class="code" href="lvm_8c.html#a82cf4e4e2322eef8c4c53b98669e2ada">luaV_lessthan</a>(L, o1, o2);
<a name="l00307"></a>00307   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00308"></a>00308   <span class="keywordflow">return</span> i;
<a name="l00309"></a>00309 }
<a name="l00310"></a>00310 
<a name="l00311"></a>00311 
<a name="l00312"></a>00312 
<a name="l00313"></a><a class="code" href="lua_8h.html#ab93cb1edc97ca887c90dbcbd43e1df88">00313</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <a class="code" href="lua_8h.html#af0a6ed3b852d680769cfc410a0672172">lua_Number</a> <a class="code" href="lapi_8c.html#a42c1f68101dc98a6ae4695c8577b17f8">lua_tonumber</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> idx) {
<a name="l00314"></a>00314   <a class="code" href="structlua__TValue.html">TValue</a> n;
<a name="l00315"></a>00315   <span class="keyword">const</span> <a class="code" href="structlua__TValue.html">TValue</a> *o = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, idx);
<a name="l00316"></a>00316   <span class="keywordflow">if</span> (<a class="code" href="lvm_8h.html#af9edcc5da8ea1ac07ffdf79fbe5bb95c">tonumber</a>(o, &amp;n))
<a name="l00317"></a>00317     <span class="keywordflow">return</span> <a class="code" href="lobject_8h.html#a690ab618235691bb5a82610f07dd8684">nvalue</a>(o);
<a name="l00318"></a>00318   <span class="keywordflow">else</span>
<a name="l00319"></a>00319     <span class="keywordflow">return</span> 0;
<a name="l00320"></a>00320 }
<a name="l00321"></a>00321 
<a name="l00322"></a>00322 
<a name="l00323"></a><a class="code" href="lua_8h.html#a90582a1c67153e7aaa7e45649fd21d50">00323</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <a class="code" href="lua_8h.html#a362144baa0cfb14dc38fd21438053d73">lua_Integer</a> <a class="code" href="lapi_8c.html#a728c95a13635f48b0cea1addbf79c545">lua_tointeger</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> idx) {
<a name="l00324"></a>00324   <a class="code" href="structlua__TValue.html">TValue</a> n;
<a name="l00325"></a>00325   <span class="keyword">const</span> <a class="code" href="structlua__TValue.html">TValue</a> *o = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, idx);
<a name="l00326"></a>00326   <span class="keywordflow">if</span> (<a class="code" href="lvm_8h.html#af9edcc5da8ea1ac07ffdf79fbe5bb95c">tonumber</a>(o, &amp;n)) {
<a name="l00327"></a>00327     <a class="code" href="lua_8h.html#a362144baa0cfb14dc38fd21438053d73">lua_Integer</a> res;
<a name="l00328"></a>00328     <a class="code" href="lua_8h.html#af0a6ed3b852d680769cfc410a0672172">lua_Number</a> num = <a class="code" href="lobject_8h.html#a690ab618235691bb5a82610f07dd8684">nvalue</a>(o);
<a name="l00329"></a>00329     <a class="code" href="luaconf_8h.html#a0620503773a63f7a9bd8bca23dc6775d">lua_number2integer</a>(res, num);
<a name="l00330"></a>00330     <span class="keywordflow">return</span> res;
<a name="l00331"></a>00331   }
<a name="l00332"></a>00332   <span class="keywordflow">else</span>
<a name="l00333"></a>00333     <span class="keywordflow">return</span> 0;
<a name="l00334"></a>00334 }
<a name="l00335"></a>00335 
<a name="l00336"></a>00336 
<a name="l00337"></a><a class="code" href="lua_8h.html#a0f530f104aeaddeeb63b27dc18b42d27">00337</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">int</span> <a class="code" href="lapi_8c.html#a444aee9aa56b0b06175ee3c7bcf7927c">lua_toboolean</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> idx) {
<a name="l00338"></a>00338   <span class="keyword">const</span> <a class="code" href="structlua__TValue.html">TValue</a> *o = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, idx);
<a name="l00339"></a>00339   <span class="keywordflow">return</span> !<a class="code" href="lobject_8h.html#a188e1a95c8c6d547a13431a6e1edd5b3">l_isfalse</a>(o);
<a name="l00340"></a>00340 }
<a name="l00341"></a>00341 
<a name="l00342"></a>00342 
<a name="l00343"></a><a class="code" href="lua_8h.html#aabf845b1c7ffc0462988b67ba83955cf">00343</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="lapi_8c.html#a3fc7dbcac3f2610f3d687ec15343bd3f">lua_tolstring</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> idx, <span class="keywordtype">size_t</span> *len) {
<a name="l00344"></a>00344   <a class="code" href="structlua__TValue.html">StkId</a> o = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, idx);
<a name="l00345"></a>00345   <span class="keywordflow">if</span> (!<a class="code" href="lobject_8h.html#a9bdf057a0de8da2ffae3ac35662dd255">ttisstring</a>(o)) {
<a name="l00346"></a>00346     <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);  <span class="comment">/* `luaV_tostring&apos; may create a new string */</span>
<a name="l00347"></a>00347     <span class="keywordflow">if</span> (!<a class="code" href="lvm_8c.html#aaa76c97841f94686c8be98f0fd0ca14d">luaV_tostring</a>(L, o)) {  <span class="comment">/* conversion failed? */</span>
<a name="l00348"></a>00348       <span class="keywordflow">if</span> (len != NULL) *len = 0;
<a name="l00349"></a>00349       <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00350"></a>00350       <span class="keywordflow">return</span> NULL;
<a name="l00351"></a>00351     }
<a name="l00352"></a>00352     <a class="code" href="lgc_8h.html#ad013db5004ccc5fbe8a6450caa1f1ad9">luaC_checkGC</a>(L);
<a name="l00353"></a>00353     o = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, idx);  <span class="comment">/* previous call may reallocate the stack */</span>
<a name="l00354"></a>00354     <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00355"></a>00355   }
<a name="l00356"></a>00356   <span class="keywordflow">if</span> (len != NULL) *len = <a class="code" href="lobject_8h.html#a8661397faed512ccc9c70a4661f1a83d">tsvalue</a>(o)-&gt;len;
<a name="l00357"></a>00357   <span class="keywordflow">return</span> <a class="code" href="lobject_8h.html#ac2c9eedf3ff2c3042445b3b534f161e1">svalue</a>(o);
<a name="l00358"></a>00358 }
<a name="l00359"></a>00359 
<a name="l00360"></a>00360 
<a name="l00361"></a><a class="code" href="lua_8h.html#a07bd1384def434a4a3efdcd48b771ca9">00361</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">size_t</span> <a class="code" href="lapi_8c.html#aa97a87dfaccc2e3b7861aaaca493db21">lua_objlen</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> idx) {
<a name="l00362"></a>00362   <a class="code" href="structlua__TValue.html">StkId</a> o = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, idx);
<a name="l00363"></a>00363   <span class="keywordflow">switch</span> (<a class="code" href="lobject_8h.html#acd205ab396b96fba48e1f758c17a2cf3">ttype</a>(o)) {
<a name="l00364"></a>00364     <span class="keywordflow">case</span> <a class="code" href="lua_8h.html#a57de20d87bb5131a3159f2bd52e3fab6">LUA_TSTRING</a>: <span class="keywordflow">return</span> <a class="code" href="lobject_8h.html#a8661397faed512ccc9c70a4661f1a83d">tsvalue</a>(o)-&gt;len;
<a name="l00365"></a>00365     <span class="keywordflow">case</span> <a class="code" href="lua_8h.html#a84fd4c52cea4073671a4cd0eb7026dc7">LUA_TUSERDATA</a>: <span class="keywordflow">return</span> <a class="code" href="lobject_8h.html#a1c49f55d93297e833141fb62903af3ad">uvalue</a>(o)-&gt;len;
<a name="l00366"></a>00366     <span class="keywordflow">case</span> <a class="code" href="lua_8h.html#a31620fd8da5b655b7879e16a116ec31a">LUA_TTABLE</a>: <span class="keywordflow">return</span> <a class="code" href="ltable_8c.html#a58e2274fe56b64bbd2d9174b63d16492">luaH_getn</a>(<a class="code" href="lobject_8h.html#a336a6ce5e8340e6de133ec249cf47ebf">hvalue</a>(o));
<a name="l00367"></a>00367     <span class="keywordflow">case</span> <a class="code" href="lua_8h.html#a7f62ecb240cb38da9c8a53b41fe21ed9">LUA_TNUMBER</a>: {
<a name="l00368"></a>00368       <span class="keywordtype">size_t</span> l;
<a name="l00369"></a>00369       <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);  <span class="comment">/* `luaV_tostring&apos; may create a new string */</span>
<a name="l00370"></a>00370       l = (<a class="code" href="lvm_8c.html#aaa76c97841f94686c8be98f0fd0ca14d">luaV_tostring</a>(L, o) ? <a class="code" href="lobject_8h.html#a8661397faed512ccc9c70a4661f1a83d">tsvalue</a>(o)-&gt;len : 0);
<a name="l00371"></a>00371       <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00372"></a>00372       <span class="keywordflow">return</span> l;
<a name="l00373"></a>00373     }
<a name="l00374"></a>00374     <span class="keywordflow">default</span>: <span class="keywordflow">return</span> 0;
<a name="l00375"></a>00375   }
<a name="l00376"></a>00376 }
<a name="l00377"></a>00377 
<a name="l00378"></a>00378 
<a name="l00379"></a><a class="code" href="lua_8h.html#a8c9a532a84b03d90b0a103c007f871b8">00379</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <a class="code" href="lua_8h.html#a5f5bedea265eccf43c6e404e020988ce">lua_CFunction</a> <a class="code" href="lapi_8c.html#ae790897a3311d599299895612986d850">lua_tocfunction</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> idx) {
<a name="l00380"></a>00380   <a class="code" href="structlua__TValue.html">StkId</a> o = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, idx);
<a name="l00381"></a>00381   <span class="keywordflow">return</span> (!<a class="code" href="lobject_8h.html#a6461891bd185c211514aef4fa7179767">iscfunction</a>(o)) ? NULL : <a class="code" href="lobject_8h.html#a4b49383d348897fe282c0d51354d8bc9">clvalue</a>(o)-&gt;c.f;
<a name="l00382"></a>00382 }
<a name="l00383"></a>00383 
<a name="l00384"></a>00384 
<a name="l00385"></a><a class="code" href="lua_8h.html#a3b3106346d9739a64d48be4e30368dec">00385</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">void</span> *<a class="code" href="lapi_8c.html#a0444ddf13e5618bca969e4b3b47bc0cc">lua_touserdata</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> idx) {
<a name="l00386"></a>00386   <a class="code" href="structlua__TValue.html">StkId</a> o = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, idx);
<a name="l00387"></a>00387   <span class="keywordflow">switch</span> (<a class="code" href="lobject_8h.html#acd205ab396b96fba48e1f758c17a2cf3">ttype</a>(o)) {
<a name="l00388"></a>00388     <span class="keywordflow">case</span> <a class="code" href="lua_8h.html#a84fd4c52cea4073671a4cd0eb7026dc7">LUA_TUSERDATA</a>: <span class="keywordflow">return</span> (<a class="code" href="lobject_8h.html#a91e9ab83c604f8d3f00711749e327928">rawuvalue</a>(o) + 1);
<a name="l00389"></a>00389     <span class="keywordflow">case</span> <a class="code" href="lua_8h.html#aa030c2d649070173902c8094d8e0e2cd">LUA_TLIGHTUSERDATA</a>: <span class="keywordflow">return</span> <a class="code" href="lobject_8h.html#a16c0267c035b3e4edda082e25069e8cf">pvalue</a>(o);
<a name="l00390"></a>00390     <span class="keywordflow">default</span>: <span class="keywordflow">return</span> NULL;
<a name="l00391"></a>00391   }
<a name="l00392"></a>00392 }
<a name="l00393"></a>00393 
<a name="l00394"></a>00394 
<a name="l00395"></a><a class="code" href="lua_8h.html#a8ad0bb2b578f5b6e84511431260a5818">00395</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <a class="code" href="structlua__State.html">lua_State</a> *<a class="code" href="lapi_8c.html#ad1dcea410edb5c5595fc070f8bf2e9a0">lua_tothread</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> idx) {
<a name="l00396"></a>00396   <a class="code" href="structlua__TValue.html">StkId</a> o = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, idx);
<a name="l00397"></a>00397   <span class="keywordflow">return</span> (!<a class="code" href="lobject_8h.html#a5ae8a42aa33c44ef3c98fcda8b7ab4c5">ttisthread</a>(o)) ? NULL : <a class="code" href="lobject_8h.html#a516f32427f1c43ee187ce4c0db042959">thvalue</a>(o);
<a name="l00398"></a>00398 }
<a name="l00399"></a>00399 
<a name="l00400"></a>00400 
<a name="l00401"></a><a class="code" href="lua_8h.html#ae00a730cd408773f7a4122fccfbbb91a">00401</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keyword">const</span> <span class="keywordtype">void</span> *<a class="code" href="lapi_8c.html#a5b533fe96cb52b5415896d41daad374a">lua_topointer</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> idx) {
<a name="l00402"></a>00402   <a class="code" href="structlua__TValue.html">StkId</a> o = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, idx);
<a name="l00403"></a>00403   <span class="keywordflow">switch</span> (<a class="code" href="lobject_8h.html#acd205ab396b96fba48e1f758c17a2cf3">ttype</a>(o)) {
<a name="l00404"></a>00404     <span class="keywordflow">case</span> <a class="code" href="lua_8h.html#a31620fd8da5b655b7879e16a116ec31a">LUA_TTABLE</a>: <span class="keywordflow">return</span> <a class="code" href="lobject_8h.html#a336a6ce5e8340e6de133ec249cf47ebf">hvalue</a>(o);
<a name="l00405"></a>00405     <span class="keywordflow">case</span> <a class="code" href="lua_8h.html#adaa7fa6e2561c1bc428ba8d265171494">LUA_TFUNCTION</a>: <span class="keywordflow">return</span> <a class="code" href="lobject_8h.html#a4b49383d348897fe282c0d51354d8bc9">clvalue</a>(o);
<a name="l00406"></a>00406     <span class="keywordflow">case</span> <a class="code" href="lua_8h.html#a028a8d8aae9580c465aabcd0c11334d9">LUA_TTHREAD</a>: <span class="keywordflow">return</span> <a class="code" href="lobject_8h.html#a516f32427f1c43ee187ce4c0db042959">thvalue</a>(o);
<a name="l00407"></a>00407     <span class="keywordflow">case</span> <a class="code" href="lua_8h.html#a84fd4c52cea4073671a4cd0eb7026dc7">LUA_TUSERDATA</a>:
<a name="l00408"></a>00408     <span class="keywordflow">case</span> <a class="code" href="lua_8h.html#aa030c2d649070173902c8094d8e0e2cd">LUA_TLIGHTUSERDATA</a>:
<a name="l00409"></a>00409       <span class="keywordflow">return</span> <a class="code" href="lapi_8c.html#a0444ddf13e5618bca969e4b3b47bc0cc">lua_touserdata</a>(L, idx);
<a name="l00410"></a>00410     <span class="keywordflow">default</span>: <span class="keywordflow">return</span> NULL;
<a name="l00411"></a>00411   }
<a name="l00412"></a>00412 }
<a name="l00413"></a>00413 
<a name="l00414"></a>00414 
<a name="l00415"></a>00415 
<a name="l00416"></a>00416 <span class="comment">/*</span>
<a name="l00417"></a>00417 <span class="comment">** push functions (C -&gt; stack)</span>
<a name="l00418"></a>00418 <span class="comment">*/</span>
<a name="l00419"></a>00419 
<a name="l00420"></a>00420 
<a name="l00421"></a><a class="code" href="lua_8h.html#a8bd9c4137a90833221f48dd16659c9e4">00421</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">void</span> <a class="code" href="lapi_8c.html#a1b4cd0d80f51e5545a97ca6c28c03c50">lua_pushnil</a> (<a class="code" href="structlua__State.html">lua_State</a> *L) {
<a name="l00422"></a>00422   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00423"></a>00423   <a class="code" href="lobject_8h.html#ad9034def7bbc1965ec3d714d84620b07">setnilvalue</a>(L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>);
<a name="l00424"></a>00424   <a class="code" href="lapi_8c.html#afe4a5994dd3704ec53de77f9fd121915">api_incr_top</a>(L);
<a name="l00425"></a>00425   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00426"></a>00426 }
<a name="l00427"></a>00427 
<a name="l00428"></a>00428 
<a name="l00429"></a><a class="code" href="lua_8h.html#a77807056ba032d64b2def2b57dc53d53">00429</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">void</span> <a class="code" href="lapi_8c.html#a328625a03fbb5548f27b1af10f109f6a">lua_pushnumber</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <a class="code" href="lua_8h.html#af0a6ed3b852d680769cfc410a0672172">lua_Number</a> n) {
<a name="l00430"></a>00430   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00431"></a>00431   <a class="code" href="lobject_8h.html#a6e4ca2bc0025d5b310e7a78f3ac04fcc">setnvalue</a>(L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>, n);
<a name="l00432"></a>00432   <a class="code" href="lapi_8c.html#afe4a5994dd3704ec53de77f9fd121915">api_incr_top</a>(L);
<a name="l00433"></a>00433   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00434"></a>00434 }
<a name="l00435"></a>00435 
<a name="l00436"></a>00436 
<a name="l00437"></a><a class="code" href="lua_8h.html#aea46fa9bf358947f5c0a1bf266b26154">00437</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">void</span> <a class="code" href="lapi_8c.html#adcec46ff05dfee9a3c4c05828b40c213">lua_pushinteger</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <a class="code" href="lua_8h.html#a362144baa0cfb14dc38fd21438053d73">lua_Integer</a> n) {
<a name="l00438"></a>00438   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00439"></a>00439   <a class="code" href="lobject_8h.html#a6e4ca2bc0025d5b310e7a78f3ac04fcc">setnvalue</a>(L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>, <a class="code" href="llimits_8h.html#ac92cecb12c5aba1164877e81e76e2cb6">cast_num</a>(n));
<a name="l00440"></a>00440   <a class="code" href="lapi_8c.html#afe4a5994dd3704ec53de77f9fd121915">api_incr_top</a>(L);
<a name="l00441"></a>00441   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00442"></a>00442 }
<a name="l00443"></a>00443 
<a name="l00444"></a>00444 
<a name="l00445"></a><a class="code" href="lua_8h.html#a8c01dd1b5018c60a078bcf58dd1fe2e8">00445</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">void</span> <a class="code" href="lapi_8c.html#ad457b6dc1bc1b6d5cf9b625c5b329e5e">lua_pushlstring</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keyword">const</span> <span class="keywordtype">char</span> *s, <span class="keywordtype">size_t</span> len) {
<a name="l00446"></a>00446   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00447"></a>00447   <a class="code" href="lgc_8h.html#ad013db5004ccc5fbe8a6450caa1f1ad9">luaC_checkGC</a>(L);
<a name="l00448"></a>00448   <a class="code" href="lobject_8h.html#a2defbd1005c5aebb5807517ddea80f3f">setsvalue2s</a>(L, L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>, <a class="code" href="lstring_8c.html#ab41fb084ce3ea5e2779f6659ccc2484d">luaS_newlstr</a>(L, s, len));
<a name="l00449"></a>00449   <a class="code" href="lapi_8c.html#afe4a5994dd3704ec53de77f9fd121915">api_incr_top</a>(L);
<a name="l00450"></a>00450   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00451"></a>00451 }
<a name="l00452"></a>00452 
<a name="l00453"></a>00453 
<a name="l00454"></a><a class="code" href="lua_8h.html#af2db74e1d8e7062bf5d1a2a779e53369">00454</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">void</span> <a class="code" href="lapi_8c.html#a1281a7e2b52370cc416123bfd32b1b29">lua_pushstring</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keyword">const</span> <span class="keywordtype">char</span> *s) {
<a name="l00455"></a>00455   <span class="keywordflow">if</span> (s == NULL)
<a name="l00456"></a>00456     <a class="code" href="lapi_8c.html#a1b4cd0d80f51e5545a97ca6c28c03c50">lua_pushnil</a>(L);
<a name="l00457"></a>00457   <span class="keywordflow">else</span>
<a name="l00458"></a>00458     <a class="code" href="lapi_8c.html#ad457b6dc1bc1b6d5cf9b625c5b329e5e">lua_pushlstring</a>(L, s, strlen(s));
<a name="l00459"></a>00459 }
<a name="l00460"></a>00460 
<a name="l00461"></a>00461 
<a name="l00462"></a><a class="code" href="lua_8h.html#a13fb1100c2e3942aa6c69baaf7e3f7cd">00462</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="lapi_8c.html#a426c9cb1d582be3e43060c4772854e5a">lua_pushvfstring</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keyword">const</span> <span class="keywordtype">char</span> *fmt,
<a name="l00463"></a>00463                                       va_list argp) {
<a name="l00464"></a>00464   <span class="keyword">const</span> <span class="keywordtype">char</span> *ret;
<a name="l00465"></a>00465   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00466"></a>00466   <a class="code" href="lgc_8h.html#ad013db5004ccc5fbe8a6450caa1f1ad9">luaC_checkGC</a>(L);
<a name="l00467"></a>00467   ret = <a class="code" href="lobject_8c.html#aa83fa444a36d79521e846a766fa083d5">luaO_pushvfstring</a>(L, fmt, argp);
<a name="l00468"></a>00468   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00469"></a>00469   <span class="keywordflow">return</span> ret;
<a name="l00470"></a>00470 }
<a name="l00471"></a>00471 
<a name="l00472"></a>00472 
<a name="l00473"></a><a class="code" href="lua_8h.html#af4a7bd8fa65e507e36aff61af8db117d">00473</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="lapi_8c.html#ab190c226d38b289e6ca57683a9d4e0f0">lua_pushfstring</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keyword">const</span> <span class="keywordtype">char</span> *fmt, ...) {
<a name="l00474"></a>00474   <span class="keyword">const</span> <span class="keywordtype">char</span> *ret;
<a name="l00475"></a>00475   va_list argp;
<a name="l00476"></a>00476   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00477"></a>00477   <a class="code" href="lgc_8h.html#ad013db5004ccc5fbe8a6450caa1f1ad9">luaC_checkGC</a>(L);
<a name="l00478"></a>00478   va_start(argp, fmt);
<a name="l00479"></a>00479   ret = <a class="code" href="lobject_8c.html#aa83fa444a36d79521e846a766fa083d5">luaO_pushvfstring</a>(L, fmt, argp);
<a name="l00480"></a>00480   va_end(argp);
<a name="l00481"></a>00481   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00482"></a>00482   <span class="keywordflow">return</span> ret;
<a name="l00483"></a>00483 }
<a name="l00484"></a>00484 
<a name="l00485"></a>00485 
<a name="l00486"></a><a class="code" href="lua_8h.html#a89f758ed8996c5f405cb7dfb41f78337">00486</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">void</span> <a class="code" href="lapi_8c.html#a142802b91cdd22516b54599f51e101e4">lua_pushcclosure</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <a class="code" href="lua_8h.html#a5f5bedea265eccf43c6e404e020988ce">lua_CFunction</a> fn, <span class="keywordtype">int</span> n) {
<a name="l00487"></a>00487   <a class="code" href="unionClosure.html">Closure</a> *cl;
<a name="l00488"></a>00488   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00489"></a>00489   <a class="code" href="lgc_8h.html#ad013db5004ccc5fbe8a6450caa1f1ad9">luaC_checkGC</a>(L);
<a name="l00490"></a>00490   <a class="code" href="lapi_8c.html#a9785915283c3f0a0ec90f1b6be32b2c2">api_checknelems</a>(L, n);
<a name="l00491"></a>00491   cl = <a class="code" href="lfunc_8c.html#a90cb27d2970524a072d17cb895b27c9a">luaF_newCclosure</a>(L, n, <a class="code" href="lapi_8c.html#a95a3021abc491c31183d30fcb175035e">getcurrenv</a>(L));
<a name="l00492"></a>00492   cl-&gt;<a class="code" href="unionClosure.html#ace9dac5a62b61db682ef0cd86b3b44b1">c</a>.<a class="code" href="structCClosure.html#a1ba64febc8e6adc43fdbb82583852000">f</a> = fn;
<a name="l00493"></a>00493   L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> -= n;
<a name="l00494"></a>00494   <span class="keywordflow">while</span> (n--)
<a name="l00495"></a>00495     <a class="code" href="lobject_8h.html#ad6d8d3d900cff1b02c3b269eabccccf9">setobj2n</a>(L, &amp;cl-&gt;<a class="code" href="unionClosure.html#ace9dac5a62b61db682ef0cd86b3b44b1">c</a>.<a class="code" href="structCClosure.html#a75d6bfc66f8ed48b3dd67007be84174f">upvalue</a>[n], L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>+n);
<a name="l00496"></a>00496   <a class="code" href="lobject_8h.html#a766f0e76b0607550fd72164373ba544d">setclvalue</a>(L, L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>, cl);
<a name="l00497"></a>00497   <a class="code" href="llimits_8h.html#a5978f5fda715bd80e845df1e16ad7780">lua_assert</a>(<a class="code" href="lgc_8h.html#a4c0ce78d476460d2e54914301f4a4bf7">iswhite</a>(<a class="code" href="lstate_8h.html#a254ca29aba03e47440082d4591a9734e">obj2gco</a>(cl)));
<a name="l00498"></a>00498   <a class="code" href="lapi_8c.html#afe4a5994dd3704ec53de77f9fd121915">api_incr_top</a>(L);
<a name="l00499"></a>00499   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00500"></a>00500 }
<a name="l00501"></a>00501 
<a name="l00502"></a>00502 
<a name="l00503"></a><a class="code" href="lua_8h.html#a9d7bacf1769dcf7cff7ba7271041e61c">00503</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">void</span> <a class="code" href="lapi_8c.html#a56bbb7479265e38da2e2596e6ec25faa">lua_pushboolean</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> b) {
<a name="l00504"></a>00504   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00505"></a>00505   <a class="code" href="lobject_8h.html#a22e86755164a1bc172b40f344d7ce70e">setbvalue</a>(L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>, (b != 0));  <span class="comment">/* ensure that true is 1 */</span>
<a name="l00506"></a>00506   <a class="code" href="lapi_8c.html#afe4a5994dd3704ec53de77f9fd121915">api_incr_top</a>(L);
<a name="l00507"></a>00507   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00508"></a>00508 }
<a name="l00509"></a>00509 
<a name="l00510"></a>00510 
<a name="l00511"></a><a class="code" href="lua_8h.html#a9d6c960026cbee9ffb95a9d1753675e2">00511</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">void</span> <a class="code" href="lapi_8c.html#a85e3e3d32b068aef62426828a104b561">lua_pushlightuserdata</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">void</span> *p) {
<a name="l00512"></a>00512   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00513"></a>00513   <a class="code" href="lobject_8h.html#a0784c90d154ccf7c643b56a00c62412a">setpvalue</a>(L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>, p);
<a name="l00514"></a>00514   <a class="code" href="lapi_8c.html#afe4a5994dd3704ec53de77f9fd121915">api_incr_top</a>(L);
<a name="l00515"></a>00515   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00516"></a>00516 }
<a name="l00517"></a>00517 
<a name="l00518"></a>00518 
<a name="l00519"></a><a class="code" href="lua_8h.html#a118bd9effa8d54ddcbe37bd5cb70a4b6">00519</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">int</span> <a class="code" href="lapi_8c.html#a4175aeea9aa6dbf096ecfca7b190fa4a">lua_pushthread</a> (<a class="code" href="structlua__State.html">lua_State</a> *L) {
<a name="l00520"></a>00520   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00521"></a>00521   <a class="code" href="lobject_8h.html#a9c2bad449e8e998bb9d937642923a225">setthvalue</a>(L, L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>, L);
<a name="l00522"></a>00522   <a class="code" href="lapi_8c.html#afe4a5994dd3704ec53de77f9fd121915">api_incr_top</a>(L);
<a name="l00523"></a>00523   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00524"></a>00524   <span class="keywordflow">return</span> (<a class="code" href="lstate_8h.html#a103db2de6edf3420c6c6c9a282562406">G</a>(L)-&gt;mainthread == L);
<a name="l00525"></a>00525 }
<a name="l00526"></a>00526 
<a name="l00527"></a>00527 
<a name="l00528"></a>00528 
<a name="l00529"></a>00529 <span class="comment">/*</span>
<a name="l00530"></a>00530 <span class="comment">** get functions (Lua -&gt; stack)</span>
<a name="l00531"></a>00531 <span class="comment">*/</span>
<a name="l00532"></a>00532 
<a name="l00533"></a>00533 
<a name="l00534"></a><a class="code" href="lua_8h.html#a8d82fa181a3003e9a304040c0bbed9ac">00534</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">void</span> <a class="code" href="lapi_8c.html#a6c759e1dc54a07d99eac4f19a4cd142a">lua_gettable</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> idx) {
<a name="l00535"></a>00535   <a class="code" href="structlua__TValue.html">StkId</a> t;
<a name="l00536"></a>00536   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00537"></a>00537   t = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, idx);
<a name="l00538"></a>00538   <a class="code" href="lapi_8c.html#a29c1133faa3c6591f82b5cca34842d67">api_checkvalidindex</a>(L, t);
<a name="l00539"></a>00539   <a class="code" href="lvm_8c.html#a3e9cff2d6a1f188a843099d2cff146a7">luaV_gettable</a>(L, t, L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> - 1, L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> - 1);
<a name="l00540"></a>00540   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00541"></a>00541 }
<a name="l00542"></a>00542 
<a name="l00543"></a>00543 
<a name="l00544"></a><a class="code" href="lua_8h.html#ac3112bb28ba217adc46f13da8e9e6585">00544</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">void</span> <a class="code" href="lapi_8c.html#ae459b7c273e6b1f60149b39f8e8f4554">lua_getfield</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> idx, <span class="keyword">const</span> <span class="keywordtype">char</span> *k) {
<a name="l00545"></a>00545   <a class="code" href="structlua__TValue.html">StkId</a> t;
<a name="l00546"></a>00546   <a class="code" href="structlua__TValue.html">TValue</a> key;
<a name="l00547"></a>00547   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00548"></a>00548   t = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, idx);
<a name="l00549"></a>00549   <a class="code" href="lapi_8c.html#a29c1133faa3c6591f82b5cca34842d67">api_checkvalidindex</a>(L, t);
<a name="l00550"></a>00550   <a class="code" href="lobject_8h.html#a251a2d3bada66aaed6249a89a0afe5f0">setsvalue</a>(L, &amp;key, <a class="code" href="lstring_8h.html#aba4257be9dae5dccd0cda4ac05986d4d">luaS_new</a>(L, k));
<a name="l00551"></a>00551   <a class="code" href="lvm_8c.html#a3e9cff2d6a1f188a843099d2cff146a7">luaV_gettable</a>(L, t, &amp;key, L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>);
<a name="l00552"></a>00552   <a class="code" href="lapi_8c.html#afe4a5994dd3704ec53de77f9fd121915">api_incr_top</a>(L);
<a name="l00553"></a>00553   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00554"></a>00554 }
<a name="l00555"></a>00555 
<a name="l00556"></a>00556 
<a name="l00557"></a><a class="code" href="lua_8h.html#af5ed4eb4ccc6e6f7921fdaee8485cb3f">00557</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">void</span> <a class="code" href="lapi_8c.html#a43379a0ba1fb68a4c81d205ad60b3cc1">lua_rawget</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> idx) {
<a name="l00558"></a>00558   <a class="code" href="structlua__TValue.html">StkId</a> t;
<a name="l00559"></a>00559   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00560"></a>00560   t = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, idx);
<a name="l00561"></a>00561   <a class="code" href="llimits_8h.html#a2e63f41a5abfb21dd4394da89206b3f2">api_check</a>(L, <a class="code" href="lobject_8h.html#ac5338f5fe3885d1ee65412e00a44384e">ttistable</a>(t));
<a name="l00562"></a>00562   <a class="code" href="lobject_8h.html#a1c51b9462c606f1f97242fae6b1220d1">setobj2s</a>(L, L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> - 1, <a class="code" href="ltable_8c.html#a8b4fce00d7db27ee9caac3d49863dea3">luaH_get</a>(<a class="code" href="lobject_8h.html#a336a6ce5e8340e6de133ec249cf47ebf">hvalue</a>(t), L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> - 1));
<a name="l00563"></a>00563   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00564"></a>00564 }
<a name="l00565"></a>00565 
<a name="l00566"></a>00566 
<a name="l00567"></a><a class="code" href="lua_8h.html#a83de0bf688c2a389db2e444aa34e752a">00567</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">void</span> <a class="code" href="lapi_8c.html#ae37bc3e2991700913a74d2b656442520">lua_rawgeti</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> idx, <span class="keywordtype">int</span> n) {
<a name="l00568"></a>00568   <a class="code" href="structlua__TValue.html">StkId</a> o;
<a name="l00569"></a>00569   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00570"></a>00570   o = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, idx);
<a name="l00571"></a>00571   <a class="code" href="llimits_8h.html#a2e63f41a5abfb21dd4394da89206b3f2">api_check</a>(L, <a class="code" href="lobject_8h.html#ac5338f5fe3885d1ee65412e00a44384e">ttistable</a>(o));
<a name="l00572"></a>00572   <a class="code" href="lobject_8h.html#a1c51b9462c606f1f97242fae6b1220d1">setobj2s</a>(L, L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>, <a class="code" href="ltable_8c.html#a28fd2df07b9e963a86933ba98646326b">luaH_getnum</a>(<a class="code" href="lobject_8h.html#a336a6ce5e8340e6de133ec249cf47ebf">hvalue</a>(o), n));
<a name="l00573"></a>00573   <a class="code" href="lapi_8c.html#afe4a5994dd3704ec53de77f9fd121915">api_incr_top</a>(L);
<a name="l00574"></a>00574   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00575"></a>00575 }
<a name="l00576"></a>00576 
<a name="l00577"></a>00577 
<a name="l00578"></a><a class="code" href="lua_8h.html#a022ddaeee46ccb89860c78480e54db05">00578</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">void</span> <a class="code" href="lapi_8c.html#a7f93e3baf3101cad59ec61b7744a55d8">lua_createtable</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> narray, <span class="keywordtype">int</span> nrec) {
<a name="l00579"></a>00579   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00580"></a>00580   <a class="code" href="lgc_8h.html#ad013db5004ccc5fbe8a6450caa1f1ad9">luaC_checkGC</a>(L);
<a name="l00581"></a>00581   <a class="code" href="lobject_8h.html#ab9379699ac579d54410e3542f061bbad">sethvalue</a>(L, L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>, <a class="code" href="ltable_8c.html#a7295cd1ebcc8e39f2b23079bb575d2e6">luaH_new</a>(L, narray, nrec));
<a name="l00582"></a>00582   <a class="code" href="lapi_8c.html#afe4a5994dd3704ec53de77f9fd121915">api_incr_top</a>(L);
<a name="l00583"></a>00583   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00584"></a>00584 }
<a name="l00585"></a>00585 
<a name="l00586"></a>00586 
<a name="l00587"></a><a class="code" href="lua_8h.html#a15b983a1c2fd3c7ab7810c4aa0096567">00587</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">int</span> <a class="code" href="lapi_8c.html#a4caa9ca5e47a30bd45e33d83bf2d6d6e">lua_getmetatable</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> objindex) {
<a name="l00588"></a>00588   <span class="keyword">const</span> <a class="code" href="structlua__TValue.html">TValue</a> *obj;
<a name="l00589"></a>00589   <a class="code" href="structTable.html">Table</a> *mt = NULL;
<a name="l00590"></a>00590   <span class="keywordtype">int</span> res;
<a name="l00591"></a>00591   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00592"></a>00592   obj = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, objindex);
<a name="l00593"></a>00593   <span class="keywordflow">switch</span> (<a class="code" href="lobject_8h.html#acd205ab396b96fba48e1f758c17a2cf3">ttype</a>(obj)) {
<a name="l00594"></a>00594     <span class="keywordflow">case</span> <a class="code" href="lua_8h.html#a31620fd8da5b655b7879e16a116ec31a">LUA_TTABLE</a>:
<a name="l00595"></a>00595       mt = <a class="code" href="lobject_8h.html#a336a6ce5e8340e6de133ec249cf47ebf">hvalue</a>(obj)-&gt;metatable;
<a name="l00596"></a>00596       <span class="keywordflow">break</span>;
<a name="l00597"></a>00597     <span class="keywordflow">case</span> <a class="code" href="lua_8h.html#a84fd4c52cea4073671a4cd0eb7026dc7">LUA_TUSERDATA</a>:
<a name="l00598"></a>00598       mt = <a class="code" href="lobject_8h.html#a1c49f55d93297e833141fb62903af3ad">uvalue</a>(obj)-&gt;metatable;
<a name="l00599"></a>00599       <span class="keywordflow">break</span>;
<a name="l00600"></a>00600     <span class="keywordflow">default</span>:
<a name="l00601"></a>00601       mt = <a class="code" href="lstate_8h.html#a103db2de6edf3420c6c6c9a282562406">G</a>(L)-&gt;mt[<a class="code" href="lobject_8h.html#acd205ab396b96fba48e1f758c17a2cf3">ttype</a>(obj)];
<a name="l00602"></a>00602       <span class="keywordflow">break</span>;
<a name="l00603"></a>00603   }
<a name="l00604"></a>00604   <span class="keywordflow">if</span> (mt == NULL)
<a name="l00605"></a>00605     res = 0;
<a name="l00606"></a>00606   <span class="keywordflow">else</span> {
<a name="l00607"></a>00607     <a class="code" href="lobject_8h.html#ab9379699ac579d54410e3542f061bbad">sethvalue</a>(L, L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>, mt);
<a name="l00608"></a>00608     <a class="code" href="lapi_8c.html#afe4a5994dd3704ec53de77f9fd121915">api_incr_top</a>(L);
<a name="l00609"></a>00609     res = 1;
<a name="l00610"></a>00610   }
<a name="l00611"></a>00611   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00612"></a>00612   <span class="keywordflow">return</span> res;
<a name="l00613"></a>00613 }
<a name="l00614"></a>00614 
<a name="l00615"></a>00615 
<a name="l00616"></a><a class="code" href="lua_8h.html#a94bd8786ad09c9a233d397688d7b21b0">00616</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">void</span> <a class="code" href="lapi_8c.html#aae62bb7fb4498cc5193abf66797b2246">lua_getfenv</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> idx) {
<a name="l00617"></a>00617   <a class="code" href="structlua__TValue.html">StkId</a> o;
<a name="l00618"></a>00618   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00619"></a>00619   o = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, idx);
<a name="l00620"></a>00620   <a class="code" href="lapi_8c.html#a29c1133faa3c6591f82b5cca34842d67">api_checkvalidindex</a>(L, o);
<a name="l00621"></a>00621   <span class="keywordflow">switch</span> (<a class="code" href="lobject_8h.html#acd205ab396b96fba48e1f758c17a2cf3">ttype</a>(o)) {
<a name="l00622"></a>00622     <span class="keywordflow">case</span> <a class="code" href="lua_8h.html#adaa7fa6e2561c1bc428ba8d265171494">LUA_TFUNCTION</a>:
<a name="l00623"></a>00623       <a class="code" href="lobject_8h.html#ab9379699ac579d54410e3542f061bbad">sethvalue</a>(L, L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>, <a class="code" href="lobject_8h.html#a4b49383d348897fe282c0d51354d8bc9">clvalue</a>(o)-&gt;c.env);
<a name="l00624"></a>00624       <span class="keywordflow">break</span>;
<a name="l00625"></a>00625     <span class="keywordflow">case</span> <a class="code" href="lua_8h.html#a84fd4c52cea4073671a4cd0eb7026dc7">LUA_TUSERDATA</a>:
<a name="l00626"></a>00626       <a class="code" href="lobject_8h.html#ab9379699ac579d54410e3542f061bbad">sethvalue</a>(L, L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>, <a class="code" href="lobject_8h.html#a1c49f55d93297e833141fb62903af3ad">uvalue</a>(o)-&gt;env);
<a name="l00627"></a>00627       <span class="keywordflow">break</span>;
<a name="l00628"></a>00628     <span class="keywordflow">case</span> <a class="code" href="lua_8h.html#a028a8d8aae9580c465aabcd0c11334d9">LUA_TTHREAD</a>:
<a name="l00629"></a>00629       <a class="code" href="lobject_8h.html#a1c51b9462c606f1f97242fae6b1220d1">setobj2s</a>(L, L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>,  <a class="code" href="lstate_8h.html#a1108b4374aa20059cd53d90b638c0e4b">gt</a>(<a class="code" href="lobject_8h.html#a516f32427f1c43ee187ce4c0db042959">thvalue</a>(o)));
<a name="l00630"></a>00630       <span class="keywordflow">break</span>;
<a name="l00631"></a>00631     <span class="keywordflow">default</span>:
<a name="l00632"></a>00632       <a class="code" href="lobject_8h.html#ad9034def7bbc1965ec3d714d84620b07">setnilvalue</a>(L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>);
<a name="l00633"></a>00633       <span class="keywordflow">break</span>;
<a name="l00634"></a>00634   }
<a name="l00635"></a>00635   <a class="code" href="lapi_8c.html#afe4a5994dd3704ec53de77f9fd121915">api_incr_top</a>(L);
<a name="l00636"></a>00636   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00637"></a>00637 }
<a name="l00638"></a>00638 
<a name="l00639"></a>00639 
<a name="l00640"></a>00640 <span class="comment">/*</span>
<a name="l00641"></a>00641 <span class="comment">** set functions (stack -&gt; Lua)</span>
<a name="l00642"></a>00642 <span class="comment">*/</span>
<a name="l00643"></a>00643 
<a name="l00644"></a>00644 
<a name="l00645"></a><a class="code" href="lua_8h.html#aeda173d104e3a566ccaac89a1f64a5eb">00645</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">void</span> <a class="code" href="lapi_8c.html#a4ca492cf3d2194aec9a6292708bf66c8">lua_settable</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> idx) {
<a name="l00646"></a>00646   <a class="code" href="structlua__TValue.html">StkId</a> t;
<a name="l00647"></a>00647   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00648"></a>00648   <a class="code" href="lapi_8c.html#a9785915283c3f0a0ec90f1b6be32b2c2">api_checknelems</a>(L, 2);
<a name="l00649"></a>00649   t = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, idx);
<a name="l00650"></a>00650   <a class="code" href="lapi_8c.html#a29c1133faa3c6591f82b5cca34842d67">api_checkvalidindex</a>(L, t);
<a name="l00651"></a>00651   <a class="code" href="lvm_8c.html#aee212b8fb5fcda851dc6f57b133d840f">luaV_settable</a>(L, t, L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> - 2, L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> - 1);
<a name="l00652"></a>00652   L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> -= 2;  <span class="comment">/* pop index and value */</span>
<a name="l00653"></a>00653   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00654"></a>00654 }
<a name="l00655"></a>00655 
<a name="l00656"></a>00656 
<a name="l00657"></a><a class="code" href="lua_8h.html#a9580a15c141cbe4bf2a63fea625c3878">00657</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">void</span> <a class="code" href="lapi_8c.html#a3f2f542ee6728d82e51b1c302f9606df">lua_setfield</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> idx, <span class="keyword">const</span> <span class="keywordtype">char</span> *k) {
<a name="l00658"></a>00658   <a class="code" href="structlua__TValue.html">StkId</a> t;
<a name="l00659"></a>00659   <a class="code" href="structlua__TValue.html">TValue</a> key;
<a name="l00660"></a>00660   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00661"></a>00661   <a class="code" href="lapi_8c.html#a9785915283c3f0a0ec90f1b6be32b2c2">api_checknelems</a>(L, 1);
<a name="l00662"></a>00662   t = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, idx);
<a name="l00663"></a>00663   <a class="code" href="lapi_8c.html#a29c1133faa3c6591f82b5cca34842d67">api_checkvalidindex</a>(L, t);
<a name="l00664"></a>00664   <a class="code" href="lobject_8h.html#a251a2d3bada66aaed6249a89a0afe5f0">setsvalue</a>(L, &amp;key, <a class="code" href="lstring_8h.html#aba4257be9dae5dccd0cda4ac05986d4d">luaS_new</a>(L, k));
<a name="l00665"></a>00665   <a class="code" href="lvm_8c.html#aee212b8fb5fcda851dc6f57b133d840f">luaV_settable</a>(L, t, &amp;key, L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> - 1);
<a name="l00666"></a>00666   L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>--;  <span class="comment">/* pop value */</span>
<a name="l00667"></a>00667   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00668"></a>00668 }
<a name="l00669"></a>00669 
<a name="l00670"></a>00670 
<a name="l00671"></a><a class="code" href="lua_8h.html#a3db5cd3ce7ae703c39d54495be44aafc">00671</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">void</span> <a class="code" href="lapi_8c.html#afb2d27f421677ef40425f9054ae216a7">lua_rawset</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> idx) {
<a name="l00672"></a>00672   <a class="code" href="structlua__TValue.html">StkId</a> t;
<a name="l00673"></a>00673   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00674"></a>00674   <a class="code" href="lapi_8c.html#a9785915283c3f0a0ec90f1b6be32b2c2">api_checknelems</a>(L, 2);
<a name="l00675"></a>00675   t = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, idx);
<a name="l00676"></a>00676   <a class="code" href="llimits_8h.html#a2e63f41a5abfb21dd4394da89206b3f2">api_check</a>(L, <a class="code" href="lobject_8h.html#ac5338f5fe3885d1ee65412e00a44384e">ttistable</a>(t));
<a name="l00677"></a>00677   <a class="code" href="lobject_8h.html#adefdd17d98f1f5734ee296395e1805d4">setobj2t</a>(L, <a class="code" href="ltable_8c.html#ab6b8518d8099b17f3ef58df047237fba">luaH_set</a>(L, <a class="code" href="lobject_8h.html#a336a6ce5e8340e6de133ec249cf47ebf">hvalue</a>(t), L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>-2), L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>-1);
<a name="l00678"></a>00678   <a class="code" href="lgc_8h.html#af06a36c96d2a39e8f60b653671b02ef6">luaC_barriert</a>(L, <a class="code" href="lobject_8h.html#a336a6ce5e8340e6de133ec249cf47ebf">hvalue</a>(t), L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>-1);
<a name="l00679"></a>00679   L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> -= 2;
<a name="l00680"></a>00680   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00681"></a>00681 }
<a name="l00682"></a>00682 
<a name="l00683"></a>00683 
<a name="l00684"></a><a class="code" href="lua_8h.html#a32f51f8a97b4f005f7a3c378dcf71df2">00684</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">void</span> <a class="code" href="lapi_8c.html#a89eb1578890571d202f8b3c357c822bc">lua_rawseti</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> idx, <span class="keywordtype">int</span> n) {
<a name="l00685"></a>00685   <a class="code" href="structlua__TValue.html">StkId</a> o;
<a name="l00686"></a>00686   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00687"></a>00687   <a class="code" href="lapi_8c.html#a9785915283c3f0a0ec90f1b6be32b2c2">api_checknelems</a>(L, 1);
<a name="l00688"></a>00688   o = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, idx);
<a name="l00689"></a>00689   <a class="code" href="llimits_8h.html#a2e63f41a5abfb21dd4394da89206b3f2">api_check</a>(L, <a class="code" href="lobject_8h.html#ac5338f5fe3885d1ee65412e00a44384e">ttistable</a>(o));
<a name="l00690"></a>00690   <a class="code" href="lobject_8h.html#adefdd17d98f1f5734ee296395e1805d4">setobj2t</a>(L, <a class="code" href="ltable_8c.html#a9fddc8c65f349970bbbbbfc79ed4bc24">luaH_setnum</a>(L, <a class="code" href="lobject_8h.html#a336a6ce5e8340e6de133ec249cf47ebf">hvalue</a>(o), n), L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>-1);
<a name="l00691"></a>00691   <a class="code" href="lgc_8h.html#af06a36c96d2a39e8f60b653671b02ef6">luaC_barriert</a>(L, <a class="code" href="lobject_8h.html#a336a6ce5e8340e6de133ec249cf47ebf">hvalue</a>(o), L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>-1);
<a name="l00692"></a>00692   L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>--;
<a name="l00693"></a>00693   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00694"></a>00694 }
<a name="l00695"></a>00695 
<a name="l00696"></a>00696 
<a name="l00697"></a><a class="code" href="lua_8h.html#a0b834b6a9cd96b141385df14bd0272a4">00697</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">int</span> <a class="code" href="lapi_8c.html#a15719ea4119bdf5b3f2a406534431a7e">lua_setmetatable</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> objindex) {
<a name="l00698"></a>00698   <a class="code" href="structlua__TValue.html">TValue</a> *obj;
<a name="l00699"></a>00699   <a class="code" href="structTable.html">Table</a> *mt;
<a name="l00700"></a>00700   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00701"></a>00701   <a class="code" href="lapi_8c.html#a9785915283c3f0a0ec90f1b6be32b2c2">api_checknelems</a>(L, 1);
<a name="l00702"></a>00702   obj = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, objindex);
<a name="l00703"></a>00703   <a class="code" href="lapi_8c.html#a29c1133faa3c6591f82b5cca34842d67">api_checkvalidindex</a>(L, obj);
<a name="l00704"></a>00704   <span class="keywordflow">if</span> (<a class="code" href="lobject_8h.html#a8630c13eaefbeaba1aa0933cab6e0238">ttisnil</a>(L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> - 1))
<a name="l00705"></a>00705     mt = NULL;
<a name="l00706"></a>00706   <span class="keywordflow">else</span> {
<a name="l00707"></a>00707     <a class="code" href="llimits_8h.html#a2e63f41a5abfb21dd4394da89206b3f2">api_check</a>(L, <a class="code" href="lobject_8h.html#ac5338f5fe3885d1ee65412e00a44384e">ttistable</a>(L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> - 1));
<a name="l00708"></a>00708     mt = <a class="code" href="lobject_8h.html#a336a6ce5e8340e6de133ec249cf47ebf">hvalue</a>(L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> - 1);
<a name="l00709"></a>00709   }
<a name="l00710"></a>00710   <span class="keywordflow">switch</span> (<a class="code" href="lobject_8h.html#acd205ab396b96fba48e1f758c17a2cf3">ttype</a>(obj)) {
<a name="l00711"></a>00711     <span class="keywordflow">case</span> <a class="code" href="lua_8h.html#a31620fd8da5b655b7879e16a116ec31a">LUA_TTABLE</a>: {
<a name="l00712"></a>00712       <a class="code" href="lobject_8h.html#a336a6ce5e8340e6de133ec249cf47ebf">hvalue</a>(obj)-&gt;metatable = mt;
<a name="l00713"></a>00713       <span class="keywordflow">if</span> (mt)
<a name="l00714"></a>00714         <a class="code" href="lgc_8h.html#a821e1c3d82d93b13d584f9af33d8c296">luaC_objbarriert</a>(L, <a class="code" href="lobject_8h.html#a336a6ce5e8340e6de133ec249cf47ebf">hvalue</a>(obj), mt);
<a name="l00715"></a>00715       <span class="keywordflow">break</span>;
<a name="l00716"></a>00716     }
<a name="l00717"></a>00717     <span class="keywordflow">case</span> <a class="code" href="lua_8h.html#a84fd4c52cea4073671a4cd0eb7026dc7">LUA_TUSERDATA</a>: {
<a name="l00718"></a>00718       <a class="code" href="lobject_8h.html#a1c49f55d93297e833141fb62903af3ad">uvalue</a>(obj)-&gt;metatable = mt;
<a name="l00719"></a>00719       <span class="keywordflow">if</span> (mt)
<a name="l00720"></a>00720         <a class="code" href="lgc_8h.html#a90ac4f3c7085a418025edcc7215e8983">luaC_objbarrier</a>(L, <a class="code" href="lobject_8h.html#a91e9ab83c604f8d3f00711749e327928">rawuvalue</a>(obj), mt);
<a name="l00721"></a>00721       <span class="keywordflow">break</span>;
<a name="l00722"></a>00722     }
<a name="l00723"></a>00723     <span class="keywordflow">default</span>: {
<a name="l00724"></a>00724       <a class="code" href="lstate_8h.html#a103db2de6edf3420c6c6c9a282562406">G</a>(L)-&gt;mt[<a class="code" href="lobject_8h.html#acd205ab396b96fba48e1f758c17a2cf3">ttype</a>(obj)] = mt;
<a name="l00725"></a>00725       <span class="keywordflow">break</span>;
<a name="l00726"></a>00726     }
<a name="l00727"></a>00727   }
<a name="l00728"></a>00728   L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>--;
<a name="l00729"></a>00729   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00730"></a>00730   <span class="keywordflow">return</span> 1;
<a name="l00731"></a>00731 }
<a name="l00732"></a>00732 
<a name="l00733"></a>00733 
<a name="l00734"></a><a class="code" href="lua_8h.html#a31404abda0b6d6f331b63bb651a82830">00734</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">int</span> <a class="code" href="lapi_8c.html#af3a6383019df780016182fb8924f3127">lua_setfenv</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> idx) {
<a name="l00735"></a>00735   <a class="code" href="structlua__TValue.html">StkId</a> o;
<a name="l00736"></a>00736   <span class="keywordtype">int</span> res = 1;
<a name="l00737"></a>00737   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00738"></a>00738   <a class="code" href="lapi_8c.html#a9785915283c3f0a0ec90f1b6be32b2c2">api_checknelems</a>(L, 1);
<a name="l00739"></a>00739   o = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, idx);
<a name="l00740"></a>00740   <a class="code" href="lapi_8c.html#a29c1133faa3c6591f82b5cca34842d67">api_checkvalidindex</a>(L, o);
<a name="l00741"></a>00741   <a class="code" href="llimits_8h.html#a2e63f41a5abfb21dd4394da89206b3f2">api_check</a>(L, <a class="code" href="lobject_8h.html#ac5338f5fe3885d1ee65412e00a44384e">ttistable</a>(L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> - 1));
<a name="l00742"></a>00742   <span class="keywordflow">switch</span> (<a class="code" href="lobject_8h.html#acd205ab396b96fba48e1f758c17a2cf3">ttype</a>(o)) {
<a name="l00743"></a>00743     <span class="keywordflow">case</span> <a class="code" href="lua_8h.html#adaa7fa6e2561c1bc428ba8d265171494">LUA_TFUNCTION</a>:
<a name="l00744"></a>00744       <a class="code" href="lobject_8h.html#a4b49383d348897fe282c0d51354d8bc9">clvalue</a>(o)-&gt;c.env = <a class="code" href="lobject_8h.html#a336a6ce5e8340e6de133ec249cf47ebf">hvalue</a>(L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> - 1);
<a name="l00745"></a>00745       <span class="keywordflow">break</span>;
<a name="l00746"></a>00746     <span class="keywordflow">case</span> <a class="code" href="lua_8h.html#a84fd4c52cea4073671a4cd0eb7026dc7">LUA_TUSERDATA</a>:
<a name="l00747"></a>00747       <a class="code" href="lobject_8h.html#a1c49f55d93297e833141fb62903af3ad">uvalue</a>(o)-&gt;env = <a class="code" href="lobject_8h.html#a336a6ce5e8340e6de133ec249cf47ebf">hvalue</a>(L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> - 1);
<a name="l00748"></a>00748       <span class="keywordflow">break</span>;
<a name="l00749"></a>00749     <span class="keywordflow">case</span> <a class="code" href="lua_8h.html#a028a8d8aae9580c465aabcd0c11334d9">LUA_TTHREAD</a>:
<a name="l00750"></a>00750       <a class="code" href="lobject_8h.html#ab9379699ac579d54410e3542f061bbad">sethvalue</a>(L, <a class="code" href="lstate_8h.html#a1108b4374aa20059cd53d90b638c0e4b">gt</a>(<a class="code" href="lobject_8h.html#a516f32427f1c43ee187ce4c0db042959">thvalue</a>(o)), <a class="code" href="lobject_8h.html#a336a6ce5e8340e6de133ec249cf47ebf">hvalue</a>(L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> - 1));
<a name="l00751"></a>00751       <span class="keywordflow">break</span>;
<a name="l00752"></a>00752     <span class="keywordflow">default</span>:
<a name="l00753"></a>00753       res = 0;
<a name="l00754"></a>00754       <span class="keywordflow">break</span>;
<a name="l00755"></a>00755   }
<a name="l00756"></a>00756   <span class="keywordflow">if</span> (res) <a class="code" href="lgc_8h.html#a90ac4f3c7085a418025edcc7215e8983">luaC_objbarrier</a>(L, <a class="code" href="lobject_8h.html#a05cdf6070135f10ad37e1048a730b634">gcvalue</a>(o), <a class="code" href="lobject_8h.html#a336a6ce5e8340e6de133ec249cf47ebf">hvalue</a>(L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> - 1));
<a name="l00757"></a>00757   L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>--;
<a name="l00758"></a>00758   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00759"></a>00759   <span class="keywordflow">return</span> res;
<a name="l00760"></a>00760 }
<a name="l00761"></a>00761 
<a name="l00762"></a>00762 
<a name="l00763"></a>00763 <span class="comment">/*</span>
<a name="l00764"></a>00764 <span class="comment">** `load&apos; and `call&apos; functions (run Lua code)</span>
<a name="l00765"></a>00765 <span class="comment">*/</span>
<a name="l00766"></a>00766 
<a name="l00767"></a>00767 
<a name="l00768"></a><a class="code" href="lapi_8c.html#afd1f4a36958642707b7598a48c507599">00768</a> <span class="preprocessor">#define adjustresults(L,nres) \</span>
<a name="l00769"></a>00769 <span class="preprocessor">    { if (nres == LUA_MULTRET &amp;&amp; L-&gt;top &gt;= L-&gt;ci-&gt;top) L-&gt;ci-&gt;top = L-&gt;top; }</span>
<a name="l00770"></a>00770 <span class="preprocessor"></span>
<a name="l00771"></a>00771 
<a name="l00772"></a><a class="code" href="lapi_8c.html#a6b76ec051caca9db7e44638873044e98">00772</a> <span class="preprocessor">#define checkresults(L,na,nr) \</span>
<a name="l00773"></a>00773 <span class="preprocessor">     api_check(L, (nr) == LUA_MULTRET || (L-&gt;ci-&gt;top - L-&gt;top &gt;= (nr) - (na)))</span>
<a name="l00774"></a>00774 <span class="preprocessor"></span>  
<a name="l00775"></a>00775 
<a name="l00776"></a><a class="code" href="lua_8h.html#a76a93304f9e313c5e8b9f2d95c1f05fe">00776</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">void</span> <a class="code" href="lapi_8c.html#a2d80481ca28902752c2b12c61d9d4234">lua_call</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> nargs, <span class="keywordtype">int</span> nresults) {
<a name="l00777"></a>00777   <a class="code" href="structlua__TValue.html">StkId</a> func;
<a name="l00778"></a>00778   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00779"></a>00779   <a class="code" href="lapi_8c.html#a9785915283c3f0a0ec90f1b6be32b2c2">api_checknelems</a>(L, nargs+1);
<a name="l00780"></a>00780   <a class="code" href="lapi_8c.html#a6b76ec051caca9db7e44638873044e98">checkresults</a>(L, nargs, nresults);
<a name="l00781"></a>00781   func = L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> - (nargs+1);
<a name="l00782"></a>00782   <a class="code" href="ldo_8c.html#a5483fddd87ca999e7d037bf397ab7997">luaD_call</a>(L, func, nresults);
<a name="l00783"></a>00783   <a class="code" href="lapi_8c.html#afd1f4a36958642707b7598a48c507599">adjustresults</a>(L, nresults);
<a name="l00784"></a>00784   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00785"></a>00785 }
<a name="l00786"></a>00786 
<a name="l00787"></a>00787 
<a name="l00788"></a>00788 
<a name="l00789"></a>00789 <span class="comment">/*</span>
<a name="l00790"></a>00790 <span class="comment">** Execute a protected call.</span>
<a name="l00791"></a>00791 <span class="comment">*/</span>
<a name="l00792"></a><a class="code" href="structCallS.html">00792</a> <span class="keyword">struct </span><a class="code" href="structCallS.html">CallS</a> {  <span class="comment">/* data to `f_call&apos; */</span>
<a name="l00793"></a><a class="code" href="structCallS.html#ad175aaaa032f3e446b391f4e04bd1a6b">00793</a>   <a class="code" href="structlua__TValue.html">StkId</a> <a class="code" href="structCallS.html#ad175aaaa032f3e446b391f4e04bd1a6b">func</a>;
<a name="l00794"></a><a class="code" href="structCallS.html#ad786e0ae2bf61fad4a46b048830c9569">00794</a>   <span class="keywordtype">int</span> <a class="code" href="structCallS.html#ad786e0ae2bf61fad4a46b048830c9569">nresults</a>;
<a name="l00795"></a>00795 };
<a name="l00796"></a>00796 
<a name="l00797"></a>00797 
<a name="l00798"></a><a class="code" href="lapi_8c.html#ac3926c93fb08234f9f47e24653124910">00798</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="lapi_8c.html#ac3926c93fb08234f9f47e24653124910">f_call</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">void</span> *ud) {
<a name="l00799"></a>00799   <span class="keyword">struct </span><a class="code" href="structCallS.html">CallS</a> *c = <a class="code" href="llimits_8h.html#af17d62ec9e237a7644de6b9b34a48a34">cast</a>(<span class="keyword">struct</span> <a class="code" href="structCallS.html">CallS</a> *, ud);
<a name="l00800"></a>00800   <a class="code" href="ldo_8c.html#a5483fddd87ca999e7d037bf397ab7997">luaD_call</a>(L, c-&gt;<a class="code" href="structCallS.html#ad175aaaa032f3e446b391f4e04bd1a6b">func</a>, c-&gt;<a class="code" href="structCallS.html#ad786e0ae2bf61fad4a46b048830c9569">nresults</a>);
<a name="l00801"></a>00801 }
<a name="l00802"></a>00802 
<a name="l00803"></a>00803 
<a name="l00804"></a>00804 
<a name="l00805"></a><a class="code" href="lua_8h.html#a513752286ffd536ea5ce1988e4ebf884">00805</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">int</span> <a class="code" href="lapi_8c.html#a2a6cbad7f1c567378d17ded68b47f8f3">lua_pcall</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> nargs, <span class="keywordtype">int</span> <a class="code" href="structCallS.html#ad786e0ae2bf61fad4a46b048830c9569">nresults</a>, <span class="keywordtype">int</span> errfunc) {
<a name="l00806"></a>00806   <span class="keyword">struct </span><a class="code" href="structCallS.html">CallS</a> c;
<a name="l00807"></a>00807   <span class="keywordtype">int</span> status;
<a name="l00808"></a>00808   ptrdiff_t <a class="code" href="structCallS.html#ad175aaaa032f3e446b391f4e04bd1a6b">func</a>;
<a name="l00809"></a>00809   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00810"></a>00810   <a class="code" href="lapi_8c.html#a9785915283c3f0a0ec90f1b6be32b2c2">api_checknelems</a>(L, nargs+1);
<a name="l00811"></a>00811   <a class="code" href="lapi_8c.html#a6b76ec051caca9db7e44638873044e98">checkresults</a>(L, nargs, nresults);
<a name="l00812"></a>00812   <span class="keywordflow">if</span> (errfunc == 0)
<a name="l00813"></a>00813     func = 0;
<a name="l00814"></a>00814   <span class="keywordflow">else</span> {
<a name="l00815"></a>00815     <a class="code" href="structlua__TValue.html">StkId</a> o = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, errfunc);
<a name="l00816"></a>00816     <a class="code" href="lapi_8c.html#a29c1133faa3c6591f82b5cca34842d67">api_checkvalidindex</a>(L, o);
<a name="l00817"></a>00817     func = <a class="code" href="ldo_8h.html#a3534573bbeec89c6dbdb3eae5a54f9b9">savestack</a>(L, o);
<a name="l00818"></a>00818   }
<a name="l00819"></a>00819   c.<a class="code" href="structCallS.html#ad175aaaa032f3e446b391f4e04bd1a6b">func</a> = L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> - (nargs+1);  <span class="comment">/* function to be called */</span>
<a name="l00820"></a>00820   c.<a class="code" href="structCallS.html#ad786e0ae2bf61fad4a46b048830c9569">nresults</a> = nresults;
<a name="l00821"></a>00821   status = <a class="code" href="ldo_8c.html#a1ad7f845cc62b110e3fcc0ae187d7c85">luaD_pcall</a>(L, <a class="code" href="lapi_8c.html#ac3926c93fb08234f9f47e24653124910">f_call</a>, &amp;c, <a class="code" href="ldo_8h.html#a3534573bbeec89c6dbdb3eae5a54f9b9">savestack</a>(L, c.<a class="code" href="structCallS.html#ad175aaaa032f3e446b391f4e04bd1a6b">func</a>), func);
<a name="l00822"></a>00822   <a class="code" href="lapi_8c.html#afd1f4a36958642707b7598a48c507599">adjustresults</a>(L, nresults);
<a name="l00823"></a>00823   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00824"></a>00824   <span class="keywordflow">return</span> status;
<a name="l00825"></a>00825 }
<a name="l00826"></a>00826 
<a name="l00827"></a>00827 
<a name="l00828"></a>00828 <span class="comment">/*</span>
<a name="l00829"></a>00829 <span class="comment">** Execute a protected C call.</span>
<a name="l00830"></a>00830 <span class="comment">*/</span>
<a name="l00831"></a><a class="code" href="structCCallS.html">00831</a> <span class="keyword">struct </span><a class="code" href="structCCallS.html">CCallS</a> {  <span class="comment">/* data to `f_Ccall&apos; */</span>
<a name="l00832"></a><a class="code" href="structCCallS.html#a276db8e24419aca2b7667c1ca4138ec6">00832</a>   <a class="code" href="lua_8h.html#a5f5bedea265eccf43c6e404e020988ce">lua_CFunction</a> <a class="code" href="structCCallS.html#a276db8e24419aca2b7667c1ca4138ec6">func</a>;
<a name="l00833"></a><a class="code" href="structCCallS.html#aa22d8ac046936fecf461187fd2fecc9a">00833</a>   <span class="keywordtype">void</span> *<a class="code" href="structCCallS.html#aa22d8ac046936fecf461187fd2fecc9a">ud</a>;
<a name="l00834"></a>00834 };
<a name="l00835"></a>00835 
<a name="l00836"></a>00836 
<a name="l00837"></a><a class="code" href="lapi_8c.html#a837bb7cab1726297daea204c78fa9a2a">00837</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="lapi_8c.html#a837bb7cab1726297daea204c78fa9a2a">f_Ccall</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">void</span> *ud) {
<a name="l00838"></a>00838   <span class="keyword">struct </span><a class="code" href="structCCallS.html">CCallS</a> *c = <a class="code" href="llimits_8h.html#af17d62ec9e237a7644de6b9b34a48a34">cast</a>(<span class="keyword">struct</span> <a class="code" href="structCCallS.html">CCallS</a> *, ud);
<a name="l00839"></a>00839   <a class="code" href="unionClosure.html">Closure</a> *cl;
<a name="l00840"></a>00840   cl = <a class="code" href="lfunc_8c.html#a90cb27d2970524a072d17cb895b27c9a">luaF_newCclosure</a>(L, 0, <a class="code" href="lapi_8c.html#a95a3021abc491c31183d30fcb175035e">getcurrenv</a>(L));
<a name="l00841"></a>00841   cl-&gt;<a class="code" href="unionClosure.html#ace9dac5a62b61db682ef0cd86b3b44b1">c</a>.<a class="code" href="structCClosure.html#a1ba64febc8e6adc43fdbb82583852000">f</a> = c-&gt;<a class="code" href="structCCallS.html#a276db8e24419aca2b7667c1ca4138ec6">func</a>;
<a name="l00842"></a>00842   <a class="code" href="lobject_8h.html#a766f0e76b0607550fd72164373ba544d">setclvalue</a>(L, L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>, cl);  <span class="comment">/* push function */</span>
<a name="l00843"></a>00843   <a class="code" href="lapi_8c.html#afe4a5994dd3704ec53de77f9fd121915">api_incr_top</a>(L);
<a name="l00844"></a>00844   <a class="code" href="lobject_8h.html#a0784c90d154ccf7c643b56a00c62412a">setpvalue</a>(L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>, c-&gt;<a class="code" href="structCCallS.html#aa22d8ac046936fecf461187fd2fecc9a">ud</a>);  <span class="comment">/* push only argument */</span>
<a name="l00845"></a>00845   <a class="code" href="lapi_8c.html#afe4a5994dd3704ec53de77f9fd121915">api_incr_top</a>(L);
<a name="l00846"></a>00846   <a class="code" href="ldo_8c.html#a5483fddd87ca999e7d037bf397ab7997">luaD_call</a>(L, L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> - 2, 0);
<a name="l00847"></a>00847 }
<a name="l00848"></a>00848 
<a name="l00849"></a>00849 
<a name="l00850"></a><a class="code" href="lua_8h.html#aecf554be5e84a1577c9e19455bfad16c">00850</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">int</span> <a class="code" href="lapi_8c.html#aff3c8f500cdceb1acdcd4cf4262aea86">lua_cpcall</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <a class="code" href="lua_8h.html#a5f5bedea265eccf43c6e404e020988ce">lua_CFunction</a> <a class="code" href="structCCallS.html#a276db8e24419aca2b7667c1ca4138ec6">func</a>, <span class="keywordtype">void</span> *<a class="code" href="structCCallS.html#aa22d8ac046936fecf461187fd2fecc9a">ud</a>) {
<a name="l00851"></a>00851   <span class="keyword">struct </span><a class="code" href="structCCallS.html">CCallS</a> c;
<a name="l00852"></a>00852   <span class="keywordtype">int</span> status;
<a name="l00853"></a>00853   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00854"></a>00854   c.<a class="code" href="structCCallS.html#a276db8e24419aca2b7667c1ca4138ec6">func</a> = func;
<a name="l00855"></a>00855   c.<a class="code" href="structCCallS.html#aa22d8ac046936fecf461187fd2fecc9a">ud</a> = ud;
<a name="l00856"></a>00856   status = <a class="code" href="ldo_8c.html#a1ad7f845cc62b110e3fcc0ae187d7c85">luaD_pcall</a>(L, <a class="code" href="lapi_8c.html#a837bb7cab1726297daea204c78fa9a2a">f_Ccall</a>, &amp;c, <a class="code" href="ldo_8h.html#a3534573bbeec89c6dbdb3eae5a54f9b9">savestack</a>(L, L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>), 0);
<a name="l00857"></a>00857   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00858"></a>00858   <span class="keywordflow">return</span> status;
<a name="l00859"></a>00859 }
<a name="l00860"></a>00860 
<a name="l00861"></a>00861 
<a name="l00862"></a><a class="code" href="lua_8h.html#a5589c19a7f18954a49e945f50fcba94a">00862</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">int</span> <a class="code" href="lapi_8c.html#a7318e2aab856e8f690ef62571d8afa8b">lua_load</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <a class="code" href="lua_8h.html#a49bb2f99132c1ae9f80ce809cce40455">lua_Reader</a> reader, <span class="keywordtype">void</span> *data,
<a name="l00863"></a>00863                       <span class="keyword">const</span> <span class="keywordtype">char</span> *chunkname) {
<a name="l00864"></a>00864   <a class="code" href="structZio.html">ZIO</a> z;
<a name="l00865"></a>00865   <span class="keywordtype">int</span> status;
<a name="l00866"></a>00866   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00867"></a>00867   <span class="keywordflow">if</span> (!chunkname) chunkname = <span class="stringliteral">&quot;?&quot;</span>;
<a name="l00868"></a>00868   <a class="code" href="lzio_8c.html#aeac95715238190000a710e2c304133a2">luaZ_init</a>(L, &amp;z, reader, data);
<a name="l00869"></a>00869   status = <a class="code" href="ldo_8c.html#a3c8b9bba5ffed516853e5ba1ec00210d">luaD_protectedparser</a>(L, &amp;z, chunkname);
<a name="l00870"></a>00870   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00871"></a>00871   <span class="keywordflow">return</span> status;
<a name="l00872"></a>00872 }
<a name="l00873"></a>00873 
<a name="l00874"></a>00874 
<a name="l00875"></a><a class="code" href="lua_8h.html#a29ceb6e6217ff14d061922a539c59eac">00875</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">int</span> <a class="code" href="lapi_8c.html#a2460412f6cbb86ffc33169b8ce1718c6">lua_dump</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <a class="code" href="lua_8h.html#a739e0fce611e90942d1f15c302187e05">lua_Writer</a> <a class="code" href="lstrlib_8c.html#ae67cb3a8aef2fe1be04d689cddf5d587">writer</a>, <span class="keywordtype">void</span> *data) {
<a name="l00876"></a>00876   <span class="keywordtype">int</span> status;
<a name="l00877"></a>00877   <a class="code" href="structlua__TValue.html">TValue</a> *o;
<a name="l00878"></a>00878   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00879"></a>00879   <a class="code" href="lapi_8c.html#a9785915283c3f0a0ec90f1b6be32b2c2">api_checknelems</a>(L, 1);
<a name="l00880"></a>00880   o = L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> - 1;
<a name="l00881"></a>00881   <span class="keywordflow">if</span> (<a class="code" href="lobject_8h.html#a6e8ea4626fad5e23912d4e26d0b09200">isLfunction</a>(o))
<a name="l00882"></a>00882     status = <a class="code" href="ldump_8c.html#a808f6a29001ac6446f40c76014c6b6e9">luaU_dump</a>(L, <a class="code" href="lobject_8h.html#a4b49383d348897fe282c0d51354d8bc9">clvalue</a>(o)-&gt;l.p, writer, data, 0);
<a name="l00883"></a>00883   <span class="keywordflow">else</span>
<a name="l00884"></a>00884     status = 1;
<a name="l00885"></a>00885   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00886"></a>00886   <span class="keywordflow">return</span> status;
<a name="l00887"></a>00887 }
<a name="l00888"></a>00888 
<a name="l00889"></a>00889 
<a name="l00890"></a><a class="code" href="lua_8h.html#af5cd8db0ed930193f1bf67c583666f91">00890</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">int</span>  <a class="code" href="lapi_8c.html#aadea4b6f60174a1334ebde560968a615">lua_status</a> (<a class="code" href="structlua__State.html">lua_State</a> *L) {
<a name="l00891"></a>00891   <span class="keywordflow">return</span> L-&gt;<a class="code" href="structlua__State.html#a563f8f114867e0b03405680633672102">status</a>;
<a name="l00892"></a>00892 }
<a name="l00893"></a>00893 
<a name="l00894"></a>00894 
<a name="l00895"></a>00895 <span class="comment">/*</span>
<a name="l00896"></a>00896 <span class="comment">** Garbage-collection function</span>
<a name="l00897"></a>00897 <span class="comment">*/</span>
<a name="l00898"></a>00898 
<a name="l00899"></a><a class="code" href="lua_8h.html#a6bac487d3f900b21271e8c591bd801cd">00899</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">int</span> <a class="code" href="lapi_8c.html#af8ed2209505943e2eb581cb4e4e02b62">lua_gc</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> what, <span class="keywordtype">int</span> data) {
<a name="l00900"></a>00900   <span class="keywordtype">int</span> res = 0;
<a name="l00901"></a>00901   <a class="code" href="structglobal__State.html">global_State</a> *g;
<a name="l00902"></a>00902   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00903"></a>00903   g = <a class="code" href="lstate_8h.html#a103db2de6edf3420c6c6c9a282562406">G</a>(L);
<a name="l00904"></a>00904   <span class="keywordflow">switch</span> (what) {
<a name="l00905"></a>00905     <span class="keywordflow">case</span> <a class="code" href="lua_8h.html#a7080a7110a1b37afc6ea2f706e944bc3">LUA_GCSTOP</a>: {
<a name="l00906"></a>00906       g-&gt;<a class="code" href="structglobal__State.html#aa9ac0098ecb410b77df6c05188442ac6">GCthreshold</a> = <a class="code" href="llimits_8h.html#a5e67dd5554c315bda4b54cd5ed0e846e">MAX_LUMEM</a>;
<a name="l00907"></a>00907       <span class="keywordflow">break</span>;
<a name="l00908"></a>00908     }
<a name="l00909"></a>00909     <span class="keywordflow">case</span> <a class="code" href="lua_8h.html#a73701e5990022e938e90828a2c8291a4">LUA_GCRESTART</a>: {
<a name="l00910"></a>00910       g-&gt;<a class="code" href="structglobal__State.html#aa9ac0098ecb410b77df6c05188442ac6">GCthreshold</a> = g-&gt;<a class="code" href="structglobal__State.html#a8c2db9bdf2b63884b770acbbc8f0d25c">totalbytes</a>;
<a name="l00911"></a>00911       <span class="keywordflow">break</span>;
<a name="l00912"></a>00912     }
<a name="l00913"></a>00913     <span class="keywordflow">case</span> <a class="code" href="lua_8h.html#a59b8b65be08a10442ea2ae41289f5073">LUA_GCCOLLECT</a>: {
<a name="l00914"></a>00914       <a class="code" href="lgc_8c.html#a42a86c66ac02f72ad364f92a946a09e7">luaC_fullgc</a>(L);
<a name="l00915"></a>00915       <span class="keywordflow">break</span>;
<a name="l00916"></a>00916     }
<a name="l00917"></a>00917     <span class="keywordflow">case</span> <a class="code" href="lua_8h.html#a3f8f1ebdffa4dbfe2dd89c2fd86bd7f4">LUA_GCCOUNT</a>: {
<a name="l00918"></a>00918       <span class="comment">/* GC values are expressed in Kbytes: #bytes/2^10 */</span>
<a name="l00919"></a>00919       res = <a class="code" href="llimits_8h.html#a37a9e2c4b53433d34bad0f12a1500c08">cast_int</a>(g-&gt;<a class="code" href="structglobal__State.html#a8c2db9bdf2b63884b770acbbc8f0d25c">totalbytes</a> &gt;&gt; 10);
<a name="l00920"></a>00920       <span class="keywordflow">break</span>;
<a name="l00921"></a>00921     }
<a name="l00922"></a>00922     <span class="keywordflow">case</span> <a class="code" href="lua_8h.html#a99f1685cd6789e0b9bbd2a4c080fbaed">LUA_GCCOUNTB</a>: {
<a name="l00923"></a>00923       res = <a class="code" href="llimits_8h.html#a37a9e2c4b53433d34bad0f12a1500c08">cast_int</a>(g-&gt;<a class="code" href="structglobal__State.html#a8c2db9bdf2b63884b770acbbc8f0d25c">totalbytes</a> &amp; 0x3ff);
<a name="l00924"></a>00924       <span class="keywordflow">break</span>;
<a name="l00925"></a>00925     }
<a name="l00926"></a>00926     <span class="keywordflow">case</span> <a class="code" href="lua_8h.html#a9e7f3eaf2e269c3422aea3fd7c8973ef">LUA_GCSTEP</a>: {
<a name="l00927"></a>00927       <a class="code" href="llimits_8h.html#a5bad522ae691bff7310f85afccf49170">lu_mem</a> a = (<a class="code" href="llimits_8h.html#af17d62ec9e237a7644de6b9b34a48a34">cast</a>(<a class="code" href="llimits_8h.html#a5bad522ae691bff7310f85afccf49170">lu_mem</a>, data) &lt;&lt; 10);
<a name="l00928"></a>00928       <span class="keywordflow">if</span> (a &lt;= g-&gt;totalbytes)
<a name="l00929"></a>00929         g-&gt;<a class="code" href="structglobal__State.html#aa9ac0098ecb410b77df6c05188442ac6">GCthreshold</a> = g-&gt;<a class="code" href="structglobal__State.html#a8c2db9bdf2b63884b770acbbc8f0d25c">totalbytes</a> - a;
<a name="l00930"></a>00930       <span class="keywordflow">else</span>
<a name="l00931"></a>00931         g-&gt;<a class="code" href="structglobal__State.html#aa9ac0098ecb410b77df6c05188442ac6">GCthreshold</a> = 0;
<a name="l00932"></a>00932       <span class="keywordflow">while</span> (g-&gt;<a class="code" href="structglobal__State.html#aa9ac0098ecb410b77df6c05188442ac6">GCthreshold</a> &lt;= g-&gt;<a class="code" href="structglobal__State.html#a8c2db9bdf2b63884b770acbbc8f0d25c">totalbytes</a>) {
<a name="l00933"></a>00933         <a class="code" href="lgc_8c.html#ab0133eb7bb37a0a690e0ef71fbc13414">luaC_step</a>(L);
<a name="l00934"></a>00934         <span class="keywordflow">if</span> (g-&gt;<a class="code" href="structglobal__State.html#aea4d494b8b9accef389f2be8830f7a84">gcstate</a> == <a class="code" href="lgc_8h.html#ab546d91106ec5cfdba254de13e5b5c5f">GCSpause</a>) {  <span class="comment">/* end of cycle? */</span>
<a name="l00935"></a>00935           res = 1;  <span class="comment">/* signal it */</span>
<a name="l00936"></a>00936           <span class="keywordflow">break</span>;
<a name="l00937"></a>00937         }
<a name="l00938"></a>00938       }
<a name="l00939"></a>00939       <span class="keywordflow">break</span>;
<a name="l00940"></a>00940     }
<a name="l00941"></a>00941     <span class="keywordflow">case</span> <a class="code" href="lua_8h.html#a28342bd4f96a077c7447489073dfa376">LUA_GCSETPAUSE</a>: {
<a name="l00942"></a>00942       res = g-&gt;<a class="code" href="structglobal__State.html#ac043711149aed55ef1d8b911e795b04d">gcpause</a>;
<a name="l00943"></a>00943       g-&gt;<a class="code" href="structglobal__State.html#ac043711149aed55ef1d8b911e795b04d">gcpause</a> = data;
<a name="l00944"></a>00944       <span class="keywordflow">break</span>;
<a name="l00945"></a>00945     }
<a name="l00946"></a>00946     <span class="keywordflow">case</span> <a class="code" href="lua_8h.html#af07b3449c8e3ffdd62649443f32e1931">LUA_GCSETSTEPMUL</a>: {
<a name="l00947"></a>00947       res = g-&gt;<a class="code" href="structglobal__State.html#acd2271d481c60fa86f30577f88227e1e">gcstepmul</a>;
<a name="l00948"></a>00948       g-&gt;<a class="code" href="structglobal__State.html#acd2271d481c60fa86f30577f88227e1e">gcstepmul</a> = data;
<a name="l00949"></a>00949       <span class="keywordflow">break</span>;
<a name="l00950"></a>00950     }
<a name="l00951"></a>00951     <span class="keywordflow">default</span>: res = -1;  <span class="comment">/* invalid option */</span>
<a name="l00952"></a>00952   }
<a name="l00953"></a>00953   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00954"></a>00954   <span class="keywordflow">return</span> res;
<a name="l00955"></a>00955 }
<a name="l00956"></a>00956 
<a name="l00957"></a>00957 
<a name="l00958"></a>00958 
<a name="l00959"></a>00959 <span class="comment">/*</span>
<a name="l00960"></a>00960 <span class="comment">** miscellaneous functions</span>
<a name="l00961"></a>00961 <span class="comment">*/</span>
<a name="l00962"></a>00962 
<a name="l00963"></a>00963 
<a name="l00964"></a><a class="code" href="lua_8h.html#aae6c05ddea7bd110a3e84595ef92e601">00964</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">int</span> <a class="code" href="lapi_8c.html#a6ba7b91143fe8a03910420d800de8e97">lua_error</a> (<a class="code" href="structlua__State.html">lua_State</a> *L) {
<a name="l00965"></a>00965   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00966"></a>00966   <a class="code" href="lapi_8c.html#a9785915283c3f0a0ec90f1b6be32b2c2">api_checknelems</a>(L, 1);
<a name="l00967"></a>00967   <a class="code" href="ldebug_8c.html#ad12d1709978097158ace5169f9802da9">luaG_errormsg</a>(L);
<a name="l00968"></a>00968   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00969"></a>00969   <span class="keywordflow">return</span> 0;  <span class="comment">/* to avoid warnings */</span>
<a name="l00970"></a>00970 }
<a name="l00971"></a>00971 
<a name="l00972"></a>00972 
<a name="l00973"></a><a class="code" href="lua_8h.html#a2a62b957ab95d9b542bf7d02794181e6">00973</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">int</span> <a class="code" href="lapi_8c.html#aa8bf464b98335a075732200ad91ce1de">lua_next</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> idx) {
<a name="l00974"></a>00974   <a class="code" href="structlua__TValue.html">StkId</a> t;
<a name="l00975"></a>00975   <span class="keywordtype">int</span> more;
<a name="l00976"></a>00976   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00977"></a>00977   t = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, idx);
<a name="l00978"></a>00978   <a class="code" href="llimits_8h.html#a2e63f41a5abfb21dd4394da89206b3f2">api_check</a>(L, <a class="code" href="lobject_8h.html#ac5338f5fe3885d1ee65412e00a44384e">ttistable</a>(t));
<a name="l00979"></a>00979   more = <a class="code" href="ltable_8c.html#a3c4370ade14fcc86ede5ca90271d0f30">luaH_next</a>(L, <a class="code" href="lobject_8h.html#a336a6ce5e8340e6de133ec249cf47ebf">hvalue</a>(t), L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> - 1);
<a name="l00980"></a>00980   <span class="keywordflow">if</span> (more) {
<a name="l00981"></a>00981     <a class="code" href="lapi_8c.html#afe4a5994dd3704ec53de77f9fd121915">api_incr_top</a>(L);
<a name="l00982"></a>00982   }
<a name="l00983"></a>00983   <span class="keywordflow">else</span>  <span class="comment">/* no more elements */</span>
<a name="l00984"></a>00984     L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> -= 1;  <span class="comment">/* remove key */</span>
<a name="l00985"></a>00985   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00986"></a>00986   <span class="keywordflow">return</span> more;
<a name="l00987"></a>00987 }
<a name="l00988"></a>00988 
<a name="l00989"></a>00989 
<a name="l00990"></a><a class="code" href="lua_8h.html#a4eba0457df5bafff4d44071d1d8080b6">00990</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">void</span> <a class="code" href="lapi_8c.html#a1de3afee1daece63d455f23818c883d9">lua_concat</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> n) {
<a name="l00991"></a>00991   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00992"></a>00992   <a class="code" href="lapi_8c.html#a9785915283c3f0a0ec90f1b6be32b2c2">api_checknelems</a>(L, n);
<a name="l00993"></a>00993   <span class="keywordflow">if</span> (n &gt;= 2) {
<a name="l00994"></a>00994     <a class="code" href="lgc_8h.html#ad013db5004ccc5fbe8a6450caa1f1ad9">luaC_checkGC</a>(L);
<a name="l00995"></a>00995     <a class="code" href="lvm_8c.html#a6ba8066ec1460f73ff3ee49654dfca80">luaV_concat</a>(L, n, <a class="code" href="llimits_8h.html#a37a9e2c4b53433d34bad0f12a1500c08">cast_int</a>(L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> - L-&gt;<a class="code" href="structlua__State.html#ac11fa7aeb6254b8de57fb9d1dd06fdf2">base</a>) - 1);
<a name="l00996"></a>00996     L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> -= (n-1);
<a name="l00997"></a>00997   }
<a name="l00998"></a>00998   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (n == 0) {  <span class="comment">/* push empty string */</span>
<a name="l00999"></a>00999     <a class="code" href="lobject_8h.html#a2defbd1005c5aebb5807517ddea80f3f">setsvalue2s</a>(L, L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>, <a class="code" href="lstring_8c.html#ab41fb084ce3ea5e2779f6659ccc2484d">luaS_newlstr</a>(L, <span class="stringliteral">&quot;&quot;</span>, 0));
<a name="l01000"></a>01000     <a class="code" href="lapi_8c.html#afe4a5994dd3704ec53de77f9fd121915">api_incr_top</a>(L);
<a name="l01001"></a>01001   }
<a name="l01002"></a>01002   <span class="comment">/* else n == 1; nothing to do */</span>
<a name="l01003"></a>01003   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l01004"></a>01004 }
<a name="l01005"></a>01005 
<a name="l01006"></a>01006 
<a name="l01007"></a><a class="code" href="lua_8h.html#ab5b8729206c208fbb794c9c2840b0812">01007</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <a class="code" href="lua_8h.html#a1c6fb648cd80375673a99321e15fcc36">lua_Alloc</a> <a class="code" href="lapi_8c.html#a3dbff8747b32b799cf63603c46da06cc">lua_getallocf</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">void</span> **<a class="code" href="structCCallS.html#aa22d8ac046936fecf461187fd2fecc9a">ud</a>) {
<a name="l01008"></a>01008   <a class="code" href="lua_8h.html#a1c6fb648cd80375673a99321e15fcc36">lua_Alloc</a> <a class="code" href="libluasqlite3_8c.html#ae16fcc70ad2cbf55b1906507bcb6fa33">f</a>;
<a name="l01009"></a>01009   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l01010"></a>01010   <span class="keywordflow">if</span> (ud) *ud = <a class="code" href="lstate_8h.html#a103db2de6edf3420c6c6c9a282562406">G</a>(L)-&gt;ud;
<a name="l01011"></a>01011   f = <a class="code" href="lstate_8h.html#a103db2de6edf3420c6c6c9a282562406">G</a>(L)-&gt;frealloc;
<a name="l01012"></a>01012   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l01013"></a>01013   <span class="keywordflow">return</span> f;
<a name="l01014"></a>01014 }
<a name="l01015"></a>01015 
<a name="l01016"></a>01016 
<a name="l01017"></a><a class="code" href="lua_8h.html#ac890276f9590df6a4d6aabdad9c558f0">01017</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">void</span> <a class="code" href="lapi_8c.html#ac890276f9590df6a4d6aabdad9c558f0">lua_setallocf</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <a class="code" href="lua_8h.html#a1c6fb648cd80375673a99321e15fcc36">lua_Alloc</a> <a class="code" href="libluasqlite3_8c.html#ae16fcc70ad2cbf55b1906507bcb6fa33">f</a>, <span class="keywordtype">void</span> *<a class="code" href="structCCallS.html#aa22d8ac046936fecf461187fd2fecc9a">ud</a>) {
<a name="l01018"></a>01018   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l01019"></a>01019   <a class="code" href="lstate_8h.html#a103db2de6edf3420c6c6c9a282562406">G</a>(L)-&gt;ud = ud;
<a name="l01020"></a>01020   <a class="code" href="lstate_8h.html#a103db2de6edf3420c6c6c9a282562406">G</a>(L)-&gt;frealloc = f;
<a name="l01021"></a>01021   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l01022"></a>01022 }
<a name="l01023"></a>01023 
<a name="l01024"></a>01024 
<a name="l01025"></a><a class="code" href="lua_8h.html#a0ed440a42dac5e7faaf51163b274c43c">01025</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">void</span> *<a class="code" href="lapi_8c.html#a467bb6f4780b27d6e7de6ee10a80dac5">lua_newuserdata</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">size_t</span> size) {
<a name="l01026"></a>01026   <a class="code" href="unionUdata.html">Udata</a> *u;
<a name="l01027"></a>01027   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l01028"></a>01028   <a class="code" href="lgc_8h.html#ad013db5004ccc5fbe8a6450caa1f1ad9">luaC_checkGC</a>(L);
<a name="l01029"></a>01029   u = <a class="code" href="lstring_8c.html#afda2e34ccf43bf959d752c6fd4adf2c9">luaS_newudata</a>(L, size, <a class="code" href="lapi_8c.html#a95a3021abc491c31183d30fcb175035e">getcurrenv</a>(L));
<a name="l01030"></a>01030   <a class="code" href="lobject_8h.html#ab358ecf44046d8def185fed182944fc1">setuvalue</a>(L, L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>, u);
<a name="l01031"></a>01031   <a class="code" href="lapi_8c.html#afe4a5994dd3704ec53de77f9fd121915">api_incr_top</a>(L);
<a name="l01032"></a>01032   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l01033"></a>01033   <span class="keywordflow">return</span> u + 1;
<a name="l01034"></a>01034 }
<a name="l01035"></a>01035 
<a name="l01036"></a>01036 
<a name="l01037"></a>01037 
<a name="l01038"></a>01038 
<a name="l01039"></a><a class="code" href="lapi_8c.html#ab605555ec9d2edee083a697f0401f1cf">01039</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="lapi_8c.html#ab605555ec9d2edee083a697f0401f1cf">aux_upvalue</a> (<a class="code" href="structlua__TValue.html">StkId</a> fi, <span class="keywordtype">int</span> n, <a class="code" href="structlua__TValue.html">TValue</a> **val) {
<a name="l01040"></a>01040   <a class="code" href="unionClosure.html">Closure</a> *<a class="code" href="libluasqlite3_8c.html#ae16fcc70ad2cbf55b1906507bcb6fa33">f</a>;
<a name="l01041"></a>01041   <span class="keywordflow">if</span> (!<a class="code" href="lobject_8h.html#a48587dcb78721d149d3184d0768f4950">ttisfunction</a>(fi)) <span class="keywordflow">return</span> NULL;
<a name="l01042"></a>01042   f = <a class="code" href="lobject_8h.html#a4b49383d348897fe282c0d51354d8bc9">clvalue</a>(fi);
<a name="l01043"></a>01043   <span class="keywordflow">if</span> (f-&gt;<a class="code" href="unionClosure.html#ace9dac5a62b61db682ef0cd86b3b44b1">c</a>.isC) {
<a name="l01044"></a>01044     <span class="keywordflow">if</span> (!(1 &lt;= n &amp;&amp; n &lt;= f-&gt;c.nupvalues)) <span class="keywordflow">return</span> NULL;
<a name="l01045"></a>01045     *val = &amp;f-&gt;<a class="code" href="unionClosure.html#ace9dac5a62b61db682ef0cd86b3b44b1">c</a>.<a class="code" href="structCClosure.html#a75d6bfc66f8ed48b3dd67007be84174f">upvalue</a>[n-1];
<a name="l01046"></a>01046     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l01047"></a>01047   }
<a name="l01048"></a>01048   <span class="keywordflow">else</span> {
<a name="l01049"></a>01049     <a class="code" href="structProto.html">Proto</a> *p = f-&gt;<a class="code" href="unionClosure.html#a8c338ec7dc76078cbee5887857de713c">l</a>.<a class="code" href="structLClosure.html#a4cf173817d3897b0e70822e70d241d6c">p</a>;
<a name="l01050"></a>01050     <span class="keywordflow">if</span> (!(1 &lt;= n &amp;&amp; n &lt;= p-&gt;sizeupvalues)) <span class="keywordflow">return</span> NULL;
<a name="l01051"></a>01051     *val = f-&gt;<a class="code" href="unionClosure.html#a8c338ec7dc76078cbee5887857de713c">l</a>.<a class="code" href="structLClosure.html#a94886e7c7df838f5fab36575b0554682">upvals</a>[n-1]-&gt;<a class="code" href="structUpVal.html#aeb2c6e23d98883dd7f117de69de23e54">v</a>;
<a name="l01052"></a>01052     <span class="keywordflow">return</span> <a class="code" href="lobject_8h.html#acb05d3ab238923581a9c629b8e11a6ac">getstr</a>(p-&gt;<a class="code" href="structProto.html#abebc63aea579a1b630efc04d2bf9c4b7">upvalues</a>[n-1]);
<a name="l01053"></a>01053   }
<a name="l01054"></a>01054 }
<a name="l01055"></a>01055 
<a name="l01056"></a>01056 
<a name="l01057"></a><a class="code" href="lua_8h.html#afd5e7d6995dc52a5cb9e370ee3a710e6">01057</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="lapi_8c.html#afd5e7d6995dc52a5cb9e370ee3a710e6">lua_getupvalue</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> funcindex, <span class="keywordtype">int</span> n) {
<a name="l01058"></a>01058   <span class="keyword">const</span> <span class="keywordtype">char</span> *name;
<a name="l01059"></a>01059   <a class="code" href="structlua__TValue.html">TValue</a> *val;
<a name="l01060"></a>01060   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l01061"></a>01061   name = <a class="code" href="lapi_8c.html#ab605555ec9d2edee083a697f0401f1cf">aux_upvalue</a>(<a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, funcindex), n, &amp;val);
<a name="l01062"></a>01062   <span class="keywordflow">if</span> (name) {
<a name="l01063"></a>01063     <a class="code" href="lobject_8h.html#a1c51b9462c606f1f97242fae6b1220d1">setobj2s</a>(L, L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>, val);
<a name="l01064"></a>01064     <a class="code" href="lapi_8c.html#afe4a5994dd3704ec53de77f9fd121915">api_incr_top</a>(L);
<a name="l01065"></a>01065   }
<a name="l01066"></a>01066   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l01067"></a>01067   <span class="keywordflow">return</span> name;
<a name="l01068"></a>01068 }
<a name="l01069"></a>01069 
<a name="l01070"></a>01070 
<a name="l01071"></a><a class="code" href="lua_8h.html#a6e2e5717e848fca56335a64739a8f2c0">01071</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="lapi_8c.html#a6e2e5717e848fca56335a64739a8f2c0">lua_setupvalue</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> funcindex, <span class="keywordtype">int</span> n) {
<a name="l01072"></a>01072   <span class="keyword">const</span> <span class="keywordtype">char</span> *name;
<a name="l01073"></a>01073   <a class="code" href="structlua__TValue.html">TValue</a> *val;
<a name="l01074"></a>01074   <a class="code" href="structlua__TValue.html">StkId</a> fi;
<a name="l01075"></a>01075   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l01076"></a>01076   fi = <a class="code" href="lapi_8c.html#a9e10181d58be6c7783928bd322a3fb1b">index2adr</a>(L, funcindex);
<a name="l01077"></a>01077   <a class="code" href="lapi_8c.html#a9785915283c3f0a0ec90f1b6be32b2c2">api_checknelems</a>(L, 1);
<a name="l01078"></a>01078   name = <a class="code" href="lapi_8c.html#ab605555ec9d2edee083a697f0401f1cf">aux_upvalue</a>(fi, n, &amp;val);
<a name="l01079"></a>01079   <span class="keywordflow">if</span> (name) {
<a name="l01080"></a>01080     L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>--;
<a name="l01081"></a>01081     <a class="code" href="lobject_8h.html#acf2af15f3d5cceca8e8870f96634bc2d">setobj</a>(L, val, L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>);
<a name="l01082"></a>01082     <a class="code" href="lgc_8h.html#a21660a316c42bc1aad10f115e2261bca">luaC_barrier</a>(L, <a class="code" href="lobject_8h.html#a4b49383d348897fe282c0d51354d8bc9">clvalue</a>(fi), L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>);
<a name="l01083"></a>01083   }
<a name="l01084"></a>01084   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l01085"></a>01085   <span class="keywordflow">return</span> name;
<a name="l01086"></a>01086 }
<a name="l01087"></a>01087 
<a name="l01088"></a>01088 <span class="comment">// alua addition</span>
<a name="l01089"></a><a class="code" href="lua_8h.html#a8b60eadf1a11879f1555d70a25038f56">01089</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">void</span> *<a class="code" href="lapi_8c.html#a8b60eadf1a11879f1555d70a25038f56">active_ctx</a>(<a class="code" href="structlua__State.html">lua_State</a> *L)
<a name="l01090"></a>01090   {
<a name="l01091"></a>01091   <span class="keywordflow">return</span> L-&gt;<a class="code" href="structlua__State.html#a0a4277cad82c16fa014c7d63bcdb2ed6">active_ctx</a>;
<a name="l01092"></a>01092   }
<a name="l01093"></a>01093 
<a name="l01094"></a>01094 <span class="comment">// alua addition</span>
<a name="l01095"></a><a class="code" href="lua_8h.html#af075b9cfc4a9b9bd5b2e5fa87e8726df">01095</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">void</span> <a class="code" href="lapi_8c.html#af075b9cfc4a9b9bd5b2e5fa87e8726df">active_register</a>(<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">void</span> *ctx)
<a name="l01096"></a>01096   {
<a name="l01097"></a>01097   L-&gt;<a class="code" href="structlua__State.html#a0a4277cad82c16fa014c7d63bcdb2ed6">active_ctx</a> = ctx;  
<a name="l01098"></a>01098   }
</pre></div></div>
<hr size="1">

<p style="text-align: right;">
  <a href="http://www.contextlogger.org/">ContextLogger2</a>&#8212;ContextLogger2 Logger Daemon Internals&#8212;<small>Generated on Mon May 2 13:49:54 2011 by&nbsp;<a href="http://www.doxygen.org/">Doxygen</a> 1.6.1</small>
</p>

</body>
</html>
