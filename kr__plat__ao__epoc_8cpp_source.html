<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ContextLogger2 Logger Daemon Internals: kr_plat_ao_epoc.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_ce488f798153ac6666006744a35bf93c.html">src</a>
  </div>
</div>
<div class="contents">
<h1>kr_plat_ao_epoc.cpp</h1><a href="kr__plat__ao__epoc_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include &quot;<a class="code" href="kr__plat__ao_8h.html">kr_plat_ao.h</a>&quot;</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="preprocessor">#include &quot;<a class="code" href="ac__app__context_8h.html">ac_app_context.h</a>&quot;</span>
<a name="l00004"></a>00004 <span class="preprocessor">#include &quot;<a class="code" href="bb__blackboard_8h.html">bb_blackboard.h</a>&quot;</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include &quot;<a class="code" href="er__errors_8h.html">er_errors.h</a>&quot;</span>
<a name="l00006"></a>00006 <span class="preprocessor">#include &quot;<a class="code" href="kr__diskspace_8h.html">kr_diskspace.h</a>&quot;</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include &quot;<a class="code" href="kr__sms__trigger__epoc_8hpp.html">kr_sms_trigger_epoc.hpp</a>&quot;</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include &quot;<a class="code" href="sa__sensor__list__log__db_8h.html">sa_sensor_list_log_db.h</a>&quot;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &quot;<a class="code" href="ut__diskspace__epoc_8hpp.html">ut_diskspace_epoc.hpp</a>&quot;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &quot;<a class="code" href="ut__telephony__epoc_8h.html">ut_telephony_epoc.h</a>&quot;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &quot;<a class="code" href="ut__retry__epoc_8hpp.html">ut_retry_epoc.hpp</a>&quot;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &quot;<a class="code" href="utils__cl2_8h.html">utils_cl2.h</a>&quot;</span>
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 <span class="comment">// --------------------------------------------------</span>
<a name="l00015"></a>00015 <span class="comment">// disk space observing</span>
<a name="l00016"></a>00016 <span class="comment">// --------------------------------------------------</span>
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 <span class="comment">/***koog </span>
<a name="l00019"></a>00019 <span class="comment">(require codegen/symbian-cxx)</span>
<a name="l00020"></a>00020 <span class="comment">(ctor-defines/spec</span>
<a name="l00021"></a>00021 <span class="comment"> &quot;CDiskObserver&quot; ;; name</span>
<a name="l00022"></a>00022 <span class="comment"> &quot;&quot; ;; args</span>
<a name="l00023"></a>00023 <span class="comment"> &quot;&quot; ;; inits</span>
<a name="l00024"></a>00024 <span class="comment"> &quot;&quot; ;; ctor</span>
<a name="l00025"></a>00025 <span class="comment"> #t ;; ConstructL</span>
<a name="l00026"></a>00026 <span class="comment">)</span>
<a name="l00027"></a>00027 <span class="comment"> ***/</span>
<a name="l00028"></a><a class="code" href="kr__plat__ao__epoc_8cpp.html#a95137ee2d22d3ddb49b8ccd8008a426b">00028</a> <span class="preprocessor">#define CTOR_DECL_CDiskObserver  \</span>
<a name="l00029"></a>00029 <span class="preprocessor">public: static CDiskObserver* NewLC(); \</span>
<a name="l00030"></a>00030 <span class="preprocessor">public: static CDiskObserver* NewL(); \</span>
<a name="l00031"></a>00031 <span class="preprocessor">private: CDiskObserver(); \</span>
<a name="l00032"></a>00032 <span class="preprocessor">private: void ConstructL();</span>
<a name="l00033"></a>00033 <span class="preprocessor"></span>
<a name="l00034"></a><a class="code" href="kr__plat__ao__epoc_8cpp.html#acf578f3cf75263d885d379bb4bd88a8e">00034</a> <span class="preprocessor">#define CTOR_IMPL_CDiskObserver  \</span>
<a name="l00035"></a>00035 <span class="preprocessor">CDiskObserver* CDiskObserver::NewLC() \</span>
<a name="l00036"></a>00036 <span class="preprocessor">{ \</span>
<a name="l00037"></a>00037 <span class="preprocessor">  CDiskObserver* obj = new (ELeave) CDiskObserver(); \</span>
<a name="l00038"></a>00038 <span class="preprocessor">  CleanupStack::PushL(obj); \</span>
<a name="l00039"></a>00039 <span class="preprocessor">  obj-&gt;ConstructL(); \</span>
<a name="l00040"></a>00040 <span class="preprocessor">  return obj; \</span>
<a name="l00041"></a>00041 <span class="preprocessor">} \</span>
<a name="l00042"></a>00042 <span class="preprocessor"> \</span>
<a name="l00043"></a>00043 <span class="preprocessor">CDiskObserver* CDiskObserver::NewL() \</span>
<a name="l00044"></a>00044 <span class="preprocessor">{ \</span>
<a name="l00045"></a>00045 <span class="preprocessor">  CDiskObserver* obj = CDiskObserver::NewLC(); \</span>
<a name="l00046"></a>00046 <span class="preprocessor">  CleanupStack::Pop(obj); \</span>
<a name="l00047"></a>00047 <span class="preprocessor">  return obj; \</span>
<a name="l00048"></a>00048 <span class="preprocessor">} \</span>
<a name="l00049"></a>00049 <span class="preprocessor"> \</span>
<a name="l00050"></a>00050 <span class="preprocessor">CDiskObserver::CDiskObserver() \</span>
<a name="l00051"></a>00051 <span class="preprocessor">{}</span>
<a name="l00052"></a>00052 <span class="preprocessor"></span><span class="comment">/***end***/</span>
<a name="l00053"></a><a class="code" href="classCDiskObserver.html">00053</a> NONSHARABLE_CLASS(<a class="code" href="classCDiskObserver.html">CDiskObserver</a>) : public <a class="code" href="classCBase.html">CBase</a>, public MDiskSpace
<a name="l00054"></a>00054 {
<a name="l00055"></a><a class="code" href="classCDiskObserver.html#aa176ac0080f1fd8b7a640cbb2fb61c82">00055</a>   <a class="code" href="kr__plat__ao__epoc_8cpp.html#a95137ee2d22d3ddb49b8ccd8008a426b">CTOR_DECL_CDiskObserver</a>;
<a name="l00056"></a>00056 
<a name="l00057"></a>00057  <span class="keyword">public</span>:
<a name="l00058"></a>00058   ~<a class="code" href="classCDiskObserver.html">CDiskObserver</a>();
<a name="l00059"></a>00059 
<a name="l00060"></a>00060  <span class="keyword">private</span>:
<a name="l00061"></a>00061   <span class="keyword">virtual</span> <span class="keywordtype">void</span> DiskSpaceNotify(TInt aDrive, TInt errCode);
<a name="l00062"></a>00062 
<a name="l00063"></a>00063  <span class="keyword">private</span>:
<a name="l00064"></a>00064   <a class="code" href="epoc-session_8hpp.html#a0de103da976bd701364cc09ce169e008">DEF_SESSION</a>(RFs, iFs);
<a name="l00065"></a><a class="code" href="classCDiskObserver.html#aa049f338ba164aa30a6fe542126e8651">00065</a>   CDiskSpaceNotifier* iNotifier;
<a name="l00066"></a>00066 };
<a name="l00067"></a>00067 
<a name="l00068"></a><a class="code" href="kr__plat__ao__epoc_8cpp.html#afa24397a683c4bfc8643eb401392d458">00068</a> <a class="code" href="kr__plat__ao__epoc_8cpp.html#acf578f3cf75263d885d379bb4bd88a8e">CTOR_IMPL_CDiskObserver</a>;
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 <span class="keywordtype">void</span> CDiskObserver::ConstructL()
<a name="l00071"></a>00071 {
<a name="l00072"></a>00072   TChar driveLetter = DATABASE_DRIVE_LETTER;
<a name="l00073"></a>00073   TInt driveNum = 0;
<a name="l00074"></a>00074   User::LeaveIfError(RFs::CharToDrive(driveLetter, driveNum));
<a name="l00075"></a>00075 
<a name="l00076"></a>00076   <a class="code" href="epoc-session_8hpp.html#af91065ea9f844797be3ef7ffea3df605">LEAVE_IF_ERROR_OR_SET_SESSION_OPEN</a>(iFs, iFs.Connect());
<a name="l00077"></a>00077   <span class="keywordtype">int</span> database_disk_threshold = <a class="code" href="ac__app__context_8h.html#a4df528c22dbfba3523ec1646aa0ae690">ac_STATIC_GET</a>(database_disk_threshold);
<a name="l00078"></a>00078   <a class="code" href="classCDiskObserver.html#aa049f338ba164aa30a6fe542126e8651">iNotifier</a> = CDiskSpaceNotifier::NewL(iFs, driveNum,
<a name="l00079"></a>00079                <span class="keyword">this</span>, 
<a name="l00080"></a>00080                (TInt64)database_disk_threshold);
<a name="l00081"></a>00081 }
<a name="l00082"></a>00082 
<a name="l00083"></a><a class="code" href="classCDiskObserver.html#a65e051e5dc39a98a12dd019efeeee660">00083</a> <a class="code" href="classCDiskObserver.html#a65e051e5dc39a98a12dd019efeeee660">CDiskObserver::~CDiskObserver</a>()
<a name="l00084"></a>00084 {
<a name="l00085"></a>00085   <span class="keyword">delete</span> <a class="code" href="classCDiskObserver.html#aa049f338ba164aa30a6fe542126e8651">iNotifier</a>;
<a name="l00086"></a>00086   <a class="code" href="epoc-session_8hpp.html#aa1bfce1abc3e149622ce1432e42f1abe">SESSION_CLOSE_IF_OPEN</a>(iFs);
<a name="l00087"></a>00087 }
<a name="l00088"></a>00088 
<a name="l00089"></a><a class="code" href="classCDiskObserver.html#a28aeabb8dabd567c571e621c3a5f8b02">00089</a> <span class="keywordtype">void</span> <a class="code" href="classCDiskObserver.html#a28aeabb8dabd567c571e621c3a5f8b02">CDiskObserver::DiskSpaceNotify</a>(TInt aDrive, TInt errCode)
<a name="l00090"></a>00090 {
<a name="l00091"></a>00091   (void)aDrive;
<a name="l00092"></a>00092   <span class="keywordflow">if</span> (errCode) {
<a name="l00093"></a>00093     <span class="comment">// We are not really expecting any errors here, not any that are</span>
<a name="l00094"></a>00094     <span class="comment">// in the API docs, anyway.</span>
<a name="l00095"></a>00095     <a class="code" href="logging__c_8h.html#abea298723ad956e744c9efec71512dd0">logg</a>(<span class="stringliteral">&quot;unexpected error in disk observer: %d&quot;</span>, errCode);
<a name="l00096"></a>00096   } <span class="keywordflow">else</span> {
<a name="l00097"></a>00097     <span class="comment">// There are a number of causes why we might get an</span>
<a name="l00098"></a>00098     <span class="comment">// RFs::NotifyDiskSpace() event, so we have to do some further</span>
<a name="l00099"></a>00099     <span class="comment">// checking here.</span>
<a name="l00100"></a>00100     TRAPD(errCode, CheckLoggingMediumReadyL(iFs));
<a name="l00101"></a>00101     <span class="keywordflow">if</span> (errCode) {
<a name="l00102"></a>00102       <span class="comment">// One issue here is that we do not really know if it is safe to</span>
<a name="l00103"></a>00103       <span class="comment">// try to log this error to the database. Possibly not, so the</span>
<a name="l00104"></a>00104       <span class="comment">// debug log, if any, shall have to do.</span>
<a name="l00105"></a>00105       ex_txtlog_error(errCode);
<a name="l00106"></a>00106       <span class="keywordflow">if</span> (errCode == KErrDiskFull) {
<a name="l00107"></a>00107   <a class="code" href="er__errors_8h.html#a50105793795d40d0be5c3f87385f2d36">er_fatal_disk_low</a>;
<a name="l00108"></a>00108       } <span class="keywordflow">else</span> {
<a name="l00109"></a>00109         <span class="comment">// A typical cause for getting here is attaching an USB cable,</span>
<a name="l00110"></a>00110         <span class="comment">// resulting in KErrNotReady (-18). Hence this visible message</span>
<a name="l00111"></a>00111         <span class="comment">// is somewhat appropriate.</span>
<a name="l00112"></a>00112   <a class="code" href="er__errors_8h.html#a42d796ef54b4e1f8e6bf49fd7eb461f6">er_fatal_disk_not_ready</a>;
<a name="l00113"></a>00113       }
<a name="l00114"></a>00114     }
<a name="l00115"></a>00115   }
<a name="l00116"></a>00116 }
<a name="l00117"></a>00117 
<a name="l00118"></a>00118 <span class="comment">// --------------------------------------------------</span>
<a name="l00119"></a>00119 <span class="comment">// network registration status observing</span>
<a name="l00120"></a>00120 <span class="comment">// --------------------------------------------------</span>
<a name="l00121"></a>00121 
<a name="l00122"></a>00122 <span class="comment">/***koog </span>
<a name="l00123"></a>00123 <span class="comment">(require codegen/symbian-cxx)</span>
<a name="l00124"></a>00124 <span class="comment">(ctor-defines/spec</span>
<a name="l00125"></a>00125 <span class="comment"> &quot;CRegistrationObserver&quot; ;; name</span>
<a name="l00126"></a>00126 <span class="comment"> &quot;&quot; ;; args</span>
<a name="l00127"></a>00127 <span class="comment"> &quot;&quot; ;; inits</span>
<a name="l00128"></a>00128 <span class="comment"> &quot;&quot; ;; ctor</span>
<a name="l00129"></a>00129 <span class="comment"> #t ;; ConstructL</span>
<a name="l00130"></a>00130 <span class="comment">)</span>
<a name="l00131"></a>00131 <span class="comment"> ***/</span>
<a name="l00132"></a><a class="code" href="kr__plat__ao__epoc_8cpp.html#a813a2bbaff6ad219e5bc3e753689ba2c">00132</a> <span class="preprocessor">#define CTOR_DECL_CRegistrationObserver  \</span>
<a name="l00133"></a>00133 <span class="preprocessor">public: static CRegistrationObserver* NewLC(); \</span>
<a name="l00134"></a>00134 <span class="preprocessor">public: static CRegistrationObserver* NewL(); \</span>
<a name="l00135"></a>00135 <span class="preprocessor">private: CRegistrationObserver(); \</span>
<a name="l00136"></a>00136 <span class="preprocessor">private: void ConstructL();</span>
<a name="l00137"></a>00137 <span class="preprocessor"></span>
<a name="l00138"></a><a class="code" href="kr__plat__ao__epoc_8cpp.html#a30b15202ac2cbb724e2581c265cfad49">00138</a> <span class="preprocessor">#define CTOR_IMPL_CRegistrationObserver  \</span>
<a name="l00139"></a>00139 <span class="preprocessor">CRegistrationObserver* CRegistrationObserver::NewLC() \</span>
<a name="l00140"></a>00140 <span class="preprocessor">{ \</span>
<a name="l00141"></a>00141 <span class="preprocessor">  CRegistrationObserver* obj = new (ELeave) CRegistrationObserver(); \</span>
<a name="l00142"></a>00142 <span class="preprocessor">  CleanupStack::PushL(obj); \</span>
<a name="l00143"></a>00143 <span class="preprocessor">  obj-&gt;ConstructL(); \</span>
<a name="l00144"></a>00144 <span class="preprocessor">  return obj; \</span>
<a name="l00145"></a>00145 <span class="preprocessor">} \</span>
<a name="l00146"></a>00146 <span class="preprocessor"> \</span>
<a name="l00147"></a>00147 <span class="preprocessor">CRegistrationObserver* CRegistrationObserver::NewL() \</span>
<a name="l00148"></a>00148 <span class="preprocessor">{ \</span>
<a name="l00149"></a>00149 <span class="preprocessor">  CRegistrationObserver* obj = CRegistrationObserver::NewLC(); \</span>
<a name="l00150"></a>00150 <span class="preprocessor">  CleanupStack::Pop(obj); \</span>
<a name="l00151"></a>00151 <span class="preprocessor">  return obj; \</span>
<a name="l00152"></a>00152 <span class="preprocessor">} \</span>
<a name="l00153"></a>00153 <span class="preprocessor"> \</span>
<a name="l00154"></a>00154 <span class="preprocessor">CRegistrationObserver::CRegistrationObserver() \</span>
<a name="l00155"></a>00155 <span class="preprocessor">{}</span>
<a name="l00156"></a>00156 <span class="preprocessor"></span><span class="comment">/***end***/</span>
<a name="l00157"></a>00157 
<a name="l00158"></a>00158 <span class="preprocessor">#define This CRegistrationObserver</span>
<a name="l00159"></a>00159 <span class="preprocessor"></span>
<a name="l00160"></a><a class="code" href="classCRegistrationObserver.html">00160</a> NONSHARABLE_CLASS(<a class="code" href="kr__plat__ao__epoc_8cpp.html#a02da52732f9927e329ea1fc6a2a7b143">This</a>) : 
<a name="l00161"></a>00161   public <a class="code" href="classCBase.html">CBase</a>, 
<a name="l00162"></a>00162   public <a class="code" href="classMObserverObs__NetworkRegistration.html">MObserverObs_NetworkRegistration</a>
<a name="l00163"></a>00163 {
<a name="l00164"></a><a class="code" href="classCRegistrationObserver.html#abe1e255c7ba29dca58fe8c8fde400633">00164</a>   <a class="code" href="kr__plat__ao__epoc_8cpp.html#a813a2bbaff6ad219e5bc3e753689ba2c">CTOR_DECL_CRegistrationObserver</a>;
<a name="l00165"></a>00165 
<a name="l00166"></a>00166  <span class="keyword">public</span>:
<a name="l00167"></a>00167   ~<a class="code" href="classCRegistrationObserver.html">CRegistrationObserver</a>();
<a name="l00168"></a>00168 
<a name="l00169"></a>00169  <span class="keyword">private</span>:
<a name="l00170"></a>00170   <span class="keyword">virtual</span> <span class="keywordtype">void</span> ObservedData_NetworkRegistration(<a class="code" href="ut__telephony__epoc_8h.html#a23813d4cb92368975d91ad067f67ca6a">TData_NetworkRegistration</a> <span class="keyword">const</span> &amp;aData);
<a name="l00171"></a>00171   <span class="keyword">virtual</span> <span class="keywordtype">void</span> Failed_NetworkRegistration(TInt aError);
<a name="l00172"></a>00172   <span class="keyword">virtual</span> <span class="keywordtype">void</span> InFlightMode_NetworkRegistration();
<a name="l00173"></a>00173 
<a name="l00174"></a>00174  <span class="keyword">private</span>:
<a name="l00175"></a><a class="code" href="classCRegistrationObserver.html#a80638b8eea8c22f53df20d9581cf5879">00175</a>   <a class="code" href="classCObserverAo__NetworkRegistration.html">CObserverAo_NetworkRegistration</a>* iObserver;
<a name="l00176"></a>00176 };
<a name="l00177"></a>00177 
<a name="l00178"></a><a class="code" href="kr__plat__ao__epoc_8cpp.html#ae155c46da860c4d8087258e4627b3b7e">00178</a> <a class="code" href="kr__plat__ao__epoc_8cpp.html#a30b15202ac2cbb724e2581c265cfad49">CTOR_IMPL_CRegistrationObserver</a>;
<a name="l00179"></a>00179 
<a name="l00180"></a>00180 <span class="keywordtype">void</span> This::ConstructL()
<a name="l00181"></a>00181 {
<a name="l00182"></a>00182   <a class="code" href="struct__ac__AppContext.html">ac_AppContext</a>* ac = <a class="code" href="ac__app__context_8cpp.html#a1e998323bbb14fe0db635365e82ee9dc">ac_get_global_AppContext</a>();
<a name="l00183"></a>00183 
<a name="l00184"></a>00184   iObserver = <a class="code" href="classCObserverAo__NetworkRegistration.html#aa125066ceb416a145f5c8ce20082c64d">CObserverAo_NetworkRegistration::NewL</a>(ac, *<span class="keyword">this</span>);
<a name="l00185"></a>00185 }
<a name="l00186"></a>00186 
<a name="l00187"></a>00187 This::~CRegistrationObserver()
<a name="l00188"></a>00188 {
<a name="l00189"></a>00189   <span class="keyword">delete</span> iObserver;
<a name="l00190"></a>00190 }
<a name="l00191"></a>00191 
<a name="l00192"></a>00192 <span class="keywordtype">void</span> This::ObservedData_NetworkRegistration(<a class="code" href="ut__telephony__epoc_8h.html#a23813d4cb92368975d91ad067f67ca6a">TData_NetworkRegistration</a> <span class="keyword">const</span> &amp;aData)
<a name="l00193"></a>00193 {
<a name="l00194"></a>00194   <span class="keywordtype">int</span> status = aData.iRegStatus;
<a name="l00195"></a>00195   <a class="code" href="logging__c_8h.html#abea298723ad956e744c9efec71512dd0">logg</a>(<span class="stringliteral">&quot;network registration status: %d&quot;</span>, status);
<a name="l00196"></a>00196   <a class="code" href="struct__LogDb.html">LogDb</a>* logDb = <a class="code" href="ac__app__context_8h.html#aacd0e420aa8cad59d1073b70d614e481">ac_global_LogDb</a>;
<a name="l00197"></a>00197   <span class="keywordflow">if</span> (logDb) {
<a name="l00198"></a>00198     log_db_log_registration(logDb, status, NULL);
<a name="l00199"></a>00199   }
<a name="l00200"></a>00200 }
<a name="l00201"></a>00201 
<a name="l00202"></a>00202 <span class="keywordtype">void</span> This::Failed_NetworkRegistration(TInt aError)
<a name="l00203"></a>00203 {
<a name="l00204"></a>00204   <a class="code" href="er__errors_8h.html#a008602962ee67e8048c9eec8828e2258">er_log_symbian</a>(0, aError, 
<a name="l00205"></a>00205      <span class="stringliteral">&quot;network registration status query failure (giving up)&quot;</span>);
<a name="l00206"></a>00206 }
<a name="l00207"></a>00207 
<a name="l00208"></a>00208 <span class="keywordtype">void</span> This::InFlightMode_NetworkRegistration()
<a name="l00209"></a>00209 {
<a name="l00210"></a>00210   <a class="code" href="logging__c_8h.html#a919260af80d8c36d20780bd23f20fa5a">logt</a>(<span class="stringliteral">&quot;network registration observer sleeping (flight mode)&quot;</span>);
<a name="l00211"></a>00211 }
<a name="l00212"></a>00212 
<a name="l00213"></a>00213 <span class="preprocessor">#undef This</span>
<a name="l00214"></a>00214 <span class="preprocessor"></span>
<a name="l00215"></a>00215 <span class="comment">// --------------------------------------------------</span>
<a name="l00216"></a>00216 <span class="comment">// network information observing</span>
<a name="l00217"></a>00217 <span class="comment">// --------------------------------------------------</span>
<a name="l00218"></a>00218 
<a name="l00219"></a>00219 <span class="comment">// In flight mode, we have been seeing KErrAccessDenied (-21). The</span>
<a name="l00220"></a>00220 <span class="comment">// current implementation avoids querying in flight mode.</span>
<a name="l00221"></a>00221 
<a name="l00222"></a>00222 <span class="comment">/***koog </span>
<a name="l00223"></a>00223 <span class="comment">(require codegen/symbian-cxx)</span>
<a name="l00224"></a>00224 <span class="comment">(ctor-defines/spec</span>
<a name="l00225"></a>00225 <span class="comment"> &quot;CNetworkObserver&quot; ;; name</span>
<a name="l00226"></a>00226 <span class="comment"> &quot;&quot; ;; args</span>
<a name="l00227"></a>00227 <span class="comment"> &quot;&quot; ;; inits</span>
<a name="l00228"></a>00228 <span class="comment"> &quot;&quot; ;; ctor</span>
<a name="l00229"></a>00229 <span class="comment"> #t ;; ConstructL</span>
<a name="l00230"></a>00230 <span class="comment">)</span>
<a name="l00231"></a>00231 <span class="comment"> ***/</span>
<a name="l00232"></a><a class="code" href="kr__plat__ao__epoc_8cpp.html#a471fe2306ea53d44115c98da44bc30ea">00232</a> <span class="preprocessor">#define CTOR_DECL_CNetworkObserver  \</span>
<a name="l00233"></a>00233 <span class="preprocessor">public: static CNetworkObserver* NewLC(); \</span>
<a name="l00234"></a>00234 <span class="preprocessor">public: static CNetworkObserver* NewL(); \</span>
<a name="l00235"></a>00235 <span class="preprocessor">private: CNetworkObserver(); \</span>
<a name="l00236"></a>00236 <span class="preprocessor">private: void ConstructL();</span>
<a name="l00237"></a>00237 <span class="preprocessor"></span>
<a name="l00238"></a><a class="code" href="kr__plat__ao__epoc_8cpp.html#ac1b2bd882906d9c45e2b6ecc21a70238">00238</a> <span class="preprocessor">#define CTOR_IMPL_CNetworkObserver  \</span>
<a name="l00239"></a>00239 <span class="preprocessor">CNetworkObserver* CNetworkObserver::NewLC() \</span>
<a name="l00240"></a>00240 <span class="preprocessor">{ \</span>
<a name="l00241"></a>00241 <span class="preprocessor">  CNetworkObserver* obj = new (ELeave) CNetworkObserver(); \</span>
<a name="l00242"></a>00242 <span class="preprocessor">  CleanupStack::PushL(obj); \</span>
<a name="l00243"></a>00243 <span class="preprocessor">  obj-&gt;ConstructL(); \</span>
<a name="l00244"></a>00244 <span class="preprocessor">  return obj; \</span>
<a name="l00245"></a>00245 <span class="preprocessor">} \</span>
<a name="l00246"></a>00246 <span class="preprocessor"> \</span>
<a name="l00247"></a>00247 <span class="preprocessor">CNetworkObserver* CNetworkObserver::NewL() \</span>
<a name="l00248"></a>00248 <span class="preprocessor">{ \</span>
<a name="l00249"></a>00249 <span class="preprocessor">  CNetworkObserver* obj = CNetworkObserver::NewLC(); \</span>
<a name="l00250"></a>00250 <span class="preprocessor">  CleanupStack::Pop(obj); \</span>
<a name="l00251"></a>00251 <span class="preprocessor">  return obj; \</span>
<a name="l00252"></a>00252 <span class="preprocessor">} \</span>
<a name="l00253"></a>00253 <span class="preprocessor"> \</span>
<a name="l00254"></a>00254 <span class="preprocessor">CNetworkObserver::CNetworkObserver() \</span>
<a name="l00255"></a>00255 <span class="preprocessor">{}</span>
<a name="l00256"></a>00256 <span class="preprocessor"></span><span class="comment">/***end***/</span>
<a name="l00257"></a>00257 
<a name="l00258"></a>00258 <span class="preprocessor">#define This CNetworkObserver</span>
<a name="l00259"></a>00259 <span class="preprocessor"></span>
<a name="l00260"></a><a class="code" href="classCNetworkObserver.html">00260</a> NONSHARABLE_CLASS(<a class="code" href="kr__plat__ao__epoc_8cpp.html#a02da52732f9927e329ea1fc6a2a7b143">This</a>) : 
<a name="l00261"></a>00261   public <a class="code" href="classCBase.html">CBase</a>, 
<a name="l00262"></a>00262   public <a class="code" href="classMObserverObs__NetworkInfo.html">MObserverObs_NetworkInfo</a>
<a name="l00263"></a>00263 {
<a name="l00264"></a><a class="code" href="classCNetworkObserver.html#a8c1ae9b10801fe779ef9f440ca336c27">00264</a>   <a class="code" href="kr__plat__ao__epoc_8cpp.html#a471fe2306ea53d44115c98da44bc30ea">CTOR_DECL_CNetworkObserver</a>;
<a name="l00265"></a>00265 
<a name="l00266"></a>00266  <span class="keyword">public</span>:
<a name="l00267"></a>00267   ~<a class="code" href="classCNetworkObserver.html">CNetworkObserver</a>();
<a name="l00268"></a>00268 
<a name="l00269"></a>00269  <span class="keyword">private</span>:
<a name="l00270"></a>00270   <span class="keyword">virtual</span> <span class="keywordtype">void</span> ObservedData_NetworkInfo(<a class="code" href="ut__telephony__epoc_8h.html#a68678b4ed0136d1686581960bf7886a9">TData_NetworkInfo</a> <span class="keyword">const</span> &amp;aData);
<a name="l00271"></a>00271   <span class="keyword">virtual</span> <span class="keywordtype">void</span> ReportTransientError_NetworkInfo(TInt aError);
<a name="l00272"></a>00272   <span class="keyword">virtual</span> <span class="keywordtype">void</span> RetriesExhausted_NetworkInfo();
<a name="l00273"></a>00273   <span class="keyword">virtual</span> <span class="keywordtype">void</span> InFlightMode_NetworkInfo();
<a name="l00274"></a>00274 
<a name="l00275"></a>00275  <span class="keyword">private</span>:
<a name="l00276"></a><a class="code" href="classCNetworkObserver.html#a95368f47b4a34954be36498544db7081">00276</a>   <a class="code" href="classCObserverAo__NetworkInfo.html">CObserverAo_NetworkInfo</a>* iObserver;
<a name="l00277"></a><a class="code" href="classCNetworkObserver.html#ac19a9ca939a0a96aa1c779608410e04d">00277</a>   <a class="code" href="ut__telephony__epoc_8h.html#a68678b4ed0136d1686581960bf7886a9">TData_NetworkInfo</a> iOldData;
<a name="l00278"></a><a class="code" href="classCNetworkObserver.html#adc2e6cb3cc94a656a69e1349fcbb3c22">00278</a>   <a class="code" href="ut__telephony__epoc_8h.html#a68678b4ed0136d1686581960bf7886a9">TData_NetworkInfo</a> iFlightModeData;
<a name="l00279"></a>00279 };
<a name="l00280"></a>00280 
<a name="l00281"></a><a class="code" href="kr__plat__ao__epoc_8cpp.html#a287309f1a8be669a2415f89757f3defc">00281</a> <a class="code" href="kr__plat__ao__epoc_8cpp.html#ac1b2bd882906d9c45e2b6ecc21a70238">CTOR_IMPL_CNetworkObserver</a>;
<a name="l00282"></a>00282 
<a name="l00283"></a>00283 <span class="keywordtype">void</span> This::ConstructL()
<a name="l00284"></a>00284 {
<a name="l00285"></a>00285   <span class="comment">// The default constructor basically gives us what we want, but we</span>
<a name="l00286"></a>00286   <span class="comment">// add the &quot;operator&quot; name to help us see from the logs what is</span>
<a name="l00287"></a>00287   <span class="comment">// going on.</span>
<a name="l00288"></a>00288   <a class="code" href="epoc-cl2app-clientserver_8hpp.html#a9a27538e88bd3e6a52ac1d1c3a2dacd7">_LIT</a>(KFlightModeText, <span class="stringliteral">&quot;(flight mode)&quot;</span>);
<a name="l00289"></a>00289   iFlightModeData.iLongName.Copy(KFlightModeText);
<a name="l00290"></a>00290 
<a name="l00291"></a>00291   <a class="code" href="struct__ac__AppContext.html">ac_AppContext</a>* ac = <a class="code" href="ac__app__context_8cpp.html#a1e998323bbb14fe0db635365e82ee9dc">ac_get_global_AppContext</a>();
<a name="l00292"></a>00292   iObserver = <a class="code" href="classCObserverAo__NetworkInfo.html#abc1aa66b87291746c17cbd77e26ebf91">CObserverAo_NetworkInfo::NewL</a>(ac, *<span class="keyword">this</span>);
<a name="l00293"></a>00293 }
<a name="l00294"></a>00294 
<a name="l00295"></a>00295 This::~CNetworkObserver()
<a name="l00296"></a>00296 {
<a name="l00297"></a>00297   <span class="keyword">delete</span> iObserver;
<a name="l00298"></a>00298 }
<a name="l00299"></a>00299 
<a name="l00300"></a>00300 <span class="keywordtype">void</span> This::ObservedData_NetworkInfo(<a class="code" href="ut__telephony__epoc_8h.html#a68678b4ed0136d1686581960bf7886a9">TData_NetworkInfo</a> <span class="keyword">const</span> &amp;aData)
<a name="l00301"></a>00301 {
<a name="l00302"></a>00302   <span class="comment">// Log operator long name, if it has changed.</span>
<a name="l00303"></a>00303   {
<a name="l00304"></a>00304     <span class="keywordflow">if</span> (aData.iLongName != iOldData.iLongName) {
<a name="l00305"></a>00305       <a class="code" href="struct__LogDb.html">LogDb</a>* logDb = <a class="code" href="ac__app__context_8h.html#aacd0e420aa8cad59d1073b70d614e481">ac_global_LogDb</a>;
<a name="l00306"></a>00306       HBufC8* text8 = ConvToUtf8ZL(aData.iLongName);
<a name="l00307"></a>00307       CleanupStack::PushL(text8);
<a name="l00308"></a>00308       <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;operator: name &apos;%s&apos;&quot;</span>, (<span class="keywordtype">char</span>*)text8-&gt;Ptr());
<a name="l00309"></a>00309       log_db_log_operator(logDb, (<span class="keyword">const</span> <span class="keywordtype">char</span>*)text8-&gt;Ptr(), NULL);
<a name="l00310"></a>00310       <a class="code" href="kr__controller_8c.html#a6aba71b58fa46f96bad7b9ce44527c4d">kr_Controller_set_operator_name</a>(<a class="code" href="ac__app__context_8h.html#a47b97ec802bb43ac191fba2ded912f03">ac_global_Controller</a>, 
<a name="l00311"></a>00311               (<span class="keyword">const</span> <span class="keywordtype">char</span>*)text8-&gt;Ptr());
<a name="l00312"></a>00312       CleanupStack::PopAndDestroy(text8);
<a name="l00313"></a>00313     }
<a name="l00314"></a>00314   }
<a name="l00315"></a>00315 
<a name="l00316"></a>00316   <span class="comment">// Propagate any changed mobile network country code.</span>
<a name="l00317"></a>00317   <span class="keywordflow">if</span> (iOldData.iCountryCode != aData.iCountryCode) {
<a name="l00318"></a>00318     TLex lex(aData.iCountryCode);
<a name="l00319"></a>00319     <span class="keywordtype">int</span> mcc;
<a name="l00320"></a>00320     TInt errCode = lex.Val(mcc);
<a name="l00321"></a>00321     <span class="keywordflow">if</span> (errCode) 
<a name="l00322"></a>00322       <span class="comment">// Unexpected MCC.</span>
<a name="l00323"></a>00323       mcc = -1;
<a name="l00324"></a>00324     <span class="comment">// Notify interested parties.</span>
<a name="l00325"></a>00325     <a class="code" href="kr__controller_8c.html#a17ffc4b4ba38da077a8be7a0e8d03ef7">kr_Controller_set_current_mcc</a>(<a class="code" href="ac__app__context_8h.html#a47b97ec802bb43ac191fba2ded912f03">ac_global_Controller</a>, mcc);
<a name="l00326"></a>00326   }
<a name="l00327"></a>00327 
<a name="l00328"></a>00328   <span class="comment">// Post data for those interested in GSM cell ID changes.</span>
<a name="l00329"></a>00329   <span class="keywordflow">if</span> ((iOldData.iCountryCode != aData.iCountryCode) ||
<a name="l00330"></a>00330       (iOldData.iNetworkId != aData.iNetworkId) ||
<a name="l00331"></a>00331       (iOldData.iLocationAreaCode != aData.iLocationAreaCode) ||
<a name="l00332"></a>00332       (iOldData.iCellId != aData.iCellId)) {
<a name="l00333"></a>00333     <a class="code" href="bb__blackboard_8cpp.html#a1cf3488fe2427796e6862dd4799301f7">bb_Blackboard_notify</a>(<a class="code" href="ac__app__context_8h.html#a97a19629a1eaca64ac8add20b98a3ff7">ac_global_Blackboard</a>,
<a name="l00334"></a>00334        <a class="code" href="bb__blackboard_8h.html#a222fef21537286535b17c6146c9b2d3ca1d3ad06d53b2bf9996779ce43971c1cb">bb_dt_cell_id</a>,
<a name="l00335"></a>00335        (gpointer)&amp;aData, 0);
<a name="l00336"></a>00336   }
<a name="l00337"></a>00337 
<a name="l00338"></a>00338   iOldData = aData;
<a name="l00339"></a>00339 
<a name="l00340"></a>00340   <a class="code" href="bb__blackboard_8cpp.html#a1cf3488fe2427796e6862dd4799301f7">bb_Blackboard_notify</a>(<a class="code" href="ac__app__context_8h.html#a97a19629a1eaca64ac8add20b98a3ff7">ac_global_Blackboard</a>,
<a name="l00341"></a>00341            <a class="code" href="bb__blackboard_8h.html#a222fef21537286535b17c6146c9b2d3ca28042cf02023ed08035067ddc52d7d94">bb_dt_network_info</a>,
<a name="l00342"></a>00342            (gpointer)&amp;aData, 0);
<a name="l00343"></a>00343 }
<a name="l00344"></a>00344 
<a name="l00345"></a>00345 <span class="keywordtype">void</span> This::ReportTransientError_NetworkInfo(TInt aError)
<a name="l00346"></a>00346 {
<a name="l00347"></a>00347   <a class="code" href="er__errors_8h.html#a008602962ee67e8048c9eec8828e2258">er_log_symbian</a>(0, aError, <span class="stringliteral">&quot;network info query failure (transient)&quot;</span>);
<a name="l00348"></a>00348 }
<a name="l00349"></a>00349 
<a name="l00350"></a>00350 <span class="keywordtype">void</span> This::RetriesExhausted_NetworkInfo()
<a name="l00351"></a>00351 {
<a name="l00352"></a>00352   <a class="code" href="er__errors_8h.html#a38fb855b186279a938f48b0407296a29">er_log_none</a>(<a class="code" href="er__errors_8h.html#a74b7465a12d63ad80bc10d1ebaf900d8">er_FATAL</a>, <span class="stringliteral">&quot;network info queries failing&quot;</span>);
<a name="l00353"></a>00353 }
<a name="l00354"></a>00354 
<a name="l00355"></a>00355 <span class="keywordtype">void</span> This::InFlightMode_NetworkInfo()
<a name="l00356"></a>00356 {
<a name="l00357"></a>00357   <a class="code" href="logging__c_8h.html#a919260af80d8c36d20780bd23f20fa5a">logt</a>(<span class="stringliteral">&quot;network info observer sleeping (flight mode)&quot;</span>);
<a name="l00358"></a>00358   ObservedData_NetworkInfo(iFlightModeData);
<a name="l00359"></a>00359 }
<a name="l00360"></a>00360 
<a name="l00361"></a>00361 <span class="preprocessor">#undef This</span>
<a name="l00362"></a>00362 <span class="preprocessor"></span>
<a name="l00363"></a>00363 <span class="comment">// --------------------------------------------------</span>
<a name="l00364"></a>00364 <span class="comment">// network signal strength observing</span>
<a name="l00365"></a>00365 <span class="comment">// --------------------------------------------------</span>
<a name="l00366"></a>00366 
<a name="l00367"></a>00367 <span class="comment">/* We require retries here in particular, as we have seen KErrOverflow frequently. In fact we have had enough many failures so as to run out of retries.</span>
<a name="l00368"></a>00368 <span class="comment"></span>
<a name="l00369"></a>00369 <span class="comment">   xxx Should find out why this is, if there are conditions under which it is not okay to make this query. Cannot find any information about the cause, but something to account for is that &quot;this functionality is not available when the phone is in flight mode&quot;.</span>
<a name="l00370"></a>00370 <span class="comment"></span>
<a name="l00371"></a>00371 <span class="comment">   We try to account for the above by observing flightmode status, and refraining from making requests (or having outstanding requests) when flightmode is on. We shall see if this addresses the issue.</span>
<a name="l00372"></a>00372 <span class="comment"></span>
<a name="l00373"></a>00373 <span class="comment">   xxx Could more easily implement based on CObserverAo_SignalStrength.</span>
<a name="l00374"></a>00374 <span class="comment">*/</span>
<a name="l00375"></a>00375 
<a name="l00376"></a>00376 <span class="comment">/***koog </span>
<a name="l00377"></a>00377 <span class="comment">(require codegen/symbian-cxx)</span>
<a name="l00378"></a>00378 <span class="comment">(ctor-defines/spec</span>
<a name="l00379"></a>00379 <span class="comment"> &quot;CSignalObserver&quot; ;; name</span>
<a name="l00380"></a>00380 <span class="comment"> &quot;&quot; ;; args</span>
<a name="l00381"></a>00381 <span class="comment"> &quot;&quot; ;; inits</span>
<a name="l00382"></a>00382 <span class="comment"> &quot;&quot; ;; ctor</span>
<a name="l00383"></a>00383 <span class="comment"> #t ;; ConstructL</span>
<a name="l00384"></a>00384 <span class="comment">)</span>
<a name="l00385"></a>00385 <span class="comment"> ***/</span>
<a name="l00386"></a><a class="code" href="kr__plat__ao__epoc_8cpp.html#a5ee621829a4f3dd72cfad686fa8043dc">00386</a> <span class="preprocessor">#define CTOR_DECL_CSignalObserver  \</span>
<a name="l00387"></a>00387 <span class="preprocessor">public: static CSignalObserver* NewLC(); \</span>
<a name="l00388"></a>00388 <span class="preprocessor">public: static CSignalObserver* NewL(); \</span>
<a name="l00389"></a>00389 <span class="preprocessor">private: CSignalObserver(); \</span>
<a name="l00390"></a>00390 <span class="preprocessor">private: void ConstructL();</span>
<a name="l00391"></a>00391 <span class="preprocessor"></span>
<a name="l00392"></a><a class="code" href="kr__plat__ao__epoc_8cpp.html#ac550b54fb693a75dc4196de6933533a7">00392</a> <span class="preprocessor">#define CTOR_IMPL_CSignalObserver  \</span>
<a name="l00393"></a>00393 <span class="preprocessor">CSignalObserver* CSignalObserver::NewLC() \</span>
<a name="l00394"></a>00394 <span class="preprocessor">{ \</span>
<a name="l00395"></a>00395 <span class="preprocessor">  CSignalObserver* obj = new (ELeave) CSignalObserver(); \</span>
<a name="l00396"></a>00396 <span class="preprocessor">  CleanupStack::PushL(obj); \</span>
<a name="l00397"></a>00397 <span class="preprocessor">  obj-&gt;ConstructL(); \</span>
<a name="l00398"></a>00398 <span class="preprocessor">  return obj; \</span>
<a name="l00399"></a>00399 <span class="preprocessor">} \</span>
<a name="l00400"></a>00400 <span class="preprocessor"> \</span>
<a name="l00401"></a>00401 <span class="preprocessor">CSignalObserver* CSignalObserver::NewL() \</span>
<a name="l00402"></a>00402 <span class="preprocessor">{ \</span>
<a name="l00403"></a>00403 <span class="preprocessor">  CSignalObserver* obj = CSignalObserver::NewLC(); \</span>
<a name="l00404"></a>00404 <span class="preprocessor">  CleanupStack::Pop(obj); \</span>
<a name="l00405"></a>00405 <span class="preprocessor">  return obj; \</span>
<a name="l00406"></a>00406 <span class="preprocessor">} \</span>
<a name="l00407"></a>00407 <span class="preprocessor"> \</span>
<a name="l00408"></a>00408 <span class="preprocessor">CSignalObserver::CSignalObserver() \</span>
<a name="l00409"></a>00409 <span class="preprocessor">{}</span>
<a name="l00410"></a>00410 <span class="preprocessor"></span><span class="comment">/***end***/</span>
<a name="l00411"></a>00411 
<a name="l00412"></a><a class="code" href="kr__plat__ao__epoc_8cpp.html#a02da52732f9927e329ea1fc6a2a7b143">00412</a> <span class="preprocessor">#define This CSignalObserver</span>
<a name="l00413"></a>00413 <span class="preprocessor"></span>
<a name="l00414"></a><a class="code" href="classCSignalObserver.html">00414</a> NONSHARABLE_CLASS(<a class="code" href="kr__plat__ao__epoc_8cpp.html#a02da52732f9927e329ea1fc6a2a7b143">This</a>) : 
<a name="l00415"></a>00415   public <a class="code" href="classCBase.html">CBase</a>, 
<a name="l00416"></a>00416   public <a class="code" href="classMGetterObs__SignalStrength.html">MGetterObs_SignalStrength</a>,
<a name="l00417"></a>00417   public <a class="code" href="classMNotifyObs__SignalStrength.html">MNotifyObs_SignalStrength</a>,
<a name="l00418"></a>00418   public <a class="code" href="classMRetryAoObserver.html">MRetryAoObserver</a>
<a name="l00419"></a>00419 {
<a name="l00420"></a><a class="code" href="classCSignalObserver.html#adb9de6754c4c799b2e43b9f85497abe7">00420</a>   <a class="code" href="kr__plat__ao__epoc_8cpp.html#a5ee621829a4f3dd72cfad686fa8043dc">CTOR_DECL_CSignalObserver</a>;
<a name="l00421"></a>00421 
<a name="l00422"></a>00422  <span class="keyword">public</span>:
<a name="l00423"></a>00423   ~<a class="code" href="classCSignalObserver.html">CSignalObserver</a>();
<a name="l00424"></a>00424 
<a name="l00425"></a>00425  <span class="keyword">private</span>:
<a name="l00426"></a>00426   <span class="keyword">virtual</span> <span class="keywordtype">void</span> RetryTimerExpired(<a class="code" href="classCRetryAo.html">CRetryAo</a>* src, TInt errCode);
<a name="l00427"></a>00427   <span class="keyword">virtual</span> <span class="keywordtype">void</span> GotData_SignalStrength(TInt aError);
<a name="l00428"></a>00428   <span class="keyword">virtual</span> <span class="keywordtype">void</span> ChangedData_SignalStrength(TInt aError);
<a name="l00429"></a>00429   <span class="keywordtype">void</span> HandleSignal(TInt aError, <a class="code" href="ut__telephony__epoc_8h.html#aa48587b535539c949b7f2cad941a78d7">TData_SignalStrength</a> <span class="keyword">const</span> &amp; aData);
<a name="l00430"></a>00430 
<a name="l00431"></a>00431  <span class="keyword">private</span>:
<a name="l00432"></a><a class="code" href="classCSignalObserver.html#a856e173f5017be01fed31de35da208fa">00432</a>   <a class="code" href="classCRetryAo.html">CRetryAo</a>* iRetryAo;
<a name="l00433"></a><a class="code" href="classCSignalObserver.html#ab0dafccfa96f0726c3cbb315834a640d">00433</a>   TBool iGetterDone;
<a name="l00434"></a><a class="code" href="classCSignalObserver.html#a4c391157590a85b9dd88e11dd8f4a6c6">00434</a>   <a class="code" href="classCGetterAo__SignalStrength.html">CGetterAo_SignalStrength</a>* iGetter;
<a name="l00435"></a><a class="code" href="classCSignalObserver.html#a0b2e1846042eb7928fb29f5f88c49d9a">00435</a>   <a class="code" href="classCNotifyAo__SignalStrength.html">CNotifyAo_SignalStrength</a>* iNotifier;
<a name="l00436"></a>00436 
<a name="l00437"></a>00437  <span class="keyword">private</span>:
<a name="l00438"></a>00438   <span class="keywordtype">void</span> MakeRequest();
<a name="l00439"></a>00439   <span class="keywordtype">void</span> Cancel();
<a name="l00440"></a>00440 
<a name="l00441"></a>00441   <span class="comment">// Flight mode observation.</span>
<a name="l00442"></a>00442  <span class="keyword">private</span>:
<a name="l00443"></a><a class="code" href="classCSignalObserver.html#aa18d5d68b9bb1205616168290df20529">00443</a>   <a class="code" href="structbb__Closure.html">bb_Closure</a> iClosure;
<a name="l00444"></a>00444   <span class="keywordtype">void</span> BbRegisterL();
<a name="l00445"></a>00445   <span class="keywordtype">void</span> BbUnregister();
<a name="l00446"></a>00446   TBool GetFlightMode();
<a name="l00447"></a>00447  <span class="keyword">public</span>:
<a name="l00448"></a>00448   <span class="keywordtype">void</span> HandleFlightModeChange();
<a name="l00449"></a>00449 };
<a name="l00450"></a>00450 
<a name="l00451"></a><a class="code" href="kr__plat__ao__epoc_8cpp.html#a71c230f6d612372e748243e6c47708d7">00451</a> <a class="code" href="kr__plat__ao__epoc_8cpp.html#ac550b54fb693a75dc4196de6933533a7">CTOR_IMPL_CSignalObserver</a>;
<a name="l00452"></a>00452 
<a name="l00453"></a>00453 <span class="keywordtype">void</span> This::MakeRequest()
<a name="l00454"></a>00454 {
<a name="l00455"></a>00455   <span class="keywordflow">if</span> (iGetterDone)
<a name="l00456"></a>00456     iNotifier-&gt;MakeRequest();
<a name="l00457"></a>00457   <span class="keywordflow">else</span>
<a name="l00458"></a>00458     iGetter-&gt;MakeRequest();
<a name="l00459"></a>00459 }
<a name="l00460"></a>00460 
<a name="l00461"></a>00461 <span class="keywordtype">void</span> This::Cancel()
<a name="l00462"></a>00462 {
<a name="l00463"></a>00463   iRetryAo-&gt;Cancel();
<a name="l00464"></a>00464   iNotifier-&gt;Cancel();
<a name="l00465"></a>00465   iGetter-&gt;Cancel();
<a name="l00466"></a>00466 
<a name="l00467"></a>00467   iRetryAo-&gt;ResetFailures();
<a name="l00468"></a>00468 
<a name="l00469"></a>00469   <span class="comment">// Once we begin observing again, we want a reading immediately,</span>
<a name="l00470"></a>00470   <span class="comment">// rather than waiting for a change in readings.</span>
<a name="l00471"></a>00471   iGetterDone = EFalse;
<a name="l00472"></a>00472 }
<a name="l00473"></a>00473 
<a name="l00474"></a>00474 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="kr__plat__ao__epoc_8cpp.html#a9bc4f4a090fa96272409959e7bf61a4f">SignalObserverFlightModeChanged</a>
<a name="l00475"></a><a class="code" href="kr__plat__ao__epoc_8cpp.html#a9bc4f4a090fa96272409959e7bf61a4f">00475</a> (<a class="code" href="struct__bb__Blackboard.html">bb_Blackboard</a>* bb, <span class="keyword">enum</span> <a class="code" href="bb__blackboard_8h.html#a222fef21537286535b17c6146c9b2d3c">bb_DataType</a> dt,
<a name="l00476"></a>00476  gpointer data, <span class="keywordtype">int</span> len, gpointer arg)
<a name="l00477"></a>00477 {
<a name="l00478"></a>00478   (void)dt;
<a name="l00479"></a>00479   (void)len;
<a name="l00480"></a>00480   <a class="code" href="kr__plat__ao__epoc_8cpp.html#a02da52732f9927e329ea1fc6a2a7b143">This</a>* <span class="keyword">self</span> = (<a class="code" href="kr__plat__ao__epoc_8cpp.html#a02da52732f9927e329ea1fc6a2a7b143">This</a>*)arg;
<a name="l00481"></a>00481   <span class="keyword">self</span>-&gt;HandleFlightModeChange();
<a name="l00482"></a>00482 }
<a name="l00483"></a>00483 
<a name="l00484"></a>00484 <span class="keywordtype">void</span> This::HandleFlightModeChange()
<a name="l00485"></a>00485 {
<a name="l00486"></a>00486   TBool fm = GetFlightMode();
<a name="l00487"></a>00487   <span class="keywordflow">if</span> (fm) {
<a name="l00488"></a>00488     Cancel();
<a name="l00489"></a>00489 
<a name="l00490"></a>00490     <span class="comment">// Notify with value +1 to indicate no signal.</span>
<a name="l00491"></a>00491     <a class="code" href="kr__controller_8c.html#a38cfd8c0a1f0868536a2904941f54676">kr_Controller_set_signal_strength</a>(<a class="code" href="ac__app__context_8h.html#a47b97ec802bb43ac191fba2ded912f03">ac_global_Controller</a>, 1);
<a name="l00492"></a>00492   } <span class="keywordflow">else</span> {
<a name="l00493"></a>00493     MakeRequest();
<a name="l00494"></a>00494   }
<a name="l00495"></a>00495 }
<a name="l00496"></a>00496 
<a name="l00497"></a>00497 TBool This::GetFlightMode()
<a name="l00498"></a>00498 {
<a name="l00499"></a>00499   <span class="comment">// Initial value (internal).</span>
<a name="l00500"></a>00500   <a class="code" href="struct__bb__Blackboard.html">bb_Blackboard</a>* bb = <a class="code" href="ac__app__context_8h.html#a97a19629a1eaca64ac8add20b98a3ff7">ac_global_Blackboard</a>;
<a name="l00501"></a>00501   <a class="code" href="structbb__Board.html">bb_Board</a>* bd = <a class="code" href="bb__blackboard_8cpp.html#a294701be39c14209dcaee7744b96402d">bb_Blackboard_board</a>(bb);
<a name="l00502"></a>00502   <span class="keywordflow">return</span> bd-&gt;<a class="code" href="structbb__Board.html#ab81e03d01f1f4993f3cfb99d4b709219">flightmode</a>;
<a name="l00503"></a>00503 }
<a name="l00504"></a>00504 
<a name="l00505"></a>00505 <span class="keywordtype">void</span> This::BbRegisterL()
<a name="l00506"></a>00506 {
<a name="l00507"></a>00507   <span class="comment">// Closure init.</span>
<a name="l00508"></a>00508   iClosure.changed = <a class="code" href="kr__plat__ao__epoc_8cpp.html#a9bc4f4a090fa96272409959e7bf61a4f">SignalObserverFlightModeChanged</a>;
<a name="l00509"></a>00509   iClosure.arg = <span class="keyword">this</span>;
<a name="l00510"></a>00510 
<a name="l00511"></a>00511   <span class="comment">// Registration proper.</span>
<a name="l00512"></a>00512   <a class="code" href="struct__bb__Blackboard.html">bb_Blackboard</a>* bb = <a class="code" href="ac__app__context_8h.html#a97a19629a1eaca64ac8add20b98a3ff7">ac_global_Blackboard</a>;
<a name="l00513"></a>00513   <span class="keywordflow">if</span> (!<a class="code" href="bb__blackboard_8cpp.html#ae56eaa4623aae09a8cf227a04765e23d">bb_Blackboard_register</a>(bb, <a class="code" href="bb__blackboard_8h.html#a222fef21537286535b17c6146c9b2d3ca0b93c86ed159d14198b4e17228138499">bb_dt_flightmode</a>, iClosure, NULL))
<a name="l00514"></a>00514     User::LeaveNoMemory();
<a name="l00515"></a>00515 }
<a name="l00516"></a>00516 
<a name="l00517"></a>00517 <span class="keywordtype">void</span> This::BbUnregister()
<a name="l00518"></a>00518 {
<a name="l00519"></a>00519   <a class="code" href="bb__blackboard_8cpp.html#acdc041c049bf2f36084ffaa1c5abd9c3">bb_Blackboard_unregister</a>(<a class="code" href="ac__app__context_8h.html#a97a19629a1eaca64ac8add20b98a3ff7">ac_global_Blackboard</a>, iClosure);
<a name="l00520"></a>00520 }
<a name="l00521"></a>00521 
<a name="l00522"></a>00522 <span class="keywordtype">void</span> This::ConstructL()
<a name="l00523"></a>00523 {
<a name="l00524"></a>00524   BbRegisterL();
<a name="l00525"></a>00525 
<a name="l00526"></a>00526   <a class="code" href="struct__ac__AppContext.html">ac_AppContext</a>* ac = <a class="code" href="ac__app__context_8cpp.html#a1e998323bbb14fe0db635365e82ee9dc">ac_get_global_AppContext</a>();
<a name="l00527"></a>00527 
<a name="l00528"></a>00528   iRetryAo = <a class="code" href="classCRetryAo.html#a9adeb0ac5b17844f42ee41d5558f85dd">CRetryAo::NewL</a>(*<span class="keyword">this</span>, 20, 60);
<a name="l00529"></a>00529 
<a name="l00530"></a>00530   iGetter = <span class="keyword">new</span> (ELeave) <a class="code" href="classCGetterAo__SignalStrength.html">CGetterAo_SignalStrength</a>(ac_Telephony(ac), *<span class="keyword">this</span>);
<a name="l00531"></a>00531   iNotifier = <span class="keyword">new</span> (ELeave) <a class="code" href="classCNotifyAo__SignalStrength.html">CNotifyAo_SignalStrength</a>(ac_Telephony(ac), *<span class="keyword">this</span>);
<a name="l00532"></a>00532 
<a name="l00533"></a>00533   TBool fm = GetFlightMode();
<a name="l00534"></a>00534   <span class="keywordflow">if</span> (!fm) {
<a name="l00535"></a>00535     <span class="comment">// We will not be getting any signal strength reading for as long</span>
<a name="l00536"></a>00536     <span class="comment">// as flightmode is on. Makes sense.</span>
<a name="l00537"></a>00537     MakeRequest();
<a name="l00538"></a>00538   }
<a name="l00539"></a>00539 }
<a name="l00540"></a>00540 
<a name="l00541"></a>00541 This::~CSignalObserver()
<a name="l00542"></a>00542 {
<a name="l00543"></a>00543   BbUnregister();
<a name="l00544"></a>00544   <span class="keyword">delete</span> iGetter;
<a name="l00545"></a>00545   <span class="keyword">delete</span> iNotifier;
<a name="l00546"></a>00546   <span class="keyword">delete</span> iRetryAo;
<a name="l00547"></a>00547 }
<a name="l00548"></a>00548 
<a name="l00549"></a>00549 <span class="keywordtype">void</span> This::RetryTimerExpired(<a class="code" href="classCRetryAo.html">CRetryAo</a>* src, TInt errCode)
<a name="l00550"></a>00550 {
<a name="l00551"></a>00551   (void)src;
<a name="l00552"></a>00552   <span class="keywordflow">if</span> (errCode) {
<a name="l00553"></a>00553     <a class="code" href="struct__LogDb.html">LogDb</a>* logDb = <a class="code" href="ac__app__context_8h.html#aacd0e420aa8cad59d1073b70d614e481">ac_global_LogDb</a>;
<a name="l00554"></a>00554     ex_dblog_fatal_error_msg(logDb, <span class="stringliteral">&quot;retry timer error&quot;</span>, errCode);
<a name="l00555"></a>00555   } <span class="keywordflow">else</span> {
<a name="l00556"></a>00556     MakeRequest();
<a name="l00557"></a>00557   }
<a name="l00558"></a>00558 }
<a name="l00559"></a>00559 
<a name="l00560"></a>00560 <span class="keywordtype">void</span> This::GotData_SignalStrength(TInt aError)
<a name="l00561"></a>00561 {
<a name="l00562"></a>00562   HandleSignal(aError, iGetter-&gt;Data());
<a name="l00563"></a>00563   <span class="keywordflow">if</span> (!aError) 
<a name="l00564"></a>00564     iGetterDone = ETrue;
<a name="l00565"></a>00565 }
<a name="l00566"></a>00566 
<a name="l00567"></a>00567 <span class="keywordtype">void</span> This::ChangedData_SignalStrength(TInt aError)
<a name="l00568"></a>00568 {
<a name="l00569"></a>00569   HandleSignal(aError, iNotifier-&gt;Data());
<a name="l00570"></a>00570 }
<a name="l00571"></a>00571 
<a name="l00572"></a>00572 <span class="keywordtype">void</span> This::HandleSignal(TInt aError, 
<a name="l00573"></a>00573       <a class="code" href="ut__telephony__epoc_8h.html#aa48587b535539c949b7f2cad941a78d7">TData_SignalStrength</a> <span class="keyword">const</span> &amp; aData)
<a name="l00574"></a>00574 {
<a name="l00575"></a>00575   <a class="code" href="struct__LogDb.html">LogDb</a>* logDb = <a class="code" href="ac__app__context_8h.html#aacd0e420aa8cad59d1073b70d614e481">ac_global_LogDb</a>;
<a name="l00576"></a>00576   <span class="keywordflow">if</span> (aError) {
<a name="l00577"></a>00577     ex_dblog_error_msg(logDb, <span class="stringliteral">&quot;signal strength query failure&quot;</span>, aError, NULL);
<a name="l00578"></a>00578     <span class="keywordflow">if</span> (!iRetryAo-&gt;Retry()) {
<a name="l00579"></a>00579       <a class="code" href="er__errors_8h.html#a38fb855b186279a938f48b0407296a29">er_log_none</a>(<a class="code" href="er__errors_8h.html#a74b7465a12d63ad80bc10d1ebaf900d8">er_FATAL</a>, <span class="stringliteral">&quot;signal strength queries failing&quot;</span>);
<a name="l00580"></a>00580     }
<a name="l00581"></a>00581   } <span class="keywordflow">else</span> {
<a name="l00582"></a>00582     iRetryAo-&gt;ResetFailures();
<a name="l00583"></a>00583 
<a name="l00584"></a>00584     <span class="keywordtype">int</span> dbm = -(aData.iSignalStrength);
<a name="l00585"></a>00585     <span class="keywordtype">int</span> bars = aData.iBar;
<a name="l00586"></a>00586     <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;signal: %d dBm (%d bars)&quot;</span>, dbm, bars);
<a name="l00587"></a>00587     log_db_log_signal(logDb, dbm, bars, NULL);
<a name="l00588"></a>00588     iNotifier-&gt;MakeRequest();
<a name="l00589"></a>00589 
<a name="l00590"></a>00590     <span class="comment">// Notify interested parties. Indiscriminately, receiver must</span>
<a name="l00591"></a>00591     <span class="comment">// check for duplicates.</span>
<a name="l00592"></a>00592     <a class="code" href="kr__controller_8c.html#a38cfd8c0a1f0868536a2904941f54676">kr_Controller_set_signal_strength</a>(<a class="code" href="ac__app__context_8h.html#a47b97ec802bb43ac191fba2ded912f03">ac_global_Controller</a>, dbm);
<a name="l00593"></a>00593   }
<a name="l00594"></a>00594 }
<a name="l00595"></a>00595 
<a name="l00596"></a>00596 <span class="preprocessor">#undef This</span>
<a name="l00597"></a>00597 <span class="preprocessor"></span>
<a name="l00598"></a>00598 <span class="comment">// --------------------------------------------------</span>
<a name="l00599"></a>00599 <span class="comment">// auxiliary controller</span>
<a name="l00600"></a>00600 <span class="comment">// --------------------------------------------------</span>
<a name="l00601"></a>00601 
<a name="l00602"></a><a class="code" href="struct__kr__PlatAo.html">00602</a> <span class="keyword">struct </span><a class="code" href="struct__kr__PlatAo.html">_kr_PlatAo</a> {
<a name="l00603"></a><a class="code" href="struct__kr__PlatAo.html#a9ccc8af2f6bb783fdebc67fc3e1f345f">00603</a>   <a class="code" href="classCDiskObserver.html">CDiskObserver</a>* <a class="code" href="struct__kr__PlatAo.html#a9ccc8af2f6bb783fdebc67fc3e1f345f">iDiskObserver</a>;
<a name="l00604"></a><a class="code" href="struct__kr__PlatAo.html#a312ff91c735c3d23e88bfcf4ff0f8d22">00604</a>   <a class="code" href="classCRegistrationObserver.html">CRegistrationObserver</a>* <a class="code" href="struct__kr__PlatAo.html#a312ff91c735c3d23e88bfcf4ff0f8d22">iRegistrationObserver</a>;
<a name="l00605"></a><a class="code" href="struct__kr__PlatAo.html#ad840d9f1c24346062199f8e201ba3fd5">00605</a>   <a class="code" href="classCNetworkObserver.html">CNetworkObserver</a>* <a class="code" href="struct__kr__PlatAo.html#ad840d9f1c24346062199f8e201ba3fd5">iNetworkObserver</a>;
<a name="l00606"></a><a class="code" href="struct__kr__PlatAo.html#ad4fa527c3f01e9cd3ee4ae024bc28a22">00606</a>   <a class="code" href="classCSignalObserver.html">CSignalObserver</a>* <a class="code" href="struct__kr__PlatAo.html#ad4fa527c3f01e9cd3ee4ae024bc28a22">iSignalObserver</a>;
<a name="l00607"></a><a class="code" href="struct__kr__PlatAo.html#a31b5f8fa6b72803c3ab9e3cbea139512">00607</a>   <a class="code" href="classCSmsTrigger.html">CSmsTrigger</a>* <a class="code" href="struct__kr__PlatAo.html#a31b5f8fa6b72803c3ab9e3cbea139512">iSmsTrigger</a>;
<a name="l00608"></a>00608 };
<a name="l00609"></a>00609 
<a name="l00610"></a><a class="code" href="kr__plat__ao__epoc_8cpp.html#aafbfa4510e682bee7f740151b2e01308">00610</a> <span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> kr_PlatAo* <a class="code" href="kr__plat__ao__epoc_8cpp.html#aafbfa4510e682bee7f740151b2e01308">kr_PlatAo_new</a>(GError** <a class="code" href="lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>)
<a name="l00611"></a>00611 {
<a name="l00612"></a>00612   <a class="code" href="struct__ac__AppContext.html">ac_AppContext</a>* ac = <a class="code" href="ac__app__context_8cpp.html#a1e998323bbb14fe0db635365e82ee9dc">ac_get_global_AppContext</a>();
<a name="l00613"></a>00613 
<a name="l00614"></a>00614   kr_PlatAo* <span class="keyword">self</span> = g_try_new0(kr_PlatAo, 1);
<a name="l00615"></a>00615   <span class="keywordflow">if</span> (G_UNLIKELY(!<span class="keyword">self</span>)) {
<a name="l00616"></a>00616     <span class="keywordflow">if</span> (error) *error = <a class="code" href="gxerror_8h.html#a850b0899a30e4dbf38df69e2d928c12b">gx_error_no_memory</a>;
<a name="l00617"></a>00617     <span class="keywordflow">return</span> NULL;
<a name="l00618"></a>00618   }
<a name="l00619"></a>00619 
<a name="l00620"></a>00620   TRAPD(errCode, self-&gt;iDiskObserver = CDiskObserver::NewL());
<a name="l00621"></a>00621   <span class="keywordflow">if</span> (G_UNLIKELY(errCode)) {
<a name="l00622"></a>00622     <a class="code" href="kr__plat__ao__epoc_8cpp.html#aae1984cae05ab56222b162f7749c949f">kr_PlatAo_destroy</a>(<span class="keyword">self</span>);
<a name="l00623"></a>00623     <span class="keywordflow">if</span> (error)
<a name="l00624"></a>00624       *error = <a class="code" href="gxerror_8c.html#a75e3ca4bc4d268c9470ec2c141fa4d47">gx_error_new</a>(<a class="code" href="error__list_8h.html#a38237953d0fe9867b523ebcb9ac69a71">domain_symbian</a>, errCode, 
<a name="l00625"></a>00625           <span class="stringliteral">&quot;disk observer creation failure: %s (%d)&quot;</span>, 
<a name="l00626"></a>00626           <a class="code" href="platform__error_8h.html#a323dca184bc375b591b6e2b3d7d7f05f">plat_error_strerror</a>(errCode), errCode);
<a name="l00627"></a>00627     <span class="keywordflow">return</span> NULL;
<a name="l00628"></a>00628   }
<a name="l00629"></a>00629 
<a name="l00630"></a>00630   TRAP(errCode, self-&gt;iRegistrationObserver = CRegistrationObserver::NewL());
<a name="l00631"></a>00631   <span class="keywordflow">if</span> (G_UNLIKELY(errCode)) {
<a name="l00632"></a>00632     <a class="code" href="kr__plat__ao__epoc_8cpp.html#aae1984cae05ab56222b162f7749c949f">kr_PlatAo_destroy</a>(<span class="keyword">self</span>);
<a name="l00633"></a>00633     <span class="keywordflow">if</span> (error)
<a name="l00634"></a>00634       *error = <a class="code" href="gxerror_8c.html#a75e3ca4bc4d268c9470ec2c141fa4d47">gx_error_new</a>(<a class="code" href="error__list_8h.html#a38237953d0fe9867b523ebcb9ac69a71">domain_symbian</a>, errCode, 
<a name="l00635"></a>00635           <span class="stringliteral">&quot;registration observer creation failure: %s (%d)&quot;</span>, 
<a name="l00636"></a>00636           <a class="code" href="platform__error_8h.html#a323dca184bc375b591b6e2b3d7d7f05f">plat_error_strerror</a>(errCode), errCode);
<a name="l00637"></a>00637     <span class="keywordflow">return</span> NULL;
<a name="l00638"></a>00638   }
<a name="l00639"></a>00639 
<a name="l00640"></a>00640 <span class="preprocessor">#if __CAN_GET_NETWORK_INFO__</span>
<a name="l00641"></a>00641 <span class="preprocessor"></span>  TRAP(errCode, self-&gt;iNetworkObserver = CNetworkObserver::NewL());
<a name="l00642"></a>00642   <span class="keywordflow">if</span> (G_UNLIKELY(errCode)) {
<a name="l00643"></a>00643     <a class="code" href="kr__plat__ao__epoc_8cpp.html#aae1984cae05ab56222b162f7749c949f">kr_PlatAo_destroy</a>(<span class="keyword">self</span>);
<a name="l00644"></a>00644     <span class="keywordflow">if</span> (error)
<a name="l00645"></a>00645       *error = <a class="code" href="gxerror_8c.html#a75e3ca4bc4d268c9470ec2c141fa4d47">gx_error_new</a>(<a class="code" href="error__list_8h.html#a38237953d0fe9867b523ebcb9ac69a71">domain_symbian</a>, errCode, 
<a name="l00646"></a>00646           <span class="stringliteral">&quot;network observer creation failure: %s (%d)&quot;</span>, 
<a name="l00647"></a>00647           <a class="code" href="platform__error_8h.html#a323dca184bc375b591b6e2b3d7d7f05f">plat_error_strerror</a>(errCode), errCode);
<a name="l00648"></a>00648     <span class="keywordflow">return</span> NULL;
<a name="l00649"></a>00649   }
<a name="l00650"></a>00650 <span class="preprocessor">#endif</span>
<a name="l00651"></a>00651 <span class="preprocessor"></span>
<a name="l00652"></a>00652   TRAP(errCode, self-&gt;iSignalObserver = CSignalObserver::NewL());
<a name="l00653"></a>00653   <span class="keywordflow">if</span> (G_UNLIKELY(errCode)) {
<a name="l00654"></a>00654     <a class="code" href="kr__plat__ao__epoc_8cpp.html#aae1984cae05ab56222b162f7749c949f">kr_PlatAo_destroy</a>(<span class="keyword">self</span>);
<a name="l00655"></a>00655     <span class="keywordflow">if</span> (error)
<a name="l00656"></a>00656       *error = <a class="code" href="gxerror_8c.html#a75e3ca4bc4d268c9470ec2c141fa4d47">gx_error_new</a>(<a class="code" href="error__list_8h.html#a38237953d0fe9867b523ebcb9ac69a71">domain_symbian</a>, errCode, 
<a name="l00657"></a>00657           <span class="stringliteral">&quot;signal strength observer creation failure: %s (%d)&quot;</span>, 
<a name="l00658"></a>00658           <a class="code" href="platform__error_8h.html#a323dca184bc375b591b6e2b3d7d7f05f">plat_error_strerror</a>(errCode), errCode);
<a name="l00659"></a>00659     <span class="keywordflow">return</span> NULL;
<a name="l00660"></a>00660   }
<a name="l00661"></a>00661 
<a name="l00662"></a>00662 <span class="preprocessor">#if __FEATURE_REMOKON__</span>
<a name="l00663"></a>00663 <span class="preprocessor"></span>  TRAP(errCode, self-&gt;iSmsTrigger = CSmsTrigger::NewL(ac));
<a name="l00664"></a>00664   <span class="keywordflow">if</span> (G_UNLIKELY(errCode)) {
<a name="l00665"></a>00665     <a class="code" href="kr__plat__ao__epoc_8cpp.html#aae1984cae05ab56222b162f7749c949f">kr_PlatAo_destroy</a>(<span class="keyword">self</span>);
<a name="l00666"></a>00666     <span class="keywordflow">if</span> (error)
<a name="l00667"></a>00667       *error = <a class="code" href="gxerror_8c.html#a75e3ca4bc4d268c9470ec2c141fa4d47">gx_error_new</a>(<a class="code" href="error__list_8h.html#a38237953d0fe9867b523ebcb9ac69a71">domain_symbian</a>, errCode, 
<a name="l00668"></a>00668           <span class="stringliteral">&quot;SMS trigger observer creation failure: %s (%d)&quot;</span>, 
<a name="l00669"></a>00669           <a class="code" href="platform__error_8h.html#a323dca184bc375b591b6e2b3d7d7f05f">plat_error_strerror</a>(errCode), errCode);
<a name="l00670"></a>00670     <span class="keywordflow">return</span> NULL;
<a name="l00671"></a>00671   }
<a name="l00672"></a>00672 <span class="preprocessor">#endif</span>
<a name="l00673"></a>00673 <span class="preprocessor"></span>
<a name="l00674"></a>00674   <span class="keywordflow">return</span> <span class="keyword">self</span>;
<a name="l00675"></a>00675 }
<a name="l00676"></a>00676 
<a name="l00677"></a><a class="code" href="kr__plat__ao__epoc_8cpp.html#aae1984cae05ab56222b162f7749c949f">00677</a> <span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span> <a class="code" href="kr__plat__ao__epoc_8cpp.html#aae1984cae05ab56222b162f7749c949f">kr_PlatAo_destroy</a>(kr_PlatAo* <span class="keyword">self</span>)
<a name="l00678"></a>00678 {
<a name="l00679"></a>00679   <span class="keywordflow">if</span> (<span class="keyword">self</span>) {
<a name="l00680"></a>00680 <span class="preprocessor">#if __FEATURE_REMOKON__</span>
<a name="l00681"></a>00681 <span class="preprocessor"></span>    <span class="keyword">delete</span> <span class="keyword">self</span>-&gt;iSmsTrigger;
<a name="l00682"></a>00682 <span class="preprocessor">#endif</span>
<a name="l00683"></a>00683 <span class="preprocessor"></span>    <span class="keyword">delete</span> <span class="keyword">self</span>-&gt;iSignalObserver;
<a name="l00684"></a>00684     <span class="keyword">delete</span> <span class="keyword">self</span>-&gt;iNetworkObserver;
<a name="l00685"></a>00685     <span class="keyword">delete</span> <span class="keyword">self</span>-&gt;iRegistrationObserver;
<a name="l00686"></a>00686     <span class="keyword">delete</span> <span class="keyword">self</span>-&gt;iDiskObserver;
<a name="l00687"></a>00687     g_free(<span class="keyword">self</span>);
<a name="l00688"></a>00688   }
<a name="l00689"></a>00689 }
<a name="l00690"></a>00690 <span class="comment"></span>
<a name="l00691"></a>00691 <span class="comment">/**</span>
<a name="l00692"></a>00692 <span class="comment"></span>
<a name="l00693"></a>00693 <span class="comment">kr_plat_ao_epoc.cpp</span>
<a name="l00694"></a>00694 <span class="comment"></span>
<a name="l00695"></a>00695 <span class="comment">Copyright 2009 Helsinki Institute for Information Technology (HIIT)</span>
<a name="l00696"></a>00696 <span class="comment">and the authors. All rights reserved.</span>
<a name="l00697"></a>00697 <span class="comment"></span>
<a name="l00698"></a>00698 <span class="comment">Authors: Tero Hasu &lt;tero.hasu@hut.fi&gt;</span>
<a name="l00699"></a>00699 <span class="comment"></span>
<a name="l00700"></a>00700 <span class="comment">Permission is hereby granted, free of charge, to any person</span>
<a name="l00701"></a>00701 <span class="comment">obtaining a copy of this software and associated documentation files</span>
<a name="l00702"></a>00702 <span class="comment">(the &quot;Software&quot;), to deal in the Software without restriction,</span>
<a name="l00703"></a>00703 <span class="comment">including without limitation the rights to use, copy, modify, merge,</span>
<a name="l00704"></a>00704 <span class="comment">publish, distribute, sublicense, and/or sell copies of the Software,</span>
<a name="l00705"></a>00705 <span class="comment">and to permit persons to whom the Software is furnished to do so,</span>
<a name="l00706"></a>00706 <span class="comment">subject to the following conditions:</span>
<a name="l00707"></a>00707 <span class="comment"></span>
<a name="l00708"></a>00708 <span class="comment">The above copyright notice and this permission notice shall be</span>
<a name="l00709"></a>00709 <span class="comment">included in all copies or substantial portions of the Software.</span>
<a name="l00710"></a>00710 <span class="comment"></span>
<a name="l00711"></a>00711 <span class="comment">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,</span>
<a name="l00712"></a>00712 <span class="comment">EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF</span>
<a name="l00713"></a>00713 <span class="comment">MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND</span>
<a name="l00714"></a>00714 <span class="comment">NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS</span>
<a name="l00715"></a>00715 <span class="comment">BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN</span>
<a name="l00716"></a>00716 <span class="comment">ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN</span>
<a name="l00717"></a>00717 <span class="comment">CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span>
<a name="l00718"></a>00718 <span class="comment">SOFTWARE.</span>
<a name="l00719"></a>00719 <span class="comment"></span>
<a name="l00720"></a>00720 <span class="comment"> **/</span>
</pre></div></div>
<hr size="1">

<p style="text-align: right;">
  <a href="http://www.contextlogger.org/">ContextLogger2</a>&#8212;ContextLogger2 Logger Daemon Internals&#8212;<small>Generated on Mon May 2 13:49:54 2011 by&nbsp;<a href="http://www.doxygen.org/">Doxygen</a> 1.6.1</small>
</p>

</body>
</html>
