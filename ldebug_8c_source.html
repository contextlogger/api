<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ContextLogger2 Logger Daemon Internals: ldebug.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_0a42b8d7a42fdff37378486477d8f5e0.html">lua</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_3536dc5472cf8658af6f2f3c074e6fb2.html">src</a>
  </div>
</div>
<div class="contents">
<h1>ldebug.c</h1><a href="ldebug_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment">** $Id: ldebug.c,v 2.29.1.6 2008/05/08 16:56:26 roberto Exp $</span>
<a name="l00003"></a>00003 <span class="comment">** Debug Interface</span>
<a name="l00004"></a>00004 <span class="comment">** See Copyright Notice in lua.h</span>
<a name="l00005"></a>00005 <span class="comment">*/</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 <span class="preprocessor">#include &lt;stdarg.h&gt;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;stddef.h&gt;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 
<a name="l00013"></a><a class="code" href="ldebug_8c.html#a2b6bdddfcfeef5c88fe82ef48697a640">00013</a> <span class="preprocessor">#define ldebug_c</span>
<a name="l00014"></a><a class="code" href="ldebug_8c.html#abf0b3947b59218777a8e928a10be205b">00014</a> <span class="preprocessor"></span><span class="preprocessor">#define LUA_CORE</span>
<a name="l00015"></a>00015 <span class="preprocessor"></span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;<a class="code" href="lua_8h.html">lua.h</a>&quot;</span>
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 <span class="preprocessor">#include &quot;<a class="code" href="lapi_8h.html">lapi.h</a>&quot;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;<a class="code" href="lcode_8h.html">lcode.h</a>&quot;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="ldebug_8h.html">ldebug.h</a>&quot;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;<a class="code" href="ldo_8h.html">ldo.h</a>&quot;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;<a class="code" href="lfunc_8h.html">lfunc.h</a>&quot;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;<a class="code" href="lobject_8h.html">lobject.h</a>&quot;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="lopcodes_8h.html">lopcodes.h</a>&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;<a class="code" href="lstate_8h.html">lstate.h</a>&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="lstring_8h.html">lstring.h</a>&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;<a class="code" href="ltable_8h.html">ltable.h</a>&quot;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="ltm_8h.html">ltm.h</a>&quot;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="lvm_8h.html">lvm.h</a>&quot;</span>
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="ldebug_8c.html#abf0d60b43b4bff2821e87b2f4054a6b7">getfuncname</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <a class="code" href="structCallInfo.html">CallInfo</a> *ci, <span class="keyword">const</span> <span class="keywordtype">char</span> **name);
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 
<a name="l00037"></a><a class="code" href="ldebug_8c.html#aadd6060aae54fd1b822345b8c58a86f5">00037</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ldebug_8c.html#aadd6060aae54fd1b822345b8c58a86f5">currentpc</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <a class="code" href="structCallInfo.html">CallInfo</a> *ci) {
<a name="l00038"></a>00038   <span class="keywordflow">if</span> (!<a class="code" href="lstate_8h.html#a489eab424b094f54dd7f6b35e2cf68a2">isLua</a>(ci)) <span class="keywordflow">return</span> -1;  <span class="comment">/* function is not a Lua function? */</span>
<a name="l00039"></a>00039   <span class="keywordflow">if</span> (ci == L-&gt;<a class="code" href="structlua__State.html#a7fbb5727050853f411ad64b4be9ab5c8">ci</a>)
<a name="l00040"></a>00040     ci-&gt;<a class="code" href="structCallInfo.html#a4f8b835724037f01569452eab143948f">savedpc</a> = L-&gt;<a class="code" href="structlua__State.html#afe3db9d5ed89b57fe5d4ec0bd7aea8e1">savedpc</a>;
<a name="l00041"></a>00041   <span class="keywordflow">return</span> <a class="code" href="ldebug_8h.html#a90cad524ed41d15bada161ecd74037ad">pcRel</a>(ci-&gt;<a class="code" href="structCallInfo.html#a4f8b835724037f01569452eab143948f">savedpc</a>, <a class="code" href="lstate_8h.html#a12b504eee786ce8f2c703a22c03d477e">ci_func</a>(ci)-&gt;l.p);
<a name="l00042"></a>00042 }
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 
<a name="l00045"></a><a class="code" href="ldebug_8c.html#a4c5c4ed4c8752d396af7ac41f74dad16">00045</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ldebug_8c.html#a4c5c4ed4c8752d396af7ac41f74dad16">currentline</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <a class="code" href="structCallInfo.html">CallInfo</a> *ci) {
<a name="l00046"></a>00046   <span class="keywordtype">int</span> pc = <a class="code" href="ldebug_8c.html#aadd6060aae54fd1b822345b8c58a86f5">currentpc</a>(L, ci);
<a name="l00047"></a>00047   <span class="keywordflow">if</span> (pc &lt; 0)
<a name="l00048"></a>00048     <span class="keywordflow">return</span> -1;  <span class="comment">/* only active lua functions have current-line information */</span>
<a name="l00049"></a>00049   <span class="keywordflow">else</span>
<a name="l00050"></a>00050     <span class="keywordflow">return</span> <a class="code" href="ldebug_8h.html#aaf173b063074236fab0f77f3b093a16c">getline</a>(<a class="code" href="lstate_8h.html#a12b504eee786ce8f2c703a22c03d477e">ci_func</a>(ci)-&gt;l.p, pc);
<a name="l00051"></a>00051 }
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 <span class="comment">/*</span>
<a name="l00055"></a>00055 <span class="comment">** this function can be called asynchronous (e.g. during a signal)</span>
<a name="l00056"></a>00056 <span class="comment">*/</span>
<a name="l00057"></a><a class="code" href="lua_8h.html#a664ce25a0c30d2c1b1e89e7ea25be7f0">00057</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">int</span> <a class="code" href="ldebug_8c.html#a664ce25a0c30d2c1b1e89e7ea25be7f0">lua_sethook</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <a class="code" href="lua_8h.html#ae9fa3596803178b98fa911d2ba0af0f4">lua_Hook</a> func, <span class="keywordtype">int</span> mask, <span class="keywordtype">int</span> count) {
<a name="l00058"></a>00058   <span class="keywordflow">if</span> (func == NULL || mask == 0) {  <span class="comment">/* turn off hooks? */</span>
<a name="l00059"></a>00059     mask = 0;
<a name="l00060"></a>00060     func = NULL;
<a name="l00061"></a>00061   }
<a name="l00062"></a>00062   L-&gt;<a class="code" href="structlua__State.html#a89d3fb3ecb6831d1c5c51b4a87ace8ed">hook</a> = func;
<a name="l00063"></a>00063   L-&gt;<a class="code" href="structlua__State.html#a5d760c922e94390cd270ebb4ca4bc848">basehookcount</a> = count;
<a name="l00064"></a>00064   <a class="code" href="ldebug_8h.html#ac42e5618900e7522d70474fcfbddab58">resethookcount</a>(L);
<a name="l00065"></a>00065   L-&gt;<a class="code" href="structlua__State.html#a1d4ee1613c41d6100db9e0c73217b41f">hookmask</a> = <a class="code" href="llimits_8h.html#a596f5b6e992f53a5a4e5732083448dd4">cast_byte</a>(mask);
<a name="l00066"></a>00066   <span class="keywordflow">return</span> 1;
<a name="l00067"></a>00067 }
<a name="l00068"></a>00068 
<a name="l00069"></a>00069 
<a name="l00070"></a><a class="code" href="lua_8h.html#a44b9923035977dcfa57279761f7379b4">00070</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <a class="code" href="lua_8h.html#ae9fa3596803178b98fa911d2ba0af0f4">lua_Hook</a> <a class="code" href="ldebug_8c.html#a44b9923035977dcfa57279761f7379b4">lua_gethook</a> (<a class="code" href="structlua__State.html">lua_State</a> *L) {
<a name="l00071"></a>00071   <span class="keywordflow">return</span> L-&gt;<a class="code" href="structlua__State.html#a89d3fb3ecb6831d1c5c51b4a87ace8ed">hook</a>;
<a name="l00072"></a>00072 }
<a name="l00073"></a>00073 
<a name="l00074"></a>00074 
<a name="l00075"></a><a class="code" href="lua_8h.html#a0b41dd9ab46652c8433b861f679fadb8">00075</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">int</span> <a class="code" href="ldebug_8c.html#a0b41dd9ab46652c8433b861f679fadb8">lua_gethookmask</a> (<a class="code" href="structlua__State.html">lua_State</a> *L) {
<a name="l00076"></a>00076   <span class="keywordflow">return</span> L-&gt;<a class="code" href="structlua__State.html#a1d4ee1613c41d6100db9e0c73217b41f">hookmask</a>;
<a name="l00077"></a>00077 }
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 
<a name="l00080"></a><a class="code" href="lua_8h.html#a18f065f752cfa08eefd338b4cbd7254b">00080</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">int</span> <a class="code" href="ldebug_8c.html#a18f065f752cfa08eefd338b4cbd7254b">lua_gethookcount</a> (<a class="code" href="structlua__State.html">lua_State</a> *L) {
<a name="l00081"></a>00081   <span class="keywordflow">return</span> L-&gt;<a class="code" href="structlua__State.html#a5d760c922e94390cd270ebb4ca4bc848">basehookcount</a>;
<a name="l00082"></a>00082 }
<a name="l00083"></a>00083 
<a name="l00084"></a>00084 
<a name="l00085"></a><a class="code" href="lua_8h.html#ac1fc03c27ee46caa4037df2d70f22110">00085</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">int</span> <a class="code" href="ldebug_8c.html#ac1fc03c27ee46caa4037df2d70f22110">lua_getstack</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> level, <a class="code" href="structlua__Debug.html">lua_Debug</a> *ar) {
<a name="l00086"></a>00086   <span class="keywordtype">int</span> status;
<a name="l00087"></a>00087   <a class="code" href="structCallInfo.html">CallInfo</a> *ci;
<a name="l00088"></a>00088   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00089"></a>00089   <span class="keywordflow">for</span> (ci = L-&gt;<a class="code" href="structlua__State.html#a7fbb5727050853f411ad64b4be9ab5c8">ci</a>; level &gt; 0 &amp;&amp; ci &gt; L-&gt;<a class="code" href="structlua__State.html#a5e99f3f914a793d73684a19eb96dda3b">base_ci</a>; ci--) {
<a name="l00090"></a>00090     level--;
<a name="l00091"></a>00091     <span class="keywordflow">if</span> (<a class="code" href="lstate_8h.html#acc4169d5ef66325644b3e46c90232919">f_isLua</a>(ci))  <span class="comment">/* Lua function? */</span>
<a name="l00092"></a>00092       level -= ci-&gt;<a class="code" href="structCallInfo.html#ae00bf2bdc64fc9d3f6599b6446b323c6">tailcalls</a>;  <span class="comment">/* skip lost tail calls */</span>
<a name="l00093"></a>00093   }
<a name="l00094"></a>00094   <span class="keywordflow">if</span> (level == 0 &amp;&amp; ci &gt; L-&gt;<a class="code" href="structlua__State.html#a5e99f3f914a793d73684a19eb96dda3b">base_ci</a>) {  <span class="comment">/* level found? */</span>
<a name="l00095"></a>00095     status = 1;
<a name="l00096"></a>00096     ar-&gt;<a class="code" href="structlua__Debug.html#afeff0b0b87ea0fe3f5ba254d91484897">i_ci</a> = <a class="code" href="llimits_8h.html#a37a9e2c4b53433d34bad0f12a1500c08">cast_int</a>(ci - L-&gt;<a class="code" href="structlua__State.html#a5e99f3f914a793d73684a19eb96dda3b">base_ci</a>);
<a name="l00097"></a>00097   }
<a name="l00098"></a>00098   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (level &lt; 0) {  <span class="comment">/* level is of a lost tail call? */</span>
<a name="l00099"></a>00099     status = 1;
<a name="l00100"></a>00100     ar-&gt;<a class="code" href="structlua__Debug.html#afeff0b0b87ea0fe3f5ba254d91484897">i_ci</a> = 0;
<a name="l00101"></a>00101   }
<a name="l00102"></a>00102   <span class="keywordflow">else</span> status = 0;  <span class="comment">/* no such level */</span>
<a name="l00103"></a>00103   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00104"></a>00104   <span class="keywordflow">return</span> status;
<a name="l00105"></a>00105 }
<a name="l00106"></a>00106 
<a name="l00107"></a>00107 
<a name="l00108"></a><a class="code" href="ldebug_8c.html#af9b48940a4b1206aa52487e903d2ba30">00108</a> <span class="keyword">static</span> <a class="code" href="structProto.html">Proto</a> *<a class="code" href="ldebug_8c.html#af9b48940a4b1206aa52487e903d2ba30">getluaproto</a> (<a class="code" href="structCallInfo.html">CallInfo</a> *ci) {
<a name="l00109"></a>00109   <span class="keywordflow">return</span> (<a class="code" href="lstate_8h.html#a489eab424b094f54dd7f6b35e2cf68a2">isLua</a>(ci) ? <a class="code" href="lstate_8h.html#a12b504eee786ce8f2c703a22c03d477e">ci_func</a>(ci)-&gt;l.p : NULL);
<a name="l00110"></a>00110 }
<a name="l00111"></a>00111 
<a name="l00112"></a>00112 
<a name="l00113"></a><a class="code" href="ldebug_8c.html#a7bb8927d39f08ee6a761487e7a100114">00113</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="ldebug_8c.html#a7bb8927d39f08ee6a761487e7a100114">findlocal</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <a class="code" href="structCallInfo.html">CallInfo</a> *ci, <span class="keywordtype">int</span> n) {
<a name="l00114"></a>00114   <span class="keyword">const</span> <span class="keywordtype">char</span> *name;
<a name="l00115"></a>00115   <a class="code" href="structProto.html">Proto</a> *fp = <a class="code" href="ldebug_8c.html#af9b48940a4b1206aa52487e903d2ba30">getluaproto</a>(ci);
<a name="l00116"></a>00116   <span class="keywordflow">if</span> (fp &amp;&amp; (name = <a class="code" href="lfunc_8c.html#aaa3cd5bc3901e7edf1ac428151cdfe8c">luaF_getlocalname</a>(fp, n, <a class="code" href="ldebug_8c.html#aadd6060aae54fd1b822345b8c58a86f5">currentpc</a>(L, ci))) != NULL)
<a name="l00117"></a>00117     <span class="keywordflow">return</span> name;  <span class="comment">/* is a local variable in a Lua function */</span>
<a name="l00118"></a>00118   <span class="keywordflow">else</span> {
<a name="l00119"></a>00119     <a class="code" href="structlua__TValue.html">StkId</a> limit = (ci == L-&gt;<a class="code" href="structlua__State.html#a7fbb5727050853f411ad64b4be9ab5c8">ci</a>) ? L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> : (ci+1)-&gt;func;
<a name="l00120"></a>00120     <span class="keywordflow">if</span> (limit - ci-&gt;<a class="code" href="structCallInfo.html#a7b8303ad59b7ba200cd5e3a26b118fbf">base</a> &gt;= n &amp;&amp; n &gt; 0)  <span class="comment">/* is &apos;n&apos; inside &apos;ci&apos; stack? */</span>
<a name="l00121"></a>00121       <span class="keywordflow">return</span> <span class="stringliteral">&quot;(*temporary)&quot;</span>;
<a name="l00122"></a>00122     <span class="keywordflow">else</span>
<a name="l00123"></a>00123       <span class="keywordflow">return</span> NULL;
<a name="l00124"></a>00124   }
<a name="l00125"></a>00125 }
<a name="l00126"></a>00126 
<a name="l00127"></a>00127 
<a name="l00128"></a><a class="code" href="lua_8h.html#aaaf420ee0b0e79a45b823d9da4905667">00128</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="ldebug_8c.html#aaaf420ee0b0e79a45b823d9da4905667">lua_getlocal</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keyword">const</span> <a class="code" href="structlua__Debug.html">lua_Debug</a> *ar, <span class="keywordtype">int</span> n) {
<a name="l00129"></a>00129   <a class="code" href="structCallInfo.html">CallInfo</a> *ci = L-&gt;<a class="code" href="structlua__State.html#a5e99f3f914a793d73684a19eb96dda3b">base_ci</a> + ar-&gt;<a class="code" href="structlua__Debug.html#afeff0b0b87ea0fe3f5ba254d91484897">i_ci</a>;
<a name="l00130"></a>00130   <span class="keyword">const</span> <span class="keywordtype">char</span> *name = <a class="code" href="ldebug_8c.html#a7bb8927d39f08ee6a761487e7a100114">findlocal</a>(L, ci, n);
<a name="l00131"></a>00131   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00132"></a>00132   <span class="keywordflow">if</span> (name)
<a name="l00133"></a>00133       <a class="code" href="lapi_8c.html#a7a20f9a76303e8dda4ecd7adc05917a7">luaA_pushobject</a>(L, ci-&gt;<a class="code" href="structCallInfo.html#a7b8303ad59b7ba200cd5e3a26b118fbf">base</a> + (n - 1));
<a name="l00134"></a>00134   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00135"></a>00135   <span class="keywordflow">return</span> name;
<a name="l00136"></a>00136 }
<a name="l00137"></a>00137 
<a name="l00138"></a>00138 
<a name="l00139"></a><a class="code" href="lua_8h.html#a425c37b17caf76545f1541a5bb81dfc6">00139</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="ldebug_8c.html#a425c37b17caf76545f1541a5bb81dfc6">lua_setlocal</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keyword">const</span> <a class="code" href="structlua__Debug.html">lua_Debug</a> *ar, <span class="keywordtype">int</span> n) {
<a name="l00140"></a>00140   <a class="code" href="structCallInfo.html">CallInfo</a> *ci = L-&gt;<a class="code" href="structlua__State.html#a5e99f3f914a793d73684a19eb96dda3b">base_ci</a> + ar-&gt;<a class="code" href="structlua__Debug.html#afeff0b0b87ea0fe3f5ba254d91484897">i_ci</a>;
<a name="l00141"></a>00141   <span class="keyword">const</span> <span class="keywordtype">char</span> *name = <a class="code" href="ldebug_8c.html#a7bb8927d39f08ee6a761487e7a100114">findlocal</a>(L, ci, n);
<a name="l00142"></a>00142   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00143"></a>00143   <span class="keywordflow">if</span> (name)
<a name="l00144"></a>00144       <a class="code" href="lobject_8h.html#a6d30d7fa36e78e0bfb56ba38d9e89ce2">setobjs2s</a>(L, ci-&gt;<a class="code" href="structCallInfo.html#a7b8303ad59b7ba200cd5e3a26b118fbf">base</a> + (n - 1), L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> - 1);
<a name="l00145"></a>00145   L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>--;  <span class="comment">/* pop value */</span>
<a name="l00146"></a>00146   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00147"></a>00147   <span class="keywordflow">return</span> name;
<a name="l00148"></a>00148 }
<a name="l00149"></a>00149 
<a name="l00150"></a>00150 
<a name="l00151"></a><a class="code" href="ldebug_8c.html#a84af60873d130ffee87eb1721f3231e4">00151</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ldebug_8c.html#a84af60873d130ffee87eb1721f3231e4">funcinfo</a> (<a class="code" href="structlua__Debug.html">lua_Debug</a> *ar, <a class="code" href="unionClosure.html">Closure</a> *cl) {
<a name="l00152"></a>00152   <span class="keywordflow">if</span> (cl-&gt;<a class="code" href="unionClosure.html#ace9dac5a62b61db682ef0cd86b3b44b1">c</a>.isC) {
<a name="l00153"></a>00153     ar-&gt;<a class="code" href="structlua__Debug.html#a422bceba8605d96bce4d19ce801a62e4">source</a> = <span class="stringliteral">&quot;=[C]&quot;</span>;
<a name="l00154"></a>00154     ar-&gt;<a class="code" href="structlua__Debug.html#a97cb69b18daa46d20fb1a13eec78661b">linedefined</a> = -1;
<a name="l00155"></a>00155     ar-&gt;<a class="code" href="structlua__Debug.html#a4c69b9d30e54cf9071cd2987ede128eb">lastlinedefined</a> = -1;
<a name="l00156"></a>00156     ar-&gt;<a class="code" href="structlua__Debug.html#afbf8df5f26e9c345378a7eb402eed081">what</a> = <span class="stringliteral">&quot;C&quot;</span>;
<a name="l00157"></a>00157   }
<a name="l00158"></a>00158   <span class="keywordflow">else</span> {
<a name="l00159"></a>00159     ar-&gt;<a class="code" href="structlua__Debug.html#a422bceba8605d96bce4d19ce801a62e4">source</a> = <a class="code" href="lobject_8h.html#acb05d3ab238923581a9c629b8e11a6ac">getstr</a>(cl-&gt;<a class="code" href="unionClosure.html#a8c338ec7dc76078cbee5887857de713c">l</a>.<a class="code" href="structLClosure.html#a4cf173817d3897b0e70822e70d241d6c">p</a>-&gt;<a class="code" href="structProto.html#a92b6ec319e7aa1ee8b8ff7807353ad96">source</a>);
<a name="l00160"></a>00160     ar-&gt;<a class="code" href="structlua__Debug.html#a97cb69b18daa46d20fb1a13eec78661b">linedefined</a> = cl-&gt;<a class="code" href="unionClosure.html#a8c338ec7dc76078cbee5887857de713c">l</a>.<a class="code" href="structLClosure.html#a4cf173817d3897b0e70822e70d241d6c">p</a>-&gt;<a class="code" href="structProto.html#a62cf1c61b70bfaa4f1fb839b7398160b">linedefined</a>;
<a name="l00161"></a>00161     ar-&gt;<a class="code" href="structlua__Debug.html#a4c69b9d30e54cf9071cd2987ede128eb">lastlinedefined</a> = cl-&gt;<a class="code" href="unionClosure.html#a8c338ec7dc76078cbee5887857de713c">l</a>.<a class="code" href="structLClosure.html#a4cf173817d3897b0e70822e70d241d6c">p</a>-&gt;<a class="code" href="structProto.html#a9ef7fae1b22b11f5a145cfee8150059c">lastlinedefined</a>;
<a name="l00162"></a>00162     ar-&gt;<a class="code" href="structlua__Debug.html#afbf8df5f26e9c345378a7eb402eed081">what</a> = (ar-&gt;<a class="code" href="structlua__Debug.html#a97cb69b18daa46d20fb1a13eec78661b">linedefined</a> == 0) ? <span class="stringliteral">&quot;main&quot;</span> : <span class="stringliteral">&quot;Lua&quot;</span>;
<a name="l00163"></a>00163   }
<a name="l00164"></a>00164   <a class="code" href="lobject_8c.html#a4708cca3615b7fafb7ea4631f486983b">luaO_chunkid</a>(ar-&gt;<a class="code" href="structlua__Debug.html#a9b953c2fa9ef95a72a9ffc423744e1a4">short_src</a>, ar-&gt;<a class="code" href="structlua__Debug.html#a422bceba8605d96bce4d19ce801a62e4">source</a>, <a class="code" href="luaconf_8h.html#a49c31c00aa2852af25a2c43046a21aeb">LUA_IDSIZE</a>);
<a name="l00165"></a>00165 }
<a name="l00166"></a>00166 
<a name="l00167"></a>00167 
<a name="l00168"></a><a class="code" href="ldebug_8c.html#a115f8498a239959c4938e58cc551c229">00168</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ldebug_8c.html#a115f8498a239959c4938e58cc551c229">info_tailcall</a> (<a class="code" href="structlua__Debug.html">lua_Debug</a> *ar) {
<a name="l00169"></a>00169   ar-&gt;<a class="code" href="structlua__Debug.html#a2978ab7f2ade479a003beb16d3b7a993">name</a> = ar-&gt;<a class="code" href="structlua__Debug.html#a7e8c201950ea4dd3f2c7df9e1201019a">namewhat</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00170"></a>00170   ar-&gt;<a class="code" href="structlua__Debug.html#afbf8df5f26e9c345378a7eb402eed081">what</a> = <span class="stringliteral">&quot;tail&quot;</span>;
<a name="l00171"></a>00171   ar-&gt;<a class="code" href="structlua__Debug.html#a4c69b9d30e54cf9071cd2987ede128eb">lastlinedefined</a> = ar-&gt;<a class="code" href="structlua__Debug.html#a97cb69b18daa46d20fb1a13eec78661b">linedefined</a> = ar-&gt;<a class="code" href="structlua__Debug.html#a97b3ed36cdfdc6f2c694b253a3d96da6">currentline</a> = -1;
<a name="l00172"></a>00172   ar-&gt;<a class="code" href="structlua__Debug.html#a422bceba8605d96bce4d19ce801a62e4">source</a> = <span class="stringliteral">&quot;=(tail call)&quot;</span>;
<a name="l00173"></a>00173   <a class="code" href="lobject_8c.html#a4708cca3615b7fafb7ea4631f486983b">luaO_chunkid</a>(ar-&gt;<a class="code" href="structlua__Debug.html#a9b953c2fa9ef95a72a9ffc423744e1a4">short_src</a>, ar-&gt;<a class="code" href="structlua__Debug.html#a422bceba8605d96bce4d19ce801a62e4">source</a>, <a class="code" href="luaconf_8h.html#a49c31c00aa2852af25a2c43046a21aeb">LUA_IDSIZE</a>);
<a name="l00174"></a>00174   ar-&gt;<a class="code" href="structlua__Debug.html#a983807ecf0dfa3e5e77fe7f0e2fd9d49">nups</a> = 0;
<a name="l00175"></a>00175 }
<a name="l00176"></a>00176 
<a name="l00177"></a>00177 
<a name="l00178"></a><a class="code" href="ldebug_8c.html#a6e3195fc94af1f75142c2801ca8cf058">00178</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ldebug_8c.html#a6e3195fc94af1f75142c2801ca8cf058">collectvalidlines</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <a class="code" href="unionClosure.html">Closure</a> *<a class="code" href="libluasqlite3_8c.html#ae16fcc70ad2cbf55b1906507bcb6fa33">f</a>) {
<a name="l00179"></a>00179   <span class="keywordflow">if</span> (f == NULL || f-&gt;<a class="code" href="unionClosure.html#ace9dac5a62b61db682ef0cd86b3b44b1">c</a>.isC) {
<a name="l00180"></a>00180     <a class="code" href="lobject_8h.html#ad9034def7bbc1965ec3d714d84620b07">setnilvalue</a>(L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>);
<a name="l00181"></a>00181   }
<a name="l00182"></a>00182   <span class="keywordflow">else</span> {
<a name="l00183"></a>00183     <a class="code" href="structTable.html">Table</a> *t = <a class="code" href="ltable_8c.html#a7295cd1ebcc8e39f2b23079bb575d2e6">luaH_new</a>(L, 0, 0);
<a name="l00184"></a>00184     <span class="keywordtype">int</span> *lineinfo = f-&gt;<a class="code" href="unionClosure.html#a8c338ec7dc76078cbee5887857de713c">l</a>.<a class="code" href="structLClosure.html#a4cf173817d3897b0e70822e70d241d6c">p</a>-&gt;<a class="code" href="structProto.html#a7b35e79a276933f7e71edceec5b4593d">lineinfo</a>;
<a name="l00185"></a>00185     <span class="keywordtype">int</span> i;
<a name="l00186"></a>00186     <span class="keywordflow">for</span> (i=0; i&lt;f-&gt;<a class="code" href="unionClosure.html#a8c338ec7dc76078cbee5887857de713c">l</a>.<a class="code" href="structLClosure.html#a4cf173817d3897b0e70822e70d241d6c">p</a>-&gt;<a class="code" href="structProto.html#a65303ae1d815313f3358a578113fcc6e">sizelineinfo</a>; i++)
<a name="l00187"></a>00187       <a class="code" href="lobject_8h.html#a22e86755164a1bc172b40f344d7ce70e">setbvalue</a>(<a class="code" href="ltable_8c.html#a9fddc8c65f349970bbbbbfc79ed4bc24">luaH_setnum</a>(L, t, lineinfo[i]), 1);
<a name="l00188"></a>00188     <a class="code" href="lobject_8h.html#ab9379699ac579d54410e3542f061bbad">sethvalue</a>(L, L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>, t); 
<a name="l00189"></a>00189   }
<a name="l00190"></a>00190   <a class="code" href="ldo_8h.html#a9c102d2b8b9a0a52bbb15eeeb4e0cbac">incr_top</a>(L);
<a name="l00191"></a>00191 }
<a name="l00192"></a>00192 
<a name="l00193"></a>00193 
<a name="l00194"></a><a class="code" href="ldebug_8c.html#ad72fa774194e83872bac4e5bf6ec1160">00194</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ldebug_8c.html#ad72fa774194e83872bac4e5bf6ec1160">auxgetinfo</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keyword">const</span> <span class="keywordtype">char</span> *what, <a class="code" href="structlua__Debug.html">lua_Debug</a> *ar,
<a name="l00195"></a>00195                     <a class="code" href="unionClosure.html">Closure</a> *<a class="code" href="libluasqlite3_8c.html#ae16fcc70ad2cbf55b1906507bcb6fa33">f</a>, <a class="code" href="structCallInfo.html">CallInfo</a> *ci) {
<a name="l00196"></a>00196   <span class="keywordtype">int</span> status = 1;
<a name="l00197"></a>00197   <span class="keywordflow">if</span> (f == NULL) {
<a name="l00198"></a>00198     <a class="code" href="ldebug_8c.html#a115f8498a239959c4938e58cc551c229">info_tailcall</a>(ar);
<a name="l00199"></a>00199     <span class="keywordflow">return</span> status;
<a name="l00200"></a>00200   }
<a name="l00201"></a>00201   <span class="keywordflow">for</span> (; *what; what++) {
<a name="l00202"></a>00202     <span class="keywordflow">switch</span> (*what) {
<a name="l00203"></a>00203       <span class="keywordflow">case</span> <span class="charliteral">&apos;S&apos;</span>: {
<a name="l00204"></a>00204         <a class="code" href="ldebug_8c.html#a84af60873d130ffee87eb1721f3231e4">funcinfo</a>(ar, f);
<a name="l00205"></a>00205         <span class="keywordflow">break</span>;
<a name="l00206"></a>00206       }
<a name="l00207"></a>00207       <span class="keywordflow">case</span> <span class="charliteral">&apos;l&apos;</span>: {
<a name="l00208"></a>00208         ar-&gt;<a class="code" href="structlua__Debug.html#a97b3ed36cdfdc6f2c694b253a3d96da6">currentline</a> = (ci) ? <a class="code" href="ldebug_8c.html#a4c5c4ed4c8752d396af7ac41f74dad16">currentline</a>(L, ci) : -1;
<a name="l00209"></a>00209         <span class="keywordflow">break</span>;
<a name="l00210"></a>00210       }
<a name="l00211"></a>00211       <span class="keywordflow">case</span> <span class="charliteral">&apos;u&apos;</span>: {
<a name="l00212"></a>00212         ar-&gt;<a class="code" href="structlua__Debug.html#a983807ecf0dfa3e5e77fe7f0e2fd9d49">nups</a> = f-&gt;<a class="code" href="unionClosure.html#ace9dac5a62b61db682ef0cd86b3b44b1">c</a>.nupvalues;
<a name="l00213"></a>00213         <span class="keywordflow">break</span>;
<a name="l00214"></a>00214       }
<a name="l00215"></a>00215       <span class="keywordflow">case</span> <span class="charliteral">&apos;n&apos;</span>: {
<a name="l00216"></a>00216         ar-&gt;<a class="code" href="structlua__Debug.html#a7e8c201950ea4dd3f2c7df9e1201019a">namewhat</a> = (ci) ? <a class="code" href="ldebug_8c.html#abf0d60b43b4bff2821e87b2f4054a6b7">getfuncname</a>(L, ci, &amp;ar-&gt;<a class="code" href="structlua__Debug.html#a2978ab7f2ade479a003beb16d3b7a993">name</a>) : NULL;
<a name="l00217"></a>00217         <span class="keywordflow">if</span> (ar-&gt;<a class="code" href="structlua__Debug.html#a7e8c201950ea4dd3f2c7df9e1201019a">namewhat</a> == NULL) {
<a name="l00218"></a>00218           ar-&gt;<a class="code" href="structlua__Debug.html#a7e8c201950ea4dd3f2c7df9e1201019a">namewhat</a> = <span class="stringliteral">&quot;&quot;</span>;  <span class="comment">/* not found */</span>
<a name="l00219"></a>00219           ar-&gt;<a class="code" href="structlua__Debug.html#a2978ab7f2ade479a003beb16d3b7a993">name</a> = NULL;
<a name="l00220"></a>00220         }
<a name="l00221"></a>00221         <span class="keywordflow">break</span>;
<a name="l00222"></a>00222       }
<a name="l00223"></a>00223       <span class="keywordflow">case</span> <span class="charliteral">&apos;L&apos;</span>:
<a name="l00224"></a>00224       <span class="keywordflow">case</span> <span class="charliteral">&apos;f&apos;</span>:  <span class="comment">/* handled by lua_getinfo */</span>
<a name="l00225"></a>00225         <span class="keywordflow">break</span>;
<a name="l00226"></a>00226       <span class="keywordflow">default</span>: status = 0;  <span class="comment">/* invalid option */</span>
<a name="l00227"></a>00227     }
<a name="l00228"></a>00228   }
<a name="l00229"></a>00229   <span class="keywordflow">return</span> status;
<a name="l00230"></a>00230 }
<a name="l00231"></a>00231 
<a name="l00232"></a>00232 
<a name="l00233"></a><a class="code" href="lua_8h.html#acaafc35d8e385c4d167229486165df6d">00233</a> <a class="code" href="luaconf_8h.html#af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</a> <span class="keywordtype">int</span> <a class="code" href="ldebug_8c.html#acaafc35d8e385c4d167229486165df6d">lua_getinfo</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keyword">const</span> <span class="keywordtype">char</span> *what, <a class="code" href="structlua__Debug.html">lua_Debug</a> *ar) {
<a name="l00234"></a>00234   <span class="keywordtype">int</span> status;
<a name="l00235"></a>00235   <a class="code" href="unionClosure.html">Closure</a> *<a class="code" href="libluasqlite3_8c.html#ae16fcc70ad2cbf55b1906507bcb6fa33">f</a> = NULL;
<a name="l00236"></a>00236   <a class="code" href="structCallInfo.html">CallInfo</a> *ci = NULL;
<a name="l00237"></a>00237   <a class="code" href="llimits_8h.html#aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</a>(L);
<a name="l00238"></a>00238   <span class="keywordflow">if</span> (*what == <span class="charliteral">&apos;&gt;&apos;</span>) {
<a name="l00239"></a>00239     <a class="code" href="structlua__TValue.html">StkId</a> func = L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> - 1;
<a name="l00240"></a>00240     <a class="code" href="luaconf_8h.html#ac171fa0deadb9a024ff076b3f27bee74">luai_apicheck</a>(L, <a class="code" href="lobject_8h.html#a48587dcb78721d149d3184d0768f4950">ttisfunction</a>(func));
<a name="l00241"></a>00241     what++;  <span class="comment">/* skip the &apos;&gt;&apos; */</span>
<a name="l00242"></a>00242     f = <a class="code" href="lobject_8h.html#a4b49383d348897fe282c0d51354d8bc9">clvalue</a>(func);
<a name="l00243"></a>00243     L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>--;  <span class="comment">/* pop function */</span>
<a name="l00244"></a>00244   }
<a name="l00245"></a>00245   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ar-&gt;<a class="code" href="structlua__Debug.html#afeff0b0b87ea0fe3f5ba254d91484897">i_ci</a> != 0) {  <span class="comment">/* no tail call? */</span>
<a name="l00246"></a>00246     ci = L-&gt;<a class="code" href="structlua__State.html#a5e99f3f914a793d73684a19eb96dda3b">base_ci</a> + ar-&gt;<a class="code" href="structlua__Debug.html#afeff0b0b87ea0fe3f5ba254d91484897">i_ci</a>;
<a name="l00247"></a>00247     <a class="code" href="llimits_8h.html#a5978f5fda715bd80e845df1e16ad7780">lua_assert</a>(<a class="code" href="lobject_8h.html#a48587dcb78721d149d3184d0768f4950">ttisfunction</a>(ci-&gt;<a class="code" href="structCallInfo.html#a378cfb37136fabfe59d1c38071c6c9d1">func</a>));
<a name="l00248"></a>00248     f = <a class="code" href="lobject_8h.html#a4b49383d348897fe282c0d51354d8bc9">clvalue</a>(ci-&gt;<a class="code" href="structCallInfo.html#a378cfb37136fabfe59d1c38071c6c9d1">func</a>);
<a name="l00249"></a>00249   }
<a name="l00250"></a>00250   status = <a class="code" href="ldebug_8c.html#ad72fa774194e83872bac4e5bf6ec1160">auxgetinfo</a>(L, what, ar, f, ci);
<a name="l00251"></a>00251   <span class="keywordflow">if</span> (strchr(what, <span class="charliteral">&apos;f&apos;</span>)) {
<a name="l00252"></a>00252     <span class="keywordflow">if</span> (f == NULL) <a class="code" href="lobject_8h.html#ad9034def7bbc1965ec3d714d84620b07">setnilvalue</a>(L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>);
<a name="l00253"></a>00253     <span class="keywordflow">else</span> <a class="code" href="lobject_8h.html#a766f0e76b0607550fd72164373ba544d">setclvalue</a>(L, L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>, f);
<a name="l00254"></a>00254     <a class="code" href="ldo_8h.html#a9c102d2b8b9a0a52bbb15eeeb4e0cbac">incr_top</a>(L);
<a name="l00255"></a>00255   }
<a name="l00256"></a>00256   <span class="keywordflow">if</span> (strchr(what, <span class="charliteral">&apos;L&apos;</span>))
<a name="l00257"></a>00257     <a class="code" href="ldebug_8c.html#a6e3195fc94af1f75142c2801ca8cf058">collectvalidlines</a>(L, f);
<a name="l00258"></a>00258   <a class="code" href="llimits_8h.html#a1781f2a7d9161848a246d475a9171875">lua_unlock</a>(L);
<a name="l00259"></a>00259   <span class="keywordflow">return</span> status;
<a name="l00260"></a>00260 }
<a name="l00261"></a>00261 
<a name="l00262"></a>00262 
<a name="l00263"></a>00263 <span class="comment">/*</span>
<a name="l00264"></a>00264 <span class="comment">** {======================================================</span>
<a name="l00265"></a>00265 <span class="comment">** Symbolic Execution and code checker</span>
<a name="l00266"></a>00266 <span class="comment">** =======================================================</span>
<a name="l00267"></a>00267 <span class="comment">*/</span>
<a name="l00268"></a>00268 
<a name="l00269"></a><a class="code" href="ldebug_8c.html#a437fe6dda055faa9899b4268918b8032">00269</a> <span class="preprocessor">#define check(x)    if (!(x)) return 0;</span>
<a name="l00270"></a>00270 <span class="preprocessor"></span>
<a name="l00271"></a><a class="code" href="ldebug_8c.html#a5a7b322872346ea6f00efe21ee19965a">00271</a> <span class="preprocessor">#define checkjump(pt,pc)  check(0 &lt;= pc &amp;&amp; pc &lt; pt-&gt;sizecode)</span>
<a name="l00272"></a>00272 <span class="preprocessor"></span>
<a name="l00273"></a><a class="code" href="ldebug_8c.html#a16636d18aebfaa0a204e1a139088e504">00273</a> <span class="preprocessor">#define checkreg(pt,reg)  check((reg) &lt; (pt)-&gt;maxstacksize)</span>
<a name="l00274"></a>00274 <span class="preprocessor"></span>
<a name="l00275"></a>00275 
<a name="l00276"></a>00276 
<a name="l00277"></a><a class="code" href="ldebug_8c.html#a294c9f5b1c8e2972efcebf379d702735">00277</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ldebug_8c.html#a294c9f5b1c8e2972efcebf379d702735">precheck</a> (<span class="keyword">const</span> <a class="code" href="structProto.html">Proto</a> *pt) {
<a name="l00278"></a>00278   <a class="code" href="ldebug_8c.html#a437fe6dda055faa9899b4268918b8032">check</a>(pt-&gt;<a class="code" href="structProto.html#a9c9ed4e9d996233f75cdf56b912e4803">maxstacksize</a> &lt;= <a class="code" href="llimits_8h.html#aacca6649d32984be8e1aa076bf42fe46">MAXSTACK</a>);
<a name="l00279"></a>00279   <a class="code" href="ldebug_8c.html#a437fe6dda055faa9899b4268918b8032">check</a>(pt-&gt;<a class="code" href="structProto.html#a3f106f177af6c68ffd8b042713266b98">numparams</a>+(pt-&gt;<a class="code" href="structProto.html#a82302f2e9040b681d5b34c1239dcd673">is_vararg</a> &amp; <a class="code" href="lobject_8h.html#a115d3e111c3aeb332cad90c55b53571c">VARARG_HASARG</a>) &lt;= pt-&gt;<a class="code" href="structProto.html#a9c9ed4e9d996233f75cdf56b912e4803">maxstacksize</a>);
<a name="l00280"></a>00280   <a class="code" href="ldebug_8c.html#a437fe6dda055faa9899b4268918b8032">check</a>(!(pt-&gt;<a class="code" href="structProto.html#a82302f2e9040b681d5b34c1239dcd673">is_vararg</a> &amp; <a class="code" href="lobject_8h.html#ac9170c69096e345f21de0630da03539a">VARARG_NEEDSARG</a>) ||
<a name="l00281"></a>00281               (pt-&gt;<a class="code" href="structProto.html#a82302f2e9040b681d5b34c1239dcd673">is_vararg</a> &amp; <a class="code" href="lobject_8h.html#a115d3e111c3aeb332cad90c55b53571c">VARARG_HASARG</a>));
<a name="l00282"></a>00282   <a class="code" href="ldebug_8c.html#a437fe6dda055faa9899b4268918b8032">check</a>(pt-&gt;<a class="code" href="structProto.html#a6ecec897497ba7d94df6ef69289ef5c0">sizeupvalues</a> &lt;= pt-&gt;<a class="code" href="structProto.html#ae20e9996154a89085ac03eaaf8f23d32">nups</a>);
<a name="l00283"></a>00283   <a class="code" href="ldebug_8c.html#a437fe6dda055faa9899b4268918b8032">check</a>(pt-&gt;<a class="code" href="structProto.html#a65303ae1d815313f3358a578113fcc6e">sizelineinfo</a> == pt-&gt;<a class="code" href="structProto.html#a43e4d3849b5859112d93bdc2534a7cc0">sizecode</a> || pt-&gt;<a class="code" href="structProto.html#a65303ae1d815313f3358a578113fcc6e">sizelineinfo</a> == 0);
<a name="l00284"></a>00284   <a class="code" href="ldebug_8c.html#a437fe6dda055faa9899b4268918b8032">check</a>(pt-&gt;<a class="code" href="structProto.html#a43e4d3849b5859112d93bdc2534a7cc0">sizecode</a> &gt; 0 &amp;&amp; <a class="code" href="lopcodes_8h.html#aaa146179c3677b790c5681dcd82f0acc">GET_OPCODE</a>(pt-&gt;<a class="code" href="structProto.html#a53b66e4e4ac4b612a41b67a0ace9b6a5">code</a>[pt-&gt;<a class="code" href="structProto.html#a43e4d3849b5859112d93bdc2534a7cc0">sizecode</a>-1]) == <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7ad436c18b194473f5ec64c28b774e41b3">OP_RETURN</a>);
<a name="l00285"></a>00285   <span class="keywordflow">return</span> 1;
<a name="l00286"></a>00286 }
<a name="l00287"></a>00287 
<a name="l00288"></a>00288 
<a name="l00289"></a><a class="code" href="ldebug_8c.html#afb13853f4f0bbe220189b6fac17cec15">00289</a> <span class="preprocessor">#define checkopenop(pt,pc)  luaG_checkopenop((pt)-&gt;code[(pc)+1])</span>
<a name="l00290"></a>00290 <span class="preprocessor"></span>
<a name="l00291"></a><a class="code" href="ldebug_8h.html#a5e67d21bc85cc7bb41bbc62271d71d23">00291</a> <span class="keywordtype">int</span> <a class="code" href="ldebug_8c.html#a4d9ff6cdad8269e1255371a4d70829d9">luaG_checkopenop</a> (<a class="code" href="llimits_8h.html#a2d9700d30c1ae59754ecf50917c04d43">Instruction</a> i) {
<a name="l00292"></a>00292   <span class="keywordflow">switch</span> (<a class="code" href="lopcodes_8h.html#aaa146179c3677b790c5681dcd82f0acc">GET_OPCODE</a>(i)) {
<a name="l00293"></a>00293     <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7a098bbeea13096667b102f7fd90cbe38f">OP_CALL</a>:
<a name="l00294"></a>00294     <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7aff2c07ebfd82aa22cc247e9855a16069">OP_TAILCALL</a>:
<a name="l00295"></a>00295     <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7ad436c18b194473f5ec64c28b774e41b3">OP_RETURN</a>:
<a name="l00296"></a>00296     <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7a01618d8295953fd4ab2ef721b2051718">OP_SETLIST</a>: {
<a name="l00297"></a>00297       <a class="code" href="ldebug_8c.html#a437fe6dda055faa9899b4268918b8032">check</a>(<a class="code" href="lopcodes_8h.html#a7a343159ef7669a438c2097b839b2b13">GETARG_B</a>(i) == 0);
<a name="l00298"></a>00298       <span class="keywordflow">return</span> 1;
<a name="l00299"></a>00299     }
<a name="l00300"></a>00300     <span class="keywordflow">default</span>: <span class="keywordflow">return</span> 0;  <span class="comment">/* invalid instruction after an open call */</span>
<a name="l00301"></a>00301   }
<a name="l00302"></a>00302 }
<a name="l00303"></a>00303 
<a name="l00304"></a>00304 
<a name="l00305"></a><a class="code" href="ldebug_8c.html#ad94e93e77edd450535bbfc829a4a71f7">00305</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ldebug_8c.html#ad94e93e77edd450535bbfc829a4a71f7">checkArgMode</a> (<span class="keyword">const</span> <a class="code" href="structProto.html">Proto</a> *pt, <span class="keywordtype">int</span> r, <span class="keyword">enum</span> <a class="code" href="lopcodes_8h.html#a74ef10b1841536b2ae065f2371fb9436">OpArgMask</a> mode) {
<a name="l00306"></a>00306   <span class="keywordflow">switch</span> (mode) {
<a name="l00307"></a>00307     <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#a74ef10b1841536b2ae065f2371fb9436a62f4c828039f757e4eb8ec28754e27ac">OpArgN</a>: <a class="code" href="ldebug_8c.html#a437fe6dda055faa9899b4268918b8032">check</a>(r == 0); <span class="keywordflow">break</span>;
<a name="l00308"></a>00308     <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#a74ef10b1841536b2ae065f2371fb9436a590dbd8a54a83dc0480430b12e9e792d">OpArgU</a>: <span class="keywordflow">break</span>;
<a name="l00309"></a>00309     <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#a74ef10b1841536b2ae065f2371fb9436a1704c8739c8e44d4a28d98cf4dc1cd1f">OpArgR</a>: <a class="code" href="ldebug_8c.html#a16636d18aebfaa0a204e1a139088e504">checkreg</a>(pt, r); <span class="keywordflow">break</span>;
<a name="l00310"></a>00310     <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#a74ef10b1841536b2ae065f2371fb9436ad365ba9de2ad41c5962f29b1edbf3fd2">OpArgK</a>:
<a name="l00311"></a>00311       <a class="code" href="ldebug_8c.html#a437fe6dda055faa9899b4268918b8032">check</a>(<a class="code" href="lopcodes_8h.html#a143ea69a87f0463de7a856da4dd612e2">ISK</a>(r) ? <a class="code" href="lopcodes_8h.html#ab5017051e99e0a98e021863757bb2228">INDEXK</a>(r) &lt; pt-&gt;<a class="code" href="structProto.html#a5bd719e0486168f6ecd4b01bf41a7444">sizek</a> : r &lt; pt-&gt;maxstacksize);
<a name="l00312"></a>00312       <span class="keywordflow">break</span>;
<a name="l00313"></a>00313   }
<a name="l00314"></a>00314   <span class="keywordflow">return</span> 1;
<a name="l00315"></a>00315 }
<a name="l00316"></a>00316 
<a name="l00317"></a>00317 
<a name="l00318"></a><a class="code" href="ldebug_8c.html#a53bb438318b5584c9242c1c07d158208">00318</a> <span class="keyword">static</span> <a class="code" href="llimits_8h.html#a2d9700d30c1ae59754ecf50917c04d43">Instruction</a> <a class="code" href="ldebug_8c.html#a53bb438318b5584c9242c1c07d158208">symbexec</a> (<span class="keyword">const</span> <a class="code" href="structProto.html">Proto</a> *pt, <span class="keywordtype">int</span> lastpc, <span class="keywordtype">int</span> reg) {
<a name="l00319"></a>00319   <span class="keywordtype">int</span> pc;
<a name="l00320"></a>00320   <span class="keywordtype">int</span> last;  <span class="comment">/* stores position of last instruction that changed `reg&apos; */</span>
<a name="l00321"></a>00321   last = pt-&gt;<a class="code" href="structProto.html#a43e4d3849b5859112d93bdc2534a7cc0">sizecode</a>-1;  <span class="comment">/* points to final return (a `neutral&apos; instruction) */</span>
<a name="l00322"></a>00322   <a class="code" href="ldebug_8c.html#a437fe6dda055faa9899b4268918b8032">check</a>(<a class="code" href="ldebug_8c.html#a294c9f5b1c8e2972efcebf379d702735">precheck</a>(pt));
<a name="l00323"></a>00323   <span class="keywordflow">for</span> (pc = 0; pc &lt; lastpc; pc++) {
<a name="l00324"></a>00324     <a class="code" href="llimits_8h.html#a2d9700d30c1ae59754ecf50917c04d43">Instruction</a> i = pt-&gt;<a class="code" href="structProto.html#a53b66e4e4ac4b612a41b67a0ace9b6a5">code</a>[pc];
<a name="l00325"></a>00325     <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7">OpCode</a> op = <a class="code" href="lopcodes_8h.html#aaa146179c3677b790c5681dcd82f0acc">GET_OPCODE</a>(i);
<a name="l00326"></a>00326     <span class="keywordtype">int</span> a = <a class="code" href="lopcodes_8h.html#a1d504abc1e2246548f89977210dce0b9">GETARG_A</a>(i);
<a name="l00327"></a>00327     <span class="keywordtype">int</span> b = 0;
<a name="l00328"></a>00328     <span class="keywordtype">int</span> c = 0;
<a name="l00329"></a>00329     <a class="code" href="ldebug_8c.html#a437fe6dda055faa9899b4268918b8032">check</a>(op &lt; <a class="code" href="lopcodes_8h.html#a1fb469ba81540d3314cfbe37c675ba20">NUM_OPCODES</a>);
<a name="l00330"></a>00330     <a class="code" href="ldebug_8c.html#a16636d18aebfaa0a204e1a139088e504">checkreg</a>(pt, a);
<a name="l00331"></a>00331     <span class="keywordflow">switch</span> (<a class="code" href="lopcodes_8h.html#afb3fdd221fb95fdd1c254f7ab479739e">getOpMode</a>(op)) {
<a name="l00332"></a>00332       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#a56752d1aeb4bd4940e632396072d68afa5032b5bab05a3312f6236ad8a6053cf3">iABC</a>: {
<a name="l00333"></a>00333         b = <a class="code" href="lopcodes_8h.html#a7a343159ef7669a438c2097b839b2b13">GETARG_B</a>(i);
<a name="l00334"></a>00334         c = <a class="code" href="lopcodes_8h.html#af96cb84f2685fda7f36d3d099dba6a44">GETARG_C</a>(i);
<a name="l00335"></a>00335         <a class="code" href="ldebug_8c.html#a437fe6dda055faa9899b4268918b8032">check</a>(<a class="code" href="ldebug_8c.html#ad94e93e77edd450535bbfc829a4a71f7">checkArgMode</a>(pt, b, <a class="code" href="lopcodes_8h.html#af4588c163e23efaa97976d30c94d89b4">getBMode</a>(op)));
<a name="l00336"></a>00336         <a class="code" href="ldebug_8c.html#a437fe6dda055faa9899b4268918b8032">check</a>(<a class="code" href="ldebug_8c.html#ad94e93e77edd450535bbfc829a4a71f7">checkArgMode</a>(pt, c, <a class="code" href="lopcodes_8h.html#aa2535ccc1080a3705abfc0b1061b281e">getCMode</a>(op)));
<a name="l00337"></a>00337         <span class="keywordflow">break</span>;
<a name="l00338"></a>00338       }
<a name="l00339"></a>00339       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#a56752d1aeb4bd4940e632396072d68afae162f330f7a1e7581cdbbb4af60dc8ea">iABx</a>: {
<a name="l00340"></a>00340         b = <a class="code" href="lopcodes_8h.html#acf8d228275fd2789dcf5f019bbabc019">GETARG_Bx</a>(i);
<a name="l00341"></a>00341         <span class="keywordflow">if</span> (<a class="code" href="lopcodes_8h.html#af4588c163e23efaa97976d30c94d89b4">getBMode</a>(op) == <a class="code" href="lopcodes_8h.html#a74ef10b1841536b2ae065f2371fb9436ad365ba9de2ad41c5962f29b1edbf3fd2">OpArgK</a>) <a class="code" href="ldebug_8c.html#a437fe6dda055faa9899b4268918b8032">check</a>(b &lt; pt-&gt;sizek);
<a name="l00342"></a>00342         <span class="keywordflow">break</span>;
<a name="l00343"></a>00343       }
<a name="l00344"></a>00344       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#a56752d1aeb4bd4940e632396072d68afa5db94456d16691b254a6b2fc7b473e55">iAsBx</a>: {
<a name="l00345"></a>00345         b = <a class="code" href="lopcodes_8h.html#a1f61a823709ac7847e481290a596c480">GETARG_sBx</a>(i);
<a name="l00346"></a>00346         <span class="keywordflow">if</span> (<a class="code" href="lopcodes_8h.html#af4588c163e23efaa97976d30c94d89b4">getBMode</a>(op) == <a class="code" href="lopcodes_8h.html#a74ef10b1841536b2ae065f2371fb9436a1704c8739c8e44d4a28d98cf4dc1cd1f">OpArgR</a>) {
<a name="l00347"></a>00347           <span class="keywordtype">int</span> dest = pc+1+b;
<a name="l00348"></a>00348           <a class="code" href="ldebug_8c.html#a437fe6dda055faa9899b4268918b8032">check</a>(0 &lt;= dest &amp;&amp; dest &lt; pt-&gt;sizecode);
<a name="l00349"></a>00349           <span class="keywordflow">if</span> (dest &gt; 0) {
<a name="l00350"></a>00350             <span class="keywordtype">int</span> j;
<a name="l00351"></a>00351             <span class="comment">/* check that it does not jump to a setlist count; this</span>
<a name="l00352"></a>00352 <span class="comment">               is tricky, because the count from a previous setlist may</span>
<a name="l00353"></a>00353 <span class="comment">               have the same value of an invalid setlist; so, we must</span>
<a name="l00354"></a>00354 <span class="comment">               go all the way back to the first of them (if any) */</span>
<a name="l00355"></a>00355             <span class="keywordflow">for</span> (j = 0; j &lt; dest; j++) {
<a name="l00356"></a>00356               <a class="code" href="llimits_8h.html#a2d9700d30c1ae59754ecf50917c04d43">Instruction</a> <a class="code" href="libluasqlite3_8c.html#a8d6141748244c12982deaaf0dafd7449">d</a> = pt-&gt;<a class="code" href="structProto.html#a53b66e4e4ac4b612a41b67a0ace9b6a5">code</a>[dest-1-j];
<a name="l00357"></a>00357               <span class="keywordflow">if</span> (!(<a class="code" href="lopcodes_8h.html#aaa146179c3677b790c5681dcd82f0acc">GET_OPCODE</a>(d) == <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7a01618d8295953fd4ab2ef721b2051718">OP_SETLIST</a> &amp;&amp; <a class="code" href="lopcodes_8h.html#af96cb84f2685fda7f36d3d099dba6a44">GETARG_C</a>(d) == 0)) <span class="keywordflow">break</span>;
<a name="l00358"></a>00358             }
<a name="l00359"></a>00359             <span class="comment">/* if &apos;j&apos; is even, previous value is not a setlist (even if</span>
<a name="l00360"></a>00360 <span class="comment">               it looks like one) */</span>
<a name="l00361"></a>00361             <a class="code" href="ldebug_8c.html#a437fe6dda055faa9899b4268918b8032">check</a>((j&amp;1) == 0);
<a name="l00362"></a>00362           }
<a name="l00363"></a>00363         }
<a name="l00364"></a>00364         <span class="keywordflow">break</span>;
<a name="l00365"></a>00365       }
<a name="l00366"></a>00366     }
<a name="l00367"></a>00367     <span class="keywordflow">if</span> (<a class="code" href="lopcodes_8h.html#aaae51a1c7e304923c51509b7cd644f29">testAMode</a>(op)) {
<a name="l00368"></a>00368       <span class="keywordflow">if</span> (a == reg) last = pc;  <span class="comment">/* change register `a&apos; */</span>
<a name="l00369"></a>00369     }
<a name="l00370"></a>00370     <span class="keywordflow">if</span> (<a class="code" href="lopcodes_8h.html#a6750851f9d04ae7f9612146b07f88c97">testTMode</a>(op)) {
<a name="l00371"></a>00371       <a class="code" href="ldebug_8c.html#a437fe6dda055faa9899b4268918b8032">check</a>(pc+2 &lt; pt-&gt;<a class="code" href="structProto.html#a43e4d3849b5859112d93bdc2534a7cc0">sizecode</a>);  <span class="comment">/* check skip */</span>
<a name="l00372"></a>00372       <a class="code" href="ldebug_8c.html#a437fe6dda055faa9899b4268918b8032">check</a>(<a class="code" href="lopcodes_8h.html#aaa146179c3677b790c5681dcd82f0acc">GET_OPCODE</a>(pt-&gt;<a class="code" href="structProto.html#a53b66e4e4ac4b612a41b67a0ace9b6a5">code</a>[pc+1]) == <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7afd679fab86e6a91d22c91734e287639b">OP_JMP</a>);
<a name="l00373"></a>00373     }
<a name="l00374"></a>00374     <span class="keywordflow">switch</span> (op) {
<a name="l00375"></a>00375       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7af5f66d1583580293a60f96a26770e5ba">OP_LOADBOOL</a>: {
<a name="l00376"></a>00376         <span class="keywordflow">if</span> (c == 1) {  <span class="comment">/* does it jump? */</span>
<a name="l00377"></a>00377           <a class="code" href="ldebug_8c.html#a437fe6dda055faa9899b4268918b8032">check</a>(pc+2 &lt; pt-&gt;<a class="code" href="structProto.html#a43e4d3849b5859112d93bdc2534a7cc0">sizecode</a>);  <span class="comment">/* check its jump */</span>
<a name="l00378"></a>00378           <a class="code" href="ldebug_8c.html#a437fe6dda055faa9899b4268918b8032">check</a>(<a class="code" href="lopcodes_8h.html#aaa146179c3677b790c5681dcd82f0acc">GET_OPCODE</a>(pt-&gt;<a class="code" href="structProto.html#a53b66e4e4ac4b612a41b67a0ace9b6a5">code</a>[pc+1]) != <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7a01618d8295953fd4ab2ef721b2051718">OP_SETLIST</a> ||
<a name="l00379"></a>00379                 <a class="code" href="lopcodes_8h.html#af96cb84f2685fda7f36d3d099dba6a44">GETARG_C</a>(pt-&gt;<a class="code" href="structProto.html#a53b66e4e4ac4b612a41b67a0ace9b6a5">code</a>[pc+1]) != 0);
<a name="l00380"></a>00380         }
<a name="l00381"></a>00381         <span class="keywordflow">break</span>;
<a name="l00382"></a>00382       }
<a name="l00383"></a>00383       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7a5c399a98a26c923cdae3971b5e5b6432">OP_LOADNIL</a>: {
<a name="l00384"></a>00384         <span class="keywordflow">if</span> (a &lt;= reg &amp;&amp; reg &lt;= b)
<a name="l00385"></a>00385           last = pc;  <span class="comment">/* set registers from `a&apos; to `b&apos; */</span>
<a name="l00386"></a>00386         <span class="keywordflow">break</span>;
<a name="l00387"></a>00387       }
<a name="l00388"></a>00388       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7ab48573533495922f053a7d1c9b0d00b4">OP_GETUPVAL</a>:
<a name="l00389"></a>00389       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7a47df60373847890b47b447c870aea678">OP_SETUPVAL</a>: {
<a name="l00390"></a>00390         <a class="code" href="ldebug_8c.html#a437fe6dda055faa9899b4268918b8032">check</a>(b &lt; pt-&gt;nups);
<a name="l00391"></a>00391         <span class="keywordflow">break</span>;
<a name="l00392"></a>00392       }
<a name="l00393"></a>00393       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7a729612e249653e5ab46b6be3bb376910">OP_GETGLOBAL</a>:
<a name="l00394"></a>00394       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7af61bd9bc4032eb3716946058ecd96f7a">OP_SETGLOBAL</a>: {
<a name="l00395"></a>00395         <a class="code" href="ldebug_8c.html#a437fe6dda055faa9899b4268918b8032">check</a>(<a class="code" href="lobject_8h.html#a9bdf057a0de8da2ffae3ac35662dd255">ttisstring</a>(&amp;pt-&gt;<a class="code" href="structProto.html#ae292fb0c0558679704933824ce96eac2">k</a>[b]));
<a name="l00396"></a>00396         <span class="keywordflow">break</span>;
<a name="l00397"></a>00397       }
<a name="l00398"></a>00398       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7a64bea18253f9e73c4c5fcfa6b0d5abd2">OP_SELF</a>: {
<a name="l00399"></a>00399         <a class="code" href="ldebug_8c.html#a16636d18aebfaa0a204e1a139088e504">checkreg</a>(pt, a+1);
<a name="l00400"></a>00400         <span class="keywordflow">if</span> (reg == a+1) last = pc;
<a name="l00401"></a>00401         <span class="keywordflow">break</span>;
<a name="l00402"></a>00402       }
<a name="l00403"></a>00403       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7a28a7da14b1413b441cf2a5d433b43a51">OP_CONCAT</a>: {
<a name="l00404"></a>00404         <a class="code" href="ldebug_8c.html#a437fe6dda055faa9899b4268918b8032">check</a>(b &lt; c);  <span class="comment">/* at least two operands */</span>
<a name="l00405"></a>00405         <span class="keywordflow">break</span>;
<a name="l00406"></a>00406       }
<a name="l00407"></a>00407       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7a7dabccd7671c8ff374cb4502a6edb9c0">OP_TFORLOOP</a>: {
<a name="l00408"></a>00408         <a class="code" href="ldebug_8c.html#a437fe6dda055faa9899b4268918b8032">check</a>(c &gt;= 1);  <span class="comment">/* at least one result (control variable) */</span>
<a name="l00409"></a>00409         <a class="code" href="ldebug_8c.html#a16636d18aebfaa0a204e1a139088e504">checkreg</a>(pt, a+2+c);  <span class="comment">/* space for results */</span>
<a name="l00410"></a>00410         <span class="keywordflow">if</span> (reg &gt;= a+2) last = pc;  <span class="comment">/* affect all regs above its base */</span>
<a name="l00411"></a>00411         <span class="keywordflow">break</span>;
<a name="l00412"></a>00412       }
<a name="l00413"></a>00413       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7aa01470a2fc70a3f2dbd20c7c8f270802">OP_FORLOOP</a>:
<a name="l00414"></a>00414       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7a5277c6eb2b1ab790c4942fdccd749e33">OP_FORPREP</a>:
<a name="l00415"></a>00415         <a class="code" href="ldebug_8c.html#a16636d18aebfaa0a204e1a139088e504">checkreg</a>(pt, a+3);
<a name="l00416"></a>00416         <span class="comment">/* go through */</span>
<a name="l00417"></a>00417       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7afd679fab86e6a91d22c91734e287639b">OP_JMP</a>: {
<a name="l00418"></a>00418         <span class="keywordtype">int</span> dest = pc+1+b;
<a name="l00419"></a>00419         <span class="comment">/* not full check and jump is forward and do not skip `lastpc&apos;? */</span>
<a name="l00420"></a>00420         <span class="keywordflow">if</span> (reg != <a class="code" href="lopcodes_8h.html#a6552ce4b3bba3b1a820dc0adaf85974a">NO_REG</a> &amp;&amp; pc &lt; dest &amp;&amp; dest &lt;= lastpc)
<a name="l00421"></a>00421           pc += b;  <span class="comment">/* do the jump */</span>
<a name="l00422"></a>00422         <span class="keywordflow">break</span>;
<a name="l00423"></a>00423       }
<a name="l00424"></a>00424       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7a098bbeea13096667b102f7fd90cbe38f">OP_CALL</a>:
<a name="l00425"></a>00425       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7aff2c07ebfd82aa22cc247e9855a16069">OP_TAILCALL</a>: {
<a name="l00426"></a>00426         <span class="keywordflow">if</span> (b != 0) {
<a name="l00427"></a>00427           <a class="code" href="ldebug_8c.html#a16636d18aebfaa0a204e1a139088e504">checkreg</a>(pt, a+b-1);
<a name="l00428"></a>00428         }
<a name="l00429"></a>00429         c--;  <span class="comment">/* c = num. returns */</span>
<a name="l00430"></a>00430         <span class="keywordflow">if</span> (c == <a class="code" href="lua_8h.html#ace3545adc11664c2f2b152fbe8b6283c">LUA_MULTRET</a>) {
<a name="l00431"></a>00431           <a class="code" href="ldebug_8c.html#a437fe6dda055faa9899b4268918b8032">check</a>(<a class="code" href="ldebug_8c.html#afb13853f4f0bbe220189b6fac17cec15">checkopenop</a>(pt, pc));
<a name="l00432"></a>00432         }
<a name="l00433"></a>00433         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c != 0)
<a name="l00434"></a>00434           <a class="code" href="ldebug_8c.html#a16636d18aebfaa0a204e1a139088e504">checkreg</a>(pt, a+c-1);
<a name="l00435"></a>00435         <span class="keywordflow">if</span> (reg &gt;= a) last = pc;  <span class="comment">/* affect all registers above base */</span>
<a name="l00436"></a>00436         <span class="keywordflow">break</span>;
<a name="l00437"></a>00437       }
<a name="l00438"></a>00438       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7ad436c18b194473f5ec64c28b774e41b3">OP_RETURN</a>: {
<a name="l00439"></a>00439         b--;  <span class="comment">/* b = num. returns */</span>
<a name="l00440"></a>00440         <span class="keywordflow">if</span> (b &gt; 0) <a class="code" href="ldebug_8c.html#a16636d18aebfaa0a204e1a139088e504">checkreg</a>(pt, a+b-1);
<a name="l00441"></a>00441         <span class="keywordflow">break</span>;
<a name="l00442"></a>00442       }
<a name="l00443"></a>00443       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7a01618d8295953fd4ab2ef721b2051718">OP_SETLIST</a>: {
<a name="l00444"></a>00444         <span class="keywordflow">if</span> (b &gt; 0) <a class="code" href="ldebug_8c.html#a16636d18aebfaa0a204e1a139088e504">checkreg</a>(pt, a + b);
<a name="l00445"></a>00445         <span class="keywordflow">if</span> (c == 0) {
<a name="l00446"></a>00446           pc++;
<a name="l00447"></a>00447           <a class="code" href="ldebug_8c.html#a437fe6dda055faa9899b4268918b8032">check</a>(pc &lt; pt-&gt;sizecode - 1);
<a name="l00448"></a>00448         }
<a name="l00449"></a>00449         <span class="keywordflow">break</span>;
<a name="l00450"></a>00450       }
<a name="l00451"></a>00451       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7a407a76cd8c503b0f4dc14603687a77a2">OP_CLOSURE</a>: {
<a name="l00452"></a>00452         <span class="keywordtype">int</span> nup, j;
<a name="l00453"></a>00453         <a class="code" href="ldebug_8c.html#a437fe6dda055faa9899b4268918b8032">check</a>(b &lt; pt-&gt;sizep);
<a name="l00454"></a>00454         nup = pt-&gt;<a class="code" href="structProto.html#a54dc8e2e8973007794fa0ab0e4a71461">p</a>[b]-&gt;<a class="code" href="structProto.html#ae20e9996154a89085ac03eaaf8f23d32">nups</a>;
<a name="l00455"></a>00455         <a class="code" href="ldebug_8c.html#a437fe6dda055faa9899b4268918b8032">check</a>(pc + nup &lt; pt-&gt;sizecode);
<a name="l00456"></a>00456         <span class="keywordflow">for</span> (j = 1; j &lt;= nup; j++) {
<a name="l00457"></a>00457           <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7">OpCode</a> op1 = <a class="code" href="lopcodes_8h.html#aaa146179c3677b790c5681dcd82f0acc">GET_OPCODE</a>(pt-&gt;<a class="code" href="structProto.html#a53b66e4e4ac4b612a41b67a0ace9b6a5">code</a>[pc + j]);
<a name="l00458"></a>00458           <a class="code" href="ldebug_8c.html#a437fe6dda055faa9899b4268918b8032">check</a>(op1 == <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7ab48573533495922f053a7d1c9b0d00b4">OP_GETUPVAL</a> || op1 == <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7addf83bbc02b6a88d325135c880d12184">OP_MOVE</a>);
<a name="l00459"></a>00459         }
<a name="l00460"></a>00460         <span class="keywordflow">if</span> (reg != <a class="code" href="lopcodes_8h.html#a6552ce4b3bba3b1a820dc0adaf85974a">NO_REG</a>)  <span class="comment">/* tracing? */</span>
<a name="l00461"></a>00461           pc += nup;  <span class="comment">/* do not &apos;execute&apos; these pseudo-instructions */</span>
<a name="l00462"></a>00462         <span class="keywordflow">break</span>;
<a name="l00463"></a>00463       }
<a name="l00464"></a>00464       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7a1856103c50818d72aaa506821a4ef004">OP_VARARG</a>: {
<a name="l00465"></a>00465         <a class="code" href="ldebug_8c.html#a437fe6dda055faa9899b4268918b8032">check</a>((pt-&gt;<a class="code" href="structProto.html#a82302f2e9040b681d5b34c1239dcd673">is_vararg</a> &amp; <a class="code" href="lobject_8h.html#a09e8493bb5a9d886eed1390820e19a88">VARARG_ISVARARG</a>) &amp;&amp;
<a name="l00466"></a>00466              !(pt-&gt;<a class="code" href="structProto.html#a82302f2e9040b681d5b34c1239dcd673">is_vararg</a> &amp; <a class="code" href="lobject_8h.html#ac9170c69096e345f21de0630da03539a">VARARG_NEEDSARG</a>));
<a name="l00467"></a>00467         b--;
<a name="l00468"></a>00468         <span class="keywordflow">if</span> (b == <a class="code" href="lua_8h.html#ace3545adc11664c2f2b152fbe8b6283c">LUA_MULTRET</a>) <a class="code" href="ldebug_8c.html#a437fe6dda055faa9899b4268918b8032">check</a>(<a class="code" href="ldebug_8c.html#afb13853f4f0bbe220189b6fac17cec15">checkopenop</a>(pt, pc));
<a name="l00469"></a>00469         <a class="code" href="ldebug_8c.html#a16636d18aebfaa0a204e1a139088e504">checkreg</a>(pt, a+b-1);
<a name="l00470"></a>00470         <span class="keywordflow">break</span>;
<a name="l00471"></a>00471       }
<a name="l00472"></a>00472       <span class="keywordflow">default</span>: <span class="keywordflow">break</span>;
<a name="l00473"></a>00473     }
<a name="l00474"></a>00474   }
<a name="l00475"></a>00475   <span class="keywordflow">return</span> pt-&gt;<a class="code" href="structProto.html#a53b66e4e4ac4b612a41b67a0ace9b6a5">code</a>[last];
<a name="l00476"></a>00476 }
<a name="l00477"></a>00477 
<a name="l00478"></a>00478 <span class="preprocessor">#undef check</span>
<a name="l00479"></a>00479 <span class="preprocessor"></span><span class="preprocessor">#undef checkjump</span>
<a name="l00480"></a>00480 <span class="preprocessor"></span><span class="preprocessor">#undef checkreg</span>
<a name="l00481"></a>00481 <span class="preprocessor"></span>
<a name="l00482"></a>00482 <span class="comment">/* }====================================================== */</span>
<a name="l00483"></a>00483 
<a name="l00484"></a>00484 
<a name="l00485"></a><a class="code" href="ldebug_8h.html#a7d65df36fe4b21a7d83053f1b5f1f653">00485</a> <span class="keywordtype">int</span> <a class="code" href="ldebug_8c.html#a1abb4dc97c40ac34a3a1de5fca70f7c2">luaG_checkcode</a> (<span class="keyword">const</span> <a class="code" href="structProto.html">Proto</a> *pt) {
<a name="l00486"></a>00486   <span class="keywordflow">return</span> (<a class="code" href="ldebug_8c.html#a53bb438318b5584c9242c1c07d158208">symbexec</a>(pt, pt-&gt;<a class="code" href="structProto.html#a43e4d3849b5859112d93bdc2534a7cc0">sizecode</a>, <a class="code" href="lopcodes_8h.html#a6552ce4b3bba3b1a820dc0adaf85974a">NO_REG</a>) != 0);
<a name="l00487"></a>00487 }
<a name="l00488"></a>00488 
<a name="l00489"></a>00489 
<a name="l00490"></a><a class="code" href="ldebug_8c.html#a896df10e8edbe86d8e62b3e81d851ab3">00490</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="ldebug_8c.html#a896df10e8edbe86d8e62b3e81d851ab3">kname</a> (<a class="code" href="structProto.html">Proto</a> *p, <span class="keywordtype">int</span> c) {
<a name="l00491"></a>00491   <span class="keywordflow">if</span> (<a class="code" href="lopcodes_8h.html#a143ea69a87f0463de7a856da4dd612e2">ISK</a>(c) &amp;&amp; <a class="code" href="lobject_8h.html#a9bdf057a0de8da2ffae3ac35662dd255">ttisstring</a>(&amp;p-&gt;<a class="code" href="structProto.html#ae292fb0c0558679704933824ce96eac2">k</a>[<a class="code" href="lopcodes_8h.html#ab5017051e99e0a98e021863757bb2228">INDEXK</a>(c)]))
<a name="l00492"></a>00492     <span class="keywordflow">return</span> <a class="code" href="lobject_8h.html#ac2c9eedf3ff2c3042445b3b534f161e1">svalue</a>(&amp;p-&gt;<a class="code" href="structProto.html#ae292fb0c0558679704933824ce96eac2">k</a>[<a class="code" href="lopcodes_8h.html#ab5017051e99e0a98e021863757bb2228">INDEXK</a>(c)]);
<a name="l00493"></a>00493   <span class="keywordflow">else</span>
<a name="l00494"></a>00494     <span class="keywordflow">return</span> <span class="stringliteral">&quot;?&quot;</span>;
<a name="l00495"></a>00495 }
<a name="l00496"></a>00496 
<a name="l00497"></a>00497 
<a name="l00498"></a><a class="code" href="ldebug_8c.html#ada297c81d135febbe80c95e340929608">00498</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="ldebug_8c.html#ada297c81d135febbe80c95e340929608">getobjname</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <a class="code" href="structCallInfo.html">CallInfo</a> *ci, <span class="keywordtype">int</span> stackpos,
<a name="l00499"></a>00499                                <span class="keyword">const</span> <span class="keywordtype">char</span> **name) {
<a name="l00500"></a>00500   <span class="keywordflow">if</span> (<a class="code" href="lstate_8h.html#a489eab424b094f54dd7f6b35e2cf68a2">isLua</a>(ci)) {  <span class="comment">/* a Lua function? */</span>
<a name="l00501"></a>00501     <a class="code" href="structProto.html">Proto</a> *p = <a class="code" href="lstate_8h.html#a12b504eee786ce8f2c703a22c03d477e">ci_func</a>(ci)-&gt;l.p;
<a name="l00502"></a>00502     <span class="keywordtype">int</span> pc = <a class="code" href="ldebug_8c.html#aadd6060aae54fd1b822345b8c58a86f5">currentpc</a>(L, ci);
<a name="l00503"></a>00503     <a class="code" href="llimits_8h.html#a2d9700d30c1ae59754ecf50917c04d43">Instruction</a> i;
<a name="l00504"></a>00504     *name = <a class="code" href="lfunc_8c.html#aaa3cd5bc3901e7edf1ac428151cdfe8c">luaF_getlocalname</a>(p, stackpos+1, pc);
<a name="l00505"></a>00505     <span class="keywordflow">if</span> (*name)  <span class="comment">/* is a local? */</span>
<a name="l00506"></a>00506       <span class="keywordflow">return</span> <span class="stringliteral">&quot;local&quot;</span>;
<a name="l00507"></a>00507     i = <a class="code" href="ldebug_8c.html#a53bb438318b5584c9242c1c07d158208">symbexec</a>(p, pc, stackpos);  <span class="comment">/* try symbolic execution */</span>
<a name="l00508"></a>00508     <a class="code" href="llimits_8h.html#a5978f5fda715bd80e845df1e16ad7780">lua_assert</a>(pc != -1);
<a name="l00509"></a>00509     <span class="keywordflow">switch</span> (<a class="code" href="lopcodes_8h.html#aaa146179c3677b790c5681dcd82f0acc">GET_OPCODE</a>(i)) {
<a name="l00510"></a>00510       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7a729612e249653e5ab46b6be3bb376910">OP_GETGLOBAL</a>: {
<a name="l00511"></a>00511         <span class="keywordtype">int</span> g = <a class="code" href="lopcodes_8h.html#acf8d228275fd2789dcf5f019bbabc019">GETARG_Bx</a>(i);  <span class="comment">/* global index */</span>
<a name="l00512"></a>00512         <a class="code" href="llimits_8h.html#a5978f5fda715bd80e845df1e16ad7780">lua_assert</a>(<a class="code" href="lobject_8h.html#a9bdf057a0de8da2ffae3ac35662dd255">ttisstring</a>(&amp;p-&gt;<a class="code" href="structProto.html#ae292fb0c0558679704933824ce96eac2">k</a>[g]));
<a name="l00513"></a>00513         *name = <a class="code" href="lobject_8h.html#ac2c9eedf3ff2c3042445b3b534f161e1">svalue</a>(&amp;p-&gt;<a class="code" href="structProto.html#ae292fb0c0558679704933824ce96eac2">k</a>[g]);
<a name="l00514"></a>00514         <span class="keywordflow">return</span> <span class="stringliteral">&quot;global&quot;</span>;
<a name="l00515"></a>00515       }
<a name="l00516"></a>00516       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7addf83bbc02b6a88d325135c880d12184">OP_MOVE</a>: {
<a name="l00517"></a>00517         <span class="keywordtype">int</span> a = <a class="code" href="lopcodes_8h.html#a1d504abc1e2246548f89977210dce0b9">GETARG_A</a>(i);
<a name="l00518"></a>00518         <span class="keywordtype">int</span> b = <a class="code" href="lopcodes_8h.html#a7a343159ef7669a438c2097b839b2b13">GETARG_B</a>(i);  <span class="comment">/* move from `b&apos; to `a&apos; */</span>
<a name="l00519"></a>00519         <span class="keywordflow">if</span> (b &lt; a)
<a name="l00520"></a>00520           <span class="keywordflow">return</span> <a class="code" href="ldebug_8c.html#ada297c81d135febbe80c95e340929608">getobjname</a>(L, ci, b, name);  <span class="comment">/* get name for `b&apos; */</span>
<a name="l00521"></a>00521         <span class="keywordflow">break</span>;
<a name="l00522"></a>00522       }
<a name="l00523"></a>00523       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7ab1ec2a36c59db7612249cc31e382fdd9">OP_GETTABLE</a>: {
<a name="l00524"></a>00524         <span class="keywordtype">int</span> k = <a class="code" href="lopcodes_8h.html#af96cb84f2685fda7f36d3d099dba6a44">GETARG_C</a>(i);  <span class="comment">/* key index */</span>
<a name="l00525"></a>00525         *name = <a class="code" href="ldebug_8c.html#a896df10e8edbe86d8e62b3e81d851ab3">kname</a>(p, k);
<a name="l00526"></a>00526         <span class="keywordflow">return</span> <span class="stringliteral">&quot;field&quot;</span>;
<a name="l00527"></a>00527       }
<a name="l00528"></a>00528       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7ab48573533495922f053a7d1c9b0d00b4">OP_GETUPVAL</a>: {
<a name="l00529"></a>00529         <span class="keywordtype">int</span> u = <a class="code" href="lopcodes_8h.html#a7a343159ef7669a438c2097b839b2b13">GETARG_B</a>(i);  <span class="comment">/* upvalue index */</span>
<a name="l00530"></a>00530         *name = p-&gt;<a class="code" href="structProto.html#abebc63aea579a1b630efc04d2bf9c4b7">upvalues</a> ? <a class="code" href="lobject_8h.html#acb05d3ab238923581a9c629b8e11a6ac">getstr</a>(p-&gt;<a class="code" href="structProto.html#abebc63aea579a1b630efc04d2bf9c4b7">upvalues</a>[u]) : <span class="stringliteral">&quot;?&quot;</span>;
<a name="l00531"></a>00531         <span class="keywordflow">return</span> <span class="stringliteral">&quot;upvalue&quot;</span>;
<a name="l00532"></a>00532       }
<a name="l00533"></a>00533       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7a64bea18253f9e73c4c5fcfa6b0d5abd2">OP_SELF</a>: {
<a name="l00534"></a>00534         <span class="keywordtype">int</span> k = <a class="code" href="lopcodes_8h.html#af96cb84f2685fda7f36d3d099dba6a44">GETARG_C</a>(i);  <span class="comment">/* key index */</span>
<a name="l00535"></a>00535         *name = <a class="code" href="ldebug_8c.html#a896df10e8edbe86d8e62b3e81d851ab3">kname</a>(p, k);
<a name="l00536"></a>00536         <span class="keywordflow">return</span> <span class="stringliteral">&quot;method&quot;</span>;
<a name="l00537"></a>00537       }
<a name="l00538"></a>00538       <span class="keywordflow">default</span>: <span class="keywordflow">break</span>;
<a name="l00539"></a>00539     }
<a name="l00540"></a>00540   }
<a name="l00541"></a>00541   <span class="keywordflow">return</span> NULL;  <span class="comment">/* no useful name found */</span>
<a name="l00542"></a>00542 }
<a name="l00543"></a>00543 
<a name="l00544"></a>00544 
<a name="l00545"></a><a class="code" href="ldebug_8c.html#abf0d60b43b4bff2821e87b2f4054a6b7">00545</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="ldebug_8c.html#abf0d60b43b4bff2821e87b2f4054a6b7">getfuncname</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <a class="code" href="structCallInfo.html">CallInfo</a> *ci, <span class="keyword">const</span> <span class="keywordtype">char</span> **name) {
<a name="l00546"></a>00546   <a class="code" href="llimits_8h.html#a2d9700d30c1ae59754ecf50917c04d43">Instruction</a> i;
<a name="l00547"></a>00547   <span class="keywordflow">if</span> ((<a class="code" href="lstate_8h.html#a489eab424b094f54dd7f6b35e2cf68a2">isLua</a>(ci) &amp;&amp; ci-&gt;<a class="code" href="structCallInfo.html#ae00bf2bdc64fc9d3f6599b6446b323c6">tailcalls</a> &gt; 0) || !<a class="code" href="lstate_8h.html#a489eab424b094f54dd7f6b35e2cf68a2">isLua</a>(ci - 1))
<a name="l00548"></a>00548     <span class="keywordflow">return</span> NULL;  <span class="comment">/* calling function is not Lua (or is unknown) */</span>
<a name="l00549"></a>00549   ci--;  <span class="comment">/* calling function */</span>
<a name="l00550"></a>00550   i = <a class="code" href="lstate_8h.html#a12b504eee786ce8f2c703a22c03d477e">ci_func</a>(ci)-&gt;l.p-&gt;code[<a class="code" href="ldebug_8c.html#aadd6060aae54fd1b822345b8c58a86f5">currentpc</a>(L, ci)];
<a name="l00551"></a>00551   <span class="keywordflow">if</span> (<a class="code" href="lopcodes_8h.html#aaa146179c3677b790c5681dcd82f0acc">GET_OPCODE</a>(i) == <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7a098bbeea13096667b102f7fd90cbe38f">OP_CALL</a> || <a class="code" href="lopcodes_8h.html#aaa146179c3677b790c5681dcd82f0acc">GET_OPCODE</a>(i) == <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7aff2c07ebfd82aa22cc247e9855a16069">OP_TAILCALL</a> ||
<a name="l00552"></a>00552       <a class="code" href="lopcodes_8h.html#aaa146179c3677b790c5681dcd82f0acc">GET_OPCODE</a>(i) == <a class="code" href="lopcodes_8h.html#abeb7dfb0e9e2b3114e240a405d046ea7a7dabccd7671c8ff374cb4502a6edb9c0">OP_TFORLOOP</a>)
<a name="l00553"></a>00553     <span class="keywordflow">return</span> <a class="code" href="ldebug_8c.html#ada297c81d135febbe80c95e340929608">getobjname</a>(L, ci, <a class="code" href="lopcodes_8h.html#a1d504abc1e2246548f89977210dce0b9">GETARG_A</a>(i), name);
<a name="l00554"></a>00554   <span class="keywordflow">else</span>
<a name="l00555"></a>00555     <span class="keywordflow">return</span> NULL;  <span class="comment">/* no useful name can be found */</span>
<a name="l00556"></a>00556 }
<a name="l00557"></a>00557 
<a name="l00558"></a>00558 
<a name="l00559"></a>00559 <span class="comment">/* only ANSI way to check whether a pointer points to an array */</span>
<a name="l00560"></a><a class="code" href="ldebug_8c.html#a9f58a8099ec72d2ec0e0937b868fccdb">00560</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ldebug_8c.html#a9f58a8099ec72d2ec0e0937b868fccdb">isinstack</a> (<a class="code" href="structCallInfo.html">CallInfo</a> *ci, <span class="keyword">const</span> <a class="code" href="structlua__TValue.html">TValue</a> *o) {
<a name="l00561"></a>00561   <a class="code" href="structlua__TValue.html">StkId</a> p;
<a name="l00562"></a>00562   <span class="keywordflow">for</span> (p = ci-&gt;<a class="code" href="structCallInfo.html#a7b8303ad59b7ba200cd5e3a26b118fbf">base</a>; p &lt; ci-&gt;top; p++)
<a name="l00563"></a>00563     <span class="keywordflow">if</span> (o == p) <span class="keywordflow">return</span> 1;
<a name="l00564"></a>00564   <span class="keywordflow">return</span> 0;
<a name="l00565"></a>00565 }
<a name="l00566"></a>00566 
<a name="l00567"></a>00567 
<a name="l00568"></a><a class="code" href="ldebug_8h.html#af3ae77496bfcfcb1c46564f3e3abd5d8">00568</a> <span class="keywordtype">void</span> <a class="code" href="ldebug_8c.html#ac435d10ca9d22f7dd70bfb36fa41a649">luaG_typeerror</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keyword">const</span> <a class="code" href="structlua__TValue.html">TValue</a> *o, <span class="keyword">const</span> <span class="keywordtype">char</span> *op) {
<a name="l00569"></a>00569   <span class="comment">//logt(&quot;luaG_typeerror&quot;);</span>
<a name="l00570"></a>00570   <span class="comment">//logg(&quot;operation is &apos;%s&apos;&quot;, op ? op : &quot;NULL&quot;);</span>
<a name="l00571"></a>00571   <span class="keyword">const</span> <span class="keywordtype">char</span> *name = NULL;
<a name="l00572"></a>00572   <span class="keyword">const</span> <span class="keywordtype">char</span> *t = <a class="code" href="ltm_8c.html#a3ba7d248c312c86b29d7027a374ebc4f">luaT_typenames</a>[<a class="code" href="lobject_8h.html#acd205ab396b96fba48e1f758c17a2cf3">ttype</a>(o)];
<a name="l00573"></a>00573   <span class="comment">//logg(&quot;type name is &apos;%s&apos;&quot;, t ? t : &quot;NULL&quot;);</span>
<a name="l00574"></a>00574   <span class="keyword">const</span> <span class="keywordtype">char</span> *kind = (<a class="code" href="ldebug_8c.html#a9f58a8099ec72d2ec0e0937b868fccdb">isinstack</a>(L-&gt;<a class="code" href="structlua__State.html#a7fbb5727050853f411ad64b4be9ab5c8">ci</a>, o)) ?
<a name="l00575"></a>00575     <a class="code" href="ldebug_8c.html#ada297c81d135febbe80c95e340929608">getobjname</a>(L, L-&gt;<a class="code" href="structlua__State.html#a7fbb5727050853f411ad64b4be9ab5c8">ci</a>, <a class="code" href="llimits_8h.html#a37a9e2c4b53433d34bad0f12a1500c08">cast_int</a>(o - L-&gt;<a class="code" href="structlua__State.html#ac11fa7aeb6254b8de57fb9d1dd06fdf2">base</a>), &amp;name) :
<a name="l00576"></a>00576     NULL;
<a name="l00577"></a>00577   <span class="comment">//logg(&quot;kind is &apos;%s&apos;&quot;, kind ? kind : &quot;NULL&quot;);</span>
<a name="l00578"></a>00578   <span class="keywordflow">if</span> (kind)
<a name="l00579"></a>00579     <a class="code" href="ldebug_8h.html#a1742aa565eb8718d23af060767d948fa">luaG_runerror_m</a>(L, <span class="stringliteral">&quot;attempt to %s %s &quot;</span> <a class="code" href="luaconf_8h.html#a036be0033b6a9a18e657d5cad9d501aa">LUA_QS</a> <span class="stringliteral">&quot; (a %s value)&quot;</span>,
<a name="l00580"></a>00580         op, kind, name, t);
<a name="l00581"></a>00581   <span class="keywordflow">else</span>
<a name="l00582"></a>00582     <a class="code" href="ldebug_8h.html#a1742aa565eb8718d23af060767d948fa">luaG_runerror_m</a>(L, <span class="stringliteral">&quot;attempt to %s a %s value&quot;</span>, op, t);
<a name="l00583"></a>00583 }
<a name="l00584"></a>00584 
<a name="l00585"></a>00585 
<a name="l00586"></a><a class="code" href="ldebug_8h.html#a211d80c7ae6c7481a284ba8967a1ba92">00586</a> <span class="keywordtype">void</span> <a class="code" href="ldebug_8c.html#a35847e9106b2a11342d215199492ded4">luaG_concaterror</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <a class="code" href="structlua__TValue.html">StkId</a> p1, <a class="code" href="structlua__TValue.html">StkId</a> p2) {
<a name="l00587"></a>00587   <span class="keywordflow">if</span> (<a class="code" href="lobject_8h.html#a9bdf057a0de8da2ffae3ac35662dd255">ttisstring</a>(p1) || <a class="code" href="lobject_8h.html#a7a1392f89b1f29ed3b1afa37a22d0be2">ttisnumber</a>(p1)) p1 = p2;
<a name="l00588"></a>00588   <a class="code" href="llimits_8h.html#a5978f5fda715bd80e845df1e16ad7780">lua_assert</a>(!<a class="code" href="lobject_8h.html#a9bdf057a0de8da2ffae3ac35662dd255">ttisstring</a>(p1) &amp;&amp; !<a class="code" href="lobject_8h.html#a7a1392f89b1f29ed3b1afa37a22d0be2">ttisnumber</a>(p1));
<a name="l00589"></a>00589   <a class="code" href="ldebug_8c.html#ac435d10ca9d22f7dd70bfb36fa41a649">luaG_typeerror</a>(L, p1, <span class="stringliteral">&quot;concatenate&quot;</span>);
<a name="l00590"></a>00590 }
<a name="l00591"></a>00591 
<a name="l00592"></a>00592 
<a name="l00593"></a><a class="code" href="ldebug_8h.html#a25ef220fbe5ff309aa2bd09aa3e0975b">00593</a> <span class="keywordtype">void</span> <a class="code" href="ldebug_8c.html#a5d76c740cd1619e024dc6de84a86b8fc">luaG_aritherror</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keyword">const</span> <a class="code" href="structlua__TValue.html">TValue</a> *p1, <span class="keyword">const</span> <a class="code" href="structlua__TValue.html">TValue</a> *p2) {
<a name="l00594"></a>00594   <a class="code" href="structlua__TValue.html">TValue</a> temp;
<a name="l00595"></a>00595   <span class="keywordflow">if</span> (<a class="code" href="lvm_8c.html#aea792c4e6a5eec41350e999d9609335e">luaV_tonumber</a>(p1, &amp;temp) == NULL)
<a name="l00596"></a>00596     p2 = p1;  <span class="comment">/* first operand is wrong */</span>
<a name="l00597"></a>00597   <a class="code" href="ldebug_8c.html#ac435d10ca9d22f7dd70bfb36fa41a649">luaG_typeerror</a>(L, p2, <span class="stringliteral">&quot;perform arithmetic on&quot;</span>);
<a name="l00598"></a>00598 }
<a name="l00599"></a>00599 
<a name="l00600"></a>00600 
<a name="l00601"></a><a class="code" href="ldebug_8h.html#a95505503dc1dfc1506d2f99f0a27580a">00601</a> <span class="keywordtype">int</span> <a class="code" href="ldebug_8c.html#a73c2897b44470d40e39663273889f98a">luaG_ordererror</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keyword">const</span> <a class="code" href="structlua__TValue.html">TValue</a> *p1, <span class="keyword">const</span> <a class="code" href="structlua__TValue.html">TValue</a> *p2) {
<a name="l00602"></a>00602   <span class="comment">//logt(&quot;luaG_ordererror&quot;);</span>
<a name="l00603"></a>00603   <span class="keyword">const</span> <span class="keywordtype">char</span> *t1 = <a class="code" href="ltm_8c.html#a3ba7d248c312c86b29d7027a374ebc4f">luaT_typenames</a>[<a class="code" href="lobject_8h.html#acd205ab396b96fba48e1f758c17a2cf3">ttype</a>(p1)];
<a name="l00604"></a>00604   <span class="keyword">const</span> <span class="keywordtype">char</span> *t2 = <a class="code" href="ltm_8c.html#a3ba7d248c312c86b29d7027a374ebc4f">luaT_typenames</a>[<a class="code" href="lobject_8h.html#acd205ab396b96fba48e1f758c17a2cf3">ttype</a>(p2)];
<a name="l00605"></a>00605 <span class="preprocessor">#if 0</span>
<a name="l00606"></a>00606 <span class="preprocessor"></span>  <span class="comment">// This does not cause a crash on Symbian.</span>
<a name="l00607"></a>00607   <a class="code" href="lobject_8h.html#a2defbd1005c5aebb5807517ddea80f3f">setsvalue2s</a>(L, L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>, <a class="code" href="lstring_8h.html#aba4257be9dae5dccd0cda4ac05986d4d">luaS_new</a>(L, <span class="stringliteral">&quot;dummy message&quot;</span>));
<a name="l00608"></a>00608   <a class="code" href="ldo_8h.html#a9c102d2b8b9a0a52bbb15eeeb4e0cbac">incr_top</a>(L);
<a name="l00609"></a>00609   <a class="code" href="ldo_8c.html#a97706fc4752c2b3ea1ea23ae2b9e2d9a">luaD_throw</a>(L, <a class="code" href="lua_8h.html#af4bd6d4de5f10de738f81d007982abed">LUA_ERRRUN</a>);
<a name="l00610"></a>00610 <span class="preprocessor">#else</span>
<a name="l00611"></a>00611 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (t1[2] == t2[2])
<a name="l00612"></a>00612     <a class="code" href="ldebug_8h.html#a1742aa565eb8718d23af060767d948fa">luaG_runerror_m</a>(L, <span class="stringliteral">&quot;attempt to compare two %s values&quot;</span>, t1);
<a name="l00613"></a>00613   <span class="keywordflow">else</span>
<a name="l00614"></a>00614     <a class="code" href="ldebug_8h.html#a1742aa565eb8718d23af060767d948fa">luaG_runerror_m</a>(L, <span class="stringliteral">&quot;attempt to compare %s with %s&quot;</span>, t1, t2);
<a name="l00615"></a>00615 <span class="preprocessor">#endif</span>
<a name="l00616"></a>00616 <span class="preprocessor"></span>  <span class="keywordflow">return</span> 0;
<a name="l00617"></a>00617 }
<a name="l00618"></a>00618 
<a name="l00619"></a>00619 
<a name="l00620"></a><a class="code" href="ldebug_8h.html#a033020d8d0a20b645ec945a1ab755ea3">00620</a> <span class="keywordtype">void</span> <a class="code" href="ldebug_8c.html#ad12d1709978097158ace5169f9802da9">luaG_errormsg</a> (<a class="code" href="structlua__State.html">lua_State</a> *L) {
<a name="l00621"></a>00621   <span class="comment">//logt(&quot;luaG_errormsg&quot;);</span>
<a name="l00622"></a>00622   <span class="keywordflow">if</span> (L-&gt;<a class="code" href="structlua__State.html#a09de3a7c6d3bcb6c2b0d26a81bb8d44b">errfunc</a> != 0) {  <span class="comment">/* is there an error handling function? */</span>
<a name="l00623"></a>00623     <span class="comment">//logt(&quot;have error handling function&quot;);</span>
<a name="l00624"></a>00624     <a class="code" href="structlua__TValue.html">StkId</a> errfunc = <a class="code" href="ldo_8h.html#a3fbde7f289e6bf661575e9b802da9e78">restorestack</a>(L, L-&gt;<a class="code" href="structlua__State.html#a09de3a7c6d3bcb6c2b0d26a81bb8d44b">errfunc</a>);
<a name="l00625"></a>00625     <span class="keywordflow">if</span> (!<a class="code" href="lobject_8h.html#a48587dcb78721d149d3184d0768f4950">ttisfunction</a>(errfunc)) <a class="code" href="ldo_8c.html#a97706fc4752c2b3ea1ea23ae2b9e2d9a">luaD_throw</a>(L, <a class="code" href="lua_8h.html#a295ea44b6036e266b06e5de0f8ff24e0">LUA_ERRERR</a>);
<a name="l00626"></a>00626     <a class="code" href="lobject_8h.html#a6d30d7fa36e78e0bfb56ba38d9e89ce2">setobjs2s</a>(L, L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>, L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> - 1);  <span class="comment">/* move argument */</span>
<a name="l00627"></a>00627     <a class="code" href="lobject_8h.html#a6d30d7fa36e78e0bfb56ba38d9e89ce2">setobjs2s</a>(L, L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> - 1, errfunc);  <span class="comment">/* push function */</span>
<a name="l00628"></a>00628     <a class="code" href="ldo_8h.html#a9c102d2b8b9a0a52bbb15eeeb4e0cbac">incr_top</a>(L);
<a name="l00629"></a>00629     <a class="code" href="ldo_8c.html#a5483fddd87ca999e7d037bf397ab7997">luaD_call</a>(L, L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a> - 2, 1);  <span class="comment">/* call it */</span>
<a name="l00630"></a>00630   }
<a name="l00631"></a>00631   <span class="comment">//logt(&quot;throwing now&quot;);</span>
<a name="l00632"></a>00632   <a class="code" href="ldo_8c.html#a97706fc4752c2b3ea1ea23ae2b9e2d9a">luaD_throw</a>(L, <a class="code" href="lua_8h.html#af4bd6d4de5f10de738f81d007982abed">LUA_ERRRUN</a>);
<a name="l00633"></a>00633 }
<a name="l00634"></a>00634 
<a name="l00635"></a>00635 <span class="preprocessor">#if EXCEPTION_CRASHES_VARARGS_BUG</span>
<a name="l00636"></a>00636 <span class="preprocessor"></span><span class="comment">// It seems that on Symbian, merely invoking a function with varargs</span>
<a name="l00637"></a>00637 <span class="comment">// can mess up the stack so that an exception (or possibly some other</span>
<a name="l00638"></a>00638 <span class="comment">// kind of a return) will then cause a KERN-EXEC 3. Possibly we will</span>
<a name="l00639"></a>00639 <span class="comment">// have to avoid invoking this function on Symbian until we can find a</span>
<a name="l00640"></a>00640 <span class="comment">// fix. In any case, this is a known problem, see</span>
<a name="l00641"></a>00641 <span class="comment">// http://discussion.forum.nokia.com/forum/showthread.php?t=115248.</span>
<a name="l00642"></a>00642 <span class="comment">// Upgrading to GCCE 4 might possibly help?</span>
<a name="l00643"></a>00643 <span class="keywordtype">void</span> luaG_runerror_wa (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keyword">const</span> <span class="keywordtype">char</span> *s) {
<a name="l00644"></a>00644   <span class="comment">//logt(&quot;luaG_runerror_wa&quot;);</span>
<a name="l00645"></a>00645   <a class="code" href="lobject_8h.html#a2defbd1005c5aebb5807517ddea80f3f">setsvalue2s</a>(L, L-&gt;<a class="code" href="structlua__State.html#a195f448e76fd404953fa1962d28212a3">top</a>, <a class="code" href="lstring_8h.html#aba4257be9dae5dccd0cda4ac05986d4d">luaS_new</a>(L, s));
<a name="l00646"></a>00646   <a class="code" href="ldo_8h.html#a9c102d2b8b9a0a52bbb15eeeb4e0cbac">incr_top</a>(L);
<a name="l00647"></a>00647   <a class="code" href="ldebug_8c.html#ad12d1709978097158ace5169f9802da9">luaG_errormsg</a>(L);
<a name="l00648"></a>00648 }
<a name="l00649"></a>00649 
<a name="l00650"></a>00650 <span class="preprocessor">#else</span>
<a name="l00651"></a>00651 <span class="preprocessor"></span>
<a name="l00652"></a>00652 <span class="comment">// only used in luaG_runerror</span>
<a name="l00653"></a><a class="code" href="ldebug_8c.html#a93da961a6585b774880b8329a4a22c29">00653</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ldebug_8c.html#a93da961a6585b774880b8329a4a22c29">addinfo</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keyword">const</span> <span class="keywordtype">char</span> *msg) {
<a name="l00654"></a>00654   <span class="comment">//logt(&quot;addinfo&quot;);</span>
<a name="l00655"></a>00655   <a class="code" href="structCallInfo.html">CallInfo</a> *ci = L-&gt;<a class="code" href="structlua__State.html#a7fbb5727050853f411ad64b4be9ab5c8">ci</a>;
<a name="l00656"></a>00656   <span class="keywordflow">if</span> (<a class="code" href="lstate_8h.html#a489eab424b094f54dd7f6b35e2cf68a2">isLua</a>(ci)) {  <span class="comment">/* is Lua code? */</span>
<a name="l00657"></a>00657     <span class="comment">//logt(&quot;is Lua code&quot;);</span>
<a name="l00658"></a>00658     <span class="keywordtype">char</span> buff[<a class="code" href="luaconf_8h.html#a49c31c00aa2852af25a2c43046a21aeb">LUA_IDSIZE</a>];  <span class="comment">/* add file:line information */</span>
<a name="l00659"></a>00659     <span class="keywordtype">int</span> line = <a class="code" href="ldebug_8c.html#a4c5c4ed4c8752d396af7ac41f74dad16">currentline</a>(L, ci);
<a name="l00660"></a>00660     <a class="code" href="lobject_8c.html#a4708cca3615b7fafb7ea4631f486983b">luaO_chunkid</a>(buff, <a class="code" href="lobject_8h.html#acb05d3ab238923581a9c629b8e11a6ac">getstr</a>(<a class="code" href="ldebug_8c.html#af9b48940a4b1206aa52487e903d2ba30">getluaproto</a>(ci)-&gt;source), <a class="code" href="luaconf_8h.html#a49c31c00aa2852af25a2c43046a21aeb">LUA_IDSIZE</a>);
<a name="l00661"></a>00661     <a class="code" href="lobject_8c.html#a8e224db7123c74d695076a96d1bfda61">luaO_pushfstring</a>(L, <span class="stringliteral">&quot;%s:%d: %s&quot;</span>, buff, line, msg);
<a name="l00662"></a>00662   }
<a name="l00663"></a>00663 }
<a name="l00664"></a>00664 
<a name="l00665"></a><a class="code" href="ldebug_8h.html#a3f5f47b50fd31358d52cc2e3c16a9d69">00665</a> <span class="keywordtype">void</span> <a class="code" href="ldebug_8c.html#a958cffe6ffd6a7229af4c44b5961a9fe">luaG_runerror_ok</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keyword">const</span> <span class="keywordtype">char</span> *fmt, ...) {
<a name="l00666"></a>00666   <span class="comment">//logt(&quot;luaG_runerror&quot;);</span>
<a name="l00667"></a>00667   va_list argp;
<a name="l00668"></a>00668   va_start(argp, fmt);
<a name="l00669"></a>00669   <a class="code" href="ldebug_8c.html#a93da961a6585b774880b8329a4a22c29">addinfo</a>(L, <a class="code" href="lobject_8c.html#aa83fa444a36d79521e846a766fa083d5">luaO_pushvfstring</a>(L, fmt, argp));
<a name="l00670"></a>00670   va_end(argp);
<a name="l00671"></a>00671   <a class="code" href="ldebug_8c.html#ad12d1709978097158ace5169f9802da9">luaG_errormsg</a>(L);
<a name="l00672"></a>00672 }
<a name="l00673"></a>00673 
<a name="l00674"></a>00674 <span class="preprocessor">#endif</span>
</pre></div></div>
<hr size="1">

<p style="text-align: right;">
  <a href="http://www.contextlogger.org/">ContextLogger2</a>&#8212;ContextLogger2 Logger Daemon Internals&#8212;<small>Generated on Mon May 2 13:49:54 2011 by&nbsp;<a href="http://www.doxygen.org/">Doxygen</a> 1.6.1</small>
</p>

</body>
</html>
