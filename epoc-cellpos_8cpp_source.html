<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ContextLogger2 Logger Daemon Internals: epoc-cellpos.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_ce488f798153ac6666006744a35bf93c.html">src</a>
  </div>
</div>
<div class="contents">
<h1>epoc-cellpos.cpp</h1><a href="epoc-cellpos_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"></span>
<a name="l00003"></a>00003 <span class="comment">References:</span>
<a name="l00004"></a>00004 <span class="comment"></span>
<a name="l00005"></a>00005 <span class="comment">http://www.forum.nokia.com/document/Cpp_Developers_Library/GUID-759FBC7F-5384-4487-8457-A8D4B76F6AA6/html/Location_Acquisition_API4.html</span>
<a name="l00006"></a>00006 <span class="comment"></span>
<a name="l00007"></a>00007 <span class="comment">*/</span>
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="preprocessor">#include &quot;<a class="code" href="epoc-cellpos_8hpp.html">epoc-cellpos.hpp</a>&quot;</span>
<a name="l00010"></a>00010 
<a name="l00011"></a>00011 <span class="preprocessor">#include &quot;<a class="code" href="epoc-gps-module_8hpp.html">epoc-gps-module.hpp</a>&quot;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &quot;<a class="code" href="epoc-gps-positioner_8hpp.html">epoc-gps-positioner.hpp</a>&quot;</span>
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 <span class="preprocessor">#include &quot;<a class="code" href="cf__query_8h.html">cf_query.h</a>&quot;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &quot;<a class="code" href="er__errors_8h.html">er_errors.h</a>&quot;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;<a class="code" href="kr__controller__private_8h.html">kr_controller_private.h</a>&quot;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &quot;<a class="code" href="sa__sensor__list__log__db_8h.html">sa_sensor_list_log_db.h</a>&quot;</span>
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;<a class="code" href="assertions_8h.html">common/assertions.h</a>&quot;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="shared_2common_2epoc-time_8h.html">common/epoc-time.h</a>&quot;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;<a class="code" href="error__list_8h.html">common/error_list.h</a>&quot;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;<a class="code" href="logging_8h.html">common/logging.h</a>&quot;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;<a class="code" href="platform__error_8h.html">common/platform_error.h</a>&quot;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="utilities_8h.html">common/utilities.h</a>&quot;</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;e32math.h&gt;</span> 
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="comment">// -------------------------------------------------------------------</span>
<a name="l00032"></a>00032 <span class="comment">// internal parameters...</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="comment">// We will never ask the positioner for service more frequently than</span>
<a name="l00035"></a>00035 <span class="comment">// this. This value is runtime adjustable.</span>
<a name="l00036"></a><a class="code" href="epoc-cellpos_8cpp.html#a8f42d5e1de952581f80956c8314822b2">00036</a> <span class="preprocessor">#define MIN_SCAN_REQUEST_INTERVAL_SECS (3 * 60)</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span>
<a name="l00038"></a>00038 <span class="comment">// We will not drain the battery for longer than this if we do not get</span>
<a name="l00039"></a>00039 <span class="comment">// a position fix, and we call Cancel. If we do get a position, it</span>
<a name="l00040"></a>00040 <span class="comment">// should be enough to not call MakeRequest. This value is runtime</span>
<a name="l00041"></a>00041 <span class="comment">// adjustable.</span>
<a name="l00042"></a><a class="code" href="epoc-cellpos_8cpp.html#aab207ce168af3a3d85a5f61d4a056a1e">00042</a> <span class="preprocessor">#define SATELLITE_QUERY_TIMEOUT_SECS (60)</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span>
<a name="l00044"></a>00044 <span class="comment">// This is given as a parameter to the positioner, and it indicates</span>
<a name="l00045"></a>00045 <span class="comment">// how frequently it should be prepared to provide periodic updates.</span>
<a name="l00046"></a>00046 <span class="comment">// In our case such time periods are irregular, and it probably makes</span>
<a name="l00047"></a>00047 <span class="comment">// sense not to set this to avoid possibly spending battery on</span>
<a name="l00048"></a>00048 <span class="comment">// needless guarantees. It seems this must be shorter than the timeout</span>
<a name="l00049"></a>00049 <span class="comment">// interval, and indeed anything else does not make much sense.</span>
<a name="l00050"></a><a class="code" href="epoc-cellpos_8cpp.html#a45e9b74821ca4f51e1cff926826aa369">00050</a> <span class="preprocessor">#define POSITIONER_SCAN_INTERVAL_SECS (0)</span>
<a name="l00051"></a>00051 <span class="preprocessor"></span>
<a name="l00052"></a><a class="code" href="epoc-cellpos_8cpp.html#a57059cd8689beceb9b0d2e18cb13fa22">00052</a> <span class="preprocessor">#define POSITIONER_MAX_AGE_SECS (60)</span>
<a name="l00053"></a>00053 <span class="preprocessor"></span>
<a name="l00054"></a>00054 <span class="comment">// -------------------------------------------------------------------</span>
<a name="l00055"></a>00055 
<a name="l00056"></a><a class="code" href="classCSensor__cellpos.html#a2344aa5bf88c1f2ec1c8cedb067441bc">00056</a> <a class="code" href="classCSensor__cellpos.html">CSensor_cellpos</a>* <a class="code" href="classCSensor__cellpos.html#a2344aa5bf88c1f2ec1c8cedb067441bc">CSensor_cellpos::NewL</a>(<a class="code" href="struct__ac__AppContext.html">ac_AppContext</a>* aAppContext)
<a name="l00057"></a>00057 {
<a name="l00058"></a>00058   <a class="code" href="classCSensor__cellpos.html">CSensor_cellpos</a>* obj = <span class="keyword">new</span> (ELeave) <a class="code" href="classCSensor__cellpos.html#ad6bd1121af17e0f01487dbaca3997937">CSensor_cellpos</a>(aAppContext);
<a name="l00059"></a>00059   CleanupStack::PushL(obj);
<a name="l00060"></a>00060   obj-&gt;<a class="code" href="classCSensor__cellpos.html#acb9c294e89484e2d2a8de14e168076ef">ConstructL</a>();
<a name="l00061"></a>00061   CleanupStack::Pop();
<a name="l00062"></a>00062   <span class="keywordflow">return</span> obj;
<a name="l00063"></a>00063 }
<a name="l00064"></a>00064 
<a name="l00065"></a><a class="code" href="classCSensor__cellpos.html#ad6bd1121af17e0f01487dbaca3997937">00065</a> <a class="code" href="classCSensor__cellpos.html#ad6bd1121af17e0f01487dbaca3997937">CSensor_cellpos::CSensor_cellpos</a>(<a class="code" href="struct__ac__AppContext.html">ac_AppContext</a>* aAppContext) : 
<a name="l00066"></a>00066   iAppContext(aAppContext),
<a name="l00067"></a>00067   iModuleId(KPositionNullModuleId)
<a name="l00068"></a>00068 {
<a name="l00069"></a>00069   <a class="code" href="classCSensor__cellpos.html#aa29374e4ecd9cb65f4b80731659e20db">iLogDb</a> = <a class="code" href="ac__app__context_8cpp.html#a04cbde7189cbbdcb81ab163d61f16dbb">ac_LogDb</a>(aAppContext);
<a name="l00070"></a>00070 }
<a name="l00071"></a>00071 
<a name="l00072"></a><a class="code" href="classCSensor__cellpos.html#acb9c294e89484e2d2a8de14e168076ef">00072</a> <span class="keywordtype">void</span> <a class="code" href="classCSensor__cellpos.html#acb9c294e89484e2d2a8de14e168076ef">CSensor_cellpos::ConstructL</a>()
<a name="l00073"></a>00073 {
<a name="l00074"></a>00074   <a class="code" href="classCSensor__cellpos.html#aa59864b002ff3886c10aa6ee20729050">ReadConfig</a>();
<a name="l00075"></a>00075 
<a name="l00076"></a>00076   <a class="code" href="struct__bb__Blackboard.html">bb_Blackboard</a>* bb = <a class="code" href="ac__app__context_8cpp.html#af838d63d9cd5a8f1af80dbc44959e5d3">ac_get_Blackboard</a>(<a class="code" href="classCSensor__cellpos.html#a476c5e6873f3381296561cb9e9a0c82d">iAppContext</a>);
<a name="l00077"></a>00077   <a class="code" href="structbb__Board.html">bb_Board</a>* bd = <a class="code" href="bb__blackboard_8cpp.html#a294701be39c14209dcaee7744b96402d">bb_Blackboard_board</a>(bb);
<a name="l00078"></a>00078   <a class="code" href="classCSensor__cellpos.html#a197ef0fbd55397c738951a13ae8224f0">iAllowAssisted</a> = bd-&gt;<a class="code" href="structbb__Board.html#a8b4f2b0556843ab1a64a06bd0cc3412d">netpos_allowed</a>;
<a name="l00079"></a>00079 
<a name="l00080"></a>00080   <a class="code" href="classCSensor__cellpos.html#a2ad308f67cb3769edd9899db59d9af17">iRetryAo</a> = <a class="code" href="classCSensor__cellpos.html#a2344aa5bf88c1f2ec1c8cedb067441bc">CRetryAo::NewL</a>(*<span class="keyword">this</span>, 4, 5); <span class="comment">// 4 tries, 5 secs</span>
<a name="l00081"></a>00081   <a class="code" href="classCSensor__cellpos.html#a4e5af72244dd6062bb6dd34068754b34">iModuleAo</a> = <a class="code" href="classCSensor__cellpos.html#a2344aa5bf88c1f2ec1c8cedb067441bc">CPosModuleStatAo::NewL</a>(*<span class="keyword">this</span>);
<a name="l00082"></a>00082   <a class="code" href="classCSensor__cellpos.html#aee0d990ea9ca7ee02cb6955feec72f5b">iCellChangeHandle</a>.Register(bb, <a class="code" href="bb__blackboard_8h.html#a222fef21537286535b17c6146c9b2d3ca1d3ad06d53b2bf9996779ce43971c1cb">bb_dt_cell_id</a>, <span class="keyword">this</span>);
<a name="l00083"></a>00083   <a class="code" href="classCSensor__cellpos.html#a3b11b065c9b5263d9bf8ca981d0a1256">iNetposChangeHandle</a>.Register(bb, <a class="code" href="bb__blackboard_8h.html#a222fef21537286535b17c6146c9b2d3ca562b9d2c270f0382d1d9a72acdc4e9d3">bb_dt_netpos_allowed</a>, <span class="keyword">this</span>);
<a name="l00084"></a>00084 }
<a name="l00085"></a>00085 
<a name="l00086"></a><a class="code" href="classCSensor__cellpos.html#aecad586e42f8751127b78106d1e00d4a">00086</a> <a class="code" href="classCSensor__cellpos.html#aecad586e42f8751127b78106d1e00d4a">CSensor_cellpos::~CSensor_cellpos</a>()
<a name="l00087"></a>00087 {
<a name="l00088"></a>00088   <a class="code" href="classCSensor__cellpos.html#a4faef525c0633631bad711c2cc2456ec">Stop</a>();
<a name="l00089"></a>00089   <span class="keyword">delete</span> <a class="code" href="classCSensor__cellpos.html#a2ad308f67cb3769edd9899db59d9af17">iRetryAo</a>;
<a name="l00090"></a>00090   <span class="keyword">delete</span> <a class="code" href="classCSensor__cellpos.html#a4e5af72244dd6062bb6dd34068754b34">iModuleAo</a>;
<a name="l00091"></a>00091 }
<a name="l00092"></a>00092 
<a name="l00093"></a><a class="code" href="classCSensor__cellpos.html#a4faef525c0633631bad711c2cc2456ec">00093</a> <span class="keywordtype">void</span> <a class="code" href="classCSensor__cellpos.html#a4faef525c0633631bad711c2cc2456ec">CSensor_cellpos::Stop</a>()
<a name="l00094"></a>00094 {
<a name="l00095"></a>00095   <a class="code" href="classCSensor__cellpos.html#a2ad308f67cb3769edd9899db59d9af17">iRetryAo</a>-&gt;Cancel();
<a name="l00096"></a>00096   <a class="code" href="classCSensor__cellpos.html#a4e5af72244dd6062bb6dd34068754b34">iModuleAo</a>-&gt;Cancel();
<a name="l00097"></a>00097   DELETE_Z(<a class="code" href="classCSensor__cellpos.html#a58da92e2caec62843a624aa5b9955f80">iSatPositioner</a>);
<a name="l00098"></a>00098   <a class="code" href="classCSensor__cellpos.html#acd86e7d51f8cb7047d36d8dbb4fa79ca">iState</a> = <a class="code" href="classCSensor__cellpos.html#a73b8dfbcec348b86a45eee3c5bdffc60a45141875a3705ea3c80f8db38c463ba3">EInactive</a>;
<a name="l00099"></a>00099 }
<a name="l00100"></a>00100 
<a name="l00101"></a><a class="code" href="classCSensor__cellpos.html#a9d16f149f348a4ec6e433459a49d5836">00101</a> <span class="keywordtype">void</span> <a class="code" href="classCSensor__cellpos.html#a9d16f149f348a4ec6e433459a49d5836">CSensor_cellpos::StartL</a>()
<a name="l00102"></a>00102 {
<a name="l00103"></a>00103   <span class="keywordflow">if</span> (!<a class="code" href="classCSensor__cellpos.html#a105272de438d79f544544c4a6db0d36e">IsActive</a>()) {
<a name="l00104"></a>00104     <a class="code" href="classCSensor__cellpos.html#a2ad308f67cb3769edd9899db59d9af17">iRetryAo</a>-&gt;<a class="code" href="classCRetryAo.html#a263404fe797ad93815c1618c4e469ca0">ResetFailures</a>();
<a name="l00105"></a>00105 
<a name="l00106"></a>00106     <a class="code" href="classCSensor__cellpos.html#a88dd21c229861f806f27b3ddecd788cd">iModuleId</a> = KPositionNullModuleId;
<a name="l00107"></a>00107 
<a name="l00108"></a>00108     <a class="code" href="classCSensor__cellpos.html#a9ec02e742c66193aab5910334916ec7f">PosModChangeL</a>();
<a name="l00109"></a>00109 
<a name="l00110"></a>00110     <a class="code" href="classCSensor__cellpos.html#acd86e7d51f8cb7047d36d8dbb4fa79ca">iState</a> = <a class="code" href="classCSensor__cellpos.html#a73b8dfbcec348b86a45eee3c5bdffc60a80f33118762ca13817ee0c518bc5e22a">EActive</a>;
<a name="l00111"></a>00111   }
<a name="l00112"></a>00112 }
<a name="l00113"></a>00113 
<a name="l00114"></a><a class="code" href="classCSensor__cellpos.html#a931625d5b39e6d01f7186d26aa228e3a">00114</a> <span class="keywordtype">void</span> <a class="code" href="classCSensor__cellpos.html#a931625d5b39e6d01f7186d26aa228e3a">CSensor_cellpos::CreateSpecifiedPositionerL</a>(TPositionModuleId bestId)
<a name="l00115"></a>00115 {
<a name="l00116"></a>00116   <span class="comment">// This is just the module we last tried to use; we do not require</span>
<a name="l00117"></a>00117   <span class="comment">// we actually succeed in creating the positioner for it.</span>
<a name="l00118"></a>00118   <a class="code" href="classCSensor__cellpos.html#a88dd21c229861f806f27b3ddecd788cd">iModuleId</a> = bestId;
<a name="l00119"></a>00119 
<a name="l00120"></a>00120   RPositionServer&amp; server = <a class="code" href="classCSensor__cellpos.html#a4e5af72244dd6062bb6dd34068754b34">iModuleAo</a>-&gt;<a class="code" href="classCPosModuleStatAo.html#a4094039ee06d232abd3a05555c18ef3f">PositionServer</a>();
<a name="l00121"></a>00121   <a class="code" href="classCSensor__cellpos.html#a58da92e2caec62843a624aa5b9955f80">iSatPositioner</a> = <a class="code" href="classCSensor__cellpos.html#a2344aa5bf88c1f2ec1c8cedb067441bc">CPositioner_gps::NewL</a>(server, *<span class="keyword">this</span>, 
<a name="l00122"></a>00122            bestId, 
<a name="l00123"></a>00123            <a class="code" href="epoc-cellpos_8cpp.html#a45e9b74821ca4f51e1cff926826aa369">POSITIONER_SCAN_INTERVAL_SECS</a>,
<a name="l00124"></a>00124            <a class="code" href="classCSensor__cellpos.html#a838640af065017e9737315f8f758f274">iSatelliteQueryTimeoutSecs</a>,
<a name="l00125"></a>00125            <a class="code" href="classCSensor__cellpos.html#aa4bf3f105823def8a880a2dc1bf7aa5b">iDataMaxAgeSecs</a>);
<a name="l00126"></a>00126 }
<a name="l00127"></a>00127 
<a name="l00128"></a><a class="code" href="classCSensor__cellpos.html#a9ec02e742c66193aab5910334916ec7f">00128</a> <span class="keywordtype">void</span> <a class="code" href="classCSensor__cellpos.html#a9ec02e742c66193aab5910334916ec7f">CSensor_cellpos::PosModChangeL</a>()
<a name="l00129"></a>00129 {
<a name="l00130"></a>00130   TInt modif = 0;
<a name="l00131"></a>00131   <span class="keywordflow">if</span> (<a class="code" href="classCSensor__cellpos.html#a197ef0fbd55397c738951a13ae8224f0">iAllowAssisted</a>)
<a name="l00132"></a>00132     modif |= <a class="code" href="classCPosModuleStatAo.html#ad5f653dcb6538f4fb1bfa58b517e858daaf13640c9f1802e20cab3550785703d4">CPosModuleStatAo::KAllowAssisted</a>;
<a name="l00133"></a>00133   TPositionModuleId bestId = <a class="code" href="classCSensor__cellpos.html#a4e5af72244dd6062bb6dd34068754b34">iModuleAo</a>-&gt;<a class="code" href="classCPosModuleStatAo.html#a6bc8a35a8da77065f8ac97314e287e20">ChooseBestPositionerL</a>(modif);
<a name="l00134"></a>00134   <span class="keywordflow">if</span> (bestId != <a class="code" href="classCSensor__cellpos.html#a88dd21c229861f806f27b3ddecd788cd">iModuleId</a>) {
<a name="l00135"></a>00135     <a class="code" href="classCSensor__cellpos.html#a2ad308f67cb3769edd9899db59d9af17">iRetryAo</a>-&gt;Cancel();
<a name="l00136"></a>00136     <a class="code" href="classCSensor__cellpos.html#a2ad308f67cb3769edd9899db59d9af17">iRetryAo</a>-&gt;<a class="code" href="classCRetryAo.html#a263404fe797ad93815c1618c4e469ca0">ResetFailures</a>();
<a name="l00137"></a>00137     DELETE_Z(<a class="code" href="classCSensor__cellpos.html#a58da92e2caec62843a624aa5b9955f80">iSatPositioner</a>);
<a name="l00138"></a>00138 
<a name="l00139"></a>00139     <span class="keywordflow">if</span> (bestId != KPositionNullModuleId) {
<a name="l00140"></a>00140       TRAPD(errCode, <a class="code" href="classCSensor__cellpos.html#a931625d5b39e6d01f7186d26aa228e3a">CreateSpecifiedPositionerL</a>(bestId));
<a name="l00141"></a>00141       <span class="keywordflow">if</span> (errCode) {
<a name="l00142"></a>00142   <a class="code" href="er__errors_8h.html#a008602962ee67e8048c9eec8828e2258">er_log_symbian</a>(0, errCode, <span class="stringliteral">&quot;WARNING: failed to create positioner&quot;</span>);
<a name="l00143"></a>00143       }
<a name="l00144"></a>00144     }
<a name="l00145"></a>00145   }
<a name="l00146"></a>00146   <a class="code" href="classCSensor__cellpos.html#a4e5af72244dd6062bb6dd34068754b34">iModuleAo</a>-&gt;<a class="code" href="classCPosModuleStatAo.html#a3350bc92913125194858207d868b5cb6">MakeRequest</a>();
<a name="l00147"></a>00147 }
<a name="l00148"></a>00148 
<a name="l00149"></a><a class="code" href="classCSensor__cellpos.html#a40d5bb60529068206a9c4b644c23acfc">00149</a> TBool <a class="code" href="classCSensor__cellpos.html#a40d5bb60529068206a9c4b644c23acfc">CSensor_cellpos::PosModIsCurrent</a>(TPositionModuleId <span class="keywordtype">id</span>)<span class="keyword"> const</span>
<a name="l00150"></a>00150 <span class="keyword"></span>{
<a name="l00151"></a>00151   <span class="keywordflow">return</span> (<a class="code" href="classCSensor__cellpos.html#a88dd21c229861f806f27b3ddecd788cd">iModuleId</a> != KPositionNullModuleId) &amp;&amp; (<a class="code" href="classCSensor__cellpos.html#a88dd21c229861f806f27b3ddecd788cd">iModuleId</a> == id);
<a name="l00152"></a>00152 }
<a name="l00153"></a>00153 
<a name="l00154"></a><a class="code" href="classCSensor__cellpos.html#a55bfa7b8ee5c714f3f6e97e52cd60e8e">00154</a> <span class="keywordtype">void</span> <a class="code" href="classCSensor__cellpos.html#a55bfa7b8ee5c714f3f6e97e52cd60e8e">CSensor_cellpos::PosModErrorL</a>(TInt errCode)
<a name="l00155"></a>00155 {
<a name="l00156"></a>00156   <a class="code" href="er__errors_8h.html#a008602962ee67e8048c9eec8828e2258">er_log_symbian</a>(0, errCode, 
<a name="l00157"></a>00157      <span class="stringliteral">&quot;INACTIVATE: cellpos: positioning module status tracking error&quot;</span>);
<a name="l00158"></a>00158   <a class="code" href="classCSensor__cellpos.html#a4faef525c0633631bad711c2cc2456ec">Stop</a>();
<a name="l00159"></a>00159 }
<a name="l00160"></a>00160 
<a name="l00161"></a>00161 <span class="comment">// Called if PosModChangeL or PosModErrorL leaves.</span>
<a name="l00162"></a><a class="code" href="classCSensor__cellpos.html#a5b36eec03bdd3a9f8f029804f4fddd8c">00162</a> <span class="keywordtype">void</span> <a class="code" href="classCSensor__cellpos.html#a5b36eec03bdd3a9f8f029804f4fddd8c">CSensor_cellpos::PosModLeave</a>(TInt errCode)
<a name="l00163"></a>00163 {
<a name="l00164"></a>00164   <a class="code" href="er__errors_8h.html#a008602962ee67e8048c9eec8828e2258">er_log_symbian</a>(<a class="code" href="er__errors_8h.html#a74b7465a12d63ad80bc10d1ebaf900d8">er_FATAL</a>, errCode, <span class="stringliteral">&quot;cellpos: leave in positioning module status reporting handler&quot;</span>);
<a name="l00165"></a>00165 }
<a name="l00166"></a>00166 
<a name="l00167"></a><a class="code" href="classCSensor__cellpos.html#ad5eb18afaaa741f38444d82a47e1e34c">00167</a> <span class="keywordtype">void</span> <a class="code" href="classCSensor__cellpos.html#ad5eb18afaaa741f38444d82a47e1e34c">CSensor_cellpos::RetryTimerExpired</a>(<a class="code" href="classCRetryAo.html">CRetryAo</a>* src, TInt errCode)
<a name="l00168"></a>00168 {
<a name="l00169"></a>00169   <span class="keywordflow">if</span> (errCode) {
<a name="l00170"></a>00170     <a class="code" href="er__errors_8h.html#a008602962ee67e8048c9eec8828e2258">er_log_symbian</a>(<a class="code" href="er__errors_8h.html#a74b7465a12d63ad80bc10d1ebaf900d8">er_FATAL</a>, errCode, <span class="stringliteral">&quot;cellpos: retry timer error&quot;</span>);
<a name="l00171"></a>00171     <span class="keywordflow">return</span>;
<a name="l00172"></a>00172   }
<a name="l00173"></a>00173   assert(<a class="code" href="classCSensor__cellpos.html#a58da92e2caec62843a624aa5b9955f80">iSatPositioner</a>);
<a name="l00174"></a>00174   <a class="code" href="classCSensor__cellpos.html#a58da92e2caec62843a624aa5b9955f80">iSatPositioner</a>-&gt;<a class="code" href="classCPositioner__gps.html#a3e663e18c3ac6ed573bf3e6dad9356e7">MakeRequest</a>();
<a name="l00175"></a>00175 }
<a name="l00176"></a>00176 
<a name="l00177"></a><a class="code" href="classCSensor__cellpos.html#a3626f899937a4ecb28d019589ac56d94">00177</a> <span class="keywordtype">void</span> <a class="code" href="classCSensor__cellpos.html#a3626f899937a4ecb28d019589ac56d94">CSensor_cellpos::BbChangedL</a>(bb::RHandle* <span class="keyword">self</span>, <span class="keyword">enum</span> <a class="code" href="bb__blackboard_8h.html#a222fef21537286535b17c6146c9b2d3c">bb_DataType</a> dt,
<a name="l00178"></a>00178          gpointer data, <span class="keywordtype">int</span> len)
<a name="l00179"></a>00179 {
<a name="l00180"></a>00180   <span class="keywordflow">if</span> (!<a class="code" href="classCSensor__cellpos.html#a105272de438d79f544544c4a6db0d36e">IsActive</a>()) 
<a name="l00181"></a>00181     <span class="keywordflow">return</span>; <span class="comment">// stopped</span>
<a name="l00182"></a>00182   <span class="keywordflow">switch</span> (dt)
<a name="l00183"></a>00183     {
<a name="l00184"></a>00184     <span class="keywordflow">case</span> <a class="code" href="bb__blackboard_8h.html#a222fef21537286535b17c6146c9b2d3ca1d3ad06d53b2bf9996779ce43971c1cb">bb_dt_cell_id</a>:
<a name="l00185"></a>00185       {
<a name="l00186"></a>00186   <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;cellpos: cell changed&quot;</span>);
<a name="l00187"></a>00187   <span class="keywordflow">if</span> (!<a class="code" href="classCSensor__cellpos.html#a58da92e2caec62843a624aa5b9955f80">iSatPositioner</a>) {
<a name="l00188"></a>00188     <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;cellpos: no positioner&quot;</span>);
<a name="l00189"></a>00189     <span class="keywordflow">return</span>; <span class="comment">// no positioner</span>
<a name="l00190"></a>00190   }
<a name="l00191"></a>00191   <span class="keywordflow">if</span> (<a class="code" href="classCSensor__cellpos.html#a58da92e2caec62843a624aa5b9955f80">iSatPositioner</a>-&gt;IsActive() || <a class="code" href="classCSensor__cellpos.html#a2ad308f67cb3769edd9899db59d9af17">iRetryAo</a>-&gt;IsActive()) {
<a name="l00192"></a>00192     <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;cellpos: already positioning&quot;</span>);
<a name="l00193"></a>00193     <span class="keywordflow">return</span>; <span class="comment">// doing positioning</span>
<a name="l00194"></a>00194   }
<a name="l00195"></a>00195   TTime now;
<a name="l00196"></a>00196   now.UniversalTime();
<a name="l00197"></a>00197   TTime earliestTime(<a class="code" href="classCSensor__cellpos.html#a754896561d38d392981d861c4a95ee55">iLastScanTime</a>.Int64());
<a name="l00198"></a>00198   earliestTime += TTimeIntervalSeconds(<a class="code" href="classCSensor__cellpos.html#a078eec7995771c4a184fdb4e3ca37d1b">iMinScanRequestIntervalSecs</a>);
<a name="l00199"></a>00199   <span class="keywordflow">if</span> (now &lt;= earliestTime) {
<a name="l00200"></a>00200     <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;cellpos: too early&quot;</span>);
<a name="l00201"></a>00201     <span class="keywordflow">return</span>; <span class="comment">// too early</span>
<a name="l00202"></a>00202   }
<a name="l00203"></a>00203   <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;cellpos: positioning...&quot;</span>);
<a name="l00204"></a>00204   <a class="code" href="classCSensor__cellpos.html#a58da92e2caec62843a624aa5b9955f80">iSatPositioner</a>-&gt;<a class="code" href="classCPositioner__gps.html#a3e663e18c3ac6ed573bf3e6dad9356e7">MakeRequest</a>();
<a name="l00205"></a>00205         <span class="keywordflow">break</span>;
<a name="l00206"></a>00206       }
<a name="l00207"></a>00207 
<a name="l00208"></a>00208     <span class="keywordflow">case</span> <a class="code" href="bb__blackboard_8h.html#a222fef21537286535b17c6146c9b2d3ca562b9d2c270f0382d1d9a72acdc4e9d3">bb_dt_netpos_allowed</a>:
<a name="l00209"></a>00209       {
<a name="l00210"></a>00210         gboolean value = GPOINTER_TO_INT(data);
<a name="l00211"></a>00211   <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;cellpos: %s network access&quot;</span>, value ? <span class="stringliteral">&quot;allow&quot;</span> : <span class="stringliteral">&quot;disallow&quot;</span>);
<a name="l00212"></a>00212   <span class="keywordflow">if</span> (value != <a class="code" href="classCSensor__cellpos.html#a197ef0fbd55397c738951a13ae8224f0">iAllowAssisted</a>) {
<a name="l00213"></a>00213     <a class="code" href="classCSensor__cellpos.html#a197ef0fbd55397c738951a13ae8224f0">iAllowAssisted</a> = value;
<a name="l00214"></a>00214     <a class="code" href="classCSensor__cellpos.html#a9ec02e742c66193aab5910334916ec7f">PosModChangeL</a>();
<a name="l00215"></a>00215   }
<a name="l00216"></a>00216         <span class="keywordflow">break</span>;
<a name="l00217"></a>00217       }
<a name="l00218"></a>00218 
<a name="l00219"></a>00219     <span class="keywordflow">default</span>:
<a name="l00220"></a>00220       {
<a name="l00221"></a>00221   assert(0);
<a name="l00222"></a>00222         <span class="keywordflow">break</span>;
<a name="l00223"></a>00223       }
<a name="l00224"></a>00224     }
<a name="l00225"></a>00225   
<a name="l00226"></a>00226 }
<a name="l00227"></a>00227 
<a name="l00228"></a>00228 <span class="comment">// xxx this could be shared with other satellite sensors</span>
<a name="l00229"></a><a class="code" href="epoc-cellpos_8cpp.html#a4963349ee8827d46fa3cc6c3a90a1484">00229</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="epoc-cellpos_8cpp.html#a4963349ee8827d46fa3cc6c3a90a1484">LogSatelliteInfoL</a>(<a class="code" href="struct__LogDb.html">LogDb</a>* aLogDb, <span class="keyword">const</span> <span class="keywordtype">char</span>* aSensorName,
<a name="l00230"></a>00230             <span class="keyword">const</span> TPositionSatelliteInfo&amp; positionInfo)
<a name="l00231"></a>00231 {
<a name="l00232"></a>00232 <span class="preprocessor">#define SAT_STRING_MAX 300</span>
<a name="l00233"></a>00233 <span class="preprocessor"></span><span class="preprocessor">#define COU_STRING_MAX 300</span>
<a name="l00234"></a>00234 <span class="preprocessor"></span>  gchar satString[<a class="code" href="epoc-cellpos_8cpp.html#ad0723bc3b266843b70cadc2856e52f4c">SAT_STRING_MAX</a>];
<a name="l00235"></a>00235   gchar couString[<a class="code" href="epoc-cellpos_8cpp.html#a81d17476ad3e4033cd9c2c60f9fb69ca">COU_STRING_MAX</a>];
<a name="l00236"></a>00236   satString[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00237"></a>00237   couString[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00238"></a>00238 
<a name="l00239"></a>00239   <span class="keywordflow">if</span> (positionInfo.PositionClassType() &amp; EPositionSatelliteInfoClass) {
<a name="l00240"></a>00240     TInt satellites = positionInfo.NumSatellitesInView();
<a name="l00241"></a>00241     TInt used_satellites = positionInfo.NumSatellitesUsed();
<a name="l00242"></a>00242     TReal32 horizontal_dop = positionInfo.HorizontalDoP();
<a name="l00243"></a>00243     TReal32 vertical_dop = positionInfo.VerticalDoP();
<a name="l00244"></a>00244     TReal32 time_dop = positionInfo.TimeDoP();
<a name="l00245"></a>00245     TTime satTime = positionInfo.SatelliteTime();
<a name="l00246"></a>00246 
<a name="l00247"></a>00247 <span class="preprocessor">#if __DO_LOGGING__</span>
<a name="l00248"></a>00248 <span class="preprocessor"></span><span class="preprocessor">#define TIME_STRING_MAX 50</span>
<a name="l00249"></a>00249 <span class="preprocessor"></span>    <a class="code" href="epoc-cl2app-clientserver_8hpp.html#a9a27538e88bd3e6a52ac1d1c3a2dacd7">_LIT</a>(KDateTimeFormat, <span class="stringliteral">&quot;%F%Y-%M-%D %H:%T:%S.%C&quot;</span>);
<a name="l00250"></a>00250     <span class="comment">// Note that KMaxTimeFormatSpec is the max size of the format</span>
<a name="l00251"></a>00251     <span class="comment">// spec, and not the result, as I understand it.</span>
<a name="l00252"></a>00252     TBuf&lt;TIME_STRING_MAX&gt; satTime16;
<a name="l00253"></a>00253     <span class="comment">// The leave will not happen if the format string and data are</span>
<a name="l00254"></a>00254     <span class="comment">// valid and the destination buffer is large enough.</span>
<a name="l00255"></a>00255     satTime.FormatL(satTime16, KDateTimeFormat);
<a name="l00256"></a>00256     gchar satTime8[<a class="code" href="epoc-cellpos_8cpp.html#a8a213085bbf085fd2f0d083c82e4f8f9">TIME_STRING_MAX</a> + 1];
<a name="l00257"></a>00257     ConvToUtf8CString(satTime8, <a class="code" href="epoc-cellpos_8cpp.html#a8a213085bbf085fd2f0d083c82e4f8f9">TIME_STRING_MAX</a>, satTime16);
<a name="l00258"></a>00258 
<a name="l00259"></a>00259     <a class="code" href="logging__c_8h.html#abea298723ad956e744c9efec71512dd0">logg</a>(<span class="stringliteral">&quot;satellite info: num satellites in view %d, num used satellites %d, hdop %g, vdop %g, tdop %g, satellite time %s&quot;</span>, satellites, used_satellites, horizontal_dop, vertical_dop, time_dop, satTime8);
<a name="l00260"></a>00260 <span class="preprocessor">#endif</span>
<a name="l00261"></a>00261 <span class="preprocessor"></span>
<a name="l00262"></a>00262     <span class="comment">// We convert Symbian time to Unix time for consistency.</span>
<a name="l00263"></a>00263     time_t satUnixTime = <a class="code" href="shared_2common_2epoc-time_8cpp.html#a4711f449672a36ccb8b6fac5c85e9554">LocalEpocTimeToUnixTime</a>(satTime); <span class="comment">// assuming 32-bit int</span>
<a name="l00264"></a>00264 
<a name="l00265"></a>00265     <span class="comment">// Build &apos;satString&apos; for database insertion.</span>
<a name="l00266"></a>00266     {
<a name="l00267"></a>00267       <span class="comment">// &quot;satellites&quot;: {&quot;horizontal_dop&quot;: 2.20000004768372,</span>
<a name="l00268"></a>00268       <span class="comment">// &quot;used_satellites&quot;: 4, &quot;vertical_dop&quot;: 1.0, &quot;time&quot;:</span>
<a name="l00269"></a>00269       <span class="comment">// 1225980390.097, &quot;satellites&quot;: 10, &quot;time_dop&quot;: 1.0}</span>
<a name="l00270"></a>00270       GString* gs = NULL;
<a name="l00271"></a>00271       <a class="code" href="gxlowmem_8h.html#acba1bcc9e324efb15c129b8f1b155558">SET_TRAP_OOM</a>(<span class="keywordflow">if</span> (gs) g_string_free(gs, TRUE);
<a name="l00272"></a>00272        User::LeaveNoMemory());
<a name="l00273"></a>00273       gs = g_string_sized_new(128);
<a name="l00274"></a>00274       g_string_printf(gs, <span class="stringliteral">&quot;{time: %d&quot;</span>, (<span class="keywordtype">int</span>)satUnixTime);
<a name="l00275"></a>00275       <span class="keywordflow">if</span> (!Math::IsNaN(satellites))
<a name="l00276"></a>00276   g_string_append_printf(gs, <span class="stringliteral">&quot;, satellites: %d&quot;</span>, satellites);
<a name="l00277"></a>00277       <span class="keywordflow">if</span> (!Math::IsNaN(used_satellites))
<a name="l00278"></a>00278   g_string_append_printf(gs, <span class="stringliteral">&quot;, used_satellites: %d&quot;</span>, used_satellites);
<a name="l00279"></a>00279       <span class="keywordflow">if</span> (!Math::IsNaN(horizontal_dop))
<a name="l00280"></a>00280   <a class="code" href="utils__cl2_8h.html#a2220db442e402b7a00b46c9d6758ba6a">g_string_append_printf_fix</a>(gs, <span class="stringliteral">&quot;, horizontal_dop: %.6f&quot;</span>, (<span class="keywordtype">double</span>)horizontal_dop);
<a name="l00281"></a>00281       <span class="keywordflow">if</span> (!Math::IsNaN(vertical_dop))
<a name="l00282"></a>00282   <span class="comment">// %f and %g seem to be a bit broken for this function at</span>
<a name="l00283"></a>00283   <span class="comment">// least, and maybe also for the other GLib printf</span>
<a name="l00284"></a>00284   <span class="comment">// functions. We can try a more recent Open C, or</span>
<a name="l00285"></a>00285   <span class="comment">// implement a replacement using C99 or Symbian functions.</span>
<a name="l00286"></a>00286   <span class="comment">// Or possibly we could backport a more recent version of</span>
<a name="l00287"></a>00287   <span class="comment">// the function in question from GLib, if there are not</span>
<a name="l00288"></a>00288   <span class="comment">// too many internal dependencies.</span>
<a name="l00289"></a>00289   <a class="code" href="utils__cl2_8h.html#a2220db442e402b7a00b46c9d6758ba6a">g_string_append_printf_fix</a>(gs, <span class="stringliteral">&quot;, vertical_dop: %.6f&quot;</span>, (<span class="keywordtype">double</span>)vertical_dop);
<a name="l00290"></a>00290       <span class="keywordflow">if</span> (!Math::IsNaN(time_dop))
<a name="l00291"></a>00291   <a class="code" href="utils__cl2_8h.html#a2220db442e402b7a00b46c9d6758ba6a">g_string_append_printf_fix</a>(gs, <span class="stringliteral">&quot;, time_dop: %.6f&quot;</span>, (<span class="keywordtype">double</span>)time_dop);
<a name="l00292"></a>00292       g_string_append_c(gs, <span class="charliteral">&apos;}&apos;</span>);
<a name="l00293"></a>00293       <a class="code" href="gxlowmem_8h.html#a6532fc0744a1fdfc3c8bf21d65189d72">UNSET_TRAP_OOM</a>();
<a name="l00294"></a>00294 
<a name="l00295"></a>00295       <span class="keywordflow">if</span> (gs-&gt;len &lt; <a class="code" href="epoc-cellpos_8cpp.html#ad0723bc3b266843b70cadc2856e52f4c">SAT_STRING_MAX</a>)
<a name="l00296"></a>00296   <span class="comment">// For easier memory management.</span>
<a name="l00297"></a>00297   strcpy(satString, gs-&gt;str);
<a name="l00298"></a>00298       <span class="keywordflow">else</span>
<a name="l00299"></a>00299   <span class="comment">// Did not fit fully, do not log partial data that may not</span>
<a name="l00300"></a>00300   <span class="comment">// be parseable.</span>
<a name="l00301"></a>00301   satString[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00302"></a>00302       g_string_free(gs, TRUE);
<a name="l00303"></a>00303       <a class="code" href="logging__c_8h.html#a919260af80d8c36d20780bd23f20fa5a">logt</a>(satString);
<a name="l00304"></a>00304     }
<a name="l00305"></a>00305   }
<a name="l00306"></a>00306 
<a name="l00307"></a>00307   <span class="keywordflow">if</span> (positionInfo.PositionClassType() &amp; EPositionCourseInfoClass) {
<a name="l00308"></a>00308     TCourse course;
<a name="l00309"></a>00309     positionInfo.GetCourse(course);
<a name="l00310"></a>00310     TReal32 speed = course.Speed();
<a name="l00311"></a>00311     TReal32 heading = course.Heading();
<a name="l00312"></a>00312     TReal32 course_value = course.Course();
<a name="l00313"></a>00313     TReal32 speed_accuracy = course.SpeedAccuracy();
<a name="l00314"></a>00314     TReal32 heading_accuracy = course.HeadingAccuracy();
<a name="l00315"></a>00315     TReal32 course_accuracy = course.CourseAccuracy();
<a name="l00316"></a>00316     <a class="code" href="logging__c_8h.html#abea298723ad956e744c9efec71512dd0">logg</a>(<span class="stringliteral">&quot;course info: speed %g m/s, heading %g deg, course %g, speed_accuracy %g m/s, heading_accuracy %d deg, course_accuracy %g&quot;</span>, speed, heading, course_value, speed_accuracy, heading_accuracy, course_accuracy);
<a name="l00317"></a>00317 
<a name="l00318"></a>00318     <span class="comment">// &quot;course&quot;: {&quot;speed&quot;: 6.0, &quot;heading&quot;: 305.880004882812, &quot;heading_accuracy&quot;: 5.80999994277954, &quot;speed_accuracy&quot;: 8.35999965667725</span>
<a name="l00319"></a>00319     {
<a name="l00320"></a>00320 <span class="preprocessor">#define APPEND_STRING(s) { int slen = strlen(s); if (space &lt;= slen) goto fail; space -= slen; strcpy(output, s);  output += slen; }</span>
<a name="l00321"></a>00321 <span class="preprocessor"></span><span class="preprocessor">#define APPEND_SEP { if (!first) APPEND_STRING(&quot;, &quot;); }</span>
<a name="l00322"></a>00322 <span class="preprocessor"></span><span class="preprocessor">#define COU_UPDATE_STATE(r) { if (r &lt; 0 || r &gt;= space) goto fail; space -= r; output += r; first = EFalse; }</span>
<a name="l00323"></a>00323 <span class="preprocessor"></span>      <span class="keywordtype">int</span> space = <a class="code" href="epoc-cellpos_8cpp.html#a81d17476ad3e4033cd9c2c60f9fb69ca">COU_STRING_MAX</a>;
<a name="l00324"></a>00324       <span class="keywordtype">int</span> r;
<a name="l00325"></a>00325       TBool first = ETrue;
<a name="l00326"></a>00326       gchar* <a class="code" href="luac_8c.html#a5a832fe6e2412dfabb93a2adae30e745">output</a> = couString;
<a name="l00327"></a>00327       <a class="code" href="epoc-cellpos_8cpp.html#a55d23f0ff006cbedfe53eb2b4af5854d">APPEND_STRING</a>(<span class="stringliteral">&quot;{&quot;</span>);
<a name="l00328"></a>00328       <span class="keywordflow">if</span> (!Math::IsNaN(speed)) { r = <a class="code" href="utils__cl2_8h.html#ab3b96fb650082eeea3c6b44bff85d18f">g_snprintf_fix</a>(output, space, <span class="stringliteral">&quot;speed: %.6f&quot;</span>, (<span class="keywordtype">double</span>)speed); <a class="code" href="epoc-cellpos_8cpp.html#ada979d4134c736317e9f259d35c184d6">COU_UPDATE_STATE</a>(r); }
<a name="l00329"></a>00329       <span class="keywordflow">if</span> (!Math::IsNaN(heading)) { <a class="code" href="epoc-cellpos_8cpp.html#a4f8de22e19fbc91d0c57459e4de61e06">APPEND_SEP</a>; r = <a class="code" href="utils__cl2_8h.html#ab3b96fb650082eeea3c6b44bff85d18f">g_snprintf_fix</a>(output, space, <span class="stringliteral">&quot;heading: %.6f&quot;</span>, (<span class="keywordtype">double</span>)heading); <a class="code" href="epoc-cellpos_8cpp.html#ada979d4134c736317e9f259d35c184d6">COU_UPDATE_STATE</a>(r); }
<a name="l00330"></a>00330       <span class="keywordflow">if</span> (!Math::IsNaN(course_value)) { <a class="code" href="epoc-cellpos_8cpp.html#a4f8de22e19fbc91d0c57459e4de61e06">APPEND_SEP</a>; r = <a class="code" href="utils__cl2_8h.html#ab3b96fb650082eeea3c6b44bff85d18f">g_snprintf_fix</a>(output, space, <span class="stringliteral">&quot;course: %.6f&quot;</span>, (<span class="keywordtype">double</span>)course_value); <a class="code" href="epoc-cellpos_8cpp.html#ada979d4134c736317e9f259d35c184d6">COU_UPDATE_STATE</a>(r); }
<a name="l00331"></a>00331       <span class="keywordflow">if</span> (!Math::IsNaN(speed_accuracy)) { <a class="code" href="epoc-cellpos_8cpp.html#a4f8de22e19fbc91d0c57459e4de61e06">APPEND_SEP</a>; r = <a class="code" href="utils__cl2_8h.html#ab3b96fb650082eeea3c6b44bff85d18f">g_snprintf_fix</a>(output, space, <span class="stringliteral">&quot;speed_accuracy: %.6f&quot;</span>, (<span class="keywordtype">double</span>)speed_accuracy); <a class="code" href="epoc-cellpos_8cpp.html#ada979d4134c736317e9f259d35c184d6">COU_UPDATE_STATE</a>(r); }
<a name="l00332"></a>00332       <span class="keywordflow">if</span> (!Math::IsNaN(heading_accuracy)) { <a class="code" href="epoc-cellpos_8cpp.html#a4f8de22e19fbc91d0c57459e4de61e06">APPEND_SEP</a>; r = <a class="code" href="utils__cl2_8h.html#ab3b96fb650082eeea3c6b44bff85d18f">g_snprintf_fix</a>(output, space, <span class="stringliteral">&quot;heading_accuracy: %.6f&quot;</span>, (<span class="keywordtype">double</span>)heading_accuracy); <a class="code" href="epoc-cellpos_8cpp.html#ada979d4134c736317e9f259d35c184d6">COU_UPDATE_STATE</a>(r); }
<a name="l00333"></a>00333       <span class="keywordflow">if</span> (!Math::IsNaN(course_accuracy)) { <a class="code" href="epoc-cellpos_8cpp.html#a4f8de22e19fbc91d0c57459e4de61e06">APPEND_SEP</a>; r = <a class="code" href="utils__cl2_8h.html#ab3b96fb650082eeea3c6b44bff85d18f">g_snprintf_fix</a>(output, space, <span class="stringliteral">&quot;course_accuracy: %.6f&quot;</span>, (<span class="keywordtype">double</span>)course_accuracy); <a class="code" href="epoc-cellpos_8cpp.html#ada979d4134c736317e9f259d35c184d6">COU_UPDATE_STATE</a>(r); }
<a name="l00334"></a>00334       <a class="code" href="epoc-cellpos_8cpp.html#a55d23f0ff006cbedfe53eb2b4af5854d">APPEND_STRING</a>(<span class="stringliteral">&quot;}&quot;</span>);
<a name="l00335"></a>00335       <span class="keywordflow">goto</span> done;
<a name="l00336"></a>00336     fail:
<a name="l00337"></a>00337       couString[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00338"></a>00338     done: ;
<a name="l00339"></a>00339       <a class="code" href="logging__c_8h.html#a919260af80d8c36d20780bd23f20fa5a">logt</a>(couString);
<a name="l00340"></a>00340     }
<a name="l00341"></a>00341   }
<a name="l00342"></a>00342 
<a name="l00343"></a>00343   <span class="keywordflow">if</span> (positionInfo.PositionClassType() &amp; EPositionInfoClass) {
<a name="l00344"></a>00344     TPosition position;
<a name="l00345"></a>00345     positionInfo.GetPosition(position);
<a name="l00346"></a>00346     <span class="comment">// It seems that with network based positioning we only get</span>
<a name="l00347"></a>00347     <span class="comment">// lat and lon and hacc, and the rest are NaN.</span>
<a name="l00348"></a>00348     TReal64 lat = position.Latitude();
<a name="l00349"></a>00349     TReal64 lon = position.Longitude();
<a name="l00350"></a>00350     <span class="comment">// To use Google Maps to look these up, can use something like http://maps.google.com/maps?q=60.187537,+24.804940&amp;hl=en</span>
<a name="l00351"></a>00351     TReal32 alt = position.Altitude();
<a name="l00352"></a>00352     TReal32 vacc = position.VerticalAccuracy();
<a name="l00353"></a>00353     TReal32 hacc = position.HorizontalAccuracy();
<a name="l00354"></a>00354     <span class="comment">//logg(&quot;position info: latitude %lg deg, longitude %lg deg, altitude %g m, vertical_accuracy %g m, horizontal_accuracy %g m&quot;, lat, lon, alt, vacc, hacc);</span>
<a name="l00355"></a>00355     <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;%s: lat %lg, lon %lg, alt %g, vacc %g m, hacc %g m&quot;</span>, aSensorName, lat, lon, alt, vacc, hacc);
<a name="l00356"></a>00356     <span class="keywordflow">if</span> (!Math::IsNaN(lat) &amp;&amp;
<a name="l00357"></a>00357   !Math::IsNaN(lon)) {
<a name="l00358"></a>00358       <a class="code" href="sa__sensor__list__log__db_8c.html#a7b1f6abd67ba82d15d38816c03ab82db">log_db_log_position</a>(aLogDb, lat, lon, alt, vacc, hacc, couString, satString, NULL);
<a name="l00359"></a>00359     } <span class="keywordflow">else</span> {
<a name="l00360"></a>00360       <a class="code" href="logging__c_8h.html#a919260af80d8c36d20780bd23f20fa5a">logt</a>(<span class="stringliteral">&quot;supposedly full reading has NaN value(s) in coordinates&quot;</span>);
<a name="l00361"></a>00361     }
<a name="l00362"></a>00362   }
<a name="l00363"></a>00363 }
<a name="l00364"></a>00364 
<a name="l00365"></a><a class="code" href="classCSensor__cellpos.html#a1877bc9dc4b3ec253613f75eeb12a2c6">00365</a> gboolean <a class="code" href="classCSensor__cellpos.html#a1877bc9dc4b3ec253613f75eeb12a2c6">CSensor_cellpos::PositionerEventL</a>(GError** <a class="code" href="lundump_8c.html#a6776ffdd5e2abf4119b1d45731e9e668">error</a>)
<a name="l00366"></a>00366 {
<a name="l00367"></a>00367   <a class="code" href="assertions_8h.html#aef4c0071b670dc2a857d2e9055e6c5de">assert_error_unset</a>(error);
<a name="l00368"></a>00368   assert(<a class="code" href="classCSensor__cellpos.html#a58da92e2caec62843a624aa5b9955f80">iSatPositioner</a>);
<a name="l00369"></a>00369 
<a name="l00370"></a>00370   <a class="code" href="classCSensor__cellpos.html#a754896561d38d392981d861c4a95ee55">iLastScanTime</a>.UniversalTime();
<a name="l00371"></a>00371 
<a name="l00372"></a>00372   <span class="comment">// See &quot;lbserrors.h&quot; for LBS-specific return codes for</span>
<a name="l00373"></a>00373   <span class="comment">// NotifyPositionUpdate requests. Note that somewhat unusually there</span>
<a name="l00374"></a>00374   <span class="comment">// are some positive values as well.</span>
<a name="l00375"></a>00375   TInt errCode = <a class="code" href="classCSensor__cellpos.html#a58da92e2caec62843a624aa5b9955f80">iSatPositioner</a>-&gt;<a class="code" href="classCPositioner__gps.html#a9070526a379600c5485b3873e0946c88">StatusCode</a>();
<a name="l00376"></a>00376 
<a name="l00377"></a>00377   <span class="keywordflow">if</span> (errCode &lt; 0) {
<a name="l00378"></a>00378     <span class="comment">// Do not yet quite know what sort of errors might be getting, so</span>
<a name="l00379"></a>00379     <span class="comment">// shall merely log errors and keep retrying. Do want to make</span>
<a name="l00380"></a>00380     <span class="comment">// sure, however, that we do not get an awful lot of errors</span>
<a name="l00381"></a>00381     <span class="comment">// growing our log file to an unreasonable size, and hence will</span>
<a name="l00382"></a>00382     <span class="comment">// stop the scanner if there are lots of consecutive error</span>
<a name="l00383"></a>00383     <span class="comment">// completions. We can be cleverer here once we know what sort of</span>
<a name="l00384"></a>00384     <span class="comment">// errors we might be getting. But it is reasonable to assume that</span>
<a name="l00385"></a>00385     <span class="comment">// there may be immediate error returns in cases such as a</span>
<a name="l00386"></a>00386     <span class="comment">// positioning module being or having become unavailable.</span>
<a name="l00387"></a>00387     <span class="keywordflow">switch</span> (errCode) { <span class="comment">// see &lt;lbserrors.h&gt;</span>
<a name="l00388"></a>00388     <span class="keywordflow">case</span> KErrTimedOut:
<a name="l00389"></a>00389       <span class="comment">// Can expect to get this after the time period specified with</span>
<a name="l00390"></a>00390       <span class="comment">// SetUpdateTimeOut. If we didn&apos;t get the position in that time,</span>
<a name="l00391"></a>00391       <span class="comment">// then we did not.</span>
<a name="l00392"></a>00392       <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;cellpos: GPS timeout&quot;</span>);
<a name="l00393"></a>00393       <span class="keywordflow">break</span>;
<a name="l00394"></a>00394 
<a name="l00395"></a>00395     <span class="keywordflow">case</span> KErrServerBusy:
<a name="l00396"></a>00396       <span class="comment">// If the server is busy, let us then just wait for the next</span>
<a name="l00397"></a>00397       <span class="comment">// cell ID change to avoid burdening it further.</span>
<a name="l00398"></a>00398       <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;cellpos: positioner busy&quot;</span>);
<a name="l00399"></a>00399       <span class="keywordflow">break</span>;
<a name="l00400"></a>00400 
<a name="l00401"></a>00401       <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;cellpos: positioning error&quot;</span>);
<a name="l00402"></a>00402 
<a name="l00403"></a>00403       <span class="comment">// Used positioning module became unavailable. (Before we had</span>
<a name="l00404"></a>00404       <span class="comment">// time to stop using it.)</span>
<a name="l00405"></a>00405     <span class="keywordflow">case</span> KErrNotFound:
<a name="l00406"></a>00406       <span class="comment">// Perhaps some capability thing.</span>
<a name="l00407"></a>00407     <span class="keywordflow">case</span> KErrAccessDenied: 
<a name="l00408"></a>00408       <span class="comment">// Could apparently happen if the user refuses to connect an</span>
<a name="l00409"></a>00409       <span class="comment">// external Bluetooth GPS device, for example.</span>
<a name="l00410"></a>00410     <span class="keywordflow">case</span> KErrCancel:
<a name="l00411"></a>00411       <a class="code" href="er__errors_8h.html#a008602962ee67e8048c9eec8828e2258">er_log_symbian</a>(0, errCode, 
<a name="l00412"></a>00412          <span class="stringliteral">&quot;cellpos: positioner error, giving up on positioner&quot;</span>);
<a name="l00413"></a>00413       <span class="comment">// We will not reset state further, lest we be asked to switch</span>
<a name="l00414"></a>00414       <span class="comment">// back to the same module again.</span>
<a name="l00415"></a>00415       DELETE_Z(<a class="code" href="classCSensor__cellpos.html#a58da92e2caec62843a624aa5b9955f80">iSatPositioner</a>);
<a name="l00416"></a>00416       <span class="keywordflow">break</span>;
<a name="l00417"></a>00417 
<a name="l00418"></a>00418     <span class="keywordflow">case</span> KErrArgument:
<a name="l00419"></a>00419     <span class="keywordflow">case</span> KErrPositionBufferOverflow:
<a name="l00420"></a>00420       <a class="code" href="er__errors_8h.html#a008602962ee67e8048c9eec8828e2258">er_log_symbian</a>(<a class="code" href="er__errors_8h.html#a74b7465a12d63ad80bc10d1ebaf900d8">er_FATAL</a>, errCode, <span class="stringliteral">&quot;cellpos: unexpected positioning error&quot;</span>);
<a name="l00421"></a>00421       <span class="keywordflow">break</span>;
<a name="l00422"></a>00422 
<a name="l00423"></a>00423     <span class="keywordflow">case</span> KErrBadHandle: <span class="comment">// positioning service session dead</span>
<a name="l00424"></a>00424       <span class="comment">// We should really recreate session, but why was it close in</span>
<a name="l00425"></a>00425       <span class="comment">// the first place, something not right here.</span>
<a name="l00426"></a>00426       <a class="code" href="er__errors_8h.html#a008602962ee67e8048c9eec8828e2258">er_log_symbian</a>(0, errCode, 
<a name="l00427"></a>00427          <span class="stringliteral">&quot;INACTIVATE: cellpos: position server session died&quot;</span>);
<a name="l00428"></a>00428       <a class="code" href="classCSensor__cellpos.html#a4faef525c0633631bad711c2cc2456ec">Stop</a>();
<a name="l00429"></a>00429       <span class="keywordflow">break</span>;
<a name="l00430"></a>00430 
<a name="l00431"></a>00431     <span class="keywordflow">default</span>:
<a name="l00432"></a>00432       <span class="comment">// We may not actually need the retry AO at all. The cell ID</span>
<a name="l00433"></a>00433       <span class="comment">// changes will determine when to retry.</span>
<a name="l00434"></a>00434       <a class="code" href="er__errors_8h.html#a008602962ee67e8048c9eec8828e2258">er_log_symbian</a>(0, errCode, 
<a name="l00435"></a>00435          <span class="stringliteral">&quot;cellpos: positioner error, not retrying&quot;</span>);
<a name="l00436"></a>00436       <span class="comment">/*</span>
<a name="l00437"></a>00437 <span class="comment">      if (!iRetryAo-&gt;Retry()) {</span>
<a name="l00438"></a>00438 <span class="comment">  er_log_symbian(0, errCode, &quot;INACTIVATE: cellpos: stopping scanning due to too many errors&quot;);</span>
<a name="l00439"></a>00439 <span class="comment">  Stop();</span>
<a name="l00440"></a>00440 <span class="comment">      }</span>
<a name="l00441"></a>00441 <span class="comment">      */</span>
<a name="l00442"></a>00442     }
<a name="l00443"></a>00443   } <span class="keywordflow">else</span> { <span class="comment">// errCode &gt;= 0 (yes, there are _positive_ codes as well)</span>
<a name="l00444"></a>00444     <a class="code" href="classCSensor__cellpos.html#a2ad308f67cb3769edd9899db59d9af17">iRetryAo</a>-&gt;<a class="code" href="classCRetryAo.html#a263404fe797ad93815c1618c4e469ca0">ResetFailures</a>();
<a name="l00445"></a>00445 
<a name="l00446"></a>00446     <span class="keywordflow">switch</span> (errCode) { <span class="comment">// see &lt;lbserrors.h&gt;</span>
<a name="l00447"></a>00447     <span class="keywordflow">case</span> KPositionQualityLoss: <span class="comment">// no data</span>
<a name="l00448"></a>00448       {
<a name="l00449"></a>00449   <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;cellpos: got no GPS data&quot;</span>);
<a name="l00450"></a>00450   <span class="keywordflow">break</span>;
<a name="l00451"></a>00451       }
<a name="l00452"></a>00452       
<a name="l00453"></a>00453     <span class="keywordflow">case</span> KErrNone: <span class="comment">// full data</span>
<a name="l00454"></a>00454     <span class="keywordflow">case</span> KPositionPartialUpdate: <span class="comment">// partial data</span>
<a name="l00455"></a>00455       {
<a name="l00456"></a>00456 <span class="preprocessor">#if __DO_LOGGING__</span>
<a name="l00457"></a>00457 <span class="preprocessor"></span>      TBool isPartial = (errCode == KPositionPartialUpdate);
<a name="l00458"></a>00458       <a class="code" href="logging__c_8h.html#abea298723ad956e744c9efec71512dd0">logg</a>(<span class="stringliteral">&quot;got %s gps reading&quot;</span>, isPartial ? <span class="stringliteral">&quot;partial&quot;</span> : <span class="stringliteral">&quot;full&quot;</span>);
<a name="l00459"></a>00459 <span class="preprocessor">#endif</span>
<a name="l00460"></a>00460 <span class="preprocessor"></span>
<a name="l00461"></a>00461       <span class="comment">// Is it so that if some module does not support satellite info</span>
<a name="l00462"></a>00462       <span class="comment">// then if we try to request it we get nothing? Well, we are</span>
<a name="l00463"></a>00463       <span class="comment">// only choosing GPS modules, and GPS is based on satellites, so</span>
<a name="l00464"></a>00464       <span class="comment">// surely there always is satellite info.</span>
<a name="l00465"></a>00465       <span class="keyword">const</span> TPositionSatelliteInfo&amp; positionInfo = <a class="code" href="classCSensor__cellpos.html#a58da92e2caec62843a624aa5b9955f80">iSatPositioner</a>-&gt;<a class="code" href="classCPositioner__gps.html#abb7c10aa5bdfa90a0a8e809bd0af5744">PositionInfo</a>();
<a name="l00466"></a>00466 
<a name="l00467"></a>00467       <a class="code" href="epoc-cellpos_8cpp.html#a4963349ee8827d46fa3cc6c3a90a1484">LogSatelliteInfoL</a>(<a class="code" href="classCSensor__cellpos.html#aa29374e4ecd9cb65f4b80731659e20db">iLogDb</a>, <span class="stringliteral">&quot;cellpos&quot;</span>, positionInfo);
<a name="l00468"></a>00468       
<a name="l00469"></a>00469       <span class="keywordflow">break</span>;
<a name="l00470"></a>00470       }
<a name="l00471"></a>00471 
<a name="l00472"></a>00472     <span class="keywordflow">default</span>: <span class="comment">// unknown completion code</span>
<a name="l00473"></a>00473       {
<a name="l00474"></a>00474   <a class="code" href="guilog_8h.html#a311969cebcd3a42da860d7b87e368932">guilogf</a>(<span class="stringliteral">&quot;cellpos: unknown completion code %d&quot;</span>, errCode);
<a name="l00475"></a>00475   <a class="code" href="ld__log__db_8c.html#a593a2e358ba9033bbd885a1acd1ab3c2">log_db_log_status</a>(<a class="code" href="classCSensor__cellpos.html#aa29374e4ecd9cb65f4b80731659e20db">iLogDb</a>, NULL, 
<a name="l00476"></a>00476         <span class="stringliteral">&quot;cellpos: unknown completion code %d&quot;</span>, errCode);
<a name="l00477"></a>00477       }
<a name="l00478"></a>00478     }
<a name="l00479"></a>00479   }
<a name="l00480"></a>00480 
<a name="l00481"></a>00481   <span class="keywordflow">return</span> TRUE;
<a name="l00482"></a>00482 }
<a name="l00483"></a>00483 
<a name="l00484"></a><a class="code" href="classCSensor__cellpos.html#a560a8f396cf670701358b07ff836a02f">00484</a> <span class="keywordtype">void</span> <a class="code" href="classCSensor__cellpos.html#a560a8f396cf670701358b07ff836a02f">CSensor_cellpos::Reconfigure</a>(<span class="keyword">const</span> gchar* name, <span class="keyword">const</span> gchar* value)
<a name="l00485"></a>00485 {
<a name="l00486"></a>00486   <span class="keywordflow">if</span> ((strcmp(name, <span class="stringliteral">&quot;sensor.cellpos.frequency&quot;</span>) == 0) ||
<a name="l00487"></a>00487       (strcmp(name, <span class="stringliteral">&quot;sensor.cellpos.timeout&quot;</span>) == 0)) {
<a name="l00488"></a>00488     <a class="code" href="classCSensor__cellpos.html#aa59864b002ff3886c10aa6ee20729050">ReadConfig</a>();
<a name="l00489"></a>00489   }
<a name="l00490"></a>00490 }
<a name="l00491"></a>00491 
<a name="l00492"></a>00492 <span class="comment">// The paremeter updates do not necessarily take effect immediately.</span>
<a name="l00493"></a><a class="code" href="classCSensor__cellpos.html#aa59864b002ff3886c10aa6ee20729050">00493</a> <span class="keywordtype">void</span> <a class="code" href="classCSensor__cellpos.html#aa59864b002ff3886c10aa6ee20729050">CSensor_cellpos::ReadConfig</a>()
<a name="l00494"></a>00494 {
<a name="l00495"></a>00495   <a class="code" href="classCSensor__cellpos.html#a078eec7995771c4a184fdb4e3ca37d1b">iMinScanRequestIntervalSecs</a> =
<a name="l00496"></a>00496     <a class="code" href="cf__query_8c.html#aba86f42ef0730e3e778a0db7cf229f60">force_get_ConfigDb_int</a>(<span class="stringliteral">&quot;sensor.cellpos.frequency&quot;</span>, 
<a name="l00497"></a>00497          <a class="code" href="epoc-cellpos_8cpp.html#a8f42d5e1de952581f80956c8314822b2">MIN_SCAN_REQUEST_INTERVAL_SECS</a>);
<a name="l00498"></a>00498   <a class="code" href="classCSensor__cellpos.html#a838640af065017e9737315f8f758f274">iSatelliteQueryTimeoutSecs</a> = 
<a name="l00499"></a>00499     <a class="code" href="cf__query_8c.html#aba86f42ef0730e3e778a0db7cf229f60">force_get_ConfigDb_int</a>(<span class="stringliteral">&quot;sensor.cellpos.timeout&quot;</span>, 
<a name="l00500"></a>00500          <a class="code" href="epoc-cellpos_8cpp.html#aab207ce168af3a3d85a5f61d4a056a1e">SATELLITE_QUERY_TIMEOUT_SECS</a>);
<a name="l00501"></a>00501   <a class="code" href="classCSensor__cellpos.html#aa4bf3f105823def8a880a2dc1bf7aa5b">iDataMaxAgeSecs</a> = 
<a name="l00502"></a>00502     <a class="code" href="cf__query_8c.html#aba86f42ef0730e3e778a0db7cf229f60">force_get_ConfigDb_int</a>(<span class="stringliteral">&quot;sensor.cellpos.ttl&quot;</span>, 
<a name="l00503"></a>00503          <a class="code" href="epoc-cellpos_8cpp.html#a57059cd8689beceb9b0d2e18cb13fa22">POSITIONER_MAX_AGE_SECS</a>);
<a name="l00504"></a>00504 }
<a name="l00505"></a>00505 <span class="comment"></span>
<a name="l00506"></a>00506 <span class="comment">/**</span>
<a name="l00507"></a>00507 <span class="comment"></span>
<a name="l00508"></a>00508 <span class="comment">epoc-cellpos.cpp</span>
<a name="l00509"></a>00509 <span class="comment"></span>
<a name="l00510"></a>00510 <span class="comment">Copyright 2009-2011 Helsinki Institute for Information Technology</span>
<a name="l00511"></a>00511 <span class="comment">(HIIT) and the authors. All rights reserved.</span>
<a name="l00512"></a>00512 <span class="comment"></span>
<a name="l00513"></a>00513 <span class="comment">Authors: Tero Hasu &lt;tero.hasu@hut.fi&gt;</span>
<a name="l00514"></a>00514 <span class="comment"></span>
<a name="l00515"></a>00515 <span class="comment">Permission is hereby granted, free of charge, to any person</span>
<a name="l00516"></a>00516 <span class="comment">obtaining a copy of this software and associated documentation files</span>
<a name="l00517"></a>00517 <span class="comment">(the &quot;Software&quot;), to deal in the Software without restriction,</span>
<a name="l00518"></a>00518 <span class="comment">including without limitation the rights to use, copy, modify, merge,</span>
<a name="l00519"></a>00519 <span class="comment">publish, distribute, sublicense, and/or sell copies of the Software,</span>
<a name="l00520"></a>00520 <span class="comment">and to permit persons to whom the Software is furnished to do so,</span>
<a name="l00521"></a>00521 <span class="comment">subject to the following conditions:</span>
<a name="l00522"></a>00522 <span class="comment"></span>
<a name="l00523"></a>00523 <span class="comment">The above copyright notice and this permission notice shall be</span>
<a name="l00524"></a>00524 <span class="comment">included in all copies or substantial portions of the Software.</span>
<a name="l00525"></a>00525 <span class="comment"></span>
<a name="l00526"></a>00526 <span class="comment">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,</span>
<a name="l00527"></a>00527 <span class="comment">EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF</span>
<a name="l00528"></a>00528 <span class="comment">MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND</span>
<a name="l00529"></a>00529 <span class="comment">NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS</span>
<a name="l00530"></a>00530 <span class="comment">BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN</span>
<a name="l00531"></a>00531 <span class="comment">ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN</span>
<a name="l00532"></a>00532 <span class="comment">CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span>
<a name="l00533"></a>00533 <span class="comment">SOFTWARE.</span>
<a name="l00534"></a>00534 <span class="comment"></span>
<a name="l00535"></a>00535 <span class="comment"> **/</span>
</pre></div></div>
<hr size="1">

<p style="text-align: right;">
  <a href="http://www.contextlogger.org/">ContextLogger2</a>&#8212;ContextLogger2 Logger Daemon Internals&#8212;<small>Generated on Mon May 2 13:49:52 2011 by&nbsp;<a href="http://www.doxygen.org/">Doxygen</a> 1.6.1</small>
</p>

</body>
</html>
