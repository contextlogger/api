<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ContextLogger2 Logger Daemon Internals: os.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_53e7feede50ae4cb655a635f658a2b4e.html">sqlite3h</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_a0c08fff43b69094a2511677d8587129.html">src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_05c6b5177aad09a72e8ee1adc608dac0.html">sqlite3</a>
  </div>
</div>
<div class="contents">
<h1>os.h</h1><a href="os_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment">** 2001 September 16</span>
<a name="l00003"></a>00003 <span class="comment">**</span>
<a name="l00004"></a>00004 <span class="comment">** The author disclaims copyright to this source code.  In place of</span>
<a name="l00005"></a>00005 <span class="comment">** a legal notice, here is a blessing:</span>
<a name="l00006"></a>00006 <span class="comment">**</span>
<a name="l00007"></a>00007 <span class="comment">**    May you do good and not evil.</span>
<a name="l00008"></a>00008 <span class="comment">**    May you find forgiveness for yourself and forgive others.</span>
<a name="l00009"></a>00009 <span class="comment">**    May you share freely, never taking more than you give.</span>
<a name="l00010"></a>00010 <span class="comment">**</span>
<a name="l00011"></a>00011 <span class="comment">******************************************************************************</span>
<a name="l00012"></a>00012 <span class="comment">**</span>
<a name="l00013"></a>00013 <span class="comment">** This header file (together with is companion C source-code file</span>
<a name="l00014"></a>00014 <span class="comment">** &quot;os.c&quot;) attempt to abstract the underlying operating system so that</span>
<a name="l00015"></a>00015 <span class="comment">** the SQLite library will work on both POSIX and windows systems.</span>
<a name="l00016"></a>00016 <span class="comment">**</span>
<a name="l00017"></a>00017 <span class="comment">** This header file is #include-ed by sqliteInt.h and thus ends up</span>
<a name="l00018"></a>00018 <span class="comment">** being included by every source file.</span>
<a name="l00019"></a>00019 <span class="comment">**</span>
<a name="l00020"></a>00020 <span class="comment">** $Id: os.h,v 1.105 2008/06/26 10:41:19 danielk1977 Exp $</span>
<a name="l00021"></a>00021 <span class="comment">*/</span>
<a name="l00022"></a>00022 <span class="preprocessor">#ifndef _SQLITE_OS_H_</span>
<a name="l00023"></a>00023 <span class="preprocessor"></span><span class="preprocessor">#define _SQLITE_OS_H_</span>
<a name="l00024"></a>00024 <span class="preprocessor"></span>
<a name="l00025"></a>00025 <span class="comment">/*</span>
<a name="l00026"></a>00026 <span class="comment">** Figure out if we are dealing with Unix, Windows, or some other</span>
<a name="l00027"></a>00027 <span class="comment">** operating system.  After the following block of preprocess macros,</span>
<a name="l00028"></a>00028 <span class="comment">** all of SQLITE_OS_UNIX, SQLITE_OS_WIN, SQLITE_OS_OS2, and SQLITE_OS_OTHER </span>
<a name="l00029"></a>00029 <span class="comment">** will defined to either 1 or 0.  One of the four will be 1.  The other </span>
<a name="l00030"></a>00030 <span class="comment">** three will be 0.</span>
<a name="l00031"></a>00031 <span class="comment">*/</span>
<a name="l00032"></a>00032 <span class="preprocessor">#if defined(SQLITE_OS_OTHER)</span>
<a name="l00033"></a>00033 <span class="preprocessor"></span><span class="preprocessor"># if SQLITE_OS_OTHER==1</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span><span class="preprocessor">#   undef SQLITE_OS_UNIX</span>
<a name="l00035"></a>00035 <span class="preprocessor"></span><span class="preprocessor">#   define SQLITE_OS_UNIX 0</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span><span class="preprocessor">#   undef SQLITE_OS_WIN</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span><span class="preprocessor">#   define SQLITE_OS_WIN 0</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span><span class="preprocessor">#   undef SQLITE_OS_OS2</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span><span class="preprocessor">#   define SQLITE_OS_OS2 0</span>
<a name="l00040"></a>00040 <span class="preprocessor"></span><span class="preprocessor"># else</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span><span class="preprocessor">#   undef SQLITE_OS_OTHER</span>
<a name="l00042"></a>00042 <span class="preprocessor"></span><span class="preprocessor"># endif</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00044"></a>00044 <span class="preprocessor"></span><span class="preprocessor">#if !defined(SQLITE_OS_UNIX) &amp;&amp; !defined(SQLITE_OS_OTHER)</span>
<a name="l00045"></a><a class="code" href="os_8h.html#a7d4ee2e28a90b02cbf17255054f0c6a6">00045</a> <span class="preprocessor"></span><span class="preprocessor"># define SQLITE_OS_OTHER 0</span>
<a name="l00046"></a>00046 <span class="preprocessor"></span><span class="preprocessor"># ifndef SQLITE_OS_WIN</span>
<a name="l00047"></a>00047 <span class="preprocessor"></span><span class="preprocessor">#   if defined(_WIN32) || defined(WIN32) || defined(__CYGWIN__) || defined(__MINGW32__) || defined(__BORLANDC__)</span>
<a name="l00048"></a>00048 <span class="preprocessor"></span><span class="preprocessor">#     define SQLITE_OS_WIN 1</span>
<a name="l00049"></a>00049 <span class="preprocessor"></span><span class="preprocessor">#     define SQLITE_OS_UNIX 0</span>
<a name="l00050"></a>00050 <span class="preprocessor"></span><span class="preprocessor">#     define SQLITE_OS_OS2 0</span>
<a name="l00051"></a>00051 <span class="preprocessor"></span><span class="preprocessor">#   elif defined(__EMX__) || defined(_OS2) || defined(OS2) || defined(_OS2_) || defined(__OS2__)</span>
<a name="l00052"></a>00052 <span class="preprocessor"></span><span class="preprocessor">#     define SQLITE_OS_WIN 0</span>
<a name="l00053"></a>00053 <span class="preprocessor"></span><span class="preprocessor">#     define SQLITE_OS_UNIX 0</span>
<a name="l00054"></a>00054 <span class="preprocessor"></span><span class="preprocessor">#     define SQLITE_OS_OS2 1</span>
<a name="l00055"></a>00055 <span class="preprocessor"></span><span class="preprocessor">#   else</span>
<a name="l00056"></a><a class="code" href="os_8h.html#ae50d6df93c48c761b3463aadae5d2524">00056</a> <span class="preprocessor"></span><span class="preprocessor">#     define SQLITE_OS_WIN 0</span>
<a name="l00057"></a><a class="code" href="os_8h.html#a3d4d9390e65721a3616da1757ff6a519">00057</a> <span class="preprocessor"></span><span class="preprocessor">#     define SQLITE_OS_UNIX 1</span>
<a name="l00058"></a><a class="code" href="os_8h.html#a1cdd08dbd7fcd12c686e6e9c487771c4">00058</a> <span class="preprocessor"></span><span class="preprocessor">#     define SQLITE_OS_OS2 0</span>
<a name="l00059"></a>00059 <span class="preprocessor"></span><span class="preprocessor">#  endif</span>
<a name="l00060"></a>00060 <span class="preprocessor"></span><span class="preprocessor"># else</span>
<a name="l00061"></a>00061 <span class="preprocessor"></span><span class="preprocessor">#  define SQLITE_OS_UNIX 0</span>
<a name="l00062"></a>00062 <span class="preprocessor"></span><span class="preprocessor">#  define SQLITE_OS_OS2 0</span>
<a name="l00063"></a>00063 <span class="preprocessor"></span><span class="preprocessor"># endif</span>
<a name="l00064"></a>00064 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00065"></a>00065 <span class="preprocessor"></span><span class="preprocessor"># ifndef SQLITE_OS_WIN</span>
<a name="l00066"></a>00066 <span class="preprocessor"></span><span class="preprocessor">#  define SQLITE_OS_WIN 0</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span><span class="preprocessor"># endif</span>
<a name="l00068"></a>00068 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00069"></a>00069 <span class="preprocessor"></span>
<a name="l00070"></a>00070 <span class="comment">/*</span>
<a name="l00071"></a>00071 <span class="comment">** Determine if we are dealing with WindowsCE - which has a much</span>
<a name="l00072"></a>00072 <span class="comment">** reduced API.</span>
<a name="l00073"></a>00073 <span class="comment">*/</span>
<a name="l00074"></a>00074 <span class="preprocessor">#if defined(_WIN32_WCE)</span>
<a name="l00075"></a>00075 <span class="preprocessor"></span><span class="preprocessor"># define SQLITE_OS_WINCE 1</span>
<a name="l00076"></a>00076 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00077"></a><a class="code" href="os_8h.html#aa23485961012353544879dc0f8dd092d">00077</a> <span class="preprocessor"></span><span class="preprocessor"># define SQLITE_OS_WINCE 0</span>
<a name="l00078"></a>00078 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00079"></a>00079 <span class="preprocessor"></span>
<a name="l00080"></a>00080 
<a name="l00081"></a>00081 <span class="comment">/*</span>
<a name="l00082"></a>00082 <span class="comment">** Define the maximum size of a temporary filename</span>
<a name="l00083"></a>00083 <span class="comment">*/</span>
<a name="l00084"></a>00084 <span class="preprocessor">#if SQLITE_OS_WIN</span>
<a name="l00085"></a>00085 <span class="preprocessor"></span><span class="preprocessor"># include &lt;windows.h&gt;</span>
<a name="l00086"></a>00086 <span class="preprocessor"># define SQLITE_TEMPNAME_SIZE (MAX_PATH+50)</span>
<a name="l00087"></a>00087 <span class="preprocessor"></span><span class="preprocessor">#elif SQLITE_OS_OS2</span>
<a name="l00088"></a>00088 <span class="preprocessor"></span><span class="preprocessor"># if (__GNUC__ &gt; 3 || __GNUC__ == 3 &amp;&amp; __GNUC_MINOR__ &gt;= 3) &amp;&amp; defined(OS2_HIGH_MEMORY)</span>
<a name="l00089"></a>00089 <span class="preprocessor"></span><span class="preprocessor">#  include &lt;os2safe.h&gt;</span> <span class="comment">/* has to be included before os2.h for linking to work */</span>
<a name="l00090"></a>00090 <span class="preprocessor"># endif</span>
<a name="l00091"></a>00091 <span class="preprocessor"></span><span class="preprocessor"># define INCL_DOSDATETIME</span>
<a name="l00092"></a>00092 <span class="preprocessor"></span><span class="preprocessor"># define INCL_DOSFILEMGR</span>
<a name="l00093"></a>00093 <span class="preprocessor"></span><span class="preprocessor"># define INCL_DOSERRORS</span>
<a name="l00094"></a>00094 <span class="preprocessor"></span><span class="preprocessor"># define INCL_DOSMISC</span>
<a name="l00095"></a>00095 <span class="preprocessor"></span><span class="preprocessor"># define INCL_DOSPROCESS</span>
<a name="l00096"></a>00096 <span class="preprocessor"></span><span class="preprocessor"># define INCL_DOSMODULEMGR</span>
<a name="l00097"></a>00097 <span class="preprocessor"></span><span class="preprocessor"># define INCL_DOSSEMAPHORES</span>
<a name="l00098"></a>00098 <span class="preprocessor"></span><span class="preprocessor"># include &lt;os2.h&gt;</span>
<a name="l00099"></a>00099 <span class="preprocessor"># include &lt;uconv.h&gt;</span>
<a name="l00100"></a>00100 <span class="preprocessor"># define SQLITE_TEMPNAME_SIZE (CCHMAXPATHCOMP)</span>
<a name="l00101"></a>00101 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00102"></a><a class="code" href="os_8h.html#a51fc8aad5ad0e3770535085740cbda50">00102</a> <span class="preprocessor"></span><span class="preprocessor"># define SQLITE_TEMPNAME_SIZE 200</span>
<a name="l00103"></a>00103 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00104"></a>00104 <span class="preprocessor"></span>
<a name="l00105"></a>00105 <span class="comment">/* If the SET_FULLSYNC macro is not defined above, then make it</span>
<a name="l00106"></a>00106 <span class="comment">** a no-op</span>
<a name="l00107"></a>00107 <span class="comment">*/</span>
<a name="l00108"></a>00108 <span class="preprocessor">#ifndef SET_FULLSYNC</span>
<a name="l00109"></a><a class="code" href="os_8h.html#ac5394cfd11f18c56658015e06375cd93">00109</a> <span class="preprocessor"></span><span class="preprocessor"># define SET_FULLSYNC(x,y)</span>
<a name="l00110"></a>00110 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00111"></a>00111 <span class="preprocessor"></span>
<a name="l00112"></a>00112 <span class="comment">/*</span>
<a name="l00113"></a>00113 <span class="comment">** The default size of a disk sector</span>
<a name="l00114"></a>00114 <span class="comment">*/</span>
<a name="l00115"></a>00115 <span class="preprocessor">#ifndef SQLITE_DEFAULT_SECTOR_SIZE</span>
<a name="l00116"></a><a class="code" href="os_8h.html#ab35bd9ac959b178e2ce0f7ccd646c557">00116</a> <span class="preprocessor"></span><span class="preprocessor"># define SQLITE_DEFAULT_SECTOR_SIZE 512</span>
<a name="l00117"></a>00117 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00118"></a>00118 <span class="preprocessor"></span>
<a name="l00119"></a>00119 <span class="comment">/*</span>
<a name="l00120"></a>00120 <span class="comment">** Temporary files are named starting with this prefix followed by 16 random</span>
<a name="l00121"></a>00121 <span class="comment">** alphanumeric characters, and no file extension. They are stored in the</span>
<a name="l00122"></a>00122 <span class="comment">** OS&apos;s standard temporary file directory, and are deleted prior to exit.</span>
<a name="l00123"></a>00123 <span class="comment">** If sqlite is being embedded in another program, you may wish to change the</span>
<a name="l00124"></a>00124 <span class="comment">** prefix to reflect your program&apos;s name, so that if your program exits</span>
<a name="l00125"></a>00125 <span class="comment">** prematurely, old temporary files can be easily identified. This can be done</span>
<a name="l00126"></a>00126 <span class="comment">** using -DSQLITE_TEMP_FILE_PREFIX=myprefix_ on the compiler command line.</span>
<a name="l00127"></a>00127 <span class="comment">**</span>
<a name="l00128"></a>00128 <span class="comment">** 2006-10-31:  The default prefix used to be &quot;sqlite_&quot;.  But then</span>
<a name="l00129"></a>00129 <span class="comment">** Mcafee started using SQLite in their anti-virus product and it</span>
<a name="l00130"></a>00130 <span class="comment">** started putting files with the &quot;sqlite&quot; name in the c:/temp folder.</span>
<a name="l00131"></a>00131 <span class="comment">** This annoyed many windows users.  Those users would then do a </span>
<a name="l00132"></a>00132 <span class="comment">** Google search for &quot;sqlite&quot;, find the telephone numbers of the</span>
<a name="l00133"></a>00133 <span class="comment">** developers and call to wake them up at night and complain.</span>
<a name="l00134"></a>00134 <span class="comment">** For this reason, the default name prefix is changed to be &quot;sqlite&quot; </span>
<a name="l00135"></a>00135 <span class="comment">** spelled backwards.  So the temp files are still identified, but</span>
<a name="l00136"></a>00136 <span class="comment">** anybody smart enough to figure out the code is also likely smart</span>
<a name="l00137"></a>00137 <span class="comment">** enough to know that calling the developer will not help get rid</span>
<a name="l00138"></a>00138 <span class="comment">** of the file.</span>
<a name="l00139"></a>00139 <span class="comment">*/</span>
<a name="l00140"></a>00140 <span class="preprocessor">#ifndef SQLITE_TEMP_FILE_PREFIX</span>
<a name="l00141"></a><a class="code" href="os_8h.html#a7aeb41d98ec51e888340be247364dd85">00141</a> <span class="preprocessor"></span><span class="preprocessor"># define SQLITE_TEMP_FILE_PREFIX &quot;etilqs_&quot;</span>
<a name="l00142"></a>00142 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00143"></a>00143 <span class="preprocessor"></span>
<a name="l00144"></a>00144 <span class="comment">/*</span>
<a name="l00145"></a>00145 <span class="comment">** The following values may be passed as the second argument to</span>
<a name="l00146"></a>00146 <span class="comment">** sqlite3OsLock(). The various locks exhibit the following semantics:</span>
<a name="l00147"></a>00147 <span class="comment">**</span>
<a name="l00148"></a>00148 <span class="comment">** SHARED:    Any number of processes may hold a SHARED lock simultaneously.</span>
<a name="l00149"></a>00149 <span class="comment">** RESERVED:  A single process may hold a RESERVED lock on a file at</span>
<a name="l00150"></a>00150 <span class="comment">**            any time. Other processes may hold and obtain new SHARED locks.</span>
<a name="l00151"></a>00151 <span class="comment">** PENDING:   A single process may hold a PENDING lock on a file at</span>
<a name="l00152"></a>00152 <span class="comment">**            any one time. Existing SHARED locks may persist, but no new</span>
<a name="l00153"></a>00153 <span class="comment">**            SHARED locks may be obtained by other processes.</span>
<a name="l00154"></a>00154 <span class="comment">** EXCLUSIVE: An EXCLUSIVE lock precludes all other locks.</span>
<a name="l00155"></a>00155 <span class="comment">**</span>
<a name="l00156"></a>00156 <span class="comment">** PENDING_LOCK may not be passed directly to sqlite3OsLock(). Instead, a</span>
<a name="l00157"></a>00157 <span class="comment">** process that requests an EXCLUSIVE lock may actually obtain a PENDING</span>
<a name="l00158"></a>00158 <span class="comment">** lock. This can be upgraded to an EXCLUSIVE lock by a subsequent call to</span>
<a name="l00159"></a>00159 <span class="comment">** sqlite3OsLock().</span>
<a name="l00160"></a>00160 <span class="comment">*/</span>
<a name="l00161"></a><a class="code" href="os_8h.html#a993c05b6c403f10fb3627e9e4fc30c83">00161</a> <span class="preprocessor">#define NO_LOCK         0</span>
<a name="l00162"></a><a class="code" href="os_8h.html#adcf3ef1db1ba24bc5f8933a36831cdf9">00162</a> <span class="preprocessor"></span><span class="preprocessor">#define SHARED_LOCK     1</span>
<a name="l00163"></a><a class="code" href="os_8h.html#a4fec7ca081b31fb9e121208e2b57fe3f">00163</a> <span class="preprocessor"></span><span class="preprocessor">#define RESERVED_LOCK   2</span>
<a name="l00164"></a><a class="code" href="os_8h.html#a0f7cda5f07b1a172f8cfb8c2266d7189">00164</a> <span class="preprocessor"></span><span class="preprocessor">#define PENDING_LOCK    3</span>
<a name="l00165"></a><a class="code" href="os_8h.html#ae17e1f5c17b52ec543aefca2a0b6b0f2">00165</a> <span class="preprocessor"></span><span class="preprocessor">#define EXCLUSIVE_LOCK  4</span>
<a name="l00166"></a>00166 <span class="preprocessor"></span>
<a name="l00167"></a>00167 <span class="comment">/*</span>
<a name="l00168"></a>00168 <span class="comment">** File Locking Notes:  (Mostly about windows but also some info for Unix)</span>
<a name="l00169"></a>00169 <span class="comment">**</span>
<a name="l00170"></a>00170 <span class="comment">** We cannot use LockFileEx() or UnlockFileEx() on Win95/98/ME because</span>
<a name="l00171"></a>00171 <span class="comment">** those functions are not available.  So we use only LockFile() and</span>
<a name="l00172"></a>00172 <span class="comment">** UnlockFile().</span>
<a name="l00173"></a>00173 <span class="comment">**</span>
<a name="l00174"></a>00174 <span class="comment">** LockFile() prevents not just writing but also reading by other processes.</span>
<a name="l00175"></a>00175 <span class="comment">** A SHARED_LOCK is obtained by locking a single randomly-chosen </span>
<a name="l00176"></a>00176 <span class="comment">** byte out of a specific range of bytes. The lock byte is obtained at </span>
<a name="l00177"></a>00177 <span class="comment">** random so two separate readers can probably access the file at the </span>
<a name="l00178"></a>00178 <span class="comment">** same time, unless they are unlucky and choose the same lock byte.</span>
<a name="l00179"></a>00179 <span class="comment">** An EXCLUSIVE_LOCK is obtained by locking all bytes in the range.</span>
<a name="l00180"></a>00180 <span class="comment">** There can only be one writer.  A RESERVED_LOCK is obtained by locking</span>
<a name="l00181"></a>00181 <span class="comment">** a single byte of the file that is designated as the reserved lock byte.</span>
<a name="l00182"></a>00182 <span class="comment">** A PENDING_LOCK is obtained by locking a designated byte different from</span>
<a name="l00183"></a>00183 <span class="comment">** the RESERVED_LOCK byte.</span>
<a name="l00184"></a>00184 <span class="comment">**</span>
<a name="l00185"></a>00185 <span class="comment">** On WinNT/2K/XP systems, LockFileEx() and UnlockFileEx() are available,</span>
<a name="l00186"></a>00186 <span class="comment">** which means we can use reader/writer locks.  When reader/writer locks</span>
<a name="l00187"></a>00187 <span class="comment">** are used, the lock is placed on the same range of bytes that is used</span>
<a name="l00188"></a>00188 <span class="comment">** for probabilistic locking in Win95/98/ME.  Hence, the locking scheme</span>
<a name="l00189"></a>00189 <span class="comment">** will support two or more Win95 readers or two or more WinNT readers.</span>
<a name="l00190"></a>00190 <span class="comment">** But a single Win95 reader will lock out all WinNT readers and a single</span>
<a name="l00191"></a>00191 <span class="comment">** WinNT reader will lock out all other Win95 readers.</span>
<a name="l00192"></a>00192 <span class="comment">**</span>
<a name="l00193"></a>00193 <span class="comment">** The following #defines specify the range of bytes used for locking.</span>
<a name="l00194"></a>00194 <span class="comment">** SHARED_SIZE is the number of bytes available in the pool from which</span>
<a name="l00195"></a>00195 <span class="comment">** a random byte is selected for a shared lock.  The pool of bytes for</span>
<a name="l00196"></a>00196 <span class="comment">** shared locks begins at SHARED_FIRST. </span>
<a name="l00197"></a>00197 <span class="comment">**</span>
<a name="l00198"></a>00198 <span class="comment">** These #defines are available in sqlite_aux.h so that adaptors for</span>
<a name="l00199"></a>00199 <span class="comment">** connecting SQLite to other operating systems can use the same byte</span>
<a name="l00200"></a>00200 <span class="comment">** ranges for locking.  In particular, the same locking strategy and</span>
<a name="l00201"></a>00201 <span class="comment">** byte ranges are used for Unix.  This leaves open the possiblity of having</span>
<a name="l00202"></a>00202 <span class="comment">** clients on win95, winNT, and unix all talking to the same shared file</span>
<a name="l00203"></a>00203 <span class="comment">** and all locking correctly.  To do so would require that samba (or whatever</span>
<a name="l00204"></a>00204 <span class="comment">** tool is being used for file sharing) implements locks correctly between</span>
<a name="l00205"></a>00205 <span class="comment">** windows and unix.  I&apos;m guessing that isn&apos;t likely to happen, but by</span>
<a name="l00206"></a>00206 <span class="comment">** using the same locking range we are at least open to the possibility.</span>
<a name="l00207"></a>00207 <span class="comment">**</span>
<a name="l00208"></a>00208 <span class="comment">** Locking in windows is manditory.  For this reason, we cannot store</span>
<a name="l00209"></a>00209 <span class="comment">** actual data in the bytes used for locking.  The pager never allocates</span>
<a name="l00210"></a>00210 <span class="comment">** the pages involved in locking therefore.  SHARED_SIZE is selected so</span>
<a name="l00211"></a>00211 <span class="comment">** that all locks will fit on a single page even at the minimum page size.</span>
<a name="l00212"></a>00212 <span class="comment">** PENDING_BYTE defines the beginning of the locks.  By default PENDING_BYTE</span>
<a name="l00213"></a>00213 <span class="comment">** is set high so that we don&apos;t have to allocate an unused page except</span>
<a name="l00214"></a>00214 <span class="comment">** for very large databases.  But one should test the page skipping logic </span>
<a name="l00215"></a>00215 <span class="comment">** by setting PENDING_BYTE low and running the entire regression suite.</span>
<a name="l00216"></a>00216 <span class="comment">**</span>
<a name="l00217"></a>00217 <span class="comment">** Changing the value of PENDING_BYTE results in a subtly incompatible</span>
<a name="l00218"></a>00218 <span class="comment">** file format.  Depending on how it is changed, you might not notice</span>
<a name="l00219"></a>00219 <span class="comment">** the incompatibility right away, even running a full regression test.</span>
<a name="l00220"></a>00220 <span class="comment">** The default location of PENDING_BYTE is the first byte past the</span>
<a name="l00221"></a>00221 <span class="comment">** 1GB boundary.</span>
<a name="l00222"></a>00222 <span class="comment">**</span>
<a name="l00223"></a>00223 <span class="comment">*/</span>
<a name="l00224"></a>00224 <span class="preprocessor">#ifndef SQLITE_TEST</span>
<a name="l00225"></a><a class="code" href="os_8h.html#a8cca202223a66c75a8bea6dabf8de43b">00225</a> <span class="preprocessor"></span><span class="preprocessor">#define PENDING_BYTE      0x40000000  </span><span class="comment">/* First byte past the 1GB boundary */</span>
<a name="l00226"></a>00226 <span class="preprocessor">#else</span>
<a name="l00227"></a>00227 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sqlite3_pending_byte;
<a name="l00228"></a>00228 <span class="preprocessor">#define PENDING_BYTE sqlite3_pending_byte</span>
<a name="l00229"></a>00229 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00230"></a>00230 <span class="preprocessor"></span>
<a name="l00231"></a><a class="code" href="os_8h.html#a8ac9fa3da7151dc5ffd9fbf0563a9417">00231</a> <span class="preprocessor">#define RESERVED_BYTE     (PENDING_BYTE+1)</span>
<a name="l00232"></a><a class="code" href="os_8h.html#a8360ac8211214cd67bb97719da3b977a">00232</a> <span class="preprocessor"></span><span class="preprocessor">#define SHARED_FIRST      (PENDING_BYTE+2)</span>
<a name="l00233"></a><a class="code" href="os_8h.html#a232fb4f165a3ecb4a9e5f2a7f1f45a19">00233</a> <span class="preprocessor"></span><span class="preprocessor">#define SHARED_SIZE       510</span>
<a name="l00234"></a>00234 <span class="preprocessor"></span>
<a name="l00235"></a>00235 <span class="comment">/* </span>
<a name="l00236"></a>00236 <span class="comment">** Functions for accessing sqlite3_file methods </span>
<a name="l00237"></a>00237 <span class="comment">*/</span>
<a name="l00238"></a>00238 <span class="keywordtype">int</span> <a class="code" href="os_8c.html#a458e3eeb363e32a910dd21ca2507a98d">sqlite3OsClose</a>(<a class="code" href="structsqlite3__file.html">sqlite3_file</a>*);
<a name="l00239"></a>00239 <span class="keywordtype">int</span> <a class="code" href="os_8c.html#a8ba5eb27c01086de33d3d43abe2863dc">sqlite3OsRead</a>(<a class="code" href="structsqlite3__file.html">sqlite3_file</a>*, <span class="keywordtype">void</span>*, <span class="keywordtype">int</span> amt, <a class="code" href="sqliteInt_8h.html#a2a0f0f4ae7001eb54351f77ea1cdbcfd">i64</a> offset);
<a name="l00240"></a>00240 <span class="keywordtype">int</span> <a class="code" href="os_8c.html#ab2aa7b80aa192c498f721ad60860315e">sqlite3OsWrite</a>(<a class="code" href="structsqlite3__file.html">sqlite3_file</a>*, <span class="keyword">const</span> <span class="keywordtype">void</span>*, <span class="keywordtype">int</span> amt, <a class="code" href="sqliteInt_8h.html#a2a0f0f4ae7001eb54351f77ea1cdbcfd">i64</a> offset);
<a name="l00241"></a>00241 <span class="keywordtype">int</span> <a class="code" href="os_8c.html#ac9663a9bea01b912890e14e536f181a9">sqlite3OsTruncate</a>(<a class="code" href="structsqlite3__file.html">sqlite3_file</a>*, <a class="code" href="sqliteInt_8h.html#a2a0f0f4ae7001eb54351f77ea1cdbcfd">i64</a> size);
<a name="l00242"></a>00242 <span class="keywordtype">int</span> <a class="code" href="os_8c.html#a08a9a7080eb78647a7906e05ccd8c7d9">sqlite3OsSync</a>(<a class="code" href="structsqlite3__file.html">sqlite3_file</a>*, <span class="keywordtype">int</span>);
<a name="l00243"></a>00243 <span class="keywordtype">int</span> <a class="code" href="os_8c.html#aa2bb9815327ee76bca70cd42a97fa82e">sqlite3OsFileSize</a>(<a class="code" href="structsqlite3__file.html">sqlite3_file</a>*, <a class="code" href="sqliteInt_8h.html#a2a0f0f4ae7001eb54351f77ea1cdbcfd">i64</a> *pSize);
<a name="l00244"></a>00244 <span class="keywordtype">int</span> <a class="code" href="os_8c.html#a98dccd3dff1ff09b2c356d8946960c45">sqlite3OsLock</a>(<a class="code" href="structsqlite3__file.html">sqlite3_file</a>*, <span class="keywordtype">int</span>);
<a name="l00245"></a>00245 <span class="keywordtype">int</span> <a class="code" href="os_8c.html#ad80fb94a60964579384230addbaab9fc">sqlite3OsUnlock</a>(<a class="code" href="structsqlite3__file.html">sqlite3_file</a>*, <span class="keywordtype">int</span>);
<a name="l00246"></a>00246 <span class="keywordtype">int</span> <a class="code" href="os_8c.html#a9af3cbaea08b47e347d495ab30fad65d">sqlite3OsCheckReservedLock</a>(<a class="code" href="structsqlite3__file.html">sqlite3_file</a> *<span class="keywordtype">id</span>, <span class="keywordtype">int</span> *pResOut);
<a name="l00247"></a>00247 <span class="keywordtype">int</span> <a class="code" href="os_8c.html#ab2a73d96e3dab8795109b7d5b5612e88">sqlite3OsFileControl</a>(<a class="code" href="structsqlite3__file.html">sqlite3_file</a>*,<span class="keywordtype">int</span>,<span class="keywordtype">void</span>*);
<a name="l00248"></a>00248 <span class="keywordtype">int</span> <a class="code" href="os_8c.html#a1ed0d544bfad30e3d2d0d332aed462fa">sqlite3OsSectorSize</a>(<a class="code" href="structsqlite3__file.html">sqlite3_file</a> *<span class="keywordtype">id</span>);
<a name="l00249"></a>00249 <span class="keywordtype">int</span> <a class="code" href="os_8c.html#a58cdb6aae4a35782cfcd2298ee239a99">sqlite3OsDeviceCharacteristics</a>(<a class="code" href="structsqlite3__file.html">sqlite3_file</a> *<span class="keywordtype">id</span>);
<a name="l00250"></a>00250 
<a name="l00251"></a>00251 <span class="comment">/* </span>
<a name="l00252"></a>00252 <span class="comment">** Functions for accessing sqlite3_vfs methods </span>
<a name="l00253"></a>00253 <span class="comment">*/</span>
<a name="l00254"></a>00254 <span class="keywordtype">int</span> <a class="code" href="os_8c.html#ac3ec0b9862182928d45cf63695dfeb9f">sqlite3OsOpen</a>(<a class="code" href="structsqlite3__vfs.html">sqlite3_vfs</a> *, <span class="keyword">const</span> <span class="keywordtype">char</span> *, <a class="code" href="structsqlite3__file.html">sqlite3_file</a>*, <span class="keywordtype">int</span>, <span class="keywordtype">int</span> *);
<a name="l00255"></a>00255 <span class="keywordtype">int</span> <a class="code" href="os_8c.html#aefc174f728d138188ac764088382e342">sqlite3OsDelete</a>(<a class="code" href="structsqlite3__vfs.html">sqlite3_vfs</a> *, <span class="keyword">const</span> <span class="keywordtype">char</span> *, <span class="keywordtype">int</span>);
<a name="l00256"></a>00256 <span class="keywordtype">int</span> <a class="code" href="os_8c.html#a0cae4a47231c187a56c7b1aa98708b6a">sqlite3OsAccess</a>(<a class="code" href="structsqlite3__vfs.html">sqlite3_vfs</a> *, <span class="keyword">const</span> <span class="keywordtype">char</span> *, <span class="keywordtype">int</span>, <span class="keywordtype">int</span> *pResOut);
<a name="l00257"></a>00257 <span class="keywordtype">int</span> <a class="code" href="os_8c.html#a0107e460384be5fa29765421c20e4a46">sqlite3OsFullPathname</a>(<a class="code" href="structsqlite3__vfs.html">sqlite3_vfs</a> *, <span class="keyword">const</span> <span class="keywordtype">char</span> *, <span class="keywordtype">int</span>, <span class="keywordtype">char</span> *);
<a name="l00258"></a>00258 <span class="preprocessor">#ifndef SQLITE_OMIT_LOAD_EXTENSION</span>
<a name="l00259"></a>00259 <span class="preprocessor"></span><span class="keywordtype">void</span> *<a class="code" href="os_8c.html#a412d2fa42a07218da7b55ea93bba4f8c">sqlite3OsDlOpen</a>(<a class="code" href="structsqlite3__vfs.html">sqlite3_vfs</a> *, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
<a name="l00260"></a>00260 <span class="keywordtype">void</span> <a class="code" href="os_8c.html#af9fbae7f2b134a6af40faaac0d7da5aa">sqlite3OsDlError</a>(<a class="code" href="structsqlite3__vfs.html">sqlite3_vfs</a> *, <span class="keywordtype">int</span>, <span class="keywordtype">char</span> *);
<a name="l00261"></a>00261 <span class="keywordtype">void</span> *<a class="code" href="os_8c.html#a40ad63fe8bd92889251d54b3a616dd97">sqlite3OsDlSym</a>(<a class="code" href="structsqlite3__vfs.html">sqlite3_vfs</a> *, <span class="keywordtype">void</span> *, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
<a name="l00262"></a>00262 <span class="keywordtype">void</span> <a class="code" href="os_8c.html#a53a98f8689f0cf46bb9f07a4d72b81bd">sqlite3OsDlClose</a>(<a class="code" href="structsqlite3__vfs.html">sqlite3_vfs</a> *, <span class="keywordtype">void</span> *);
<a name="l00263"></a>00263 <span class="preprocessor">#endif </span><span class="comment">/* SQLITE_OMIT_LOAD_EXTENSION */</span>
<a name="l00264"></a>00264 <span class="keywordtype">int</span> <a class="code" href="os_8c.html#a0d278d7fb9b18671ccb3be5c20b5c2d1">sqlite3OsRandomness</a>(<a class="code" href="structsqlite3__vfs.html">sqlite3_vfs</a> *, <span class="keywordtype">int</span>, <span class="keywordtype">char</span> *);
<a name="l00265"></a>00265 <span class="keywordtype">int</span> <a class="code" href="os_8c.html#a0534cab88cfb39b03c0f2a80494acf56">sqlite3OsSleep</a>(<a class="code" href="structsqlite3__vfs.html">sqlite3_vfs</a> *, <span class="keywordtype">int</span>);
<a name="l00266"></a>00266 <span class="keywordtype">int</span> <a class="code" href="os_8c.html#a1371fb22564c725792654f13c9e85cfe">sqlite3OsCurrentTime</a>(<a class="code" href="structsqlite3__vfs.html">sqlite3_vfs</a> *, <span class="keywordtype">double</span>*);
<a name="l00267"></a>00267 
<a name="l00268"></a>00268 <span class="comment">/*</span>
<a name="l00269"></a>00269 <span class="comment">** Convenience functions for opening and closing files using </span>
<a name="l00270"></a>00270 <span class="comment">** sqlite3_malloc() to obtain space for the file-handle structure.</span>
<a name="l00271"></a>00271 <span class="comment">*/</span>
<a name="l00272"></a>00272 <span class="keywordtype">int</span> <a class="code" href="os_8c.html#abc39a77b7f8cb5b745e409fcdae89e84">sqlite3OsOpenMalloc</a>(<a class="code" href="structsqlite3__vfs.html">sqlite3_vfs</a> *, <span class="keyword">const</span> <span class="keywordtype">char</span> *, <a class="code" href="structsqlite3__file.html">sqlite3_file</a> **, <span class="keywordtype">int</span>,<span class="keywordtype">int</span>*);
<a name="l00273"></a>00273 <span class="keywordtype">int</span> <a class="code" href="os_8c.html#a454eb770db26fff1e88f4f82ed3e3195">sqlite3OsCloseFree</a>(<a class="code" href="structsqlite3__file.html">sqlite3_file</a> *);
<a name="l00274"></a>00274 
<a name="l00275"></a>00275 <span class="preprocessor">#endif </span><span class="comment">/* _SQLITE_OS_H_ */</span>
</pre></div></div>
<hr size="1">

<p style="text-align: right;">
  <a href="http://www.contextlogger.org/">ContextLogger2</a>&#8212;ContextLogger2 Logger Daemon Internals&#8212;<small>Generated on Mon May 2 13:49:55 2011 by&nbsp;<a href="http://www.doxygen.org/">Doxygen</a> 1.6.1</small>
</p>

</body>
</html>
