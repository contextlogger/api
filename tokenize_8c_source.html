<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ContextLogger2 Logger Daemon Internals: tokenize.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_53e7feede50ae4cb655a635f658a2b4e.html">sqlite3h</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_a0c08fff43b69094a2511677d8587129.html">src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_05c6b5177aad09a72e8ee1adc608dac0.html">sqlite3</a>
  </div>
</div>
<div class="contents">
<h1>tokenize.c</h1><a href="tokenize_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment">** 2001 September 15</span>
<a name="l00003"></a>00003 <span class="comment">**</span>
<a name="l00004"></a>00004 <span class="comment">** The author disclaims copyright to this source code.  In place of</span>
<a name="l00005"></a>00005 <span class="comment">** a legal notice, here is a blessing:</span>
<a name="l00006"></a>00006 <span class="comment">**</span>
<a name="l00007"></a>00007 <span class="comment">**    May you do good and not evil.</span>
<a name="l00008"></a>00008 <span class="comment">**    May you find forgiveness for yourself and forgive others.</span>
<a name="l00009"></a>00009 <span class="comment">**    May you share freely, never taking more than you give.</span>
<a name="l00010"></a>00010 <span class="comment">**</span>
<a name="l00011"></a>00011 <span class="comment">*************************************************************************</span>
<a name="l00012"></a>00012 <span class="comment">** An tokenizer for SQL</span>
<a name="l00013"></a>00013 <span class="comment">**</span>
<a name="l00014"></a>00014 <span class="comment">** This file contains C code that splits an SQL input string up into</span>
<a name="l00015"></a>00015 <span class="comment">** individual tokens and sends those tokens one-by-one over to the</span>
<a name="l00016"></a>00016 <span class="comment">** parser for analysis.</span>
<a name="l00017"></a>00017 <span class="comment">**</span>
<a name="l00018"></a>00018 <span class="comment">** $Id: tokenize.c,v 1.152 2008/09/01 15:52:11 drh Exp $</span>
<a name="l00019"></a>00019 <span class="comment">*/</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="sqliteInt_8h.html">sqliteInt.h</a>&quot;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &lt;ctype.h&gt;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="comment">/*</span>
<a name="l00025"></a>00025 <span class="comment">** The charMap() macro maps alphabetic characters into their</span>
<a name="l00026"></a>00026 <span class="comment">** lower-case ASCII equivalent.  On ASCII machines, this is just</span>
<a name="l00027"></a>00027 <span class="comment">** an upper-to-lower case map.  On EBCDIC machines we also need</span>
<a name="l00028"></a>00028 <span class="comment">** to adjust the encoding.  Only alphabetic characters and underscores</span>
<a name="l00029"></a>00029 <span class="comment">** need to be translated.</span>
<a name="l00030"></a>00030 <span class="comment">*/</span>
<a name="l00031"></a>00031 <span class="preprocessor">#ifdef SQLITE_ASCII</span>
<a name="l00032"></a><a class="code" href="tokenize_8c.html#a416d7e2ce12ee25ba0fcc84d2ebace94">00032</a> <span class="preprocessor"></span><span class="preprocessor"># define charMap(X) sqlite3UpperToLower[(unsigned char)X]</span>
<a name="l00033"></a>00033 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span><span class="preprocessor">#ifdef SQLITE_EBCDIC</span>
<a name="l00035"></a>00035 <span class="preprocessor"></span><span class="preprocessor"># define charMap(X) ebcdicToAscii[(unsigned char)X]</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> ebcdicToAscii[] = {
<a name="l00037"></a>00037 <span class="comment">/* 0   1   2   3   4   5   6   7   8   9   A   B   C   D   E   F */</span>
<a name="l00038"></a>00038    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  <span class="comment">/* 0x */</span>
<a name="l00039"></a>00039    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  <span class="comment">/* 1x */</span>
<a name="l00040"></a>00040    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  <span class="comment">/* 2x */</span>
<a name="l00041"></a>00041    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  <span class="comment">/* 3x */</span>
<a name="l00042"></a>00042    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  <span class="comment">/* 4x */</span>
<a name="l00043"></a>00043    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  <span class="comment">/* 5x */</span>
<a name="l00044"></a>00044    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 95,  0,  0,  <span class="comment">/* 6x */</span>
<a name="l00045"></a>00045    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  <span class="comment">/* 7x */</span>
<a name="l00046"></a>00046    0, 97, 98, 99,100,101,102,103,104,105,  0,  0,  0,  0,  0,  0,  <span class="comment">/* 8x */</span>
<a name="l00047"></a>00047    0,106,107,108,109,110,111,112,113,114,  0,  0,  0,  0,  0,  0,  <span class="comment">/* 9x */</span>
<a name="l00048"></a>00048    0,  0,115,116,117,118,119,120,121,122,  0,  0,  0,  0,  0,  0,  <span class="comment">/* Ax */</span>
<a name="l00049"></a>00049    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  <span class="comment">/* Bx */</span>
<a name="l00050"></a>00050    0, 97, 98, 99,100,101,102,103,104,105,  0,  0,  0,  0,  0,  0,  <span class="comment">/* Cx */</span>
<a name="l00051"></a>00051    0,106,107,108,109,110,111,112,113,114,  0,  0,  0,  0,  0,  0,  <span class="comment">/* Dx */</span>
<a name="l00052"></a>00052    0,  0,115,116,117,118,119,120,121,122,  0,  0,  0,  0,  0,  0,  <span class="comment">/* Ex */</span>
<a name="l00053"></a>00053    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  <span class="comment">/* Fx */</span>
<a name="l00054"></a>00054 };
<a name="l00055"></a>00055 <span class="preprocessor">#endif</span>
<a name="l00056"></a>00056 <span class="preprocessor"></span>
<a name="l00057"></a>00057 <span class="comment">/*</span>
<a name="l00058"></a>00058 <span class="comment">** The sqlite3KeywordCode function looks up an identifier to determine if</span>
<a name="l00059"></a>00059 <span class="comment">** it is a keyword.  If it is a keyword, the token code of that keyword is </span>
<a name="l00060"></a>00060 <span class="comment">** returned.  If the input is not a keyword, TK_ID is returned.</span>
<a name="l00061"></a>00061 <span class="comment">**</span>
<a name="l00062"></a>00062 <span class="comment">** The implementation of this routine was generated by a program,</span>
<a name="l00063"></a>00063 <span class="comment">** mkkeywordhash.h, located in the tool subdirectory of the distribution.</span>
<a name="l00064"></a>00064 <span class="comment">** The output of the mkkeywordhash.c program is written into a file</span>
<a name="l00065"></a>00065 <span class="comment">** named keywordhash.h and then included into this source file by</span>
<a name="l00066"></a>00066 <span class="comment">** the #include below.</span>
<a name="l00067"></a>00067 <span class="comment">*/</span>
<a name="l00068"></a>00068 <span class="preprocessor">#include &quot;<a class="code" href="keywordhash_8h.html">keywordhash.h</a>&quot;</span>
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 <span class="comment">/*</span>
<a name="l00072"></a>00072 <span class="comment">** If X is a character that can be used in an identifier then</span>
<a name="l00073"></a>00073 <span class="comment">** IdChar(X) will be true.  Otherwise it is false.</span>
<a name="l00074"></a>00074 <span class="comment">**</span>
<a name="l00075"></a>00075 <span class="comment">** For ASCII, any character with the high-order bit set is</span>
<a name="l00076"></a>00076 <span class="comment">** allowed in an identifier.  For 7-bit characters, </span>
<a name="l00077"></a>00077 <span class="comment">** sqlite3IsIdChar[X] must be 1.</span>
<a name="l00078"></a>00078 <span class="comment">**</span>
<a name="l00079"></a>00079 <span class="comment">** For EBCDIC, the rules are more complex but have the same</span>
<a name="l00080"></a>00080 <span class="comment">** end result.</span>
<a name="l00081"></a>00081 <span class="comment">**</span>
<a name="l00082"></a>00082 <span class="comment">** Ticket #1066.  the SQL standard does not allow &apos;$&apos; in the</span>
<a name="l00083"></a>00083 <span class="comment">** middle of identfiers.  But many SQL implementations do. </span>
<a name="l00084"></a>00084 <span class="comment">** SQLite will allow &apos;$&apos; in identifiers for compatibility.</span>
<a name="l00085"></a>00085 <span class="comment">** But the feature is undocumented.</span>
<a name="l00086"></a>00086 <span class="comment">*/</span>
<a name="l00087"></a>00087 <span class="preprocessor">#ifdef SQLITE_ASCII</span>
<a name="l00088"></a><a class="code" href="tokenize_8c.html#adf734df80d45e695dfe8c460ac3d7055">00088</a> <span class="preprocessor"></span><span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="tokenize_8c.html#adf734df80d45e695dfe8c460ac3d7055">sqlite3IsAsciiIdChar</a>[] = {
<a name="l00089"></a>00089 <span class="comment">/* x0 x1 x2 x3 x4 x5 x6 x7 x8 x9 xA xB xC xD xE xF */</span>
<a name="l00090"></a>00090     0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,  <span class="comment">/* 2x */</span>
<a name="l00091"></a>00091     1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0,  <span class="comment">/* 3x */</span>
<a name="l00092"></a>00092     0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,  <span class="comment">/* 4x */</span>
<a name="l00093"></a>00093     1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1,  <span class="comment">/* 5x */</span>
<a name="l00094"></a>00094     0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,  <span class="comment">/* 6x */</span>
<a name="l00095"></a>00095     1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0,  <span class="comment">/* 7x */</span>
<a name="l00096"></a>00096 };
<a name="l00097"></a><a class="code" href="tokenize_8c.html#a26191b553b179817d928443be24f2dab">00097</a> <span class="preprocessor">#define IdChar(C)  (((c=C)&amp;0x80)!=0 || (c&gt;0x1f &amp;&amp; sqlite3IsAsciiIdChar[c-0x20]))</span>
<a name="l00098"></a>00098 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00099"></a>00099 <span class="preprocessor"></span><span class="preprocessor">#ifdef SQLITE_EBCDIC</span>
<a name="l00100"></a>00100 <span class="preprocessor"></span><span class="keyword">const</span> <span class="keywordtype">char</span> sqlite3IsEbcdicIdChar[] = {
<a name="l00101"></a>00101 <span class="comment">/* x0 x1 x2 x3 x4 x5 x6 x7 x8 x9 xA xB xC xD xE xF */</span>
<a name="l00102"></a>00102     0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0,  <span class="comment">/* 4x */</span>
<a name="l00103"></a>00103     0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 0, 0, 0,  <span class="comment">/* 5x */</span>
<a name="l00104"></a>00104     0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 0, 0,  <span class="comment">/* 6x */</span>
<a name="l00105"></a>00105     0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0,  <span class="comment">/* 7x */</span>
<a name="l00106"></a>00106     0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 0,  <span class="comment">/* 8x */</span>
<a name="l00107"></a>00107     0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0, 1, 0,  <span class="comment">/* 9x */</span>
<a name="l00108"></a>00108     1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0,  <span class="comment">/* Ax */</span>
<a name="l00109"></a>00109     0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,  <span class="comment">/* Bx */</span>
<a name="l00110"></a>00110     0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1,  <span class="comment">/* Cx */</span>
<a name="l00111"></a>00111     0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1,  <span class="comment">/* Dx */</span>
<a name="l00112"></a>00112     0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1,  <span class="comment">/* Ex */</span>
<a name="l00113"></a>00113     1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0,  <span class="comment">/* Fx */</span>
<a name="l00114"></a>00114 };
<a name="l00115"></a>00115 <span class="preprocessor">#define IdChar(C)  (((c=C)&gt;=0x42 &amp;&amp; sqlite3IsEbcdicIdChar[c-0x40]))</span>
<a name="l00116"></a>00116 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00117"></a>00117 <span class="preprocessor"></span>
<a name="l00118"></a>00118 
<a name="l00119"></a>00119 <span class="comment">/*</span>
<a name="l00120"></a>00120 <span class="comment">** Return the length of the token that begins at z[0]. </span>
<a name="l00121"></a>00121 <span class="comment">** Store the token type in *tokenType before returning.</span>
<a name="l00122"></a>00122 <span class="comment">*/</span>
<a name="l00123"></a><a class="code" href="tokenize_8c.html#af36bedde6ecc8a04a3c49fc97368a54e">00123</a> <span class="keywordtype">int</span> <a class="code" href="sqliteInt_8h.html#a3dff0756b5b32e398819ecd8dbc3b1cc">sqlite3GetToken</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *z, <span class="keywordtype">int</span> *tokenType){
<a name="l00124"></a>00124   <span class="keywordtype">int</span> i, c;
<a name="l00125"></a>00125   <span class="keywordflow">switch</span>( *z ){
<a name="l00126"></a>00126     <span class="keywordflow">case</span> <span class="charliteral">&apos; &apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;\t&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;\n&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;\f&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;\r&apos;</span>: {
<a name="l00127"></a>00127       <span class="keywordflow">for</span>(i=1; isspace(z[i]); i++){}
<a name="l00128"></a>00128       *tokenType = <a class="code" href="parse_8h.html#a77d023f9f2848210b2e45395283b537f">TK_SPACE</a>;
<a name="l00129"></a>00129       <span class="keywordflow">return</span> i;
<a name="l00130"></a>00130     }
<a name="l00131"></a>00131     <span class="keywordflow">case</span> <span class="charliteral">&apos;-&apos;</span>: {
<a name="l00132"></a>00132       <span class="keywordflow">if</span>( z[1]==<span class="charliteral">&apos;-&apos;</span> ){
<a name="l00133"></a>00133         <span class="keywordflow">for</span>(i=2; (c=z[i])!=0 &amp;&amp; c!=<span class="charliteral">&apos;\n&apos;</span>; i++){}
<a name="l00134"></a>00134         *tokenType = <a class="code" href="parse_8h.html#a77d023f9f2848210b2e45395283b537f">TK_SPACE</a>;
<a name="l00135"></a>00135         <span class="keywordflow">return</span> i;
<a name="l00136"></a>00136       }
<a name="l00137"></a>00137       *tokenType = <a class="code" href="parse_8h.html#ac444a1caaa6b2f52ba9ac31ff1a9d494">TK_MINUS</a>;
<a name="l00138"></a>00138       <span class="keywordflow">return</span> 1;
<a name="l00139"></a>00139     }
<a name="l00140"></a>00140     <span class="keywordflow">case</span> <span class="charliteral">&apos;(&apos;</span>: {
<a name="l00141"></a>00141       *tokenType = <a class="code" href="parse_8h.html#a1123af06b99e3a64fe688b4b091cb301">TK_LP</a>;
<a name="l00142"></a>00142       <span class="keywordflow">return</span> 1;
<a name="l00143"></a>00143     }
<a name="l00144"></a>00144     <span class="keywordflow">case</span> <span class="charliteral">&apos;)&apos;</span>: {
<a name="l00145"></a>00145       *tokenType = <a class="code" href="parse_8h.html#ad123e3bc2af3646c800852abfd3418e3">TK_RP</a>;
<a name="l00146"></a>00146       <span class="keywordflow">return</span> 1;
<a name="l00147"></a>00147     }
<a name="l00148"></a>00148     <span class="keywordflow">case</span> <span class="charliteral">&apos;;&apos;</span>: {
<a name="l00149"></a>00149       *tokenType = <a class="code" href="parse_8h.html#ae4603b9a10eb251df55dfafbe8d723bd">TK_SEMI</a>;
<a name="l00150"></a>00150       <span class="keywordflow">return</span> 1;
<a name="l00151"></a>00151     }
<a name="l00152"></a>00152     <span class="keywordflow">case</span> <span class="charliteral">&apos;+&apos;</span>: {
<a name="l00153"></a>00153       *tokenType = <a class="code" href="parse_8h.html#a4f2c64b6344c27d6fedb5ccba238e612">TK_PLUS</a>;
<a name="l00154"></a>00154       <span class="keywordflow">return</span> 1;
<a name="l00155"></a>00155     }
<a name="l00156"></a>00156     <span class="keywordflow">case</span> <span class="charliteral">&apos;*&apos;</span>: {
<a name="l00157"></a>00157       *tokenType = <a class="code" href="parse_8h.html#a3bdc94804e9f7e03bd084d0ba35fd17f">TK_STAR</a>;
<a name="l00158"></a>00158       <span class="keywordflow">return</span> 1;
<a name="l00159"></a>00159     }
<a name="l00160"></a>00160     <span class="keywordflow">case</span> <span class="charliteral">&apos;/&apos;</span>: {
<a name="l00161"></a>00161       <span class="keywordflow">if</span>( z[1]!=<span class="charliteral">&apos;*&apos;</span> || z[2]==0 ){
<a name="l00162"></a>00162         *tokenType = <a class="code" href="parse_8h.html#a3d6ab6a7cbd9767abb242b937a44f405">TK_SLASH</a>;
<a name="l00163"></a>00163         <span class="keywordflow">return</span> 1;
<a name="l00164"></a>00164       }
<a name="l00165"></a>00165       <span class="keywordflow">for</span>(i=3, c=z[2]; (c!=<span class="charliteral">&apos;*&apos;</span> || z[i]!=<span class="charliteral">&apos;/&apos;</span>) &amp;&amp; (c=z[i])!=0; i++){}
<a name="l00166"></a>00166       <span class="keywordflow">if</span>( c ) i++;
<a name="l00167"></a>00167       *tokenType = <a class="code" href="parse_8h.html#a77d023f9f2848210b2e45395283b537f">TK_SPACE</a>;
<a name="l00168"></a>00168       <span class="keywordflow">return</span> i;
<a name="l00169"></a>00169     }
<a name="l00170"></a>00170     <span class="keywordflow">case</span> <span class="charliteral">&apos;%&apos;</span>: {
<a name="l00171"></a>00171       *tokenType = <a class="code" href="parse_8h.html#a265f8d9c4dc4d9adde077e5da3f3ce91">TK_REM</a>;
<a name="l00172"></a>00172       <span class="keywordflow">return</span> 1;
<a name="l00173"></a>00173     }
<a name="l00174"></a>00174     <span class="keywordflow">case</span> <span class="charliteral">&apos;=&apos;</span>: {
<a name="l00175"></a>00175       *tokenType = <a class="code" href="parse_8h.html#a57801ac8a2967e8778d3a94d6a8ba240">TK_EQ</a>;
<a name="l00176"></a>00176       <span class="keywordflow">return</span> 1 + (z[1]==<span class="charliteral">&apos;=&apos;</span>);
<a name="l00177"></a>00177     }
<a name="l00178"></a>00178     <span class="keywordflow">case</span> <span class="charliteral">&apos;&lt;&apos;</span>: {
<a name="l00179"></a>00179       <span class="keywordflow">if</span>( (c=z[1])==<span class="charliteral">&apos;=&apos;</span> ){
<a name="l00180"></a>00180         *tokenType = <a class="code" href="parse_8h.html#ab2968df89b2ff434e31d618a3ac9c2ff">TK_LE</a>;
<a name="l00181"></a>00181         <span class="keywordflow">return</span> 2;
<a name="l00182"></a>00182       }<span class="keywordflow">else</span> <span class="keywordflow">if</span>( c==<span class="charliteral">&apos;&gt;&apos;</span> ){
<a name="l00183"></a>00183         *tokenType = <a class="code" href="parse_8h.html#ac373fd52f17c3f257d2f630bf3031da4">TK_NE</a>;
<a name="l00184"></a>00184         <span class="keywordflow">return</span> 2;
<a name="l00185"></a>00185       }<span class="keywordflow">else</span> <span class="keywordflow">if</span>( c==<span class="charliteral">&apos;&lt;&apos;</span> ){
<a name="l00186"></a>00186         *tokenType = <a class="code" href="parse_8h.html#ac635b293e2553afaf4c492f2acceecd5">TK_LSHIFT</a>;
<a name="l00187"></a>00187         <span class="keywordflow">return</span> 2;
<a name="l00188"></a>00188       }<span class="keywordflow">else</span>{
<a name="l00189"></a>00189         *tokenType = <a class="code" href="parse_8h.html#a8ae3cd6a51a9c976e55f803363ac40d1">TK_LT</a>;
<a name="l00190"></a>00190         <span class="keywordflow">return</span> 1;
<a name="l00191"></a>00191       }
<a name="l00192"></a>00192     }
<a name="l00193"></a>00193     <span class="keywordflow">case</span> <span class="charliteral">&apos;&gt;&apos;</span>: {
<a name="l00194"></a>00194       <span class="keywordflow">if</span>( (c=z[1])==<span class="charliteral">&apos;=&apos;</span> ){
<a name="l00195"></a>00195         *tokenType = <a class="code" href="parse_8h.html#a8454a03f79a8093f2a6214565089164c">TK_GE</a>;
<a name="l00196"></a>00196         <span class="keywordflow">return</span> 2;
<a name="l00197"></a>00197       }<span class="keywordflow">else</span> <span class="keywordflow">if</span>( c==<span class="charliteral">&apos;&gt;&apos;</span> ){
<a name="l00198"></a>00198         *tokenType = <a class="code" href="parse_8h.html#a8050326aed2d2062f1aa7e498284c028">TK_RSHIFT</a>;
<a name="l00199"></a>00199         <span class="keywordflow">return</span> 2;
<a name="l00200"></a>00200       }<span class="keywordflow">else</span>{
<a name="l00201"></a>00201         *tokenType = <a class="code" href="parse_8h.html#a035f542186f94631dd42a67c570a9f0e">TK_GT</a>;
<a name="l00202"></a>00202         <span class="keywordflow">return</span> 1;
<a name="l00203"></a>00203       }
<a name="l00204"></a>00204     }
<a name="l00205"></a>00205     <span class="keywordflow">case</span> <span class="charliteral">&apos;!&apos;</span>: {
<a name="l00206"></a>00206       <span class="keywordflow">if</span>( z[1]!=<span class="charliteral">&apos;=&apos;</span> ){
<a name="l00207"></a>00207         *tokenType = <a class="code" href="parse_8h.html#a9abeb4fa263deb0057fa5beeaf008668">TK_ILLEGAL</a>;
<a name="l00208"></a>00208         <span class="keywordflow">return</span> 2;
<a name="l00209"></a>00209       }<span class="keywordflow">else</span>{
<a name="l00210"></a>00210         *tokenType = <a class="code" href="parse_8h.html#ac373fd52f17c3f257d2f630bf3031da4">TK_NE</a>;
<a name="l00211"></a>00211         <span class="keywordflow">return</span> 2;
<a name="l00212"></a>00212       }
<a name="l00213"></a>00213     }
<a name="l00214"></a>00214     <span class="keywordflow">case</span> <span class="charliteral">&apos;|&apos;</span>: {
<a name="l00215"></a>00215       <span class="keywordflow">if</span>( z[1]!=<span class="charliteral">&apos;|&apos;</span> ){
<a name="l00216"></a>00216         *tokenType = <a class="code" href="parse_8h.html#ac76cbaeec06b27bc48f930afe4e6f236">TK_BITOR</a>;
<a name="l00217"></a>00217         <span class="keywordflow">return</span> 1;
<a name="l00218"></a>00218       }<span class="keywordflow">else</span>{
<a name="l00219"></a>00219         *tokenType = <a class="code" href="parse_8h.html#ab6c9cda927ee625080c31da2ee3f57d8">TK_CONCAT</a>;
<a name="l00220"></a>00220         <span class="keywordflow">return</span> 2;
<a name="l00221"></a>00221       }
<a name="l00222"></a>00222     }
<a name="l00223"></a>00223     <span class="keywordflow">case</span> <span class="charliteral">&apos;,&apos;</span>: {
<a name="l00224"></a>00224       *tokenType = <a class="code" href="parse_8h.html#a8421318f64240202311f07c6570e54e6">TK_COMMA</a>;
<a name="l00225"></a>00225       <span class="keywordflow">return</span> 1;
<a name="l00226"></a>00226     }
<a name="l00227"></a>00227     <span class="keywordflow">case</span> <span class="charliteral">&apos;&amp;&apos;</span>: {
<a name="l00228"></a>00228       *tokenType = <a class="code" href="parse_8h.html#a81deb9d0ad55ed414a11ae7fa24ddfa5">TK_BITAND</a>;
<a name="l00229"></a>00229       <span class="keywordflow">return</span> 1;
<a name="l00230"></a>00230     }
<a name="l00231"></a>00231     <span class="keywordflow">case</span> <span class="charliteral">&apos;~&apos;</span>: {
<a name="l00232"></a>00232       *tokenType = <a class="code" href="parse_8h.html#af82adc7c78e677690a27599ff1640648">TK_BITNOT</a>;
<a name="l00233"></a>00233       <span class="keywordflow">return</span> 1;
<a name="l00234"></a>00234     }
<a name="l00235"></a>00235     <span class="keywordflow">case</span> <span class="charliteral">&apos;`&apos;</span>:
<a name="l00236"></a>00236     <span class="keywordflow">case</span> <span class="charliteral">&apos;\&apos;&apos;</span>:
<a name="l00237"></a>00237     <span class="keywordflow">case</span> <span class="charliteral">&apos;&quot;&apos;</span>: {
<a name="l00238"></a>00238       <span class="keywordtype">int</span> delim = z[0];
<a name="l00239"></a>00239       <span class="keywordflow">for</span>(i=1; (c=z[i])!=0; i++){
<a name="l00240"></a>00240         <span class="keywordflow">if</span>( c==delim ){
<a name="l00241"></a>00241           <span class="keywordflow">if</span>( z[i+1]==delim ){
<a name="l00242"></a>00242             i++;
<a name="l00243"></a>00243           }<span class="keywordflow">else</span>{
<a name="l00244"></a>00244             <span class="keywordflow">break</span>;
<a name="l00245"></a>00245           }
<a name="l00246"></a>00246         }
<a name="l00247"></a>00247       }
<a name="l00248"></a>00248       <span class="keywordflow">if</span>( c==<span class="charliteral">&apos;\&apos;&apos;</span> ){
<a name="l00249"></a>00249         *tokenType = <a class="code" href="parse_8h.html#a9810f9bc21f26ee9b8d7b374534ff54b">TK_STRING</a>;
<a name="l00250"></a>00250         <span class="keywordflow">return</span> i+1;
<a name="l00251"></a>00251       }<span class="keywordflow">else</span> <span class="keywordflow">if</span>( c!=0 ){
<a name="l00252"></a>00252         *tokenType = <a class="code" href="parse_8h.html#afe9cd6ccefe30f67bf0b9c83421d270b">TK_ID</a>;
<a name="l00253"></a>00253         <span class="keywordflow">return</span> i+1;
<a name="l00254"></a>00254       }<span class="keywordflow">else</span>{
<a name="l00255"></a>00255         *tokenType = <a class="code" href="parse_8h.html#a9abeb4fa263deb0057fa5beeaf008668">TK_ILLEGAL</a>;
<a name="l00256"></a>00256         <span class="keywordflow">return</span> i;
<a name="l00257"></a>00257       }
<a name="l00258"></a>00258     }
<a name="l00259"></a>00259     <span class="keywordflow">case</span> <span class="charliteral">&apos;.&apos;</span>: {
<a name="l00260"></a>00260 <span class="preprocessor">#ifndef SQLITE_OMIT_FLOATING_POINT</span>
<a name="l00261"></a>00261 <span class="preprocessor"></span>      <span class="keywordflow">if</span>( !isdigit(z[1]) )
<a name="l00262"></a>00262 #endif
<a name="l00263"></a>00263       {
<a name="l00264"></a>00264         *tokenType = <a class="code" href="parse_8h.html#a41093e546c611510c67b3f5c74ba9eb8">TK_DOT</a>;
<a name="l00265"></a>00265         <span class="keywordflow">return</span> 1;
<a name="l00266"></a>00266       }
<a name="l00267"></a>00267       <span class="comment">/* If the next character is a digit, this is a floating point</span>
<a name="l00268"></a>00268 <span class="comment">      ** number that begins with &quot;.&quot;.  Fall thru into the next case */</span>
<a name="l00269"></a>00269     }
<a name="l00270"></a>00270     <span class="keywordflow">case</span> <span class="charliteral">&apos;0&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;1&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;2&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;3&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;4&apos;</span>:
<a name="l00271"></a>00271     <span class="keywordflow">case</span> <span class="charliteral">&apos;5&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;6&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;7&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;8&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;9&apos;</span>: {
<a name="l00272"></a>00272       *tokenType = <a class="code" href="parse_8h.html#a9630e9dd96af624355f0f641613038ae">TK_INTEGER</a>;
<a name="l00273"></a>00273       <span class="keywordflow">for</span>(i=0; isdigit(z[i]); i++){}
<a name="l00274"></a>00274 <span class="preprocessor">#ifndef SQLITE_OMIT_FLOATING_POINT</span>
<a name="l00275"></a>00275 <span class="preprocessor"></span>      <span class="keywordflow">if</span>( z[i]==<span class="charliteral">&apos;.&apos;</span> ){
<a name="l00276"></a>00276         i++;
<a name="l00277"></a>00277         <span class="keywordflow">while</span>( isdigit(z[i]) ){ i++; }
<a name="l00278"></a>00278         *tokenType = <a class="code" href="parse_8h.html#a76166a57ba5861e71c0b332b2d94a75d">TK_FLOAT</a>;
<a name="l00279"></a>00279       }
<a name="l00280"></a>00280       <span class="keywordflow">if</span>( (z[i]==<span class="charliteral">&apos;e&apos;</span> || z[i]==<span class="charliteral">&apos;E&apos;</span>) &amp;&amp;
<a name="l00281"></a>00281            ( isdigit(z[i+1]) 
<a name="l00282"></a>00282             || ((z[i+1]==<span class="charliteral">&apos;+&apos;</span> || z[i+1]==<span class="charliteral">&apos;-&apos;</span>) &amp;&amp; isdigit(z[i+2]))
<a name="l00283"></a>00283            )
<a name="l00284"></a>00284       ){
<a name="l00285"></a>00285         i += 2;
<a name="l00286"></a>00286         <span class="keywordflow">while</span>( isdigit(z[i]) ){ i++; }
<a name="l00287"></a>00287         *tokenType = <a class="code" href="parse_8h.html#a76166a57ba5861e71c0b332b2d94a75d">TK_FLOAT</a>;
<a name="l00288"></a>00288       }
<a name="l00289"></a>00289 <span class="preprocessor">#endif</span>
<a name="l00290"></a>00290 <span class="preprocessor"></span>      <span class="keywordflow">while</span>( <a class="code" href="fts1_8c.html#a26191b553b179817d928443be24f2dab">IdChar</a>(z[i]) ){
<a name="l00291"></a>00291         *tokenType = <a class="code" href="parse_8h.html#a9abeb4fa263deb0057fa5beeaf008668">TK_ILLEGAL</a>;
<a name="l00292"></a>00292         i++;
<a name="l00293"></a>00293       }
<a name="l00294"></a>00294       <span class="keywordflow">return</span> i;
<a name="l00295"></a>00295     }
<a name="l00296"></a>00296     <span class="keywordflow">case</span> <span class="charliteral">&apos;[&apos;</span>: {
<a name="l00297"></a>00297       <span class="keywordflow">for</span>(i=1, c=z[0]; c!=<span class="charliteral">&apos;]&apos;</span> &amp;&amp; (c=z[i])!=0; i++){}
<a name="l00298"></a>00298       *tokenType = c==<span class="charliteral">&apos;]&apos;</span> ? <a class="code" href="parse_8h.html#afe9cd6ccefe30f67bf0b9c83421d270b">TK_ID</a> : <a class="code" href="parse_8h.html#a9abeb4fa263deb0057fa5beeaf008668">TK_ILLEGAL</a>;
<a name="l00299"></a>00299       <span class="keywordflow">return</span> i;
<a name="l00300"></a>00300     }
<a name="l00301"></a>00301     <span class="keywordflow">case</span> <span class="charliteral">&apos;?&apos;</span>: {
<a name="l00302"></a>00302       *tokenType = <a class="code" href="parse_8h.html#ab0618a9ee137c31ec3134eb20dd71ac7">TK_VARIABLE</a>;
<a name="l00303"></a>00303       <span class="keywordflow">for</span>(i=1; isdigit(z[i]); i++){}
<a name="l00304"></a>00304       <span class="keywordflow">return</span> i;
<a name="l00305"></a>00305     }
<a name="l00306"></a>00306     <span class="keywordflow">case</span> <span class="charliteral">&apos;#&apos;</span>: {
<a name="l00307"></a>00307       <span class="keywordflow">for</span>(i=1; isdigit(z[i]); i++){}
<a name="l00308"></a>00308       <span class="keywordflow">if</span>( i&gt;1 ){
<a name="l00309"></a>00309         <span class="comment">/* Parameters of the form #NNN (where NNN is a number) are used</span>
<a name="l00310"></a>00310 <span class="comment">        ** internally by sqlite3NestedParse.  */</span>
<a name="l00311"></a>00311         *tokenType = <a class="code" href="parse_8h.html#a43ed276edd91747f89f75a4da3547d49">TK_REGISTER</a>;
<a name="l00312"></a>00312         <span class="keywordflow">return</span> i;
<a name="l00313"></a>00313       }
<a name="l00314"></a>00314       <span class="comment">/* Fall through into the next case if the &apos;#&apos; is not followed by</span>
<a name="l00315"></a>00315 <span class="comment">      ** a digit. Try to match #AAAA where AAAA is a parameter name. */</span>
<a name="l00316"></a>00316     }
<a name="l00317"></a>00317 <span class="preprocessor">#ifndef SQLITE_OMIT_TCL_VARIABLE</span>
<a name="l00318"></a>00318 <span class="preprocessor"></span>    <span class="keywordflow">case</span> <span class="charliteral">&apos;$&apos;</span>:
<a name="l00319"></a>00319 <span class="preprocessor">#endif</span>
<a name="l00320"></a>00320 <span class="preprocessor"></span>    <span class="keywordflow">case</span> <span class="charliteral">&apos;@&apos;</span>:  <span class="comment">/* For compatibility with MS SQL Server */</span>
<a name="l00321"></a>00321     <span class="keywordflow">case</span> <span class="charliteral">&apos;:&apos;</span>: {
<a name="l00322"></a>00322       <span class="keywordtype">int</span> n = 0;
<a name="l00323"></a>00323       *tokenType = <a class="code" href="parse_8h.html#ab0618a9ee137c31ec3134eb20dd71ac7">TK_VARIABLE</a>;
<a name="l00324"></a>00324       <span class="keywordflow">for</span>(i=1; (c=z[i])!=0; i++){
<a name="l00325"></a>00325         <span class="keywordflow">if</span>( <a class="code" href="fts1_8c.html#a26191b553b179817d928443be24f2dab">IdChar</a>(c) ){
<a name="l00326"></a>00326           n++;
<a name="l00327"></a>00327 <span class="preprocessor">#ifndef SQLITE_OMIT_TCL_VARIABLE</span>
<a name="l00328"></a>00328 <span class="preprocessor"></span>        }<span class="keywordflow">else</span> <span class="keywordflow">if</span>( c==<span class="charliteral">&apos;(&apos;</span> &amp;&amp; n&gt;0 ){
<a name="l00329"></a>00329           <span class="keywordflow">do</span>{
<a name="l00330"></a>00330             i++;
<a name="l00331"></a>00331           }<span class="keywordflow">while</span>( (c=z[i])!=0 &amp;&amp; !isspace(c) &amp;&amp; c!=<span class="charliteral">&apos;)&apos;</span> );
<a name="l00332"></a>00332           <span class="keywordflow">if</span>( c==<span class="charliteral">&apos;)&apos;</span> ){
<a name="l00333"></a>00333             i++;
<a name="l00334"></a>00334           }<span class="keywordflow">else</span>{
<a name="l00335"></a>00335             *tokenType = <a class="code" href="parse_8h.html#a9abeb4fa263deb0057fa5beeaf008668">TK_ILLEGAL</a>;
<a name="l00336"></a>00336           }
<a name="l00337"></a>00337           <span class="keywordflow">break</span>;
<a name="l00338"></a>00338         }<span class="keywordflow">else</span> <span class="keywordflow">if</span>( c==<span class="charliteral">&apos;:&apos;</span> &amp;&amp; z[i+1]==<span class="charliteral">&apos;:&apos;</span> ){
<a name="l00339"></a>00339           i++;
<a name="l00340"></a>00340 <span class="preprocessor">#endif</span>
<a name="l00341"></a>00341 <span class="preprocessor"></span>        }<span class="keywordflow">else</span>{
<a name="l00342"></a>00342           <span class="keywordflow">break</span>;
<a name="l00343"></a>00343         }
<a name="l00344"></a>00344       }
<a name="l00345"></a>00345       <span class="keywordflow">if</span>( n==0 ) *tokenType = <a class="code" href="parse_8h.html#a9abeb4fa263deb0057fa5beeaf008668">TK_ILLEGAL</a>;
<a name="l00346"></a>00346       <span class="keywordflow">return</span> i;
<a name="l00347"></a>00347     }
<a name="l00348"></a>00348 <span class="preprocessor">#ifndef SQLITE_OMIT_BLOB_LITERAL</span>
<a name="l00349"></a>00349 <span class="preprocessor"></span>    <span class="keywordflow">case</span> <span class="charliteral">&apos;x&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;X&apos;</span>: {
<a name="l00350"></a>00350       <span class="keywordflow">if</span>( z[1]==<span class="charliteral">&apos;\&apos;&apos;</span> ){
<a name="l00351"></a>00351         *tokenType = <a class="code" href="parse_8h.html#aa5ba4343d39a2808adb818ffe2cb2c56">TK_BLOB</a>;
<a name="l00352"></a>00352         <span class="keywordflow">for</span>(i=2; (c=z[i])!=0 &amp;&amp; c!=<span class="charliteral">&apos;\&apos;&apos;</span>; i++){
<a name="l00353"></a>00353           <span class="keywordflow">if</span>( !isxdigit(c) ){
<a name="l00354"></a>00354             *tokenType = <a class="code" href="parse_8h.html#a9abeb4fa263deb0057fa5beeaf008668">TK_ILLEGAL</a>;
<a name="l00355"></a>00355           }
<a name="l00356"></a>00356         }
<a name="l00357"></a>00357         <span class="keywordflow">if</span>( i%2 || !c ) *tokenType = <a class="code" href="parse_8h.html#a9abeb4fa263deb0057fa5beeaf008668">TK_ILLEGAL</a>;
<a name="l00358"></a>00358         <span class="keywordflow">if</span>( c ) i++;
<a name="l00359"></a>00359         <span class="keywordflow">return</span> i;
<a name="l00360"></a>00360       }
<a name="l00361"></a>00361       <span class="comment">/* Otherwise fall through to the next case */</span>
<a name="l00362"></a>00362     }
<a name="l00363"></a>00363 <span class="preprocessor">#endif</span>
<a name="l00364"></a>00364 <span class="preprocessor"></span>    <span class="keywordflow">default</span>: {
<a name="l00365"></a>00365       <span class="keywordflow">if</span>( !<a class="code" href="fts1_8c.html#a26191b553b179817d928443be24f2dab">IdChar</a>(*z) ){
<a name="l00366"></a>00366         <span class="keywordflow">break</span>;
<a name="l00367"></a>00367       }
<a name="l00368"></a>00368       <span class="keywordflow">for</span>(i=1; <a class="code" href="fts1_8c.html#a26191b553b179817d928443be24f2dab">IdChar</a>(z[i]); i++){}
<a name="l00369"></a>00369       *tokenType = <a class="code" href="keywordhash_8h.html#aa955bae98c47221b815579359b52335c">keywordCode</a>((<span class="keywordtype">char</span>*)z, i);
<a name="l00370"></a>00370       <span class="keywordflow">return</span> i;
<a name="l00371"></a>00371     }
<a name="l00372"></a>00372   }
<a name="l00373"></a>00373   *tokenType = <a class="code" href="parse_8h.html#a9abeb4fa263deb0057fa5beeaf008668">TK_ILLEGAL</a>;
<a name="l00374"></a>00374   <span class="keywordflow">return</span> 1;
<a name="l00375"></a>00375 }
<a name="l00376"></a>00376 
<a name="l00377"></a>00377 <span class="comment">/*</span>
<a name="l00378"></a>00378 <span class="comment">** Run the parser on the given SQL string.  The parser structure is</span>
<a name="l00379"></a>00379 <span class="comment">** passed in.  An SQLITE_ status code is returned.  If an error occurs</span>
<a name="l00380"></a>00380 <span class="comment">** then an and attempt is made to write an error message into </span>
<a name="l00381"></a>00381 <span class="comment">** memory obtained from sqlite3_malloc() and to make *pzErrMsg point to that</span>
<a name="l00382"></a>00382 <span class="comment">** error message.</span>
<a name="l00383"></a>00383 <span class="comment">*/</span>
<a name="l00384"></a><a class="code" href="tokenize_8c.html#aa611a342b92f4baa0196b56974b91060">00384</a> <span class="keywordtype">int</span> <a class="code" href="sqliteInt_8h.html#a012b875619bdd3e411e20471e044fc47">sqlite3RunParser</a>(<a class="code" href="structParse.html">Parse</a> *pParse, <span class="keyword">const</span> <span class="keywordtype">char</span> *zSql, <span class="keywordtype">char</span> **pzErrMsg){
<a name="l00385"></a>00385   <span class="keywordtype">int</span> nErr = 0;
<a name="l00386"></a>00386   <span class="keywordtype">int</span> i;
<a name="l00387"></a>00387   <span class="keywordtype">void</span> *pEngine;
<a name="l00388"></a>00388   <span class="keywordtype">int</span> tokenType;
<a name="l00389"></a>00389   <span class="keywordtype">int</span> lastTokenParsed = -1;
<a name="l00390"></a>00390   <a class="code" href="structsqlite3.html">sqlite3</a> *<a class="code" href="shell_8c.html#ad6e663497d2c934364b3bcf07496b30b">db</a> = pParse-&gt;<a class="code" href="structParse.html#a44364e5e1197927f89864ec345bc5491">db</a>;
<a name="l00391"></a>00391   <span class="keywordtype">int</span> mxSqlLen = db-&gt;<a class="code" href="structsqlite3.html#ad8acf663e1619905094c9dfe4125157b">aLimit</a>[<a class="code" href="sqlite3_8h.html#a6498a9b0e2a19d61612a3f51d458fb15">SQLITE_LIMIT_SQL_LENGTH</a>];
<a name="l00392"></a>00392 
<a name="l00393"></a>00393   <span class="keywordflow">if</span>( db-&gt;<a class="code" href="structsqlite3.html#ada07202e7fd80f275e2e5063d96b5cb0">activeVdbeCnt</a>==0 ){
<a name="l00394"></a>00394     db-&gt;<a class="code" href="structsqlite3.html#aa5db6567b0e7d5009c52e0307b1cf095">u1</a>.<a class="code" href="structsqlite3.html#a80b995fd97507bbf978d6960adde53f8">isInterrupted</a> = 0;
<a name="l00395"></a>00395   }
<a name="l00396"></a>00396   pParse-&gt;<a class="code" href="structParse.html#a897c2ea40a1065d49a134f18ca251637">rc</a> = <a class="code" href="sqlite3_8h.html#a650d09c7bec7ddadb7c8aa3519dc842c">SQLITE_OK</a>;
<a name="l00397"></a>00397   pParse-&gt;<a class="code" href="structParse.html#a14f58728b3ae2a297272510ae4bd9a89">zTail</a> = pParse-&gt;<a class="code" href="structParse.html#ab1db81718a9796065caf669fb470c24c">zSql</a> = zSql;
<a name="l00398"></a>00398   i = 0;
<a name="l00399"></a>00399   assert( pzErrMsg!=0 );
<a name="l00400"></a>00400   pEngine = <a class="code" href="parse_8c.html#a5eab1cd41f2a0f1d140281c8a4d4aa67">sqlite3ParserAlloc</a>((<span class="keywordtype">void</span>*(*)(<span class="keywordtype">size_t</span>))<a class="code" href="malloc_8c.html#a8c1a33577a57524c7c6eef3d9e64e742">sqlite3Malloc</a>);
<a name="l00401"></a>00401   <span class="keywordflow">if</span>( pEngine==0 ){
<a name="l00402"></a>00402     db-&gt;<a class="code" href="structsqlite3.html#a79beb0036337ba7fc2de5ccbb9225935">mallocFailed</a> = 1;
<a name="l00403"></a>00403     <span class="keywordflow">return</span> <a class="code" href="sqlite3_8h.html#a9e34c7a5186dc9095e108e517eaac9f6">SQLITE_NOMEM</a>;
<a name="l00404"></a>00404   }
<a name="l00405"></a>00405   assert( pParse-&gt;<a class="code" href="structParse.html#ad499020d1bf06f3c98c8d36e2ceb83fd">sLastToken</a>.<a class="code" href="structToken.html#a1a4bbef5fb47ea00fc69cbaf8f18c66a">dyn</a>==0 );
<a name="l00406"></a>00406   assert( pParse-&gt;<a class="code" href="structParse.html#a4788769c077dc86ffa3ee1e40ed6b4a1">pNewTable</a>==0 );
<a name="l00407"></a>00407   assert( pParse-&gt;<a class="code" href="structParse.html#a92ea8f2ac3190dd7c8360e0334ae78b3">pNewTrigger</a>==0 );
<a name="l00408"></a>00408   assert( pParse-&gt;<a class="code" href="structParse.html#a088771dc116d91113bed715a1968d42e">nVar</a>==0 );
<a name="l00409"></a>00409   assert( pParse-&gt;<a class="code" href="structParse.html#a4d5051bb0608f0766e859fb38ed41dc1">nVarExpr</a>==0 );
<a name="l00410"></a>00410   assert( pParse-&gt;<a class="code" href="structParse.html#adad4778e7658569016747818aad1bb92">nVarExprAlloc</a>==0 );
<a name="l00411"></a>00411   assert( pParse-&gt;<a class="code" href="structParse.html#accb46003a1f43d6e3da1a336303da6f3">apVarExpr</a>==0 );
<a name="l00412"></a>00412   <span class="keywordflow">while</span>( !db-&gt;<a class="code" href="structsqlite3.html#a79beb0036337ba7fc2de5ccbb9225935">mallocFailed</a> &amp;&amp; zSql[i]!=0 ){
<a name="l00413"></a>00413     assert( i&gt;=0 );
<a name="l00414"></a>00414     pParse-&gt;<a class="code" href="structParse.html#ad499020d1bf06f3c98c8d36e2ceb83fd">sLastToken</a>.<a class="code" href="structToken.html#a27654081d5afd48666ef407d6a34d490">z</a> = (<a class="code" href="sqliteInt_8h.html#a74a0f6424ae628af25f23f0a35f6ead3">u8</a>*)&amp;zSql[i];
<a name="l00415"></a>00415     assert( pParse-&gt;<a class="code" href="structParse.html#ad499020d1bf06f3c98c8d36e2ceb83fd">sLastToken</a>.<a class="code" href="structToken.html#a1a4bbef5fb47ea00fc69cbaf8f18c66a">dyn</a>==0 );
<a name="l00416"></a>00416     pParse-&gt;<a class="code" href="structParse.html#ad499020d1bf06f3c98c8d36e2ceb83fd">sLastToken</a>.<a class="code" href="structToken.html#a53adf03e2ba58b7967932f40d29e7fb9">n</a> = <a class="code" href="sqliteInt_8h.html#a3dff0756b5b32e398819ecd8dbc3b1cc">sqlite3GetToken</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)&amp;zSql[i],&amp;tokenType);
<a name="l00417"></a>00417     i += pParse-&gt;<a class="code" href="structParse.html#ad499020d1bf06f3c98c8d36e2ceb83fd">sLastToken</a>.<a class="code" href="structToken.html#a53adf03e2ba58b7967932f40d29e7fb9">n</a>;
<a name="l00418"></a>00418     <span class="keywordflow">if</span>( i&gt;mxSqlLen ){
<a name="l00419"></a>00419       pParse-&gt;<a class="code" href="structParse.html#a897c2ea40a1065d49a134f18ca251637">rc</a> = <a class="code" href="sqlite3_8h.html#a88e41cbe09fb26a267081d59316ef126">SQLITE_TOOBIG</a>;
<a name="l00420"></a>00420       <span class="keywordflow">break</span>;
<a name="l00421"></a>00421     }
<a name="l00422"></a>00422     <span class="keywordflow">switch</span>( tokenType ){
<a name="l00423"></a>00423       <span class="keywordflow">case</span> <a class="code" href="parse_8h.html#a77d023f9f2848210b2e45395283b537f">TK_SPACE</a>: {
<a name="l00424"></a>00424         <span class="keywordflow">if</span>( db-&gt;<a class="code" href="structsqlite3.html#aa5db6567b0e7d5009c52e0307b1cf095">u1</a>.<a class="code" href="structsqlite3.html#a80b995fd97507bbf978d6960adde53f8">isInterrupted</a> ){
<a name="l00425"></a>00425           pParse-&gt;<a class="code" href="structParse.html#a897c2ea40a1065d49a134f18ca251637">rc</a> = <a class="code" href="sqlite3_8h.html#a03c9b25faf07d0e47ce7a1b1e46b2adc">SQLITE_INTERRUPT</a>;
<a name="l00426"></a>00426           <a class="code" href="malloc_8c.html#af1c1714a3fa3d522e9909a10b3e69cfb">sqlite3SetString</a>(pzErrMsg, db, <span class="stringliteral">&quot;interrupt&quot;</span>);
<a name="l00427"></a>00427           <span class="keywordflow">goto</span> abort_parse;
<a name="l00428"></a>00428         }
<a name="l00429"></a>00429         <span class="keywordflow">break</span>;
<a name="l00430"></a>00430       }
<a name="l00431"></a>00431       <span class="keywordflow">case</span> <a class="code" href="parse_8h.html#a9abeb4fa263deb0057fa5beeaf008668">TK_ILLEGAL</a>: {
<a name="l00432"></a>00432         <a class="code" href="malloc_8c.html#a8ca215f2395ca90fd180460afb2eba9d">sqlite3DbFree</a>(db, *pzErrMsg);
<a name="l00433"></a>00433         *pzErrMsg = <a class="code" href="printf_8c.html#a565f1e5e7ec859ec4e815ed15d42a415">sqlite3MPrintf</a>(db, <span class="stringliteral">&quot;unrecognized token: \&quot;%T\&quot;&quot;</span>,
<a name="l00434"></a>00434                         &amp;pParse-&gt;<a class="code" href="structParse.html#ad499020d1bf06f3c98c8d36e2ceb83fd">sLastToken</a>);
<a name="l00435"></a>00435         nErr++;
<a name="l00436"></a>00436         <span class="keywordflow">goto</span> abort_parse;
<a name="l00437"></a>00437       }
<a name="l00438"></a>00438       <span class="keywordflow">case</span> <a class="code" href="parse_8h.html#ae4603b9a10eb251df55dfafbe8d723bd">TK_SEMI</a>: {
<a name="l00439"></a>00439         pParse-&gt;<a class="code" href="structParse.html#a14f58728b3ae2a297272510ae4bd9a89">zTail</a> = &amp;zSql[i];
<a name="l00440"></a>00440         <span class="comment">/* Fall thru into the default case */</span>
<a name="l00441"></a>00441       }
<a name="l00442"></a>00442       <span class="keywordflow">default</span>: {
<a name="l00443"></a>00443         <a class="code" href="parse_8c.html#a6589870a3814695ee38ab56b6651891c">sqlite3Parser</a>(pEngine, tokenType, pParse-&gt;<a class="code" href="structParse.html#ad499020d1bf06f3c98c8d36e2ceb83fd">sLastToken</a>, pParse);
<a name="l00444"></a>00444         lastTokenParsed = tokenType;
<a name="l00445"></a>00445         <span class="keywordflow">if</span>( pParse-&gt;<a class="code" href="structParse.html#a897c2ea40a1065d49a134f18ca251637">rc</a>!=<a class="code" href="sqlite3_8h.html#a650d09c7bec7ddadb7c8aa3519dc842c">SQLITE_OK</a> ){
<a name="l00446"></a>00446           <span class="keywordflow">goto</span> abort_parse;
<a name="l00447"></a>00447         }
<a name="l00448"></a>00448         <span class="keywordflow">break</span>;
<a name="l00449"></a>00449       }
<a name="l00450"></a>00450     }
<a name="l00451"></a>00451   }
<a name="l00452"></a>00452 abort_parse:
<a name="l00453"></a>00453   <span class="keywordflow">if</span>( zSql[i]==0 &amp;&amp; nErr==0 &amp;&amp; pParse-&gt;<a class="code" href="structParse.html#a897c2ea40a1065d49a134f18ca251637">rc</a>==<a class="code" href="sqlite3_8h.html#a650d09c7bec7ddadb7c8aa3519dc842c">SQLITE_OK</a> ){
<a name="l00454"></a>00454     <span class="keywordflow">if</span>( lastTokenParsed!=<a class="code" href="parse_8h.html#ae4603b9a10eb251df55dfafbe8d723bd">TK_SEMI</a> ){
<a name="l00455"></a>00455       <a class="code" href="parse_8c.html#a6589870a3814695ee38ab56b6651891c">sqlite3Parser</a>(pEngine, <a class="code" href="parse_8h.html#ae4603b9a10eb251df55dfafbe8d723bd">TK_SEMI</a>, pParse-&gt;<a class="code" href="structParse.html#ad499020d1bf06f3c98c8d36e2ceb83fd">sLastToken</a>, pParse);
<a name="l00456"></a>00456       pParse-&gt;<a class="code" href="structParse.html#a14f58728b3ae2a297272510ae4bd9a89">zTail</a> = &amp;zSql[i];
<a name="l00457"></a>00457     }
<a name="l00458"></a>00458     <a class="code" href="parse_8c.html#a6589870a3814695ee38ab56b6651891c">sqlite3Parser</a>(pEngine, 0, pParse-&gt;<a class="code" href="structParse.html#ad499020d1bf06f3c98c8d36e2ceb83fd">sLastToken</a>, pParse);
<a name="l00459"></a>00459   }
<a name="l00460"></a>00460 <span class="preprocessor">#ifdef YYTRACKMAXSTACKDEPTH</span>
<a name="l00461"></a>00461 <span class="preprocessor"></span>  <a class="code" href="sqliteInt_8h.html#a718022863f8794ccbe129459f4a73d4d">sqlite3StatusSet</a>(<a class="code" href="sqlite3_8h.html#ae4531b1071337bb93853c9e0944af289">SQLITE_STATUS_PARSER_STACK</a>,
<a name="l00462"></a>00462       sqlite3ParserStackPeak(pEngine)
<a name="l00463"></a>00463   );
<a name="l00464"></a>00464 <span class="preprocessor">#endif </span><span class="comment">/* YYDEBUG */</span>
<a name="l00465"></a>00465   <a class="code" href="parse_8c.html#abc929b1b51dfb68a2327700b7fd7b4a9">sqlite3ParserFree</a>(pEngine, <a class="code" href="malloc_8c.html#a89d4380358f918be2a8e2171d95bbb04">sqlite3_free</a>);
<a name="l00466"></a>00466   <span class="keywordflow">if</span>( db-&gt;<a class="code" href="structsqlite3.html#a79beb0036337ba7fc2de5ccbb9225935">mallocFailed</a> ){
<a name="l00467"></a>00467     pParse-&gt;<a class="code" href="structParse.html#a897c2ea40a1065d49a134f18ca251637">rc</a> = <a class="code" href="sqlite3_8h.html#a9e34c7a5186dc9095e108e517eaac9f6">SQLITE_NOMEM</a>;
<a name="l00468"></a>00468   }
<a name="l00469"></a>00469   <span class="keywordflow">if</span>( pParse-&gt;<a class="code" href="structParse.html#a897c2ea40a1065d49a134f18ca251637">rc</a>!=<a class="code" href="sqlite3_8h.html#a650d09c7bec7ddadb7c8aa3519dc842c">SQLITE_OK</a> &amp;&amp; pParse-&gt;<a class="code" href="structParse.html#a897c2ea40a1065d49a134f18ca251637">rc</a>!=<a class="code" href="sqlite3_8h.html#afd1d7cc5f2e803af5e944f548e28f141">SQLITE_DONE</a> &amp;&amp; pParse-&gt;<a class="code" href="structParse.html#a04146757986ff4654c7b321654896e81">zErrMsg</a>==0 ){
<a name="l00470"></a>00470     <a class="code" href="malloc_8c.html#af1c1714a3fa3d522e9909a10b3e69cfb">sqlite3SetString</a>(&amp;pParse-&gt;<a class="code" href="structParse.html#a04146757986ff4654c7b321654896e81">zErrMsg</a>, db, <span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="main_8c.html#a02d1b390ceb669b8e689f27ea7134cad">sqlite3ErrStr</a>(pParse-&gt;<a class="code" href="structParse.html#a897c2ea40a1065d49a134f18ca251637">rc</a>));
<a name="l00471"></a>00471   }
<a name="l00472"></a>00472   <span class="keywordflow">if</span>( pParse-&gt;<a class="code" href="structParse.html#a04146757986ff4654c7b321654896e81">zErrMsg</a> ){
<a name="l00473"></a>00473     <span class="keywordflow">if</span>( *pzErrMsg==0 ){
<a name="l00474"></a>00474       *pzErrMsg = pParse-&gt;<a class="code" href="structParse.html#a04146757986ff4654c7b321654896e81">zErrMsg</a>;
<a name="l00475"></a>00475     }<span class="keywordflow">else</span>{
<a name="l00476"></a>00476       <a class="code" href="malloc_8c.html#a8ca215f2395ca90fd180460afb2eba9d">sqlite3DbFree</a>(db, pParse-&gt;<a class="code" href="structParse.html#a04146757986ff4654c7b321654896e81">zErrMsg</a>);
<a name="l00477"></a>00477     }
<a name="l00478"></a>00478     pParse-&gt;<a class="code" href="structParse.html#a04146757986ff4654c7b321654896e81">zErrMsg</a> = 0;
<a name="l00479"></a>00479     nErr++;
<a name="l00480"></a>00480   }
<a name="l00481"></a>00481   <span class="keywordflow">if</span>( pParse-&gt;<a class="code" href="structParse.html#a81774053fd5063046f532c07e3daa98b">pVdbe</a> &amp;&amp; pParse-&gt;<a class="code" href="structParse.html#ac7206f0c7e580ab32b7dfb20950bb1c9">nErr</a>&gt;0 &amp;&amp; pParse-&gt;<a class="code" href="structParse.html#a33d62687b6d368acf94e954490358819">nested</a>==0 ){
<a name="l00482"></a>00482     <a class="code" href="vdbe_8h.html#a7c6e6c7a7ebeb5a9d7e575a4715802e0">sqlite3VdbeDelete</a>(pParse-&gt;<a class="code" href="structParse.html#a81774053fd5063046f532c07e3daa98b">pVdbe</a>);
<a name="l00483"></a>00483     pParse-&gt;<a class="code" href="structParse.html#a81774053fd5063046f532c07e3daa98b">pVdbe</a> = 0;
<a name="l00484"></a>00484   }
<a name="l00485"></a>00485 <span class="preprocessor">#ifndef SQLITE_OMIT_SHARED_CACHE</span>
<a name="l00486"></a>00486 <span class="preprocessor"></span>  <span class="keywordflow">if</span>( pParse-&gt;<a class="code" href="structParse.html#a33d62687b6d368acf94e954490358819">nested</a>==0 ){
<a name="l00487"></a>00487     <a class="code" href="malloc_8c.html#a8ca215f2395ca90fd180460afb2eba9d">sqlite3DbFree</a>(db, pParse-&gt;<a class="code" href="structParse.html#ae8e553d660dc69d285945d3db8f127c7">aTableLock</a>);
<a name="l00488"></a>00488     pParse-&gt;<a class="code" href="structParse.html#ae8e553d660dc69d285945d3db8f127c7">aTableLock</a> = 0;
<a name="l00489"></a>00489     pParse-&gt;<a class="code" href="structParse.html#a8c61b1b13dcb394b190fa09f5c253928">nTableLock</a> = 0;
<a name="l00490"></a>00490   }
<a name="l00491"></a>00491 <span class="preprocessor">#endif</span>
<a name="l00492"></a>00492 <span class="preprocessor"></span><span class="preprocessor">#ifndef SQLITE_OMIT_VIRTUALTABLE</span>
<a name="l00493"></a>00493 <span class="preprocessor"></span>  <a class="code" href="malloc_8c.html#a8ca215f2395ca90fd180460afb2eba9d">sqlite3DbFree</a>(db, pParse-&gt;<a class="code" href="structParse.html#acdfd318c0f04ec640d6affc85ef8a009">apVtabLock</a>);
<a name="l00494"></a>00494 <span class="preprocessor">#endif</span>
<a name="l00495"></a>00495 <span class="preprocessor"></span>
<a name="l00496"></a>00496   <span class="keywordflow">if</span>( !<a class="code" href="sqliteInt_8h.html#aa2b209cc5834d5f703df3c53ecf9767d">IN_DECLARE_VTAB</a> ){
<a name="l00497"></a>00497     <span class="comment">/* If the pParse-&gt;declareVtab flag is set, do not delete any table </span>
<a name="l00498"></a>00498 <span class="comment">    ** structure built up in pParse-&gt;pNewTable. The calling code (see vtab.c)</span>
<a name="l00499"></a>00499 <span class="comment">    ** will take responsibility for freeing the Table structure.</span>
<a name="l00500"></a>00500 <span class="comment">    */</span>
<a name="l00501"></a>00501     <a class="code" href="build_8c.html#a643487b51d4e5baf37ac4d892963bab1">sqlite3DeleteTable</a>(pParse-&gt;<a class="code" href="structParse.html#a4788769c077dc86ffa3ee1e40ed6b4a1">pNewTable</a>);
<a name="l00502"></a>00502   }
<a name="l00503"></a>00503 
<a name="l00504"></a>00504   <a class="code" href="sqliteInt_8h.html#a473ae7a275cdc4c4deea579769e26bdb">sqlite3DeleteTrigger</a>(db, pParse-&gt;<a class="code" href="structParse.html#a92ea8f2ac3190dd7c8360e0334ae78b3">pNewTrigger</a>);
<a name="l00505"></a>00505   <a class="code" href="malloc_8c.html#a8ca215f2395ca90fd180460afb2eba9d">sqlite3DbFree</a>(db, pParse-&gt;<a class="code" href="structParse.html#accb46003a1f43d6e3da1a336303da6f3">apVarExpr</a>);
<a name="l00506"></a>00506   <a class="code" href="malloc_8c.html#a8ca215f2395ca90fd180460afb2eba9d">sqlite3DbFree</a>(db, pParse-&gt;<a class="code" href="structParse.html#a5d59266be4e256238d3bbdf1a9ff7d5b">aAlias</a>);
<a name="l00507"></a>00507   <span class="keywordflow">while</span>( pParse-&gt;<a class="code" href="structParse.html#a4e8319f0a7f0d21e472c13ac6cf67060">pZombieTab</a> ){
<a name="l00508"></a>00508     <a class="code" href="structTable.html">Table</a> *p = pParse-&gt;<a class="code" href="structParse.html#a4e8319f0a7f0d21e472c13ac6cf67060">pZombieTab</a>;
<a name="l00509"></a>00509     pParse-&gt;<a class="code" href="structParse.html#a4e8319f0a7f0d21e472c13ac6cf67060">pZombieTab</a> = p-&gt;<a class="code" href="structTable.html#ae365eb0d8f6d3cb39f3908323cba45e4">pNextZombie</a>;
<a name="l00510"></a>00510     <a class="code" href="build_8c.html#a643487b51d4e5baf37ac4d892963bab1">sqlite3DeleteTable</a>(p);
<a name="l00511"></a>00511   }
<a name="l00512"></a>00512   <span class="keywordflow">if</span>( nErr&gt;0 &amp;&amp; (pParse-&gt;<a class="code" href="structParse.html#a897c2ea40a1065d49a134f18ca251637">rc</a>==<a class="code" href="sqlite3_8h.html#a650d09c7bec7ddadb7c8aa3519dc842c">SQLITE_OK</a> || pParse-&gt;<a class="code" href="structParse.html#a897c2ea40a1065d49a134f18ca251637">rc</a>==<a class="code" href="sqlite3_8h.html#afd1d7cc5f2e803af5e944f548e28f141">SQLITE_DONE</a>) ){
<a name="l00513"></a>00513     pParse-&gt;<a class="code" href="structParse.html#a897c2ea40a1065d49a134f18ca251637">rc</a> = <a class="code" href="sqlite3_8h.html#afda25cd6575e87558d2b7cd4a6585f2f">SQLITE_ERROR</a>;
<a name="l00514"></a>00514   }
<a name="l00515"></a>00515   <span class="keywordflow">return</span> nErr;
<a name="l00516"></a>00516 }
</pre></div></div>
<hr size="1">

<p style="text-align: right;">
  <a href="http://www.contextlogger.org/">ContextLogger2</a>&#8212;ContextLogger2 Logger Daemon Internals&#8212;<small>Generated on Mon May 2 13:49:56 2011 by&nbsp;<a href="http://www.doxygen.org/">Doxygen</a> 1.6.1</small>
</p>

</body>
</html>
