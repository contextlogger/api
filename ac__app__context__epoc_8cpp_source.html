<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ContextLogger2 Logger Daemon Internals: ac_app_context_epoc.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_ce488f798153ac6666006744a35bf93c.html">src</a>
  </div>
</div>
<div class="contents">
<h1>ac_app_context_epoc.cpp</h1><a href="ac__app__context__epoc_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// Not a standalone file. It exists as a separate file only to avoid</span>
<a name="l00002"></a>00002 <span class="comment">// platform-specific clutter in the primary implementation file.</span>
<a name="l00003"></a>00003 
<a name="l00004"></a>00004 <span class="preprocessor">#include &quot;<a class="code" href="epoc-s60-version_8hpp.html">epoc-s60-version.hpp</a>&quot;</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include &quot;<a class="code" href="sa__sensor__list__log__db_8h.html">sa_sensor_list_log_db.h</a>&quot;</span>
<a name="l00006"></a>00006 <span class="preprocessor">#include &quot;<a class="code" href="ut__telephony__epoc_8h.html">ut_telephony_epoc.h</a>&quot;</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include &quot;<a class="code" href="utils__cl2_8h.html">utils_cl2.h</a>&quot;</span> <span class="comment">// DEF_SESSION</span>
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;f32file.h&gt;</span> <span class="comment">// RFs</span>
<a name="l00010"></a>00010 
<a name="l00011"></a>00011 <span class="preprocessor">#include &lt;etel3rdparty.h&gt;</span> <span class="comment">// CTelephony</span>
<a name="l00012"></a>00012 
<a name="l00013"></a>00013 <span class="preprocessor">#if __NEED_CONTACT_DATABASE__</span>
<a name="l00014"></a>00014 <span class="preprocessor"></span><span class="preprocessor">#include &lt;cntdb.h&gt;</span> <span class="comment">// CContactDatabase</span>
<a name="l00015"></a>00015 <span class="preprocessor">#endif</span>
<a name="l00016"></a>00016 <span class="preprocessor"></span>
<a name="l00017"></a>00017 <span class="comment">// --------------------------------------------------</span>
<a name="l00018"></a>00018 <span class="comment">// battery status observing</span>
<a name="l00019"></a>00019 <span class="comment">// --------------------------------------------------</span>
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="comment">/*</span>
<a name="l00022"></a>00022 <span class="comment">The primary function of this AO is to exit the process if battery is running low. We do not want to be the ones to consume the last bit of battery.</span>
<a name="l00023"></a>00023 <span class="comment"></span>
<a name="l00024"></a>00024 <span class="comment">As a secondary task, the battery level is also logged, if the required resources have been initialized.</span>
<a name="l00025"></a>00025 <span class="comment"></span>
<a name="l00026"></a>00026 <span class="comment">It is worth noting that there also is the hwrmpowerstatesdkpskeys.h API, which it seems we might likewise use. Do not know if one is &quot;better&quot; than the other.</span>
<a name="l00027"></a>00027 <span class="comment">http://www.forum.nokia.com/document/Cpp_Developers_Library/GUID-759FBC7F-5384-4487-8457-A8D4B76F6AA6/html/hwrmpowerstatesdkpskeys_8h.html</span>
<a name="l00028"></a>00028 <span class="comment">*/</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="comment">/***koog </span>
<a name="l00031"></a>00031 <span class="comment">(require codegen/symbian-cxx)</span>
<a name="l00032"></a>00032 <span class="comment">(ctor-defines/spec</span>
<a name="l00033"></a>00033 <span class="comment"> &quot;CBatteryObserver&quot; ;; name</span>
<a name="l00034"></a>00034 <span class="comment"> &quot;CTelephony&amp; tel, MGetterObs_BatteryInfo&amp; obs&quot; ;; args</span>
<a name="l00035"></a>00035 <span class="comment"> &quot;iObserver(obs)&quot; ;; inits</span>
<a name="l00036"></a>00036 <span class="comment"> &quot;&quot; ;; ctor</span>
<a name="l00037"></a>00037 <span class="comment"> #t ;; ConstructL</span>
<a name="l00038"></a>00038 <span class="comment"> &apos;(args-to-constructl)</span>
<a name="l00039"></a>00039 <span class="comment">)</span>
<a name="l00040"></a>00040 <span class="comment"> ***/</span>
<a name="l00041"></a><a class="code" href="ac__app__context__epoc_8cpp.html#a3a9b9b031c4c4ed0b242d1553450847b">00041</a> <span class="preprocessor">#define CTOR_DECL_CBatteryObserver  \</span>
<a name="l00042"></a>00042 <span class="preprocessor">public: static CBatteryObserver* NewLC(CTelephony&amp; tel, MGetterObs_BatteryInfo&amp; obs); \</span>
<a name="l00043"></a>00043 <span class="preprocessor">public: static CBatteryObserver* NewL(CTelephony&amp; tel, MGetterObs_BatteryInfo&amp; obs); \</span>
<a name="l00044"></a>00044 <span class="preprocessor">private: CBatteryObserver(CTelephony&amp; tel, MGetterObs_BatteryInfo&amp; obs); \</span>
<a name="l00045"></a>00045 <span class="preprocessor">private: void ConstructL(CTelephony&amp; tel, MGetterObs_BatteryInfo&amp; obs);</span>
<a name="l00046"></a>00046 <span class="preprocessor"></span>
<a name="l00047"></a><a class="code" href="ac__app__context__epoc_8cpp.html#a936b1d06704a6138e8d93d92b148826d">00047</a> <span class="preprocessor">#define CTOR_IMPL_CBatteryObserver  \</span>
<a name="l00048"></a>00048 <span class="preprocessor">CBatteryObserver* CBatteryObserver::NewLC(CTelephony&amp; tel, MGetterObs_BatteryInfo&amp; obs) \</span>
<a name="l00049"></a>00049 <span class="preprocessor">{ \</span>
<a name="l00050"></a>00050 <span class="preprocessor">  CBatteryObserver* obj = new (ELeave) CBatteryObserver(tel, obs); \</span>
<a name="l00051"></a>00051 <span class="preprocessor">  CleanupStack::PushL(obj); \</span>
<a name="l00052"></a>00052 <span class="preprocessor">  obj-&gt;ConstructL(tel, obs); \</span>
<a name="l00053"></a>00053 <span class="preprocessor">  return obj; \</span>
<a name="l00054"></a>00054 <span class="preprocessor">} \</span>
<a name="l00055"></a>00055 <span class="preprocessor"> \</span>
<a name="l00056"></a>00056 <span class="preprocessor">CBatteryObserver* CBatteryObserver::NewL(CTelephony&amp; tel, MGetterObs_BatteryInfo&amp; obs) \</span>
<a name="l00057"></a>00057 <span class="preprocessor">{ \</span>
<a name="l00058"></a>00058 <span class="preprocessor">  CBatteryObserver* obj = CBatteryObserver::NewLC(tel, obs); \</span>
<a name="l00059"></a>00059 <span class="preprocessor">  CleanupStack::Pop(obj); \</span>
<a name="l00060"></a>00060 <span class="preprocessor">  return obj; \</span>
<a name="l00061"></a>00061 <span class="preprocessor">} \</span>
<a name="l00062"></a>00062 <span class="preprocessor"> \</span>
<a name="l00063"></a>00063 <span class="preprocessor">CBatteryObserver::CBatteryObserver(CTelephony&amp; tel, MGetterObs_BatteryInfo&amp; obs) : iObserver(obs) \</span>
<a name="l00064"></a>00064 <span class="preprocessor">{}</span>
<a name="l00065"></a>00065 <span class="preprocessor"></span><span class="comment">/***end***/</span>
<a name="l00066"></a><a class="code" href="classCBatteryObserver.html">00066</a> NONSHARABLE_CLASS(<a class="code" href="classCBatteryObserver.html">CBatteryObserver</a>) : 
<a name="l00067"></a>00067   public <a class="code" href="classCBase.html">CBase</a>, 
<a name="l00068"></a>00068   public <a class="code" href="classMGetterObs__BatteryInfo.html">MGetterObs_BatteryInfo</a>,
<a name="l00069"></a>00069   public <a class="code" href="classMNotifyObs__BatteryInfo.html">MNotifyObs_BatteryInfo</a>
<a name="l00070"></a>00070 {
<a name="l00071"></a><a class="code" href="classCBatteryObserver.html#a54506ffa5935f4511fb092659b798d37">00071</a>   <a class="code" href="ac__app__context__epoc_8cpp.html#a3a9b9b031c4c4ed0b242d1553450847b">CTOR_DECL_CBatteryObserver</a>;
<a name="l00072"></a>00072 
<a name="l00073"></a>00073  <span class="keyword">public</span>:
<a name="l00074"></a>00074   ~<a class="code" href="classCBatteryObserver.html">CBatteryObserver</a>();
<a name="l00075"></a>00075 
<a name="l00076"></a>00076  <span class="keyword">private</span>:
<a name="l00077"></a>00077   <span class="keyword">virtual</span> <span class="keywordtype">void</span> GotData_BatteryInfo(TInt aError);
<a name="l00078"></a>00078   <span class="keyword">virtual</span> <span class="keywordtype">void</span> ChangedData_BatteryInfo(TInt aError);
<a name="l00079"></a>00079   <span class="keywordtype">void</span> HandleBattery(TInt aError, CTelephony::TBatteryInfoV1 <span class="keyword">const</span> &amp; aData);
<a name="l00080"></a>00080 
<a name="l00081"></a>00081  <span class="keyword">private</span>:
<a name="l00082"></a><a class="code" href="classCBatteryObserver.html#abebde20683764325d3bf5bd21c8d29c3">00082</a>   <a class="code" href="classCGetterAo__BatteryInfo.html">CGetterAo_BatteryInfo</a>* iBatteryInfoGetter;
<a name="l00083"></a><a class="code" href="classCBatteryObserver.html#acf7893c0a81e7f4e79d4f1f06ffafe15">00083</a>   <a class="code" href="classCNotifyAo__BatteryInfo.html">CNotifyAo_BatteryInfo</a>* iBatteryInfoNotifier;
<a name="l00084"></a>00084 
<a name="l00085"></a>00085  <span class="keyword">private</span>:
<a name="l00086"></a><a class="code" href="classCBatteryObserver.html#ae4127684de65a7280859c6f5f5bf5f84">00086</a>   <a class="code" href="classMGetterObs__BatteryInfo.html">MGetterObs_BatteryInfo</a>&amp; iObserver;
<a name="l00087"></a>00087 };
<a name="l00088"></a>00088 
<a name="l00089"></a><a class="code" href="ac__app__context__epoc_8cpp.html#a0472186bad0b1d9b15b947d8c2cc7801">00089</a> <a class="code" href="ac__app__context__epoc_8cpp.html#a936b1d06704a6138e8d93d92b148826d">CTOR_IMPL_CBatteryObserver</a>;
<a name="l00090"></a>00090 
<a name="l00091"></a>00091 <span class="keywordtype">void</span> CBatteryObserver::ConstructL(CTelephony&amp; tel, <a class="code" href="classMGetterObs__BatteryInfo.html">MGetterObs_BatteryInfo</a>&amp; obs)
<a name="l00092"></a>00092 {
<a name="l00093"></a>00093   <a class="code" href="classCBatteryObserver.html#abebde20683764325d3bf5bd21c8d29c3">iBatteryInfoGetter</a> = <span class="keyword">new</span> (ELeave) <a class="code" href="classCGetterAo__BatteryInfo.html">CGetterAo_BatteryInfo</a>(tel, *<span class="keyword">this</span>);
<a name="l00094"></a>00094   <a class="code" href="classCBatteryObserver.html#acf7893c0a81e7f4e79d4f1f06ffafe15">iBatteryInfoNotifier</a> = <span class="keyword">new</span> (ELeave) <a class="code" href="classCNotifyAo__BatteryInfo.html">CNotifyAo_BatteryInfo</a>(tel, *<span class="keyword">this</span>);
<a name="l00095"></a>00095 
<a name="l00096"></a>00096   <a class="code" href="classCBatteryObserver.html#abebde20683764325d3bf5bd21c8d29c3">iBatteryInfoGetter</a>-&gt;<a class="code" href="classCGetterAo__BatteryInfo.html#a610bcfe0d261b626bd4cabfd00f30472">MakeRequest</a>();
<a name="l00097"></a>00097 }
<a name="l00098"></a>00098 
<a name="l00099"></a><a class="code" href="classCBatteryObserver.html#acaa43589aad2b6ebf7b5f324b7f4813d">00099</a> <a class="code" href="classCBatteryObserver.html#acaa43589aad2b6ebf7b5f324b7f4813d">CBatteryObserver::~CBatteryObserver</a>()
<a name="l00100"></a>00100 {
<a name="l00101"></a>00101   <span class="keyword">delete</span> <a class="code" href="classCBatteryObserver.html#abebde20683764325d3bf5bd21c8d29c3">iBatteryInfoGetter</a>;
<a name="l00102"></a>00102   <span class="keyword">delete</span> <a class="code" href="classCBatteryObserver.html#acf7893c0a81e7f4e79d4f1f06ffafe15">iBatteryInfoNotifier</a>;
<a name="l00103"></a>00103 }
<a name="l00104"></a>00104 
<a name="l00105"></a><a class="code" href="classCBatteryObserver.html#aa9ad6a2d5b6abec1d7cdcb2734844783">00105</a> <span class="keywordtype">void</span> <a class="code" href="classCBatteryObserver.html#aa9ad6a2d5b6abec1d7cdcb2734844783">CBatteryObserver::GotData_BatteryInfo</a>(TInt aError)
<a name="l00106"></a>00106 {
<a name="l00107"></a>00107   <a class="code" href="classCBatteryObserver.html#a98b51c6eb61ebfb25d1fc7dcfcf745e3">HandleBattery</a>(aError, <a class="code" href="classCBatteryObserver.html#abebde20683764325d3bf5bd21c8d29c3">iBatteryInfoGetter</a>-&gt;<a class="code" href="classCGetterAo__BatteryInfo.html#a4f73e86f32ee93efdc917420faac2164">Data</a>());
<a name="l00108"></a>00108   <a class="code" href="classCBatteryObserver.html#ae4127684de65a7280859c6f5f5bf5f84">iObserver</a>.<a class="code" href="classMGetterObs__BatteryInfo.html#a5582131cce99ff4c941fd2f882ee0949">GotData_BatteryInfo</a>(aError); <span class="comment">// forward</span>
<a name="l00109"></a>00109 }
<a name="l00110"></a>00110 
<a name="l00111"></a><a class="code" href="classCBatteryObserver.html#abfb3638b6e20980e11e5a058cd2d9ea4">00111</a> <span class="keywordtype">void</span> <a class="code" href="classCBatteryObserver.html#abfb3638b6e20980e11e5a058cd2d9ea4">CBatteryObserver::ChangedData_BatteryInfo</a>(TInt aError)
<a name="l00112"></a>00112 {
<a name="l00113"></a>00113   <a class="code" href="classCBatteryObserver.html#a98b51c6eb61ebfb25d1fc7dcfcf745e3">HandleBattery</a>(aError, <a class="code" href="classCBatteryObserver.html#acf7893c0a81e7f4e79d4f1f06ffafe15">iBatteryInfoNotifier</a>-&gt;<a class="code" href="classCNotifyAo__BatteryInfo.html#a769b1c75add4f8f95b196077f8eeb9a8">Data</a>());
<a name="l00114"></a>00114 }
<a name="l00115"></a>00115 
<a name="l00116"></a><a class="code" href="classCBatteryObserver.html#a98b51c6eb61ebfb25d1fc7dcfcf745e3">00116</a> <span class="keywordtype">void</span> <a class="code" href="classCBatteryObserver.html#a98b51c6eb61ebfb25d1fc7dcfcf745e3">CBatteryObserver::HandleBattery</a>(TInt aError, 
<a name="l00117"></a>00117              CTelephony::TBatteryInfoV1 <span class="keyword">const</span> &amp; aData)
<a name="l00118"></a>00118 {
<a name="l00119"></a>00119   <span class="keywordflow">if</span> (aError) {
<a name="l00120"></a>00120     <span class="comment">// This is unexpected, but if we cannot query it, then we shall</span>
<a name="l00121"></a>00121     <span class="comment">// live without this feature for the rest of the runtime.</span>
<a name="l00122"></a>00122     <a class="code" href="er__errors_8h.html#a008602962ee67e8048c9eec8828e2258">er_log_symbian</a>(0, aError, <span class="stringliteral">&quot;battery info status query failure&quot;</span>);
<a name="l00123"></a>00123   } <span class="keywordflow">else</span> {
<a name="l00124"></a>00124     <span class="keywordtype">int</span> status = aData.iStatus;
<a name="l00125"></a>00125     <span class="keywordtype">int</span> level = aData.iChargeLevel;
<a name="l00126"></a>00126     <a class="code" href="logging__c_8h.html#abea298723ad956e744c9efec71512dd0">logg</a>(<span class="stringliteral">&quot;battery status: %d (%d%%)&quot;</span>, status, level);
<a name="l00127"></a>00127 
<a name="l00128"></a>00128     <a class="code" href="struct__LogDb.html">LogDb</a>* logDb = <a class="code" href="ac__app__context_8h.html#aacd0e420aa8cad59d1073b70d614e481">ac_global_LogDb</a>;
<a name="l00129"></a>00129     <span class="keywordflow">if</span> (logDb) {
<a name="l00130"></a>00130       log_db_log_battery(logDb, status, level, NULL);
<a name="l00131"></a>00131     }
<a name="l00132"></a>00132 
<a name="l00133"></a>00133 <span class="preprocessor">#if __QUIT_ON_LOW_BATTERY__</span>
<a name="l00134"></a>00134 <span class="preprocessor"></span>    <span class="comment">// If no external power and battery low.</span>
<a name="l00135"></a>00135     <span class="keywordflow">if</span> ((aData.iStatus != CTelephony::EBatteryConnectedButExternallyPowered) &amp;&amp;
<a name="l00136"></a>00136   (aData.iStatus != CTelephony::ENoBatteryConnected) &amp;&amp;
<a name="l00137"></a>00137   (aData.iChargeLevel &lt; 20))
<a name="l00138"></a>00138       {
<a name="l00139"></a>00139   <a class="code" href="er__errors_8h.html#a38fb855b186279a938f48b0407296a29">er_log_none</a>(0, <span class="stringliteral">&quot;battery running low (at %d%%): exiting&quot;</span>, level);
<a name="l00140"></a>00140   <span class="keywordflow">if</span> (logDb) {
<a name="l00141"></a>00141     <a class="code" href="er__errors_8h.html#a53e0a99b4c648dace1ccaf63b2606cde">er_fatal_battery_low</a>;
<a name="l00142"></a>00142   } <span class="keywordflow">else</span> {
<a name="l00143"></a>00143     <span class="comment">// This is to avoid repeated error dialogs when the logger</span>
<a name="l00144"></a>00144     <span class="comment">// does not get as far as properly running due to low battery.</span>
<a name="l00145"></a>00145     <a class="code" href="er__errors_8c.html#a6824dbf6ed2230b79c7a3898bd5fda1d">er_fatal_quiet</a>();
<a name="l00146"></a>00146   }
<a name="l00147"></a>00147       } 
<a name="l00148"></a>00148     <span class="keywordflow">else</span> 
<a name="l00149"></a>00149 <span class="preprocessor">#endif</span>
<a name="l00150"></a>00150 <span class="preprocessor"></span>      {
<a name="l00151"></a>00151   <a class="code" href="classCBatteryObserver.html#acf7893c0a81e7f4e79d4f1f06ffafe15">iBatteryInfoNotifier</a>-&gt;<a class="code" href="classCNotifyAo__BatteryInfo.html#a7502e8b3e239c2a982b1904908e4faee">MakeRequest</a>();
<a name="l00152"></a>00152       }
<a name="l00153"></a>00153   }
<a name="l00154"></a>00154 }
<a name="l00155"></a>00155 
<a name="l00156"></a>00156 <span class="comment">// --------------------------------------------------</span>
<a name="l00157"></a>00157 <span class="comment">// flightmode observing</span>
<a name="l00158"></a>00158 <span class="comment">// --------------------------------------------------</span>
<a name="l00159"></a>00159 
<a name="l00160"></a>00160 <span class="comment">/***koog </span>
<a name="l00161"></a>00161 <span class="comment">(require codegen/symbian-cxx)</span>
<a name="l00162"></a>00162 <span class="comment">(ctor-defines/spec</span>
<a name="l00163"></a>00163 <span class="comment"> &quot;CFlightModeObserver&quot; ;; name</span>
<a name="l00164"></a>00164 <span class="comment"> &quot;CTelephony&amp; tel, MGetterObs_FlightMode&amp; obs&quot; ;; args</span>
<a name="l00165"></a>00165 <span class="comment"> &quot;iObserver(obs)&quot; ;; inits</span>
<a name="l00166"></a>00166 <span class="comment"> &quot;&quot; ;; ctor</span>
<a name="l00167"></a>00167 <span class="comment"> #t ;; ConstructL</span>
<a name="l00168"></a>00168 <span class="comment"> &apos;(args-to-constructl)</span>
<a name="l00169"></a>00169 <span class="comment">)</span>
<a name="l00170"></a>00170 <span class="comment"> ***/</span>
<a name="l00171"></a><a class="code" href="ac__app__context__epoc_8cpp.html#a74a07def7c0b9b3a9f958f3f8ed93448">00171</a> <span class="preprocessor">#define CTOR_DECL_CFlightModeObserver  \</span>
<a name="l00172"></a>00172 <span class="preprocessor">public: static CFlightModeObserver* NewLC(CTelephony&amp; tel, MGetterObs_FlightMode&amp; obs); \</span>
<a name="l00173"></a>00173 <span class="preprocessor">public: static CFlightModeObserver* NewL(CTelephony&amp; tel, MGetterObs_FlightMode&amp; obs); \</span>
<a name="l00174"></a>00174 <span class="preprocessor">private: CFlightModeObserver(CTelephony&amp; tel, MGetterObs_FlightMode&amp; obs); \</span>
<a name="l00175"></a>00175 <span class="preprocessor">private: void ConstructL(CTelephony&amp; tel, MGetterObs_FlightMode&amp; obs);</span>
<a name="l00176"></a>00176 <span class="preprocessor"></span>
<a name="l00177"></a><a class="code" href="ac__app__context__epoc_8cpp.html#a881b1ddad59fd122cbadf1bd60b741a2">00177</a> <span class="preprocessor">#define CTOR_IMPL_CFlightModeObserver  \</span>
<a name="l00178"></a>00178 <span class="preprocessor">CFlightModeObserver* CFlightModeObserver::NewLC(CTelephony&amp; tel, MGetterObs_FlightMode&amp; obs) \</span>
<a name="l00179"></a>00179 <span class="preprocessor">{ \</span>
<a name="l00180"></a>00180 <span class="preprocessor">  CFlightModeObserver* obj = new (ELeave) CFlightModeObserver(tel, obs); \</span>
<a name="l00181"></a>00181 <span class="preprocessor">  CleanupStack::PushL(obj); \</span>
<a name="l00182"></a>00182 <span class="preprocessor">  obj-&gt;ConstructL(tel, obs); \</span>
<a name="l00183"></a>00183 <span class="preprocessor">  return obj; \</span>
<a name="l00184"></a>00184 <span class="preprocessor">} \</span>
<a name="l00185"></a>00185 <span class="preprocessor"> \</span>
<a name="l00186"></a>00186 <span class="preprocessor">CFlightModeObserver* CFlightModeObserver::NewL(CTelephony&amp; tel, MGetterObs_FlightMode&amp; obs) \</span>
<a name="l00187"></a>00187 <span class="preprocessor">{ \</span>
<a name="l00188"></a>00188 <span class="preprocessor">  CFlightModeObserver* obj = CFlightModeObserver::NewLC(tel, obs); \</span>
<a name="l00189"></a>00189 <span class="preprocessor">  CleanupStack::Pop(obj); \</span>
<a name="l00190"></a>00190 <span class="preprocessor">  return obj; \</span>
<a name="l00191"></a>00191 <span class="preprocessor">} \</span>
<a name="l00192"></a>00192 <span class="preprocessor"> \</span>
<a name="l00193"></a>00193 <span class="preprocessor">CFlightModeObserver::CFlightModeObserver(CTelephony&amp; tel, MGetterObs_FlightMode&amp; obs) : iObserver(obs) \</span>
<a name="l00194"></a>00194 <span class="preprocessor">{}</span>
<a name="l00195"></a>00195 <span class="preprocessor"></span><span class="comment">/***end***/</span>
<a name="l00196"></a><a class="code" href="classCFlightModeObserver.html">00196</a> NONSHARABLE_CLASS(<a class="code" href="classCFlightModeObserver.html">CFlightModeObserver</a>) : 
<a name="l00197"></a>00197   public <a class="code" href="classCBase.html">CBase</a>, 
<a name="l00198"></a>00198   public <a class="code" href="classMGetterObs__FlightMode.html">MGetterObs_FlightMode</a>,
<a name="l00199"></a>00199   public <a class="code" href="classMNotifyObs__FlightMode.html">MNotifyObs_FlightMode</a>
<a name="l00200"></a>00200 {
<a name="l00201"></a><a class="code" href="classCFlightModeObserver.html#a7f2763fa45c4872929562f38cb4c41d5">00201</a>   <a class="code" href="ac__app__context__epoc_8cpp.html#a74a07def7c0b9b3a9f958f3f8ed93448">CTOR_DECL_CFlightModeObserver</a>;
<a name="l00202"></a>00202 
<a name="l00203"></a>00203  <span class="keyword">public</span>:
<a name="l00204"></a>00204   ~<a class="code" href="classCFlightModeObserver.html">CFlightModeObserver</a>();
<a name="l00205"></a>00205 
<a name="l00206"></a>00206  <span class="keyword">private</span>: <span class="comment">// MGetterObs_FlightMode</span>
<a name="l00207"></a>00207   <span class="keyword">virtual</span> <span class="keywordtype">void</span> GotData_FlightMode(TInt aError);
<a name="l00208"></a>00208  <span class="keyword">private</span>: <span class="comment">// MNotifyObs_FlightMode</span>
<a name="l00209"></a>00209   <span class="keyword">virtual</span> <span class="keywordtype">void</span> ChangedData_FlightMode(TInt aError);
<a name="l00210"></a>00210  <span class="keyword">private</span>:
<a name="l00211"></a>00211   <span class="keywordtype">void</span> HandleFlightMode(TInt aError, CTelephony::TFlightModeV1 <span class="keyword">const</span> &amp; aData);
<a name="l00212"></a>00212 
<a name="l00213"></a>00213  <span class="keyword">private</span>:
<a name="l00214"></a><a class="code" href="classCFlightModeObserver.html#a75e3008a1edd148d6a994eb63fae27f2">00214</a>   <a class="code" href="classCGetterAo__FlightMode.html">CGetterAo_FlightMode</a>* iGetter;
<a name="l00215"></a><a class="code" href="classCFlightModeObserver.html#a5f306d92cf19a84dc2b36a4e04f85aa0">00215</a>   <a class="code" href="classCNotifyAo__FlightMode.html">CNotifyAo_FlightMode</a>* iNotifier;
<a name="l00216"></a>00216 
<a name="l00217"></a>00217  <span class="keyword">private</span>:
<a name="l00218"></a><a class="code" href="classCFlightModeObserver.html#ab932d5dcc400da37d0a3917cb828b5af">00218</a>   <a class="code" href="classMGetterObs__FlightMode.html">MGetterObs_FlightMode</a>&amp; iObserver;
<a name="l00219"></a>00219 };
<a name="l00220"></a>00220 
<a name="l00221"></a><a class="code" href="ac__app__context__epoc_8cpp.html#abce01f94f1b3c605c633d35508616902">00221</a> <a class="code" href="ac__app__context__epoc_8cpp.html#a881b1ddad59fd122cbadf1bd60b741a2">CTOR_IMPL_CFlightModeObserver</a>;
<a name="l00222"></a>00222 
<a name="l00223"></a>00223 <span class="keywordtype">void</span> CFlightModeObserver::ConstructL(CTelephony&amp; tel, <a class="code" href="classMGetterObs__FlightMode.html">MGetterObs_FlightMode</a>&amp; obs)
<a name="l00224"></a>00224 {
<a name="l00225"></a>00225   <a class="code" href="classCFlightModeObserver.html#a75e3008a1edd148d6a994eb63fae27f2">iGetter</a> = <span class="keyword">new</span> (ELeave) <a class="code" href="classCGetterAo__FlightMode.html">CGetterAo_FlightMode</a>(tel, *<span class="keyword">this</span>);
<a name="l00226"></a>00226   <a class="code" href="classCFlightModeObserver.html#a5f306d92cf19a84dc2b36a4e04f85aa0">iNotifier</a> = <span class="keyword">new</span> (ELeave) <a class="code" href="classCNotifyAo__FlightMode.html">CNotifyAo_FlightMode</a>(tel, *<span class="keyword">this</span>);
<a name="l00227"></a>00227 
<a name="l00228"></a>00228   <a class="code" href="classCFlightModeObserver.html#a75e3008a1edd148d6a994eb63fae27f2">iGetter</a>-&gt;<a class="code" href="classCGetterAo__FlightMode.html#af1cf0e9fd9022224532cbd54de0dfc3c">MakeRequest</a>();
<a name="l00229"></a>00229 }
<a name="l00230"></a>00230 
<a name="l00231"></a><a class="code" href="classCFlightModeObserver.html#a7b6e83c8afff11d09fcbcd75a2566bbe">00231</a> <a class="code" href="classCFlightModeObserver.html#a7b6e83c8afff11d09fcbcd75a2566bbe">CFlightModeObserver::~CFlightModeObserver</a>()
<a name="l00232"></a>00232 {
<a name="l00233"></a>00233   <span class="keyword">delete</span> <a class="code" href="classCFlightModeObserver.html#a75e3008a1edd148d6a994eb63fae27f2">iGetter</a>;
<a name="l00234"></a>00234   <span class="keyword">delete</span> <a class="code" href="classCFlightModeObserver.html#a5f306d92cf19a84dc2b36a4e04f85aa0">iNotifier</a>;
<a name="l00235"></a>00235 }
<a name="l00236"></a>00236 
<a name="l00237"></a><a class="code" href="classCFlightModeObserver.html#ae64d6a7287b44a5492f30468feff25eb">00237</a> <span class="keywordtype">void</span> <a class="code" href="classCFlightModeObserver.html#ae64d6a7287b44a5492f30468feff25eb">CFlightModeObserver::GotData_FlightMode</a>(TInt aError)
<a name="l00238"></a>00238 {
<a name="l00239"></a>00239   <a class="code" href="classCFlightModeObserver.html#a672a3ee33f26ef8ee1612a04ed29eb7c">HandleFlightMode</a>(aError, <a class="code" href="classCFlightModeObserver.html#a75e3008a1edd148d6a994eb63fae27f2">iGetter</a>-&gt;<a class="code" href="classCGetterAo__FlightMode.html#afac4d62566f765eb9a84632440cd9161">Data</a>());
<a name="l00240"></a>00240   <a class="code" href="classCFlightModeObserver.html#ab932d5dcc400da37d0a3917cb828b5af">iObserver</a>.<a class="code" href="classMGetterObs__FlightMode.html#abd2818c76b4528b94e5efbf38eb527ff">GotData_FlightMode</a>(aError); <span class="comment">// forward</span>
<a name="l00241"></a>00241 }
<a name="l00242"></a>00242 
<a name="l00243"></a><a class="code" href="classCFlightModeObserver.html#ad704e62a385f2c6b9ea2ae6d093b0a77">00243</a> <span class="keywordtype">void</span> <a class="code" href="classCFlightModeObserver.html#ad704e62a385f2c6b9ea2ae6d093b0a77">CFlightModeObserver::ChangedData_FlightMode</a>(TInt aError)
<a name="l00244"></a>00244 {
<a name="l00245"></a>00245   <a class="code" href="classCFlightModeObserver.html#a672a3ee33f26ef8ee1612a04ed29eb7c">HandleFlightMode</a>(aError, <a class="code" href="classCFlightModeObserver.html#a5f306d92cf19a84dc2b36a4e04f85aa0">iNotifier</a>-&gt;<a class="code" href="classCNotifyAo__FlightMode.html#aa1b96f47c557eaf4bc3a1f50aaf1433a">Data</a>());
<a name="l00246"></a>00246 }
<a name="l00247"></a>00247 
<a name="l00248"></a><a class="code" href="ac__app__context__epoc_8cpp.html#a79f54cef95a8296cc6ee0c2484909c52">00248</a> <span class="keyword">static</span> gboolean <a class="code" href="ac__app__context__epoc_8cpp.html#a79f54cef95a8296cc6ee0c2484909c52">TFlightModeV1ToBoolean</a>(<span class="keyword">const</span> CTelephony::TFlightModeV1&amp; data)
<a name="l00249"></a>00249 {
<a name="l00250"></a>00250   <span class="keywordflow">if</span> (data.iFlightModeStatus == CTelephony::EFlightModeOn)
<a name="l00251"></a>00251     <span class="keywordflow">return</span> ETrue;
<a name="l00252"></a>00252   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data.iFlightModeStatus == CTelephony::EFlightModeOff)
<a name="l00253"></a>00253     <span class="keywordflow">return</span> EFalse;
<a name="l00254"></a>00254   <span class="keywordflow">else</span>
<a name="l00255"></a>00255     assert(0 &amp;&amp; <span class="stringliteral">&quot;unexpected TFlightModeStatus value&quot;</span>);
<a name="l00256"></a>00256   <span class="keywordflow">return</span> EFalse;
<a name="l00257"></a>00257 }
<a name="l00258"></a>00258 
<a name="l00259"></a><a class="code" href="classCFlightModeObserver.html#a672a3ee33f26ef8ee1612a04ed29eb7c">00259</a> <span class="keywordtype">void</span> <a class="code" href="classCFlightModeObserver.html#a672a3ee33f26ef8ee1612a04ed29eb7c">CFlightModeObserver::HandleFlightMode</a>(TInt aError, 
<a name="l00260"></a>00260              CTelephony::TFlightModeV1 <span class="keyword">const</span> &amp; aData)
<a name="l00261"></a>00261 {
<a name="l00262"></a>00262   <span class="keywordflow">if</span> (aError) {
<a name="l00263"></a>00263     <span class="comment">// This is unexpected. No matter the network state, surely we</span>
<a name="l00264"></a>00264     <span class="comment">// should at least be able to determine whether the network is</span>
<a name="l00265"></a>00265     <span class="comment">// unavailable.</span>
<a name="l00266"></a>00266     <a class="code" href="er__errors_8h.html#a008602962ee67e8048c9eec8828e2258">er_log_symbian</a>(<a class="code" href="er__errors_8h.html#a74b7465a12d63ad80bc10d1ebaf900d8">er_FATAL</a>, aError, <span class="stringliteral">&quot;flightmode info status query failure&quot;</span>);
<a name="l00267"></a>00267   } <span class="keywordflow">else</span> {
<a name="l00268"></a>00268     gboolean on = <a class="code" href="ac__app__context__epoc_8cpp.html#a79f54cef95a8296cc6ee0c2484909c52">TFlightModeV1ToBoolean</a>(aData);
<a name="l00269"></a>00269 
<a name="l00270"></a>00270     <a class="code" href="logging__c_8h.html#abea298723ad956e744c9efec71512dd0">logg</a>(<span class="stringliteral">&quot;flightmode: %s&quot;</span>, <a class="code" href="sh__utils_8h.html#a44c1c33f446f670c69bf49382dba7792">boolstr_on</a>(on));
<a name="l00271"></a>00271 
<a name="l00272"></a>00272 <span class="preprocessor">#if __FLIGHTMODE_ENABLED__</span>
<a name="l00273"></a>00273 <span class="preprocessor"></span>    <a class="code" href="struct__LogDb.html">LogDb</a>* logDb = <a class="code" href="ac__app__context_8h.html#aacd0e420aa8cad59d1073b70d614e481">ac_global_LogDb</a>;
<a name="l00274"></a>00274     <span class="keywordflow">if</span> (logDb) {
<a name="l00275"></a>00275       log_db_log_flightmode(logDb, on, NULL);
<a name="l00276"></a>00276     }
<a name="l00277"></a>00277 <span class="preprocessor">#endif</span>
<a name="l00278"></a>00278 <span class="preprocessor"></span>
<a name="l00279"></a>00279     <span class="comment">// Post to blackboard if changed (compare against blackboard).</span>
<a name="l00280"></a>00280     {
<a name="l00281"></a>00281       <a class="code" href="struct__bb__Blackboard.html">bb_Blackboard</a>* bb = <a class="code" href="ac__app__context_8h.html#a97a19629a1eaca64ac8add20b98a3ff7">ac_global_Blackboard</a>;
<a name="l00282"></a>00282       <a class="code" href="structbb__Board.html">bb_Board</a>* bd = <a class="code" href="bb__blackboard_8cpp.html#a294701be39c14209dcaee7744b96402d">bb_Blackboard_board</a>(bb);
<a name="l00283"></a>00283       <span class="keywordflow">if</span> (bd-&gt;<a class="code" href="structbb__Board.html#ab81e03d01f1f4993f3cfb99d4b709219">flightmode</a> != on) {
<a name="l00284"></a>00284   bd-&gt;<a class="code" href="structbb__Board.html#ab81e03d01f1f4993f3cfb99d4b709219">flightmode</a> = on;
<a name="l00285"></a>00285   <a class="code" href="bb__blackboard_8cpp.html#a1cf3488fe2427796e6862dd4799301f7">bb_Blackboard_notify</a>(bb, <a class="code" href="bb__blackboard_8h.html#a222fef21537286535b17c6146c9b2d3ca0b93c86ed159d14198b4e17228138499">bb_dt_flightmode</a>,
<a name="l00286"></a>00286            (gpointer)&amp;(bd-&gt;<a class="code" href="structbb__Board.html#ab81e03d01f1f4993f3cfb99d4b709219">flightmode</a>), 0);
<a name="l00287"></a>00287       }
<a name="l00288"></a>00288     }
<a name="l00289"></a>00289 
<a name="l00290"></a>00290     <a class="code" href="classCFlightModeObserver.html#a5f306d92cf19a84dc2b36a4e04f85aa0">iNotifier</a>-&gt;<a class="code" href="classCNotifyAo__FlightMode.html#afd5dc6f42f9e1b61b1409d0bf8ec592d">MakeRequest</a>();
<a name="l00291"></a>00291   }
<a name="l00292"></a>00292 }
<a name="l00293"></a>00293 
<a name="l00294"></a>00294 <span class="comment">// --------------------------------------------------</span>
<a name="l00295"></a>00295 <span class="comment">// plat app context implementation</span>
<a name="l00296"></a>00296 <span class="comment">// --------------------------------------------------</span>
<a name="l00297"></a>00297 
<a name="l00298"></a>00298 <span class="comment">/***koog </span>
<a name="l00299"></a>00299 <span class="comment">(require codegen/symbian-cxx)</span>
<a name="l00300"></a>00300 <span class="comment">(ctor-defines/spec</span>
<a name="l00301"></a>00301 <span class="comment"> &quot;CAppContextImpl&quot; ;; name</span>
<a name="l00302"></a>00302 <span class="comment"> &quot;ac_AppContext* ac, MAppContextInitObserver&amp; obs&quot; ;; args</span>
<a name="l00303"></a>00303 <span class="comment"> &quot;iCtx(ac), iObs(obs)&quot; ;; inits</span>
<a name="l00304"></a>00304 <span class="comment"> &quot;&quot; ;; ctor</span>
<a name="l00305"></a>00305 <span class="comment"> #t ;; ConstructL</span>
<a name="l00306"></a>00306 <span class="comment">)</span>
<a name="l00307"></a>00307 <span class="comment"> ***/</span>
<a name="l00308"></a><a class="code" href="ac__app__context__epoc_8cpp.html#afff6726921224973000c1123e2d49d62">00308</a> <span class="preprocessor">#define CTOR_DECL_CAppContextImpl  \</span>
<a name="l00309"></a>00309 <span class="preprocessor">public: static CAppContextImpl* NewLC(ac_AppContext* ac, MAppContextInitObserver&amp; obs); \</span>
<a name="l00310"></a>00310 <span class="preprocessor">public: static CAppContextImpl* NewL(ac_AppContext* ac, MAppContextInitObserver&amp; obs); \</span>
<a name="l00311"></a>00311 <span class="preprocessor">private: CAppContextImpl(ac_AppContext* ac, MAppContextInitObserver&amp; obs); \</span>
<a name="l00312"></a>00312 <span class="preprocessor">private: void ConstructL();</span>
<a name="l00313"></a>00313 <span class="preprocessor"></span>
<a name="l00314"></a><a class="code" href="ac__app__context__epoc_8cpp.html#a83d8b69826cc96c1936faf5d923b63f3">00314</a> <span class="preprocessor">#define CTOR_IMPL_CAppContextImpl  \</span>
<a name="l00315"></a>00315 <span class="preprocessor">CAppContextImpl* CAppContextImpl::NewLC(ac_AppContext* ac, MAppContextInitObserver&amp; obs) \</span>
<a name="l00316"></a>00316 <span class="preprocessor">{ \</span>
<a name="l00317"></a>00317 <span class="preprocessor">  CAppContextImpl* obj = new (ELeave) CAppContextImpl(ac, obs); \</span>
<a name="l00318"></a>00318 <span class="preprocessor">  CleanupStack::PushL(obj); \</span>
<a name="l00319"></a>00319 <span class="preprocessor">  obj-&gt;ConstructL(); \</span>
<a name="l00320"></a>00320 <span class="preprocessor">  return obj; \</span>
<a name="l00321"></a>00321 <span class="preprocessor">} \</span>
<a name="l00322"></a>00322 <span class="preprocessor"> \</span>
<a name="l00323"></a>00323 <span class="preprocessor">CAppContextImpl* CAppContextImpl::NewL(ac_AppContext* ac, MAppContextInitObserver&amp; obs) \</span>
<a name="l00324"></a>00324 <span class="preprocessor">{ \</span>
<a name="l00325"></a>00325 <span class="preprocessor">  CAppContextImpl* obj = CAppContextImpl::NewLC(ac, obs); \</span>
<a name="l00326"></a>00326 <span class="preprocessor">  CleanupStack::Pop(obj); \</span>
<a name="l00327"></a>00327 <span class="preprocessor">  return obj; \</span>
<a name="l00328"></a>00328 <span class="preprocessor">} \</span>
<a name="l00329"></a>00329 <span class="preprocessor"> \</span>
<a name="l00330"></a>00330 <span class="preprocessor">CAppContextImpl::CAppContextImpl(ac_AppContext* ac, MAppContextInitObserver&amp; obs) : iCtx(ac), iObs(obs) \</span>
<a name="l00331"></a>00331 <span class="preprocessor">{}</span>
<a name="l00332"></a>00332 <span class="preprocessor"></span><span class="comment">/***end***/</span>
<a name="l00333"></a>00333 
<a name="l00334"></a><a class="code" href="classCAppContextImpl.html">00334</a> NONSHARABLE_CLASS(<a class="code" href="classCAppContextImpl.html">CAppContextImpl</a>) : 
<a name="l00335"></a>00335   public <a class="code" href="classCBase.html">CBase</a>,
<a name="l00336"></a>00336   public <a class="code" href="classMGetterObs__BatteryInfo.html">MGetterObs_BatteryInfo</a>,
<a name="l00337"></a>00337   public <a class="code" href="classMGetterObs__FlightMode.html">MGetterObs_FlightMode</a>
<a name="l00338"></a>00338 {
<a name="l00339"></a><a class="code" href="classCAppContextImpl.html#a4738c273a83aba7320c48204937f16cc">00339</a>   <a class="code" href="ac__app__context__epoc_8cpp.html#afff6726921224973000c1123e2d49d62">CTOR_DECL_CAppContextImpl</a>;
<a name="l00340"></a>00340 
<a name="l00341"></a>00341  <span class="keyword">public</span>:
<a name="l00342"></a>00342   ~<a class="code" href="classCAppContextImpl.html">CAppContextImpl</a>();
<a name="l00343"></a>00343 
<a name="l00344"></a>00344  <span class="keyword">public</span>:
<a name="l00345"></a><a class="code" href="classCAppContextImpl.html#a69a1b0c8486ad1d1d84b40b6fb38761a">00345</a>   <a class="code" href="struct__ac__AppContext.html">ac_AppContext</a>* iCtx;
<a name="l00346"></a>00346 
<a name="l00347"></a>00347   <span class="comment">// The observer is notified of the completion of any asynchronous</span>
<a name="l00348"></a>00348   <span class="comment">// initialization.</span>
<a name="l00349"></a><a class="code" href="classCAppContextImpl.html#af0cdb8ff9fe8bdf983b2cc2f43c11b55">00349</a>   MAppContextInitObserver&amp; iObs;
<a name="l00350"></a>00350 
<a name="l00351"></a>00351  <span class="keyword">public</span>: <span class="comment">// internally public</span>
<a name="l00352"></a>00352   <a class="code" href="epoc-session_8hpp.html#a0de103da976bd701364cc09ce169e008">DEF_SESSION</a>(RFs, iFs);
<a name="l00353"></a>00353 
<a name="l00354"></a><a class="code" href="classCAppContextImpl.html#adbf9d47578649a2e7ed4cffaee01f788">00354</a>   CTelephony* <a class="code" href="epoc-indicator_8cpp.html#a23d4edd9d60b296b1290f2da2d64eede">iTelephony</a>;
<a name="l00355"></a>00355 
<a name="l00356"></a>00356 <span class="preprocessor">#if __NEED_CONTACT_DATABASE__</span>
<a name="l00357"></a>00357 <span class="preprocessor"></span>  CContactDatabase* iContactDatabase;
<a name="l00358"></a>00358 <span class="preprocessor">#endif</span>
<a name="l00359"></a>00359 <span class="preprocessor"></span>
<a name="l00360"></a><a class="code" href="classCAppContextImpl.html#ab37068d20c1bb682f6250b5cb124805c">00360</a>   <a class="code" href="structTPlatformVersion.html">TPlatformVersion</a> iPlatformVersion;
<a name="l00361"></a>00361 
<a name="l00362"></a>00362  <span class="keyword">private</span>:
<a name="l00363"></a><a class="code" href="classCAppContextImpl.html#af2eb480ed3e0efc754b4bc9d86b155c5">00363</a>   <a class="code" href="classCBatteryObserver.html">CBatteryObserver</a>* iBatteryObserver;
<a name="l00364"></a><a class="code" href="classCAppContextImpl.html#ac23c00ed394ff234c9b2ed5d0739ec97">00364</a>   <a class="code" href="classCFlightModeObserver.html">CFlightModeObserver</a>* iFlightModeObserver;
<a name="l00365"></a>00365 
<a name="l00366"></a>00366  <span class="keyword">private</span>: <span class="comment">// MGetterObs_BatteryInfo</span>
<a name="l00367"></a>00367   <span class="keyword">virtual</span> <span class="keywordtype">void</span> GotData_BatteryInfo(TInt aError);
<a name="l00368"></a>00368  <span class="keyword">private</span>: <span class="comment">// MGetterObs_FlightMode</span>
<a name="l00369"></a>00369   <span class="keyword">virtual</span> <span class="keywordtype">void</span> GotData_FlightMode(TInt aError);
<a name="l00370"></a>00370 
<a name="l00371"></a>00371  <span class="keyword">private</span>:
<a name="l00372"></a><a class="code" href="classCAppContextImpl.html#a5b4d9e807d952d20d80fb7b75b73c42c">00372</a>   TBool iHaveBattery;
<a name="l00373"></a><a class="code" href="classCAppContextImpl.html#a41419833774e1eb96813586ae60bb28d">00373</a>   TBool iHaveFlightMode;
<a name="l00374"></a>00374   <span class="keywordtype">void</span> GotMoreInfo();
<a name="l00375"></a>00375 };
<a name="l00376"></a>00376 
<a name="l00377"></a><a class="code" href="ac__app__context__epoc_8cpp.html#aa05c085bbcf90a18c6b44a84aea9839b">00377</a> <a class="code" href="ac__app__context__epoc_8cpp.html#a83d8b69826cc96c1936faf5d923b63f3">CTOR_IMPL_CAppContextImpl</a>;
<a name="l00378"></a>00378 
<a name="l00379"></a><a class="code" href="classCAppContextImpl.html#a2a6430ec44f422b208daf37342d9f435">00379</a> <span class="keywordtype">void</span> <a class="code" href="classCAppContextImpl.html#a2a6430ec44f422b208daf37342d9f435">CAppContextImpl::GotMoreInfo</a>()
<a name="l00380"></a>00380 {
<a name="l00381"></a>00381   <span class="keywordflow">if</span> (<a class="code" href="classCAppContextImpl.html#a5b4d9e807d952d20d80fb7b75b73c42c">iHaveBattery</a> &amp;&amp; <a class="code" href="classCAppContextImpl.html#a41419833774e1eb96813586ae60bb28d">iHaveFlightMode</a>) {
<a name="l00382"></a>00382     <span class="comment">// We need no bookkeeping for as long as we are only waiting for</span>
<a name="l00383"></a>00383     <span class="comment">// this one reading before we are ready.</span>
<a name="l00384"></a>00384     <a class="code" href="classCAppContextImpl.html#af0cdb8ff9fe8bdf983b2cc2f43c11b55">iObs</a>.AppContextReady(0);
<a name="l00385"></a>00385   }
<a name="l00386"></a>00386 }
<a name="l00387"></a>00387 
<a name="l00388"></a><a class="code" href="classCAppContextImpl.html#aad1c4a61790a7922ebb3d925cbe09075">00388</a> <span class="keywordtype">void</span> <a class="code" href="classCAppContextImpl.html#aad1c4a61790a7922ebb3d925cbe09075">CAppContextImpl::GotData_BatteryInfo</a>(TInt aError)
<a name="l00389"></a>00389 {
<a name="l00390"></a>00390   (void)aError; <span class="comment">// do not care</span>
<a name="l00391"></a>00391   <a class="code" href="classCAppContextImpl.html#a5b4d9e807d952d20d80fb7b75b73c42c">iHaveBattery</a> = ETrue;
<a name="l00392"></a>00392   <a class="code" href="classCAppContextImpl.html#a2a6430ec44f422b208daf37342d9f435">GotMoreInfo</a>();
<a name="l00393"></a>00393 }
<a name="l00394"></a>00394 
<a name="l00395"></a><a class="code" href="classCAppContextImpl.html#ae72db1914ccbdf1dd5f0dae6b1383d13">00395</a> <span class="keywordtype">void</span> <a class="code" href="classCAppContextImpl.html#ae72db1914ccbdf1dd5f0dae6b1383d13">CAppContextImpl::GotData_FlightMode</a>(TInt aError)
<a name="l00396"></a>00396 {
<a name="l00397"></a>00397   (void)aError; <span class="comment">// no error, would have exited</span>
<a name="l00398"></a>00398   <a class="code" href="classCAppContextImpl.html#a41419833774e1eb96813586ae60bb28d">iHaveFlightMode</a> = ETrue;
<a name="l00399"></a>00399   <a class="code" href="classCAppContextImpl.html#a2a6430ec44f422b208daf37342d9f435">GotMoreInfo</a>();
<a name="l00400"></a>00400 }
<a name="l00401"></a>00401 
<a name="l00402"></a>00402 <span class="keywordtype">void</span> CAppContextImpl::ConstructL()
<a name="l00403"></a>00403 {
<a name="l00404"></a>00404   <a class="code" href="classCAppContextImpl.html#adbf9d47578649a2e7ed4cffaee01f788">iTelephony</a> = CTelephony::NewL();
<a name="l00405"></a>00405 
<a name="l00406"></a>00406   <a class="code" href="classCAppContextImpl.html#af2eb480ed3e0efc754b4bc9d86b155c5">iBatteryObserver</a> = CBatteryObserver::NewL(*<a class="code" href="classCAppContextImpl.html#adbf9d47578649a2e7ed4cffaee01f788">iTelephony</a>, *<span class="keyword">this</span>);
<a name="l00407"></a>00407 
<a name="l00408"></a>00408   <a class="code" href="classCAppContextImpl.html#ac23c00ed394ff234c9b2ed5d0739ec97">iFlightModeObserver</a> = CFlightModeObserver::NewL(*<a class="code" href="classCAppContextImpl.html#adbf9d47578649a2e7ed4cffaee01f788">iTelephony</a>, *<span class="keyword">this</span>);
<a name="l00409"></a>00409 
<a name="l00410"></a>00410   <a class="code" href="epoc-session_8hpp.html#af91065ea9f844797be3ef7ffea3df605">LEAVE_IF_ERROR_OR_SET_SESSION_OPEN</a>(iFs, iFs.Connect());
<a name="l00411"></a>00411 
<a name="l00412"></a>00412   <a class="code" href="epoc-s60-version_8cpp.html#a1826076c68facaa8651540fb5253c768">GetS60PlatformVersionL</a>(iFs, <a class="code" href="classCAppContextImpl.html#ab37068d20c1bb682f6250b5cb124805c">iPlatformVersion</a>);
<a name="l00413"></a>00413 
<a name="l00414"></a>00414 <span class="preprocessor">#if __NEED_CONTACT_DATABASE__</span>
<a name="l00415"></a>00415 <span class="preprocessor"></span>  iContactDatabase = CContactDatabase::OpenL();
<a name="l00416"></a>00416 <span class="preprocessor">#endif</span>
<a name="l00417"></a>00417 <span class="preprocessor"></span>}
<a name="l00418"></a>00418 
<a name="l00419"></a><a class="code" href="classCAppContextImpl.html#ad213158fa24ac240d485bc65ecc55c16">00419</a> <a class="code" href="classCAppContextImpl.html#ad213158fa24ac240d485bc65ecc55c16">CAppContextImpl::~CAppContextImpl</a>()
<a name="l00420"></a>00420 {
<a name="l00421"></a>00421   <span class="keyword">delete</span> <a class="code" href="classCAppContextImpl.html#ac23c00ed394ff234c9b2ed5d0739ec97">iFlightModeObserver</a>;
<a name="l00422"></a>00422   <span class="keyword">delete</span> <a class="code" href="classCAppContextImpl.html#af2eb480ed3e0efc754b4bc9d86b155c5">iBatteryObserver</a>;
<a name="l00423"></a>00423 <span class="preprocessor">#if __NEED_CONTACT_DATABASE__</span>
<a name="l00424"></a>00424 <span class="preprocessor"></span>  <span class="keyword">delete</span> iContactDatabase;
<a name="l00425"></a>00425 <span class="preprocessor">#endif</span>
<a name="l00426"></a>00426 <span class="preprocessor"></span>  <span class="keyword">delete</span> <a class="code" href="classCAppContextImpl.html#adbf9d47578649a2e7ed4cffaee01f788">iTelephony</a>;
<a name="l00427"></a>00427   <a class="code" href="epoc-session_8hpp.html#aa1bfce1abc3e149622ce1432e42f1abe">SESSION_CLOSE_IF_OPEN</a>(iFs);
<a name="l00428"></a>00428 }
<a name="l00429"></a>00429 
<a name="l00430"></a>00430 <span class="comment">// --------------------------------------------------</span>
<a name="l00431"></a>00431 <span class="comment">// interface</span>
<a name="l00432"></a>00432 <span class="comment">// --------------------------------------------------</span>
<a name="l00433"></a>00433 
<a name="l00434"></a>00434 CAppContext* CAppContext::NewL(<a class="code" href="struct__ac__AppContext.html">ac_AppContext</a>* ac,
<a name="l00435"></a>00435              MAppContextInitObserver&amp; obs)
<a name="l00436"></a>00436 {
<a name="l00437"></a>00437   <a class="code" href="classCAppContextImpl.html">CAppContextImpl</a>* impl = CAppContextImpl::NewL(ac, obs);
<a name="l00438"></a>00438   CleanupStack::PushL(impl);
<a name="l00439"></a>00439   CAppContext* obj = <span class="keyword">new</span> (ELeave) CAppContext;
<a name="l00440"></a>00440   obj-&gt;iImpl = impl;
<a name="l00441"></a>00441   CleanupStack::Pop();
<a name="l00442"></a>00442   <span class="keywordflow">return</span> obj;
<a name="l00443"></a>00443 }
<a name="l00444"></a>00444 
<a name="l00445"></a>00445 CAppContext::~CAppContext()
<a name="l00446"></a>00446 {
<a name="l00447"></a>00447   <span class="keyword">delete</span> iImpl;
<a name="l00448"></a>00448 }
<a name="l00449"></a>00449 <span class="comment"></span>
<a name="l00450"></a>00450 <span class="comment">/**</span>
<a name="l00451"></a>00451 <span class="comment"></span>
<a name="l00452"></a>00452 <span class="comment">Copyright 2010 Helsinki Institute for Information Technology (HIIT)</span>
<a name="l00453"></a>00453 <span class="comment">and the authors. All rights reserved.</span>
<a name="l00454"></a>00454 <span class="comment"></span>
<a name="l00455"></a>00455 <span class="comment">Authors: Tero Hasu &lt;tero.hasu@hut.fi&gt;</span>
<a name="l00456"></a>00456 <span class="comment"></span>
<a name="l00457"></a>00457 <span class="comment">Permission is hereby granted, free of charge, to any person</span>
<a name="l00458"></a>00458 <span class="comment">obtaining a copy of this software and associated documentation files</span>
<a name="l00459"></a>00459 <span class="comment">(the &quot;Software&quot;), to deal in the Software without restriction,</span>
<a name="l00460"></a>00460 <span class="comment">including without limitation the rights to use, copy, modify, merge,</span>
<a name="l00461"></a>00461 <span class="comment">publish, distribute, sublicense, and/or sell copies of the Software,</span>
<a name="l00462"></a>00462 <span class="comment">and to permit persons to whom the Software is furnished to do so,</span>
<a name="l00463"></a>00463 <span class="comment">subject to the following conditions:</span>
<a name="l00464"></a>00464 <span class="comment"></span>
<a name="l00465"></a>00465 <span class="comment">The above copyright notice and this permission notice shall be</span>
<a name="l00466"></a>00466 <span class="comment">included in all copies or substantial portions of the Software.</span>
<a name="l00467"></a>00467 <span class="comment"></span>
<a name="l00468"></a>00468 <span class="comment">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,</span>
<a name="l00469"></a>00469 <span class="comment">EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF</span>
<a name="l00470"></a>00470 <span class="comment">MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND</span>
<a name="l00471"></a>00471 <span class="comment">NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS</span>
<a name="l00472"></a>00472 <span class="comment">BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN</span>
<a name="l00473"></a>00473 <span class="comment">ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN</span>
<a name="l00474"></a>00474 <span class="comment">CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span>
<a name="l00475"></a>00475 <span class="comment">SOFTWARE.</span>
<a name="l00476"></a>00476 <span class="comment"></span>
<a name="l00477"></a>00477 <span class="comment"> **/</span>
</pre></div></div>
<hr size="1">

<p style="text-align: right;">
  <a href="http://www.contextlogger.org/">ContextLogger2</a>&#8212;ContextLogger2 Logger Daemon Internals&#8212;<small>Generated on Mon May 2 13:49:51 2011 by&nbsp;<a href="http://www.doxygen.org/">Doxygen</a> 1.6.1</small>
</p>

</body>
</html>
